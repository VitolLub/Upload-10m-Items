var ChromePlatformAnalytics=function(){var n,e,t=function(){chrome.runtime.onMessage.addListener((function(n,e,t){"object"==typeof n&&("cpa.sendAppView"===n.cmd?a(n.data):"cpa.sendEvent"===n.cmd?c(n.data):"cpa.toggle"===n.cmd&&i(n.data))}))},a=function(n){e.sendAppView(n)},c=function(n){e.sendEvent.apply(e,n)},i=function(e){n.getConfig().addCallback((function(n){n.setTrackingPermitted(!!e)}))};return{init:function(a,c){t(),n=analytics.getService(a),e=n.getTracker(c)},sendAppView:a,sendEvent:c,toggle:i}}();
var TaskManager=function(){var n=!1,t=[],u=1e3,i=function(){},f=null,a=function(t){f=setInterval((function(){n||e()}),t)},e=function(){if(t[0]){var n=t.shift().task;"function"==typeof n&&n()}else"function"==typeof i&&i()};return{init:function(n){u=n.interval,n.onEnd&&(i=n.onEnd),e(),a(u)},updateInterval:function(n){f&&clearInterval(f),a(n)},push:function(n,u){t[t.length-1];t.push({tabId:n,task:u})},unshift:function(n,u){t.unshift({tabId:n,task:u})},stop:function(){t=[],f&&clearInterval(f)},pause:function(){n=!0},unpause:function(){n=!1},filter:function(n){t=t.filter(n)}}}();
var App=function(){var e=!1,t=!1,a={showExtInfo:!0,showPopupByKeypress:!1,showTopRight:!1,hideSubrank:!0,hidePremium:!1,tmInterval:200},n={},o=!1,r=function(){void 0===localStorage.ab&&(localStorage.ab=Math.ceil(100*Math.random()))},s=function(e){for(var t in e)a[t]=e[t];localStorage.settings=JSON.stringify(a),d()},i=function(e,t){var a="img/off38.png";e&&(a="img/on38.png",t&&(a="img/on38dot.png")),chrome.browserAction.setIcon({path:a})},l=function(){chrome.runtime.onMessage.addListener((function(r,l,c){var u,m=r.cmd,v=r.data,S=(l.tab||{}).id;if("app.get_state"===m)c({state:e,settings:a});else if("app.set_state"===m)u=v.state,e=!!u,localStorage.enabled=e,i(e,!t),d();else if("ab.get"===m)c(parseInt(localStorage.ab));else if("settings.set"===m)!function(e){e.tmInterval&&e.tmInterval!==a.tmInterval&&TaskManager.updateInterval(e.tmInterval)}(v),s(v);else if("new_tab"===m)chrome.tabs.create({url:v});else{if("add_ajax_task"===m){var h=v.url;n[h]=!0;var b=v.priority;return f(S,h,b,c),!0}if("clear_tasks"===m)g(S);else if("tab.unloaded"===m)g(S),o===S&&(o=!1,TaskManager.unpause());else if("captcha.prompt"===m){if(TaskManager.pause(),o)return;o=S,chrome.tabs.update(S,{active:!0})}else if("captcha.resolved"===m)o&&chrome.tabs.sendMessage(o,{cmd:"captcha.resolve"}),o=!1,tmpCap=!1,TaskManager.unpause();else if("tm.pause"===m)TaskManager.pause();else if("tm.unpause"===m)TaskManager.unpause();else if("notifications.get"===m){if(!e||Session.getVisit()<3)return void c(!1);for(var w=v,I={},T=0,k=w.length;T<k;T++){var M=w[T],y=localStorage["notification"+M];I[M]=y||!1}c(I)}else if("notifications.later"===m){var q="notification"+v.id;localStorage[q]=Date.now()}else if("notifications.dismiss"===m){q="notification"+v.id;localStorage[q]=!0}else if("userdata.set"===m)for(var q in v)localStorage["userdata."+q]=v[q];else"clipboard.copy"===m?p(v):"discounts.seen"===m&&(localStorage.discountsSeen=!0,i(e,!1))}}))},c=function(){chrome.webRequest.onBeforeSendHeaders.addListener((function(e){if(n[e.url]||n[e.requestId])return n[e.url]?(delete n[e.url],n[e.requestId]=!0):n[e.requestId]&&delete n[e.requestId],e.requestHeaders.forEach((function(e){"cookie"===e.name.toLowerCase()&&(e.value=u(e.value))})),{requestHeaders:e.requestHeaders}}),{urls:["*://www.amazon.com/gp/aw/d/*","*://www.amazon.com/*ref=redir_mobile_desktop*"]},["blocking","requestHeaders"])},u=function(e){return-1!==e.indexOf("streamlined=")?e.replace(/streamlined=\w+/g,"streamlined=true"):[e,"streamlined=true"].join("; ")},d=function(){chrome.tabs.query({},(function(t){for(var n=0,o=t.length;n<o;n++)chrome.tabs.sendMessage(t[n].id,{cmd:"app.update_state",data:{state:e,settings:a}},(function(e){}))}))},f=function(e,t,a,n){TaskManager[a?"unshift":"push"](e,(function(){m(t,n)}))},g=function(e){TaskManager.filter((function(t){return t.tabId!==e}))},m=function(e,t){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){var e=a.responseText;t&&t({error:!1,data:e})}else t&&t({error:!0,status:a.status,statusText:a.statusText})},a.open("GET",e),a.send()},p=function(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.focus(),t.select(),document.execCommand("Copy",!1,null),document.body.removeChild(t)};return{init:function(){r(),e=void 0===localStorage.enabled||"true"===localStorage.enabled,t=void 0!==localStorage.discountsSeen&&"true"===localStorage.discountsSeen,ChromePlatformAnalytics.init("dsaqv","UA-56097614-8"),ChromePlatformAnalytics.sendEvent(["state",e?"enabled":"disabled"]),localStorage.settings&&(a=JSON.parse(localStorage.settings)),a.tmInterval||(a.tmInterval=200),i(e,!t),l(),c(),TaskManager.init({interval:a.tmInterval}),Session.init()}}}(),Session=function(){var e=1,t=Date.now(),a=function(){localStorage.visit=e,localStorage.visitTimestamp=t};return{init:function(){localStorage.visit&&(e=parseInt(localStorage.visit),t=parseInt(localStorage.visitTimestamp)||Date.now()),a()},getVisit:function(){return Date.now()-t>432e5&&(t=Date.now(),e++,a()),e}}}();App.init();