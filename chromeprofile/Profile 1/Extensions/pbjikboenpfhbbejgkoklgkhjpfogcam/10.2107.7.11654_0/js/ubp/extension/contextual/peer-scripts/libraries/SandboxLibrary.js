var SandboxLibrary;
(function (SandboxLibrary) {
    var Sandboxer = (function () {
        function Sandboxer(extensionMessageProxy) {
            this.sandboxMessagePrefix = "UBPSandboxer";
            this.sandboxManager = new SandboxLibrary.SandboxManager({
                strategy: new SandboxLibrary.IFrameCreationStrategy(),
                forwardMessageFunction: extensionMessageProxy,
                whitelistedOrigins: {}
            });
        }
        Sandboxer.prototype.sandboxMessageHandler = function (msg) {
            this.sandboxManager.sandboxMessageHandler(msg);
        };
        Sandboxer.prototype.handle = function (requestType, args) {
            if (!args) {
                throw new Error("Must provide arguments to Sandbox API's");
            }
            switch (requestType) {
                case this.sandboxMessagePrefix.concat("CreateSandbox"):
                    if (args.tabId && args.sandboxSpecification) {
                        return this.sandboxManager.createSandbox(args.tabId, args.sandboxSpecification);
                    }
                    break;
                case this.sandboxMessagePrefix.concat("CreateSandboxById"):
                    if (args.tabId && args.sandboxSpecification) {
                        return this.sandboxManager.createSandboxById(args.tabId, args.sandboxSpecification);
                    }
                    break;
                case this.sandboxMessagePrefix.concat("CreateSandboxByIdPost"):
                    if (args.tabId && args.sandboxSpecification) {
                        return this.sandboxManager.createSandboxByIdPost(args.tabId, args.sandboxSpecification);
                    }
                    break;
                case this.sandboxMessagePrefix.concat("ModifySandbox"):
                    if (args.sandboxId && args.sandboxCSSSpecification) {
                        return this.sandboxManager.modifySandbox(args.sandboxId, args.sandboxCSSSpecification);
                    }
                    break;
                case this.sandboxMessagePrefix.concat("ShowSandbox"):
                    if (args.sandboxId && args.sandboxCSSSpecification) {
                        return this.sandboxManager.showSandbox(args.sandboxId, args.sandboxCSSSpecification, args.pageStyleSpecification);
                    }
                    break;
                case this.sandboxMessagePrefix.concat("DestroySandbox"):
                    if (args.sandboxId) {
                        return this.sandboxManager.destroySandbox(args.sandboxId);
                    }
                    break;
                case this.sandboxMessagePrefix.concat("AddWhitelistedOrigin"):
                    if (args.origin) {
                        return this.sandboxManager.addWhitelistedOrigin(args.origin);
                    }
                    break;
                case this.sandboxMessagePrefix.concat("SendMessageToSandbox"):
                    if (args.sandboxId && args.message) {
                        return this.sandboxManager.sendMessageToSandbox(args.sandboxId, args.message);
                    }
                    break;
                case this.sandboxMessagePrefix.concat("InstrumentSandbox"):
                    if (args.tabId && args.sandboxSelector && args.message) {
                        return this.sandboxManager.instrumentSandbox(args.tabId, args.sandboxSelector, args.message);
                    }
                    break;
                case this.sandboxMessagePrefix.concat("GetSandboxAttribute"):
                    if (args.tabId && args.sandboxSelector && args.message) {
                        return this.sandboxManager.getSandboxAttribute(args.tabId, args.sandboxSelector, args.message);
                    }
                    break;
                default:
                    throw new Error("Invalid request type: " + requestType);
            }
            throw new Error("Invalid args for sandbox message: " + requestType);
        };
        Sandboxer.prototype.canHandle = function (requestType) {
            switch (requestType) {
                case this.sandboxMessagePrefix.concat("CreateSandbox"):
                case this.sandboxMessagePrefix.concat("CreateSandboxById"):
                case this.sandboxMessagePrefix.concat("CreateSandboxByIdPost"):
                case this.sandboxMessagePrefix.concat("ModifySandbox"):
                case this.sandboxMessagePrefix.concat("ShowSandbox"):
                case this.sandboxMessagePrefix.concat("DestroySandbox"):
                case this.sandboxMessagePrefix.concat("AddWhitelistedOrigin"):
                case this.sandboxMessagePrefix.concat("SendMessageToSandbox"):
                case this.sandboxMessagePrefix.concat("InstrumentSandbox"):
                case this.sandboxMessagePrefix.concat("GetSandboxAttribute"):
                    return true;
                default:
                    return false;
            }
        };
        return Sandboxer;
    }());
    SandboxLibrary.Sandboxer = Sandboxer;
    var SandboxManager = (function () {
        function SandboxManager(args) {
            this.instanceId = randomInteger();
            this.pendingSandboxes = {};
            this.establishedSandboxes = {};
            if (args.strategy) {
                this.strategy = args.strategy;
            }
            else {
                throw new Error("SandboxManager requires a notification creation strategy");
            }
            this.forwardMessageFunction = args.forwardMessageFunction || function () {
            };
            this.whitelistedOrigins = args.whitelistedOrigins || {};
        }
        SandboxManager.prototype.sandboxMessageHandler = function (msg) {
            if (!this._isRelevantMessage(msg)) {
                return;
            }
            msg = msg;
            if (this._isHandshakeMessage(msg)) {
                this._handleHandshake(msg);
            }
            else {
                this._handleMessage(msg);
            }
        };
        SandboxManager.prototype.createSandbox = function (tabId, sandboxSpec) {
            var targetUrl = sandboxSpec.url, proxyUrl = sandboxSpec.proxy, cssSpec = sandboxSpec.sandboxCSSSpecification;
            if (!(targetUrl && proxyUrl)) {
                throw new Error("Must provide both proxy and target url to createSandbox");
            }
            var handle = this._generateSandboxHandle();
            if (targetUrl.match(/[&\?]ubpSandboxHandle=/)) {
                throw new Error("target URL already contains a reserved query string key: ubpSandboxHandle");
            }
            targetUrl = appendQueryParams(targetUrl, {
                "ubpSandboxHandle": "1"
            });
            if (proxyUrl.match(/[&\?]target=/)) {
                throw new Error("proxy URL already contains a reserved query string key: target");
            }
            proxyUrl = appendQueryParams(proxyUrl, {
                "ubpSandboxHandle": handle,
                "target": targetUrl
            });
            this.strategy.createSandbox(tabId, handle, proxyUrl, cssSpec);
            this.pendingSandboxes[handle] = true;
            var origin = this.strategy.grokOrigin(proxyUrl);
            if (origin) {
                this.addWhitelistedOrigin(origin);
            }
            return handle;
        };
        SandboxManager.prototype.createSandboxById = function (tabId, sandboxSpec) {
            var targetUrl = sandboxSpec.url, proxyUrl = sandboxSpec.proxy, sandboxId = sandboxSpec.sandboxId, cssSpec = sandboxSpec.sandboxCSSSpecification;
            if (!(targetUrl && proxyUrl)) {
                throw new Error("Must provide both proxy and target url to createSandbox");
            }
            if (!sandboxId) {
                throw new Error("Must provide sandbox Id to createSandbox");
            }
            var sandbox = this.strategy._sandboxInMemoryStorage.retrieveSandboxBySandboxId(sandboxId);
            if (sandbox) {
                return sandboxId;
            }
            if (targetUrl.match(/[&\?]ubpSandboxHandle=/)) {
                throw new Error("target URL already contains a reserved query string key: ubpSandboxHandle");
            }
            targetUrl = appendQueryParams(targetUrl, {
                "ubpSandboxHandle": "1"
            });
            if (proxyUrl.match(/[&\?]target=/)) {
                throw new Error("proxy URL already contains a reserved query string key: target");
            }
            proxyUrl = appendQueryParams(proxyUrl, {
                "ubpSandboxHandle": sandboxId,
                "target": targetUrl
            });
            this.strategy.createSandbox(tabId, sandboxId, proxyUrl, cssSpec);
            this.pendingSandboxes[sandboxId] = true;
            var origin = this.strategy.grokOrigin(proxyUrl);
            if (origin) {
                this.addWhitelistedOrigin(origin);
            }
            return sandboxId;
        };
        SandboxManager.prototype.createSandboxByIdPost = function (tabId, sandboxSpec) {
            var target = sandboxSpec.url, jsonMsg = sandboxSpec.jsonMsg, proxyUrl = sandboxSpec.proxy, sandboxId = sandboxSpec.sandboxId, cssSpec = sandboxSpec.sandboxCSSSpecification;
            if (!(target && jsonMsg && proxyUrl)) {
                throw new Error("Must provide proxy, target url and jsonMsg to createSandbox");
            }
            if (!sandboxId) {
                throw new Error("Must provide sandbox Id to createSandbox");
            }
            var sandbox = this.strategy._sandboxInMemoryStorage.retrieveSandboxBySandboxId(sandboxId);
            if (sandbox) {
                return sandboxId;
            }
            if (proxyUrl.match(/[&\?]target=/)) {
                throw new Error("proxy URL already contains a reserved query string key: target");
            }
            proxyUrl = appendQueryParams(proxyUrl, {
                "ubpSandboxHandle": sandboxId,
                "target": target,
                "jsonMsg": jsonMsg
            });
            this.strategy.createSandbox(tabId, sandboxId, proxyUrl, cssSpec);
            this.pendingSandboxes[sandboxId] = true;
            var origin = this.strategy.grokOrigin(proxyUrl);
            if (origin) {
                this.addWhitelistedOrigin(origin);
            }
            return sandboxId;
        };
        SandboxManager.prototype.modifySandbox = function (handle, sandboxCSSSpecification) {
            this.strategy.modifySandbox(handle, sandboxCSSSpecification);
        };
        SandboxManager.prototype.showSandbox = function (handle, sandboxCSSSpecification, pageStyleSpecification) {
            this.strategy.showSandbox(handle, sandboxCSSSpecification, pageStyleSpecification);
        };
        SandboxManager.prototype.destroySandbox = function (handle) {
            delete this.pendingSandboxes[handle];
            delete this.establishedSandboxes[handle];
            this.strategy.destroySandbox(handle);
        };
        SandboxManager.prototype.addWhitelistedOrigin = function (origin) {
            this.whitelistedOrigins[origin] = origin;
        };
        SandboxManager.prototype.sendMessageToSandbox = function (handle, message) {
            this.strategy.sendMessageToSandbox(handle, message);
        };
        SandboxManager.prototype.instrumentSandbox = function (tabId, sandboxSelector, message) {
            return this.strategy.instrumentSandbox(tabId, sandboxSelector, message);
        };
        SandboxManager.prototype.getSandboxAttribute = function (tabId, sandboxSelector, message) {
            return this.strategy.getSandboxAttribute(tabId, sandboxSelector, message);
        };
        SandboxManager.prototype._handleMessage = function (msg) {
            if (msg.data && msg.data.mType === "InstrumentMessage") {
                if (typeof SandboxLibrary.instrumentMessages[msg.data['instrumentMessageId']] === "function") {
                    SandboxLibrary.instrumentMessages[msg.data['instrumentMessageId']](msg.data['data']);
                    delete SandboxLibrary.instrumentMessages[msg.data['instrumentMessageId']];
                }
            }
            else {
                this.forwardMessageFunction(msg.data);
            }
        };
        SandboxManager.prototype._handleHandshake = function (msg) {
            var handle = msg.data.handle;
            this.establishedSandboxes[handle] = msg.source;
            delete this.pendingSandboxes[handle];
        };
        SandboxManager.prototype._isValidOrigin = function (origin) {
            return !!this.whitelistedOrigins[origin];
        };
        SandboxManager.prototype._isRelevantMessage = function (msg) {
            return !!(msg &&
                msg.source &&
                msg.data &&
                msg.data.mType &&
                msg.data.handle &&
                this._isValidOrigin(this.strategy.grokOrigin(msg.origin)));
        };
        SandboxManager.prototype._isHandshakeMessage = function (msg) {
            return msg.data.mType === SandboxManager.SANDBOX_HANDSHAKE;
        };
        SandboxManager.prototype._generateSandboxHandle = function () {
            return SandboxManager.SANDBOX_PREFIX +
                "_iid=" + this.instanceId +
                "_sid=" + randomInteger() +
                "_time=" + Date.now();
        };
        SandboxManager.SANDBOX_HANDSHAKE = "UBPSandboxHandshake";
        SandboxManager.SANDBOX_PREFIX = "UBPNotif";
        return SandboxManager;
    }());
    SandboxLibrary.SandboxManager = SandboxManager;
    var IFrameCreationStrategy = (function () {
        function IFrameCreationStrategy() {
            this._defaultCSSRules = {
                "background": "transparent",
                "border": "0",
                "box-shadow": "none",
                "display": "block",
                "height": "0px",
                "left": "0",
                "overflow-x": "visible",
                "overflow-y": "visible",
                "padding": "0",
                "position": "absolute",
                "right": "auto",
                "top": "0",
                "width": "0px",
                "z-index": "99999"
            };
            this._sandboxInMemoryStorage = new SandboxInMemoryStorage();
        }
        IFrameCreationStrategy.prototype.grokOrigin = function (url) {
            var a = document.createElement("a");
            a.href = url;
            return (a.protocol + "//" + a.host).toLowerCase();
        };
        IFrameCreationStrategy.prototype.createSandbox = function (tabId, sandboxId, proxyUrl, cssSpec) {
            var selectorToUse = IFrameCreationStrategy.SELECTORS_TO_QUERY[Math.floor(Math.random() * IFrameCreationStrategy.SELECTORS_TO_QUERY.length)];
            var originalNodesOnPage = document.querySelectorAll(selectorToUse);
            if (!originalNodesOnPage || originalNodesOnPage.length === 0) {
                var elementTagToUse = IFrameCreationStrategy.ELEMENT_TO_CREATE_AS_FALLBACK[Math.floor(Math.random() * IFrameCreationStrategy.ELEMENT_TO_CREATE_AS_FALLBACK.length)];
                var newNodeToInsert = document.createElement(elementTagToUse);
                this._attachShadowDOMAndAppendToBody(newNodeToInsert, tabId, sandboxId, proxyUrl, cssSpec);
                return;
            }
            var randomNumber = Math.floor(Math.random() * originalNodesOnPage.length);
            var originalNode = originalNodesOnPage[randomNumber];
            var cloneElementToAttachTo = this._createAndSanitizeCloneElement(originalNode);
            this._attachShadowDOMAndAppendToBody(cloneElementToAttachTo, tabId, sandboxId, proxyUrl, cssSpec);
        };
        IFrameCreationStrategy.prototype._createAndSanitizeCloneElement = function (originalNode) {
            var cloneElement = originalNode.cloneNode(true);
            cloneElement.removeAttribute("id");
            cloneElement.removeAttribute("class");
            cloneElement.removeAttribute("style");
            cloneElement.removeAttribute("hidden");
            for (var i = 0; i < cloneElement.attributes.length; i++) {
                cloneElement.removeAttribute(cloneElement.attributes[i].name);
            }
            var childrenWithIds = cloneElement.querySelectorAll("[id]");
            for (var i = 0; i < childrenWithIds.length; i++) {
                childrenWithIds[i].removeAttribute("id");
            }
            return cloneElement;
        };
        IFrameCreationStrategy.prototype._generateRandomClassName = function () {
            var className = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0;
                var v = (c == 'x' ? r : (r & 0x3 | 0x8));
                return v.toString(16);
            });
            className = window.btoa(className);
            if (className.length >= 15) {
                className = className.substring(0, Math.floor(Math.random() * Math.min(11, (className.length - 4))) + 4);
            }
            return className;
        };
        IFrameCreationStrategy.prototype._attachShadowDOMAndAppendToBody = function (elementToAttachShadow, tabId, sandboxId, proxyUrl, cssSpec) {
            try {
                elementToAttachShadow.setAttribute("class", this._generateRandomClassName());
                var shadowRoot = elementToAttachShadow.attachShadow({ mode: "closed" });
                shadowRoot._hostElementOfShadowRoot = elementToAttachShadow;
                var sandbox = document.createElement("iframe");
                sandbox.style.cssText = this._buildCssString(this._defaultCSSRules).concat(this._buildCssString(cssSpec));
                sandbox.src = proxyUrl;
                sandbox.setAttribute("id", sandboxId);
                shadowRoot.appendChild(sandbox);
                document.body.appendChild(elementToAttachShadow);
                this._sandboxInMemoryStorage.storeShadowRoot(shadowRoot, tabId, sandboxId, proxyUrl);
            }
            catch (err) {
                throw new Error("Error occurred while attaching shadow: " + err.toString());
            }
        };
        IFrameCreationStrategy.prototype.modifySandbox = function (sandboxId, cssSpec) {
            var sandbox = this._sandboxInMemoryStorage.retrieveSandboxBySandboxId(sandboxId);
            if (!sandbox) {
                throw new Error("Cannot modify sandbox; wasn't found");
            }
            sandbox.style.cssText += this._buildCssString(cssSpec);
        };
        IFrameCreationStrategy.prototype.showSandbox = function (sandboxId, cssSpec, pageStyleSpecification) {
            var sandbox = this._sandboxInMemoryStorage.retrieveSandboxBySandboxId(sandboxId);
            if (!sandbox) {
                throw new Error("Cannot show sandbox; wasn't found");
            }
            if (pageStyleSpecification &&
                pageStyleSpecification.elementCssSelector &&
                pageStyleSpecification.inlineCss &&
                pageStyleSpecification.styleHandle) {
                var element = this._getParentPageElement(pageStyleSpecification.elementCssSelector);
                if (!element.dataset["ubpOldStyle"]) {
                    element.dataset["ubpOldStyle"] = element.getAttribute("style") || "-custom-noop: noop;";
                }
                element.dataset["ubpStyleHandle"] = pageStyleSpecification.styleHandle;
                var styleToSet = null;
                if (element.dataset["ubpOldStyle"]) {
                    styleToSet = [element.dataset["ubpOldStyle"], pageStyleSpecification.inlineCss].join("; ") + "; ";
                }
                else {
                    styleToSet = pageStyleSpecification.inlineCss + "; ";
                }
                element.setAttribute("style", styleToSet);
            }
            if (pageStyleSpecification) {
                var cssRules = pageStyleSpecification.styleSheetCSSRules || [];
                if (!!pageStyleSpecification.styleSheetCSSRule) {
                    cssRules.push(pageStyleSpecification.styleSheetCSSRule);
                }
                if (cssRules.length > 0) {
                    this._applyStyleSheetCSSRule(sandboxId, cssRules);
                }
            }
            sandbox.style.cssText += this._buildCssString(cssSpec);
        };
        IFrameCreationStrategy.prototype.sendMessageToSandbox = function (sandboxId, message) {
            var sandbox = this._sandboxInMemoryStorage.retrieveSandboxBySandboxId(sandboxId);
            if (!sandbox || !sandbox.contentWindow) {
                throw new Error("Cannot send message to sandbox; Sandbox with id: '" + sandboxId + "' is not valid");
            }
            try {
                sandbox.contentWindow.postMessage(message, "*");
            }
            catch (e) {
                var error = new Error("Error while sending message to sandbox: " + e);
                throw error;
            }
        };
        IFrameCreationStrategy.prototype.instrumentSandbox = function (tabId, sandBoxSelector, message) {
            var element = (this._sandboxInMemoryStorage.retrieveSandboxByTabIdSandboxSelector(tabId, sandBoxSelector));
            if (!element) {
                throw new Error("instrumentSandbox: ElementNotFound");
            }
            try {
                var instrumentMessageId = randomInteger();
                return new Promise(function (resolve, reject) {
                    SandboxLibrary.instrumentMessages[instrumentMessageId] = resolve;
                    message.messageName = "InstrumentMessage";
                    message.instrumentMessageId = instrumentMessageId;
                    if (!element.contentWindow) {
                        reject("ElementNotAnIFrame");
                    }
                    else {
                        element.contentWindow.postMessage(message, "*");
                    }
                });
            }
            catch (e) {
                var error = new Error("Error while sending message to instrument sandbox: " + e);
                throw error;
            }
        };
        IFrameCreationStrategy.prototype.getSandboxAttribute = function (tabId, sandboxSelector, message) {
            if (!message || !message.action || !message.action.attributeName) {
                throw new Error("InvalidMessage for getSandboxAttribute" + message);
            }
            var element = (this._sandboxInMemoryStorage.retrieveSandboxByTabIdSandboxSelector(tabId, sandboxSelector));
            if (!element) {
                throw new Error("ElementNotFound to retrieve sandbox attribute");
            }
            return element.getAttribute(message.action.attributeName);
        };
        IFrameCreationStrategy.prototype.destroySandbox = function (sandboxId) {
            var shadowRoot = this._sandboxInMemoryStorage.retrieveShadowRootBySandboxId(sandboxId);
            if (!shadowRoot) {
                return;
            }
            var sandbox = this._sandboxInMemoryStorage.retrieveSandboxBySandboxId(sandboxId);
            if (sandbox) {
                shadowRoot.removeChild(sandbox);
            }
            var styleElement = shadowRoot.getElementById(IFrameCreationStrategy.STYLE_HANDLE_PREFIX + sandboxId);
            if (styleElement) {
                shadowRoot.removeChild(styleElement);
            }
            if (shadowRoot._hostElementOfShadowRoot) {
                shadowRoot._hostElementOfShadowRoot.parentNode.removeChild(shadowRoot._hostElementOfShadowRoot);
            }
            this._sandboxInMemoryStorage.deleteShadowRoot(sandboxId);
        };
        IFrameCreationStrategy.prototype._buildCssString = function (cssSpec) {
            var styleRulesArray = [];
            for (var styleName in cssSpec) {
                if (cssSpec.hasOwnProperty(styleName)) {
                    styleRulesArray.push([styleName, cssSpec[styleName]].join(":"));
                }
            }
            return styleRulesArray.join(";").concat(";");
        };
        IFrameCreationStrategy.prototype._getParentPageElement = function (elementCssSelector) {
            var element = document.querySelector(elementCssSelector);
            if (!element) {
                throw new Error("StyleLibrary couldn't find the specified element.");
            }
            return element;
        };
        IFrameCreationStrategy.prototype._applyStyleSheetCSSRule = function (handle, styleSheetCSSRules) {
            var styleHandle = IFrameCreationStrategy.STYLE_HANDLE_PREFIX + handle;
            var styleSheet = this._createStyleSheet(handle, styleHandle);
            styleSheetCSSRules.forEach(function (styleSheetCSSRule) {
                styleSheet.insertRule(styleSheetCSSRule);
            });
        };
        IFrameCreationStrategy.prototype._createStyleSheet = function (handle, styleHandle) {
            var shadowRoot = this._sandboxInMemoryStorage.retrieveShadowRootBySandboxId(handle);
            var styleElement = document.createElement("style");
            styleElement.setAttribute("id", styleHandle);
            shadowRoot.appendChild(styleElement);
            return styleElement.sheet;
        };
        IFrameCreationStrategy.STYLE_HANDLE_PREFIX = "UBPStyle";
        IFrameCreationStrategy.SELECTORS_TO_QUERY = ["div:not(:empty)", "span:not(:empty)"];
        IFrameCreationStrategy.ELEMENT_TO_CREATE_AS_FALLBACK = ["div", "span"];
        return IFrameCreationStrategy;
    }());
    SandboxLibrary.IFrameCreationStrategy = IFrameCreationStrategy;
    var SandboxInMemoryStorage = (function () {
        function SandboxInMemoryStorage() {
            this._PROXY_URL_TO_CONTROLLER_PATH_REGEX = "%2F([a-z]*)(%3F|&)";
            this._SANDBOX_SELECTOR_TO_CONTROLLER_PATH_REGEX = "src\\*=([a-z]*)";
            this._currentShadowRootsMap = {};
            this._tabIdControllerPathToSandboxId = {};
            this._sandBoxIdToTabIdControllerPath = {};
        }
        SandboxInMemoryStorage.prototype.storeShadowRoot = function (shadowRoot, tabId, sandboxId, proxyUrl) {
            this._currentShadowRootsMap[sandboxId] = shadowRoot;
            var regexMatchResult = proxyUrl.match(this._PROXY_URL_TO_CONTROLLER_PATH_REGEX);
            if (!regexMatchResult ||
                regexMatchResult[1] === null || regexMatchResult[1] === undefined) {
                return;
            }
            var controllerPath = regexMatchResult[1];
            var tabIdControllerPathKey = this._createTabIdControllerPathKey(tabId, controllerPath);
            this._tabIdControllerPathToSandboxId[tabIdControllerPathKey] = sandboxId;
            this._sandBoxIdToTabIdControllerPath[sandboxId] = tabIdControllerPathKey;
        };
        SandboxInMemoryStorage.prototype.retrieveShadowRootBySandboxId = function (sandboxId) {
            return this._currentShadowRootsMap[sandboxId];
        };
        SandboxInMemoryStorage.prototype.retrieveShadowRootByTabIdSandboxSelector = function (tabId, sandboxSelector) {
            var sandboxId = this._getSandboxId(tabId, sandboxSelector);
            if (!sandboxId) {
                throw new Error("retrieveShadowRoot: SandboxId not found for tabId :" + tabId + " and sandboxSelector: " + sandboxSelector);
            }
            return this.retrieveShadowRootBySandboxId(sandboxId);
        };
        SandboxInMemoryStorage.prototype.retrieveSandboxBySandboxId = function (sandboxId) {
            var shadowRoot = this.retrieveShadowRootBySandboxId(sandboxId);
            if (shadowRoot) {
                return shadowRoot.getElementById(sandboxId);
            }
            else {
                return null;
            }
        };
        SandboxInMemoryStorage.prototype.retrieveSandboxByTabIdSandboxSelector = function (tabId, sandboxSelector) {
            var sandboxId = this._getSandboxId(tabId, sandboxSelector);
            if (!sandboxId) {
                throw new Error("retrieveSandbox: SandboxId not found for tabId :" + tabId + " and sandboxSelector: " + sandboxSelector);
            }
            return this.retrieveSandboxBySandboxId(sandboxId);
        };
        SandboxInMemoryStorage.prototype.deleteShadowRoot = function (sandboxId) {
            delete this._currentShadowRootsMap[sandboxId];
            var tabIdControllerPath = this._sandBoxIdToTabIdControllerPath[sandboxId];
            delete this._tabIdControllerPathToSandboxId[tabIdControllerPath];
            delete this._sandBoxIdToTabIdControllerPath[sandboxId];
        };
        SandboxInMemoryStorage.prototype._createTabIdControllerPathKey = function (tabId, controllerPath) {
            return tabId + "_" + controllerPath;
        };
        SandboxInMemoryStorage.prototype._getSandboxId = function (tabId, sandboxSelector) {
            var regexMatchResult = sandboxSelector.match(this._SANDBOX_SELECTOR_TO_CONTROLLER_PATH_REGEX);
            if (!regexMatchResult ||
                regexMatchResult[1] === null || regexMatchResult[1] === undefined) {
                return;
            }
            var controllerPath = regexMatchResult[1];
            var tabIdControllerPathKey = this._createTabIdControllerPathKey(tabId, controllerPath);
            return this._tabIdControllerPathToSandboxId[tabIdControllerPathKey];
        };
        return SandboxInMemoryStorage;
    }());
    SandboxLibrary.SandboxInMemoryStorage = SandboxInMemoryStorage;
    var MAX_SAFE_INTEGER = Number["MAX_SAFE_INTEGER"] || 9007199254740991;
    var MIN_SAFE_INTEGER = Number["MIN_SAFE_INTEGER"] || -9007199254740991;
    var USE_SIGN_BIT = (MAX_SAFE_INTEGER * -1) === MIN_SAFE_INTEGER;
    function randomInteger() {
        var randomInteger = Math.floor(Math.random() * MAX_SAFE_INTEGER);
        if (USE_SIGN_BIT) {
            var heads = Math.floor(Math.random() * 2);
            if (heads) {
                randomInteger *= -1;
            }
        }
        return randomInteger.toString();
    }
    SandboxLibrary.instrumentMessages = {};
    function appendQueryParams(url, params) {
        var sourceUrl = "", queryString = "", urlhash = "";
        for (var key in params) {
            if (params.hasOwnProperty(key)) {
                queryString += "&" + encodeURIComponent(key) + "=" + encodeURIComponent(params[key]);
            }
        }
        if (url.indexOf('#') > 0) {
            var cl = url.indexOf('#');
            urlhash = url.substring(url.indexOf('#'), url.length);
        }
        else {
            urlhash = '';
            cl = url.length;
        }
        sourceUrl = url.substring(0, cl);
        if (sourceUrl.indexOf("?") > -1) {
            if (sourceUrl.charAt(sourceUrl.length - 1) === "&" || sourceUrl.charAt(sourceUrl.length - 1) === "?") {
                queryString = queryString.slice(1);
            }
        }
        else {
            queryString = "?" + queryString.slice(1);
        }
        return sourceUrl + queryString + urlhash;
    }
    SandboxLibrary.appendQueryParams = appendQueryParams;
})(SandboxLibrary || (SandboxLibrary = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2FuZGJveExpYnJhcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvdWJwL2V4dGVuc2lvbi9jb250ZXh0dWFsL3BlZXItc2NyaXB0cy9saWJyYXJpZXMvU2FuZGJveExpYnJhcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBMEJBLElBQVUsY0FBYyxDQXkyQ3ZCO0FBejJDRCxXQUFVLGNBQWM7SUFRcEI7UUFxQkksbUJBQVkscUJBQXFDO1lBUmpELHlCQUFvQixHQUFVLGNBQWMsQ0FBQztZQVN6QyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksY0FBYyxDQUFDLGNBQWMsQ0FBQztnQkFDcEQsUUFBUSxFQUFHLElBQUksY0FBYyxDQUFDLHNCQUFzQixFQUFFO2dCQUN0RCxzQkFBc0IsRUFBRyxxQkFBcUI7Z0JBQzlDLGtCQUFrQixFQUFHLEVBQUU7YUFDMUIsQ0FBQyxDQUFDO1FBQ1AsQ0FBQztRQVFELHlDQUFxQixHQUFyQixVQUFzQixHQUFPO1lBQ3pCLElBQUksQ0FBQyxjQUFjLENBQUMscUJBQXFCLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbkQsQ0FBQztRQVNELDBCQUFNLEdBQU4sVUFBTyxXQUFrQixFQUFDLElBU3pCO1lBQ0csSUFBSSxDQUFDLElBQUksRUFBRTtnQkFDUCxNQUFNLElBQUksS0FBSyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7YUFDOUQ7WUFDRCxRQUFRLFdBQVcsRUFBRTtnQkFDakIsS0FBSyxJQUFJLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQztvQkFDbEQsSUFBRyxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxvQkFBb0IsRUFBRTt3QkFDeEMsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO3FCQUNuRjtvQkFDRCxNQUFNO2dCQUNW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NUM7UUFDRCxPQUFPLFNBQVMsR0FBRyxXQUFXLEdBQUcsT0FBTyxDQUFDO0lBQzdDLENBQUM7SUFqQ2UsZ0NBQWlCLG9CQWlDaEMsQ0FBQTtBQUNMLENBQUMsRUF6MkNTLGNBQWMsS0FBZCxjQUFjLFFBeTJDdkIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNhbmRib3hMaWJyYXJ5IGlzIGEgTW9kdWxlIGZvciBjb25zdHJ1Y3RpbmcgYSBTYW5kYm94TWFuYWdlciBpbnN0YW5jZVxuICogaW5zaWRlIG9mIGEgY29udGVudC1zY3JpcHQsIHdoaWNoIHByb3ZpZGVzIHRoZSBsb2dpYyBmb3IgY3JlYXRpbmcsXG4gKiBtb2RpZnlpbmcsIGFuZCBkZXN0cm95aW5nIHNhbmRib3hlcyBpbiB0aGUgY29udGV4dCBvZiBhIHVzZXIncyB3ZWItcGFnZS5cbiAqIFRoZSBTYW5kYm94RHJpdmVyIGlzIHJlc3BvbnNpYmxlIGZvciBpbnN0YW50aWF0aW5nIGFuZCB3aXJpbmdcbiAqIHVwIHRoZSBTYW5kYm94TWFuYWdlciB0byB0aGUgMS1CQS5cbiAqXG4gKiBCZWNhdXNlIHRoZSBsaWJyYXJ5IGlzIGEgY29udGVudC1zY3JpcHQsIGl0IGNhbm5vdCBsb2FkIG90aGVyIG1vZHVsZXMsXG4gKiBhbmQgcmVsaWVzIG9uIGFueSBhbHJlYWR5IGluamVjdGVkIHNjcmlwdHMgZm9yIGZ1bmN0aW9uYWxpdHkuXG4gKlxuICogU2FuZGJveGVzIGFyZSBvcmdhbml6ZXMgYXMgc3VjaCwgd2l0aCBhIHByb3h5IGZyYW1lIHdyYXBwaW5nIHRoZSBtYWluIGNvbnRlbnQuXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogfCAgIHByb3h5IGZyYW1lICAgICAgIHwgPC0gVVJMIHNldCBieSBcIklTYW5kYm94U3BlY2lmaWNhdGlvbi5wcm94eVwiXG4gKiB8IC0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogfCB8IGNvbnRlbnQgZnJhbWUgICAgIHwgPC0gVVJMIHNldCBieSBcIklTYW5kYm94U3BlY2lmaWNhdGlvbi51cmxcIlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqXG4gKiBTYW5ib3hMaWJyYXJ5IGNvbnRhaW5zIHRocmVlIGNsYXNzZXM6IFNhbmRib3hlciwgU2FuZGJveE1hbmFnZXIsIGFuZFxuICogSUZyYW1lQ3JlYXRpb25TdHJhdGVneS5cbiAqIFNhbmRib3hlciBpcyB0aGUgQVBJIGZvciB0aGUgbGlicmFyeSwgYW5kIGlzIHdoYXQncyB1c2VkIGRpcmVjdGx5IGJ5XG4gKiB0aGUgU2FuZG94RHJpdmVyLlxuICogU2FuZGJveE1hbmFnZXIgaW1wbGVtZW50cyB0aGUgQVBJJ3MgbWV0aG9kcywgcGVyZm9ybWluZyBhbnkgc3RhdGUtbWFuYWdlbWVudFxuICogYW5kIGFkZGl0aW9uYWwgYnVzaW5lc3MgbG9naWMuXG4gKiBJRnJhbWVDcmVhdGlvblN0cmF0ZWd5IGlzIHJlc3BvbnNpYmxlIGZvciBhY3R1YWxseSBjcmVhdGluZyB0aGUgaWZyYW1lcywgbW9kaWZ5aW5nXG4gKiBDU1MsIGFuZCBhbnkgb3RoZXIgZGlyZWN0IG1hbmlwdWxhdGlvbiBvZiB0aGUgRE9NLlxuICovXG5uYW1lc3BhY2UgU2FuZGJveExpYnJhcnkge1xuXG4gICAgLyoqXG4gICAgICogU2FuZGJveGVyIGluc3RhbnRpYXRlcyBhbGwgdGhlIG5lY2Vzc2FyeSBvYmplY3RzLCBhbmQgZG9lcyB0aGVcbiAgICAgKiBtZXNzYWdlIHR5cGUvYXJndW1lbnQgY2hlY2tpbmcuIEl0IGlzIHRoZSBQdWJsaWMgQVBJIGZvciB0aGlzIGxpYnJhcnksXG4gICAgICogYW5kIHRoZSBvbmx5IG9iamVjdCB0aGF0IHNob3VsZCBldmVyIGJlIGluc3RhbnRpYXRlZCBvdXRzaWRlIG9mIHRoZVxuICAgICAqIFNhbmRib3hMaWJyYXJ5IG1vZHVsZS5cbiAgICAgKi9cbiAgICBleHBvcnQgY2xhc3MgU2FuZGJveGVyIGltcGxlbWVudHMgSUNvbnRleHR1YWxQZWVyTGlicmFyeSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbiBpbnN0YW5jZSB0byB0aGUgc2FuZGJveE1hbmFnZXIuIEltcGxlbWVudHMgdGhlIHVuZGVybHlpbmdcbiAgICAgICAgICogU2FuZGJveExpYnJhcnkgbWV0aG9kcywgYW5kIGRlbGVnYXRlcyBhbnkgRE9NIG1hbmlwdWxhdGlvblxuICAgICAgICAgKiB0byB0aGUgSUZyYW1lQ3JlYXRpb25TdHJhdGVneS5cbiAgICAgICAgICovXG4gICAgICAgIHNhbmRib3hNYW5hZ2VyOlNhbmRib3hNYW5hZ2VyO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHByZWZpeCBmb3IgYWxsIG1lc3NhZ2VzIHNlbnQgZnJvbSB0aGUgMS1CQSB0byBpZGVudGlmeVxuICAgICAgICAgKiB3aGljaCBBUEkgdG8gY2FsbC5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHNhbmRib3hNZXNzYWdlUHJlZml4OnN0cmluZyA9IFwiVUJQU2FuZGJveGVyXCI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbnN0cnVjdHMgdGhlIFNhbmRib3hlciAodGhlIG9iamVjdCB0aGF0IGlzIGRpcmVjdGx5IGFjY2Vzc2VkXG4gICAgICAgICAqIGJ5IHRoZSBkcml2ZXIpIGdpdmVuIGEgcnVudGltZS1zcGVjaWZpYyBmdW5jdGlvbiBmb3IgZm9yd2FyZGluZ1xuICAgICAgICAgKiBtZXNzYWdlcyB1cCBmcm9tIHRoZSBzYW5kYm94ZXMuXG4gICAgICAgICAqIEBwYXJhbSBleHRlbnNpb25NZXNzYWdlUHJveHlcbiAgICAgICAgICovXG4gICAgICAgIGNvbnN0cnVjdG9yKGV4dGVuc2lvbk1lc3NhZ2VQcm94eToobXNnOmFueSk9PnZvaWQpe1xuICAgICAgICAgICAgdGhpcy5zYW5kYm94TWFuYWdlciA9IG5ldyBTYW5kYm94TGlicmFyeS5TYW5kYm94TWFuYWdlcih7XG4gICAgICAgICAgICAgICAgc3RyYXRlZ3kgOiBuZXcgU2FuZGJveExpYnJhcnkuSUZyYW1lQ3JlYXRpb25TdHJhdGVneSgpLFxuICAgICAgICAgICAgICAgIGZvcndhcmRNZXNzYWdlRnVuY3Rpb24gOiBleHRlbnNpb25NZXNzYWdlUHJveHksXG4gICAgICAgICAgICAgICAgd2hpdGVsaXN0ZWRPcmlnaW5zIDoge31cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFsaWFzZXMgdGhlIHNhbmRib3hNYW5hZ2VyJ3Mgc2FuZGJveE1lc3NhZ2VIYW5kbGVyIG9udG9cbiAgICAgICAgICogdGhpcyBvYmplY3QsIHNvIHRoYXQgdGhlIGRyaXZlciBjYW4gYXR0YWNoIGEgbGlzdGVuZXIgdG9cbiAgICAgICAgICogdGhlIHdpbmRvdyBhbmQgZm9yd2FyZCBtZXNzYWdlcyBjb21pbmcgZnJvbSBzYW5kYm94ZXMuXG4gICAgICAgICAqIEBwYXJhbSB7YW55fSBtc2dcbiAgICAgICAgICovXG4gICAgICAgIHNhbmRib3hNZXNzYWdlSGFuZGxlcihtc2c6YW55KTp2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuc2FuZGJveE1hbmFnZXIuc2FuZGJveE1lc3NhZ2VIYW5kbGVyKG1zZyk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogUGFyc2VzIHRoZSBtZXNzYWdlIGZyb20gdGhlIDEtQkEgYW5kIGludm9rZXMgdGhlIGFwcHJvcHJpYXRlIG1ldGhvZCxcbiAgICAgICAgICogYW5kIHJldHVybnMgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgbWV0aG9kLlxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gcmVxdWVzdFR5cGVcbiAgICAgICAgICogQHBhcmFtIGFyZ3NcbiAgICAgICAgICogQHJldHVybnMgeyp9XG4gICAgICAgICAqL1xuICAgICAgICBoYW5kbGUocmVxdWVzdFR5cGU6c3RyaW5nLGFyZ3M6e1xuICAgICAgICAgICAgdGFiSWQ/OiBzdHJpbmc7XG4gICAgICAgICAgICBzYW5kYm94SWQ/OnN0cmluZztcbiAgICAgICAgICAgIHNhbmRib3hTcGVjaWZpY2F0aW9uPzpJU2FuZGJveFNwZWNpZmljYXRpb247XG4gICAgICAgICAgICBzYW5kYm94Q1NTU3BlY2lmaWNhdGlvbj86SVNhbmRib3hDU1NTcGVjaWZpY2F0aW9uO1xuICAgICAgICAgICAgcGFnZVN0eWxlU3BlY2lmaWNhdGlvbj86IElTdHlsZVNwZWNpZmljYXRpb247XG4gICAgICAgICAgICBvcmlnaW4/OmFueTtcbiAgICAgICAgICAgIG1lc3NhZ2U/OiBhbnk7XG4gICAgICAgICAgICBzYW5kYm94U2VsZWN0b3I/OiBzdHJpbmc7XG4gICAgICAgIH0pOmFueXtcbiAgICAgICAgICAgIGlmICghYXJncykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk11c3QgcHJvdmlkZSBhcmd1bWVudHMgdG8gU2FuZGJveCBBUEknc1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3aXRjaCAocmVxdWVzdFR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIHRoaXMuc2FuZGJveE1lc3NhZ2VQcmVmaXguY29uY2F0KFwiQ3JlYXRlU2FuZGJveFwiKTpcbiAgICAgICAgICAgICAgICAgICAgaWYoYXJncy50YWJJZCAmJiBhcmdzLnNhbmRib3hTcGVjaWZpY2F0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zYW5kYm94TWFuYWdlci5jcmVhdGVTYW5kYm94KGFyZ3MudGFiSWQsIGFyZ3Muc2FuZGJveFNwZWNpZmljYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5zYW5kYm94TWVzc2FnZVByZWZpeC5jb25jYXQoXCJDcmVhdGVTYW5kYm94QnlJZFwiKTpcbiAgICAgICAgICAgICAgICAgICAgaWYoYXJncy50YWJJZCAmJiBhcmdzLnNhbmRib3hTcGVjaWZpY2F0aW9uKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNhbmRib3hNYW5hZ2VyLmNyZWF0ZVNhbmRib3hCeUlkKGFyZ3MudGFiSWQsIGFyZ3Muc2FuZGJveFNwZWNpZmljYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5zYW5kYm94TWVzc2FnZVByZWZpeC5jb25jYXQoXCJDcmVhdGVTYW5kYm94QnlJZFBvc3RcIik6XG4gICAgICAgICAgICAgICAgICAgIGlmKGFyZ3MudGFiSWQgJiYgYXJncy5zYW5kYm94U3BlY2lmaWNhdGlvbil7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zYW5kYm94TWFuYWdlci5jcmVhdGVTYW5kYm94QnlJZFBvc3QoYXJncy50YWJJZCwgYXJncy5zYW5kYm94U3BlY2lmaWNhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLnNhbmRib3hNZXNzYWdlUHJlZml4LmNvbmNhdChcIk1vZGlmeVNhbmRib3hcIik6XG4gICAgICAgICAgICAgICAgICAgIGlmKGFyZ3Muc2FuZGJveElkICYmIGFyZ3Muc2FuZGJveENTU1NwZWNpZmljYXRpb24pe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2FuZGJveE1hbmFnZXIubW9kaWZ5U2FuZGJveChhcmdzLnNhbmRib3hJZCxhcmdzLnNhbmRib3hDU1NTcGVjaWZpY2F0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIHRoaXMuc2FuZGJveE1lc3NhZ2VQcmVmaXguY29uY2F0KFwiU2hvd1NhbmRib3hcIik6XG4gICAgICAgICAgICAgICAgICAgIGlmKGFyZ3Muc2FuZGJveElkICYmIGFyZ3Muc2FuZGJveENTU1NwZWNpZmljYXRpb24pe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2FuZGJveE1hbmFnZXIuc2hvd1NhbmRib3goYXJncy5zYW5kYm94SWQsIGFyZ3Muc2FuZGJveENTU1NwZWNpZmljYXRpb24sIGFyZ3MucGFnZVN0eWxlU3BlY2lmaWNhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLnNhbmRib3hNZXNzYWdlUHJlZml4LmNvbmNhdChcIkRlc3Ryb3lTYW5kYm94XCIpOlxuICAgICAgICAgICAgICAgICAgICBpZihhcmdzLnNhbmRib3hJZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zYW5kYm94TWFuYWdlci5kZXN0cm95U2FuZGJveChhcmdzLnNhbmRib3hJZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLnNhbmRib3hNZXNzYWdlUHJlZml4LmNvbmNhdChcIkFkZFdoaXRlbGlzdGVkT3JpZ2luXCIpOlxuICAgICAgICAgICAgICAgICAgICBpZihhcmdzLm9yaWdpbil7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zYW5kYm94TWFuYWdlci5hZGRXaGl0ZWxpc3RlZE9yaWdpbihhcmdzLm9yaWdpbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLnNhbmRib3hNZXNzYWdlUHJlZml4LmNvbmNhdChcIlNlbmRNZXNzYWdlVG9TYW5kYm94XCIpOlxuICAgICAgICAgICAgICAgICAgICBpZihhcmdzLnNhbmRib3hJZCAmJiBhcmdzLm1lc3NhZ2Upe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2FuZGJveE1hbmFnZXIuc2VuZE1lc3NhZ2VUb1NhbmRib3goYXJncy5zYW5kYm94SWQsIGFyZ3MubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLnNhbmRib3hNZXNzYWdlUHJlZml4LmNvbmNhdChcIkluc3RydW1lbnRTYW5kYm94XCIpOlxuICAgICAgICAgICAgICAgICAgICBpZihhcmdzLnRhYklkICYmIGFyZ3Muc2FuZGJveFNlbGVjdG9yICYmIGFyZ3MubWVzc2FnZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zYW5kYm94TWFuYWdlci5pbnN0cnVtZW50U2FuZGJveChhcmdzLnRhYklkLCBhcmdzLnNhbmRib3hTZWxlY3RvciwgYXJncy5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIHRoaXMuc2FuZGJveE1lc3NhZ2VQcmVmaXguY29uY2F0KFwiR2V0U2FuZGJveEF0dHJpYnV0ZVwiKTpcbiAgICAgICAgICAgICAgICAgICAgaWYoYXJncy50YWJJZCAmJiBhcmdzLnNhbmRib3hTZWxlY3RvciAmJiBhcmdzLm1lc3NhZ2Upe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2FuZGJveE1hbmFnZXIuZ2V0U2FuZGJveEF0dHJpYnV0ZShhcmdzLnRhYklkLCBhcmdzLnNhbmRib3hTZWxlY3RvciwgYXJncy5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHJlcXVlc3QgdHlwZTogXCIgKyByZXF1ZXN0VHlwZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3MgZm9yIHNhbmRib3ggbWVzc2FnZTogXCIgKyByZXF1ZXN0VHlwZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogVGVzdHMgaWYgYSBwYXJ0aWN1bGFyIHJlcXVlc3QgdHlwZSAoYmFzZWQgb24gdGhlIG1lc3NhZ2UgZnJvbSB0aGUgMS1CQSlcbiAgICAgICAgICogY2FuIGJlIGhhbmRsZWQgYnkgdGhlIFNhbmRib3hMaWJyYXJ5LlxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gcmVxdWVzdFR5cGVcbiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICBjYW5IYW5kbGUocmVxdWVzdFR5cGU6c3RyaW5nKTpib29sZWFue1xuICAgICAgICAgICAgc3dpdGNoIChyZXF1ZXN0VHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5zYW5kYm94TWVzc2FnZVByZWZpeC5jb25jYXQoXCJDcmVhdGVTYW5kYm94XCIpOlxuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5zYW5kYm94TWVzc2FnZVByZWZpeC5jb25jYXQoXCJDcmVhdGVTYW5kYm94QnlJZFwiKTpcbiAgICAgICAgICAgICAgICBjYXNlIHRoaXMuc2FuZGJveE1lc3NhZ2VQcmVmaXguY29uY2F0KFwiQ3JlYXRlU2FuZGJveEJ5SWRQb3N0XCIpOlxuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5zYW5kYm94TWVzc2FnZVByZWZpeC5jb25jYXQoXCJNb2RpZnlTYW5kYm94XCIpOlxuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5zYW5kYm94TWVzc2FnZVByZWZpeC5jb25jYXQoXCJTaG93U2FuZGJveFwiKTpcbiAgICAgICAgICAgICAgICBjYXNlIHRoaXMuc2FuZGJveE1lc3NhZ2VQcmVmaXguY29uY2F0KFwiRGVzdHJveVNhbmRib3hcIik6XG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLnNhbmRib3hNZXNzYWdlUHJlZml4LmNvbmNhdChcIkFkZFdoaXRlbGlzdGVkT3JpZ2luXCIpOlxuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5zYW5kYm94TWVzc2FnZVByZWZpeC5jb25jYXQoXCJTZW5kTWVzc2FnZVRvU2FuZGJveFwiKTpcbiAgICAgICAgICAgICAgICBjYXNlIHRoaXMuc2FuZGJveE1lc3NhZ2VQcmVmaXguY29uY2F0KFwiSW5zdHJ1bWVudFNhbmRib3hcIik6XG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLnNhbmRib3hNZXNzYWdlUHJlZml4LmNvbmNhdChcIkdldFNhbmRib3hBdHRyaWJ1dGVcIik6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNhbmRib3hNYW5hZ2VyIGlzIHJlc3BvbnNpYmxlIGZvciBleGVjdXRpbmcgcmVxdWVzdHMgdG8gY3JlYXRlLCBtb2RpZnksXG4gICAgICogYW5kIGRlc3Ryb3kgc2FuZGJveGVzLCBhcyB3ZWxsIGFzIGZlcnJ5IG1lc3NhZ2VzIGJldHdlZW4gc2FuZGJveGVzIGFuZFxuICAgICAqIHRoZSAxLUJBLiBTYW5kYm94TWFuYWdlciB1c2VzIGFuIGluc3RhbmNlIG9mIElGcmFtZUNyZWF0aW9uU3RyYXRlZ3kgdG9cbiAgICAgKiBhY3R1YWxseSBpbXBsZW1lbnQgdGhlIGNyZWF0aW9uIG9mIHRoZSBzYW5kYm94LlxuICAgICAqL1xuICAgIGV4cG9ydCBjbGFzcyBTYW5kYm94TWFuYWdlciB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJZGVudGlmaWVzIGEgbWVzc2FnZSBjb21pbmcgZnJvbSBhIHNhbmRib3ggYXMgYSBoYW5kc2hha2UgYXR0ZW1wdC5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHN0YXRpYyBTQU5EQk9YX0hBTkRTSEFLRSA9IFwiVUJQU2FuZGJveEhhbmRzaGFrZVwiO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIHByZWZpeCBpcyB1c2VkIHRvIGlkZW50aWZ5IHRoZSBpZnJhbWUgYXNcbiAgICAgICAgICogY29taW5nIGZyb20gdGhlIFNhbmRib3hNYW5hZ2VyLCBhbmQgaXMgdXNlZFxuICAgICAgICAgKiBhcyB0aGUgcHJlZml4IGZvciB0aGUgZWxlbWVudCdzIGlkLlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgc3RhdGljIFNBTkRCT1hfUFJFRklYICAgID0gXCJVQlBOb3RpZlwiO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSYW5kb20gSmF2YVNjcmlwdCBpbnRlZ2VyIHRoYXQgcmVwcmVzZW50cyB0aGUgY3VycmVudFxuICAgICAgICAgKiBpbnN0YW5jZSBvZiB0aGUgU2FuZGJveE1hbmFnZXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoaXMgaXMgdXNlZCB0byB0YWcgdGhlIHNhbmRib3hlcyB0aGlzIFNhbmRib3hNYW5hZ2VyIGNyZWF0ZXMgdG8gaGVscFxuICAgICAgICAgKiB3aXRoIGRldmVsb3BtZW50IGFuZCBkZWJ1Z2dpbmcuXG4gICAgICAgICAqXG4gICAgICAgICAqIE51bWJlciBiZXR3ZWVuIC05MDA3MTk5MjU0NzQwOTkwIGFuZCA5MDA3MTk5MjU0NzQwOTkwLiBPZGRzIG9mIHR3bywgYWN0aXZlXG4gICAgICAgICAqIGluc3RhbmNlcyB3aXRoaW4gdGhlIGJyb3dzZXIgaGF2aW5nIHRoZSBzYW1lIGlkIGFyZSBhc3Ryb25vbWljYWxseSBsb3cuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICBpbnN0YW5jZUlkOnN0cmluZyA9IHJhbmRvbUludGVnZXIoKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVmZXJlbmNlIHRvIHRoZSBvYmplY3QgdGhhdCBpcyByZXNwb25zaWJsZSBmb3IgYW55IERPTSBtYW5pcHVsYXRpb24uXG4gICAgICAgICAqIFBhc3NlZCBpbiBhdCBpbnN0YW50aWF0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgc3RyYXRlZ3k6SUZyYW1lQ3JlYXRpb25TdHJhdGVneTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRnVuY3Rpb24gcGFzc2VkIGluIGF0IGluc3RhbnRpYXRpb24gd2hpY2ggaXMgdXNlZCB0byBjb21tdW5pY2F0ZSBtZXNzYWdlc1xuICAgICAgICAgKiBiYWNrIHVwIHRvIHRoZSAxLUJBLlxuICAgICAgICAgKi9cbiAgICAgICAgZm9yd2FyZE1lc3NhZ2VGdW5jdGlvbjoobXNnOklTYW5kYm94TWVzc2FnZSk9PnZvaWQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIElkZW50aXR5IGhhc2ggb2Ygb3JpZ2luID0+IG9yaWdpbi4gVGhlc2Ugb3JpZ2lucyBhbGxvdyB1cyB0byBmaWx0ZXJcbiAgICAgICAgICogaW5jb21pbmcgbWVzc2FnZXMgYmFzZWQgb24gdGhlIG9yaWdpbiBvZiB0aGUgZnJhbWUgdGhhdCBzZW50IHRoZW0uXG4gICAgICAgICAqIFdlIGFkZCBvcmlnaW5zIHRvIHRoaXMgbGlzdCBieSBleHRyYWN0aW5nIHRoZW0gZnJvbSB0aGUgcHJveHkgdXJsJ3NcbiAgICAgICAgICogaW4gQ3JlYXRlU2FuZGJveC5cbiAgICAgICAgICogICBlLmcuXG4gICAgICAgICAqIHtcbiAgICAgICAgICogICBcImh0dHBzOi8vd3d3LmFtYXpvbi5jb21cIiA6IFwiaHR0cHM6Ly93d3cuYW1hem9uLmNvbVwiXG4gICAgICAgICAqICAgXCJodHRwczovL21hdGNoLmFtYXpvbmJyb3dzZXJhcHAuY29tXCIgOiBcImh0dHBzOi8vbWF0Y2guYW1hem9uYnJvd3NlcmFwcC5jb21cIlxuICAgICAgICAgKiB9XG4gICAgICAgICAqL1xuICAgICAgICB3aGl0ZWxpc3RlZE9yaWdpbnM6e1tvcmlnaW46c3RyaW5nXTpzdHJpbmd9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYXNoIGZvciByZW1lbWJlcmluZyB3aGljaCBzYW5kYm94ZXMgaGF2ZSB5ZXQgdG8gaGFuZHNoYWtlLlxuICAgICAgICAgKi9cbiAgICAgICAgcGVuZGluZ1NhbmRib3hlcyAgICA6U2FuZGJveEhhbmRsZUV4aXN0ZW5jZU1hcCA9IHt9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYXNoIGZvciBtYXBwaW5nIGhhbmRsZXMgdG8gcmVmZXJlbmNlcyB0byB0aGUgd2luZG93IG9iamVjdFxuICAgICAgICAgKiBvZiB0aGUgcHJveHkgaWZyYW1lLlxuICAgICAgICAgKi9cbiAgICAgICAgZXN0YWJsaXNoZWRTYW5kYm94ZXM6U2FuZGJveEhhbmRsZVRvV2luZG93TWFwID0ge307XG5cbiAgICAgICAgY29uc3RydWN0b3IoYXJnczp7XG4gICAgICAgICAgICBzdHJhdGVneTpJRnJhbWVDcmVhdGlvblN0cmF0ZWd5O1xuICAgICAgICAgICAgZm9yd2FyZE1lc3NhZ2VGdW5jdGlvbjooZGF0YTphbnkpPT52b2lkO1xuICAgICAgICAgICAgd2hpdGVsaXN0ZWRPcmlnaW5zOntbb3JpZ2luOnN0cmluZ106c3RyaW5nfTtcbiAgICAgICAgfSkge1xuICAgICAgICAgICAgaWYgKGFyZ3Muc3RyYXRlZ3kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0cmF0ZWd5ID0gYXJncy5zdHJhdGVneTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2FuZGJveE1hbmFnZXIgcmVxdWlyZXMgYSBub3RpZmljYXRpb24gY3JlYXRpb24gc3RyYXRlZ3lcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZm9yd2FyZE1lc3NhZ2VGdW5jdGlvbiA9IGFyZ3MuZm9yd2FyZE1lc3NhZ2VGdW5jdGlvbiB8fCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLndoaXRlbGlzdGVkT3JpZ2lucyAgPSBhcmdzLndoaXRlbGlzdGVkT3JpZ2lucyAgfHwge307XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVzcG9uZHMgdG8gbWVzc2FnZXMgY29taW5nIGZyb20gdGhlIHBhZ2UgdG8gdGhlIGNvbnRlbnQtc2NyaXB0LlxuICAgICAgICAgKiBUaGlzIGFsbG93cyBmb3IgdGhlIHNhbmRib3hlcyB0byBjb21tdW5pY2F0ZSB3aXRoIHRoZSBmZWF0dXJlXG4gICAgICAgICAqIHByb2Nlc3NlcywgYXMgd2VsbCBhcyBlc3RhYmxpc2ggdGhlIGhhbmRzaGFrZSBiZXR3ZWVuIHNhbmRib3hcbiAgICAgICAgICogYW5kIGNvbnRlbnQtc2NyaXB0IGxpYnJhcnkuXG4gICAgICAgICAqIEBwYXJhbSBtc2dcbiAgICAgICAgICovXG4gICAgICAgIHNhbmRib3hNZXNzYWdlSGFuZGxlcihtc2c6YW55KTp2b2lkIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5faXNSZWxldmFudE1lc3NhZ2UobXNnKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjsvL2V4aXQgaWYgdGhlIG1lc3NhZ2UgaXNuJ3QgcmVsZXZhbnQuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtc2cgPSA8SUV4dGVybmFsU2FuZGJveE1lc3NhZ2U+IG1zZztcbiAgICAgICAgICAgIGlmICh0aGlzLl9pc0hhbmRzaGFrZU1lc3NhZ2UobXNnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZUhhbmRzaGFrZShtc2cpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVNZXNzYWdlKG1zZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogQVBJIGZvciBjcmVhdGluZyBhIG5ldyBzYW5kYm94LiBFdmVyeSBzYW5kYm94IG11c3QgYmUgY29udGFpbmVkIHdpdGhpblxuICAgICAgICAgKiBhIHByb3h5IFVSTC4gRGVsZWdhdGVzIHRvIElGcmFtZUNyZWF0aW9uU3RyYXRlZ3kgZm9yIGFjdHVhbGx5IGNyZWF0aW5nXG4gICAgICAgICAqIHRoZSBpZnJhbWUsIHdoaWxlIHRha2luZyBjYXJlIG9mIHN0b3JpbmcgYW5kIGdlbmVyYXRpbmcgYW55IG1ldGFkYXRhIHVzZWRcbiAgICAgICAgICogdG8gdHJhY2sgdGhlIHNhbmRib3hlcy5cbiAgICAgICAgICogQHBhcmFtIHRhYklkIHRoZSB7c3RyaW5nfSBpZCBvZiB0aGUgdGFiXG4gICAgICAgICAqIEBwYXJhbSB7SVNhbmRib3hTcGVjaWZpY2F0aW9ufSBzYW5kYm94U3BlY1xuICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBzYW5kYm94SWRcbiAgICAgICAgICovXG4gICAgICAgIGNyZWF0ZVNhbmRib3godGFiSWQ6c3RyaW5nLCBzYW5kYm94U3BlYzpJU2FuZGJveFNwZWNpZmljYXRpb24pOnN0cmluZyB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0VXJsOnN0cmluZyA9IHNhbmRib3hTcGVjLnVybCxcbiAgICAgICAgICAgICAgICBwcm94eVVybDpzdHJpbmcgID0gc2FuZGJveFNwZWMucHJveHksXG4gICAgICAgICAgICAgICAgY3NzU3BlYzphbnkgICAgPSBzYW5kYm94U3BlYy5zYW5kYm94Q1NTU3BlY2lmaWNhdGlvbjtcblxuICAgICAgICAgICAgaWYgKCEodGFyZ2V0VXJsICYmIHByb3h5VXJsKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk11c3QgcHJvdmlkZSBib3RoIHByb3h5IGFuZCB0YXJnZXQgdXJsIHRvIGNyZWF0ZVNhbmRib3hcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBoYW5kbGUgPSB0aGlzLl9nZW5lcmF0ZVNhbmRib3hIYW5kbGUoKTtcblxuICAgICAgICAgICAgLy9Gb3IgYm90aCB0aGUgdGFyZ2V0IGFuZCBwcm94eSBVUkwgd2UgaGF2ZSB0byBtYWtlIHN1cmVcbiAgICAgICAgICAgIC8vdGhhdCBub25lIG9mIHRoZSBxdWVyeSBzdHJpbmcgcGFyYW1ldGVycyB3ZSB1c2UgaGF2ZVxuICAgICAgICAgICAgLy9hbHJlYWR5IGJlZW4gc2V0L2FwcGVuZGVkIHRvIHRoZSBVUkwuIFdlIGN1cnJlbnRseSB0aHJvd1xuICAgICAgICAgICAgLy9pZiB3ZSBkaXNjb3ZlciBhIFVSTCBjb250YWlucyBhIHJlc2VydmVkIHF1ZXJ5IHN0cmluZyBrZXkgbmFtZS5cbiAgICAgICAgICAgIGlmICh0YXJnZXRVcmwubWF0Y2goL1smXFw/XXVicFNhbmRib3hIYW5kbGU9LykpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0YXJnZXQgVVJMIGFscmVhZHkgY29udGFpbnMgYSByZXNlcnZlZCBxdWVyeSBzdHJpbmcga2V5OiB1YnBTYW5kYm94SGFuZGxlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9UT0RPOiBSZW1vdmUgdGhpcyBhcHBlbmRpbmcgb2YgcXVlcnkgcGFyYW1zIHRvIHRhcmdldFVybCBvbmNlIHdlIG1vdmUgdG8gSG9yaXpvbnRlLlxuICAgICAgICAgICAgdGFyZ2V0VXJsID0gYXBwZW5kUXVlcnlQYXJhbXModGFyZ2V0VXJsLHtcbiAgICAgICAgICAgICAgICBcInVicFNhbmRib3hIYW5kbGVcIiA6IFwiMVwiXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHByb3h5VXJsLm1hdGNoKC9bJlxcP110YXJnZXQ9LykpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJwcm94eSBVUkwgYWxyZWFkeSBjb250YWlucyBhIHJlc2VydmVkIHF1ZXJ5IHN0cmluZyBrZXk6IHRhcmdldFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcHJveHlVcmwgPSBhcHBlbmRRdWVyeVBhcmFtcyhwcm94eVVybCwge1xuICAgICAgICAgICAgICAgIFwidWJwU2FuZGJveEhhbmRsZVwiOiBoYW5kbGUsXG4gICAgICAgICAgICAgICAgXCJ0YXJnZXRcIiA6IHRhcmdldFVybFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuc3RyYXRlZ3kuY3JlYXRlU2FuZGJveCh0YWJJZCwgaGFuZGxlLHByb3h5VXJsLGNzc1NwZWMpO1xuXG4gICAgICAgICAgICB0aGlzLnBlbmRpbmdTYW5kYm94ZXNbaGFuZGxlXSA9IHRydWU7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogV2UgZ2V0IHRoZSBvcmlnaW4gb2YgdGhlIHNhbmRib3ggVVJMIGFuZCBhZGQgaXQgdG8gd2hpdGVsaXN0ZWQgb3JpZ2lucyBsaXN0IHdoaWxlIGNyZWF0aW5nXG4gICAgICAgICAgICAgKiBzYW5kYm94LiBXaGVuIHdlIHJlY2VpdmUgYSBtZXNzYWdlIGZyb20gYSBzYW5kYm94IHdlIGNoZWNrIGlmIGl0cyBmcm9tIHdoaXRlbGlzdGVkIG9yaWdpbnNcbiAgICAgICAgICAgICAqIHRoZW4gb25seSB3ZSBwcm9jZXNzIGl0LlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB2YXIgb3JpZ2luID0gdGhpcy5zdHJhdGVneS5ncm9rT3JpZ2luKHByb3h5VXJsKTtcbiAgICAgICAgICAgIGlmIChvcmlnaW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZFdoaXRlbGlzdGVkT3JpZ2luKG9yaWdpbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBoYW5kbGU7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogQVBJIGZvciBjcmVhdGluZyBhIG5ldyBzYW5kYm94IHVzaW5nIGdpdmVuIElELiBUaGlzIEFQSSBoYXMgYmVlblxuICAgICAgICAgKiBjcmVhdGVkIGFzIGEgZml4IHRvIG11bHRpcGxlIG1lc3NhZ2VzIGJlaW5nIGRlbGl2ZXJlZCB0byBjb250ZW50XG4gICAgICAgICAqIHNjcmlwdHMgaHR0cHM6Ly90dC5hbWF6b24uY29tLzAxMjI1ODcxNjQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEV2ZXJ5IHNhbmRib3ggbXVzdCBiZSBjb250YWluZWQgd2l0aGluIGEgcHJveHkgVVJMLiBEZWxlZ2F0ZXMgdG9cbiAgICAgICAgICogSUZyYW1lQ3JlYXRpb25TdHJhdGVneSBmb3IgYWN0dWFsbHkgY3JlYXRpbmcgdGhlIGlmcmFtZSwgd2hpbGVcbiAgICAgICAgICogdGFraW5nIGNhcmUgb2Ygc3RvcmluZyBhbmQgZ2VuZXJhdGluZyBhbnkgbWV0YWRhdGEgdXNlZCB0byB0cmFja1xuICAgICAgICAgKiB0aGUgc2FuZGJveGVzLlxuICAgICAgICAgKiBAcGFyYW0gdGFiSWQgdGhlIHtzdHJpbmd9IGlkIG9mIHRoZSB0YWJcbiAgICAgICAgICogQHBhcmFtIHtJU2FuZGJveFNwZWNpZmljYXRpb259IHNhbmRib3hTcGVjXG4gICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IHNhbmRib3hJZFxuICAgICAgICAgKi9cbiAgICAgICAgY3JlYXRlU2FuZGJveEJ5SWQodGFiSWQ6c3RyaW5nLCBzYW5kYm94U3BlYzpJU2FuZGJveFNwZWNpZmljYXRpb24pOnN0cmluZyB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0VXJsOnN0cmluZyA9IHNhbmRib3hTcGVjLnVybCxcbiAgICAgICAgICAgICAgICBwcm94eVVybDpzdHJpbmcgID0gc2FuZGJveFNwZWMucHJveHksXG4gICAgICAgICAgICAgICAgc2FuZGJveElkOnN0cmluZyAgPSBzYW5kYm94U3BlYy5zYW5kYm94SWQsXG4gICAgICAgICAgICAgICAgY3NzU3BlYzphbnkgICAgPSBzYW5kYm94U3BlYy5zYW5kYm94Q1NTU3BlY2lmaWNhdGlvbjtcblxuICAgICAgICAgICAgaWYgKCEodGFyZ2V0VXJsICYmIHByb3h5VXJsKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk11c3QgcHJvdmlkZSBib3RoIHByb3h5IGFuZCB0YXJnZXQgdXJsIHRvIGNyZWF0ZVNhbmRib3hcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKCFzYW5kYm94SWQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNdXN0IHByb3ZpZGUgc2FuZGJveCBJZCB0byBjcmVhdGVTYW5kYm94XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL2NoZWNrIGlmIGFscmVhZHkgZXhpc3RzXG4gICAgICAgICAgICB2YXIgc2FuZGJveCA9IHRoaXMuc3RyYXRlZ3kuX3NhbmRib3hJbk1lbW9yeVN0b3JhZ2UucmV0cmlldmVTYW5kYm94QnlTYW5kYm94SWQoc2FuZGJveElkKTtcbiAgICAgICAgICAgIGlmIChzYW5kYm94KSB7XG4gICAgICAgICAgICAgICAgLy9uby1vcC4gTm90IHRocm93aW5nIGhlcmUsIGJlY2F1c2Ugb2YgbXVsdGlwbGUgY29udGVudCBzY3JpcHQgbWVzc2FnZXMgYnVnIGh0dHBzOi8vdHQuYW1hem9uLmNvbS8wMTIyNTg3MTY0XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNhbmRib3hJZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9Gb3IgYm90aCB0aGUgdGFyZ2V0IGFuZCBwcm94eSBVUkwgd2UgaGF2ZSB0byBtYWtlIHN1cmVcbiAgICAgICAgICAgIC8vdGhhdCBub25lIG9mIHRoZSBxdWVyeSBzdHJpbmcgcGFyYW1ldGVycyB3ZSB1c2UgaGF2ZVxuICAgICAgICAgICAgLy9hbHJlYWR5IGJlZW4gc2V0L2FwcGVuZGVkIHRvIHRoZSBVUkwuIFdlIGN1cnJlbnRseSB0aHJvd1xuICAgICAgICAgICAgLy9pZiB3ZSBkaXNjb3ZlciBhIFVSTCBjb250YWlucyBhIHJlc2VydmVkIHF1ZXJ5IHN0cmluZyBrZXkgbmFtZS5cbiAgICAgICAgICAgIGlmICh0YXJnZXRVcmwubWF0Y2goL1smXFw/XXVicFNhbmRib3hIYW5kbGU9LykpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0YXJnZXQgVVJMIGFscmVhZHkgY29udGFpbnMgYSByZXNlcnZlZCBxdWVyeSBzdHJpbmcga2V5OiB1YnBTYW5kYm94SGFuZGxlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9UT0RPOiBSZW1vdmUgdGhpcyBhcHBlbmRpbmcgb2YgcXVlcnkgcGFyYW1zIHRvIHRhcmdldFVybCBvbmNlIHdlIG1vdmUgdG8gSG9yaXpvbnRlLlxuICAgICAgICAgICAgdGFyZ2V0VXJsID0gYXBwZW5kUXVlcnlQYXJhbXModGFyZ2V0VXJsLHtcbiAgICAgICAgICAgICAgICBcInVicFNhbmRib3hIYW5kbGVcIiA6IFwiMVwiXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHByb3h5VXJsLm1hdGNoKC9bJlxcP110YXJnZXQ9LykpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJwcm94eSBVUkwgYWxyZWFkeSBjb250YWlucyBhIHJlc2VydmVkIHF1ZXJ5IHN0cmluZyBrZXk6IHRhcmdldFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcHJveHlVcmwgPSBhcHBlbmRRdWVyeVBhcmFtcyhwcm94eVVybCwge1xuICAgICAgICAgICAgICAgIFwidWJwU2FuZGJveEhhbmRsZVwiOiBzYW5kYm94SWQsXG4gICAgICAgICAgICAgICAgXCJ0YXJnZXRcIiA6IHRhcmdldFVybFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuc3RyYXRlZ3kuY3JlYXRlU2FuZGJveCh0YWJJZCwgc2FuZGJveElkLHByb3h5VXJsLGNzc1NwZWMpO1xuXG4gICAgICAgICAgICB0aGlzLnBlbmRpbmdTYW5kYm94ZXNbc2FuZGJveElkXSA9IHRydWU7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogV2UgZ2V0IHRoZSBvcmlnaW4gb2YgdGhlIHNhbmRib3ggVVJMIGFuZCBhZGQgaXQgdG8gd2hpdGVsaXN0ZWQgb3JpZ2lucyBsaXN0IHdoaWxlIGNyZWF0aW5nXG4gICAgICAgICAgICAgKiBzYW5kYm94LiBXaGVuIHdlIHJlY2VpdmUgYSBtZXNzYWdlIGZyb20gYSBzYW5kYm94IHdlIGNoZWNrIGlmIGl0cyBmcm9tIHdoaXRlbGlzdGVkIG9yaWdpbnNcbiAgICAgICAgICAgICAqIHRoZW4gb25seSB3ZSBwcm9jZXNzIGl0LlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB2YXIgb3JpZ2luID0gdGhpcy5zdHJhdGVneS5ncm9rT3JpZ2luKHByb3h5VXJsKTtcbiAgICAgICAgICAgIGlmIChvcmlnaW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZFdoaXRlbGlzdGVkT3JpZ2luKG9yaWdpbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBzYW5kYm94SWQ7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogQVBJIGZvciBjcmVhdGluZyBhIG5ldyBzYW5kYm94IHVzaW5nIGdpdmVuIElELiBUaGlzIHNhbmRib3gvaWZyYW1lIHdpbGxcbiAgICAgICAgICogc2VuZCBhIFBPU1QgcmVxdWVzdCB0byBIb3Jpem9udGUuXG4gICAgICAgICAqIEV2ZXJ5IHNhbmRib3ggbXVzdCBiZSBjb250YWluZWQgd2l0aGluIGEgcHJveHkgVVJMLiBEZWxlZ2F0ZXMgdG9cbiAgICAgICAgICogSUZyYW1lQ3JlYXRpb25TdHJhdGVneSBmb3IgYWN0dWFsbHkgY3JlYXRpbmcgdGhlIGlmcmFtZSwgd2hpbGVcbiAgICAgICAgICogdGFraW5nIGNhcmUgb2Ygc3RvcmluZyBhbmQgZ2VuZXJhdGluZyBhbnkgbWV0YWRhdGEgdXNlZCB0byB0cmFja1xuICAgICAgICAgKiB0aGUgc2FuZGJveGVzLlxuICAgICAgICAgKiBAcGFyYW0gdGFiSWQgdGhlIHtzdHJpbmd9IGlkIG9mIHRoZSB0YWJcbiAgICAgICAgICogQHBhcmFtIHNhbmRib3hTcGVjIHtJU2FuZGJveFNwZWNpZmljYXRpb259XG4gICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IHNhbmRib3hJZFxuICAgICAgICAgKi9cbiAgICAgICAgY3JlYXRlU2FuZGJveEJ5SWRQb3N0KHRhYklkOnN0cmluZywgc2FuZGJveFNwZWM6SVNhbmRib3hTcGVjaWZpY2F0aW9uKTpzdHJpbmcge1xuICAgICAgICAgICAgdmFyIHRhcmdldDpzdHJpbmcgPSBzYW5kYm94U3BlYy51cmwsXG4gICAgICAgICAgICAgICAganNvbk1zZzpzdHJpbmcgPSBzYW5kYm94U3BlYy5qc29uTXNnLFxuICAgICAgICAgICAgICAgIHByb3h5VXJsOnN0cmluZyAgPSBzYW5kYm94U3BlYy5wcm94eSxcbiAgICAgICAgICAgICAgICBzYW5kYm94SWQ6c3RyaW5nICA9IHNhbmRib3hTcGVjLnNhbmRib3hJZCxcbiAgICAgICAgICAgICAgICBjc3NTcGVjOmFueSAgICA9IHNhbmRib3hTcGVjLnNhbmRib3hDU1NTcGVjaWZpY2F0aW9uO1xuXG4gICAgICAgICAgICBpZiAoISh0YXJnZXQgJiYganNvbk1zZyAmJiBwcm94eVVybCkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNdXN0IHByb3ZpZGUgcHJveHksIHRhcmdldCB1cmwgYW5kIGpzb25Nc2cgdG8gY3JlYXRlU2FuZGJveFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoIXNhbmRib3hJZCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk11c3QgcHJvdmlkZSBzYW5kYm94IElkIHRvIGNyZWF0ZVNhbmRib3hcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vY2hlY2sgaWYgYWxyZWFkeSBleGlzdHNcbiAgICAgICAgICAgIHZhciBzYW5kYm94ID0gdGhpcy5zdHJhdGVneS5fc2FuZGJveEluTWVtb3J5U3RvcmFnZS5yZXRyaWV2ZVNhbmRib3hCeVNhbmRib3hJZChzYW5kYm94SWQpO1xuICAgICAgICAgICAgaWYgKHNhbmRib3gpIHtcbiAgICAgICAgICAgICAgICAvL25vLW9wLiBOb3QgdGhyb3dpbmcgaGVyZSwgYmVjYXVzZSBvZiBtdWx0aXBsZSBjb250ZW50IHNjcmlwdCBtZXNzYWdlcyBidWcgaHR0cHM6Ly90dC5hbWF6b24uY29tLzAxMjI1ODcxNjRcbiAgICAgICAgICAgICAgICByZXR1cm4gc2FuZGJveElkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJveHlVcmwubWF0Y2goL1smXFw/XXRhcmdldD0vKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInByb3h5IFVSTCBhbHJlYWR5IGNvbnRhaW5zIGEgcmVzZXJ2ZWQgcXVlcnkgc3RyaW5nIGtleTogdGFyZ2V0XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwcm94eVVybCA9IGFwcGVuZFF1ZXJ5UGFyYW1zKHByb3h5VXJsLCB7XG4gICAgICAgICAgICAgICAgXCJ1YnBTYW5kYm94SGFuZGxlXCI6IHNhbmRib3hJZCxcbiAgICAgICAgICAgICAgICBcInRhcmdldFwiIDogdGFyZ2V0LFxuICAgICAgICAgICAgICAgIFwianNvbk1zZ1wiIDoganNvbk1zZ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuc3RyYXRlZ3kuY3JlYXRlU2FuZGJveCh0YWJJZCwgc2FuZGJveElkLHByb3h5VXJsLGNzc1NwZWMpO1xuICAgICAgICAgICAgdGhpcy5wZW5kaW5nU2FuZGJveGVzW3NhbmRib3hJZF0gPSB0cnVlO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFdlIGdldCB0aGUgb3JpZ2luIG9mIHRoZSBzYW5kYm94IFVSTCBhbmQgYWRkIGl0IHRvIHdoaXRlbGlzdGVkIG9yaWdpbnMgbGlzdCB3aGlsZSBjcmVhdGluZ1xuICAgICAgICAgICAgICogc2FuZGJveC4gV2hlbiB3ZSByZWNlaXZlIGEgbWVzc2FnZSBmcm9tIGEgc2FuZGJveCB3ZSBjaGVjayBpZiBpdHMgZnJvbSB3aGl0ZWxpc3RlZCBvcmlnaW5zXG4gICAgICAgICAgICAgKiB0aGVuIG9ubHkgd2UgcHJvY2VzcyBpdC5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdmFyIG9yaWdpbiA9IHRoaXMuc3RyYXRlZ3kuZ3Jva09yaWdpbihwcm94eVVybCk7XG4gICAgICAgICAgICBpZiAob3JpZ2luKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRXaGl0ZWxpc3RlZE9yaWdpbihvcmlnaW4pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc2FuZGJveElkO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFQSSBmb3IgYWx0ZXJpbmcgdGhlIHNhbmRib3gncyBDU1MgcnVsZXMuIFNpbXBseVxuICAgICAgICAgKiBkZWxlZ2F0ZXMgdG8gdGhlIElGcmFtZUNyZWF0aW9uU3RyYXRlZ3kuXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBoYW5kbGVcbiAgICAgICAgICogQHBhcmFtIHtJU2FuZGJveENTU1NwZWNpZmljYXRpb259IHNhbmRib3hDU1NTcGVjaWZpY2F0aW9uXG4gICAgICAgICAqL1xuICAgICAgICBtb2RpZnlTYW5kYm94KGhhbmRsZTpzdHJpbmcsc2FuZGJveENTU1NwZWNpZmljYXRpb246YW55KTp2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuc3RyYXRlZ3kubW9kaWZ5U2FuZGJveChoYW5kbGUsc2FuZGJveENTU1NwZWNpZmljYXRpb24pO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFQSSBmb3Igc2hvd2luZyhhcHBseWluZyBDU1Mgc3R5bGUgdG8pIHNhbmRib3guIEJlZm9yZSBzaG93aW5nIHNhbmRib3gsIHRoaXMgQVBJIGFsc28gYXBwbGllcyBzdHlsZVxuICAgICAgICAgKiB0byB0aGUgcGFnZSBzbyB0aGF0IGlmIGNhbGxlciB3YW50cyB0byBtb2RpZnkgcGFnZSBzdHlsZSB0aGV5IGNhbiBkbyBieSBwYXNzaW5nIHBhZ2VTdHlsZVNwZWNpZmljYXRpb24uXG4gICAgICAgICAqIEVnLiBwdXNoaW5nIHdlYnBhZ2UgZG93biBiZWZvcmUgc2hvd2luZyB0aGUgc3RyaXBlLlxuICAgICAgICAgKiBUaGlzIEFQSSBkZWxlZ2F0ZXMgdG8gdGhlIElGcmFtZUNyZWF0aW9uU3RyYXRlZ3kuXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBoYW5kbGVcbiAgICAgICAgICogQHBhcmFtIHtJU2FuZGJveENTU1NwZWNpZmljYXRpb259IHNhbmRib3hDU1NTcGVjaWZpY2F0aW9uXG4gICAgICAgICAqIEBwYXJhbSB7SVN0eWxlU3BlY2lmaWNhdGlvbn0gb3B0aW9uYWwgcGFnZVN0eWxlU3BlY2lmaWNhdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgc2hvd1NhbmRib3goaGFuZGxlOnN0cmluZywgc2FuZGJveENTU1NwZWNpZmljYXRpb246YW55LCBwYWdlU3R5bGVTcGVjaWZpY2F0aW9uPzogYW55KTp2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuc3RyYXRlZ3kuc2hvd1NhbmRib3goaGFuZGxlLCBzYW5kYm94Q1NTU3BlY2lmaWNhdGlvbiwgcGFnZVN0eWxlU3BlY2lmaWNhdGlvbik7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVtb3ZlcyB0aGUgc2FuZGJveCBhc3NvY2lhdGVkIHdpdGggdGhhdCBoYW5kbGUuIHN0cmF0ZWd5LmRlc3Ryb3lTYW5kYm94XG4gICAgICAgICAqIHBvdGVudGlhbGx5IHRocm93cyBpZiB0aGUgc2FuZGJveCBjYW5ub3QgYmUgZm91bmQuXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBoYW5kbGVcbiAgICAgICAgICovXG4gICAgICAgIGRlc3Ryb3lTYW5kYm94KGhhbmRsZTpzdHJpbmcpOnZvaWQge1xuICAgICAgICAgICAgLy9Zb3UgY2FuIGNhbGwgZGVsZXRlIG9uIGFuIG9iamVjdCBldmVuIGlmIHRoZSBwcm9wZXJ0eSBkb2Vzbid0IGV4aXN0IHdpdGhvdXQgYW55IGFkdmVyc2UgZWZmZWN0cy5cbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnBlbmRpbmdTYW5kYm94ZXNbaGFuZGxlXTtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmVzdGFibGlzaGVkU2FuZGJveGVzW2hhbmRsZV07XG4gICAgICAgICAgICB0aGlzLnN0cmF0ZWd5LmRlc3Ryb3lTYW5kYm94KGhhbmRsZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogTWFudWFsbHkgYWRkIGFuIG9yaWdpbiB0byB0aGUgbGlzdCBvZiB3aGl0ZWxpc3RlZCBvcmlnaW5zLlxuICAgICAgICAgKiBPcmlnaW5zIHRha2UgdGhlIGZvcm0gb2YgXCJodHRwczovL3d3dy5hbWF6b24uY29tXCIgb3JcbiAgICAgICAgICogPHByb3RvY29sPjovLzxob3N0PlxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gb3JpZ2luXG4gICAgICAgICAqL1xuICAgICAgICBhZGRXaGl0ZWxpc3RlZE9yaWdpbihvcmlnaW46c3RyaW5nKTp2b2lke1xuICAgICAgICAgICAgdGhpcy53aGl0ZWxpc3RlZE9yaWdpbnNbb3JpZ2luXSA9IG9yaWdpbjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBUEkgZm9yIHNlbmRpbmcgbWVzc2FnZSB0byBnaXZlbiBzYW5kYm94XG4gICAgICAgICAqIGRlbGVnYXRlcyB0byB0aGUgSUZyYW1lQ3JlYXRpb25TdHJhdGVneS5cbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGhhbmRsZSAtIHVuaXF1ZSBpZGVudGlmaWVyIHRvIHNlbmQgbWVzc2FnZSB0byBjb3JyZWN0IHRhYi4gc2VlIHtAbGluayBTYW5kYm94TWFuYWdlciNfZ2VuZXJhdGVTYW5kYm94SGFuZGxlfVxuICAgICAgICAgKiBAcGFyYW0ge2FueX0gbWVzc2FnZSAtIG1lc3NhZ2UgdG8gYmUgc2VudCB0byBzYW5kYm94IC0ge0BsaW5rIElTYW5kYm94TWVzc2FnZVdpdGhQYXlsb2FkfVxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZE1lc3NhZ2VUb1NhbmRib3goaGFuZGxlOnN0cmluZyxtZXNzYWdlOklTYW5kYm94TWVzc2FnZVdpdGhQYXlsb2FkKTp2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuc3RyYXRlZ3kuc2VuZE1lc3NhZ2VUb1NhbmRib3goaGFuZGxlLCBtZXNzYWdlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBUEkgZm9yIGluc3RydW1lbnRpbmcgYSBzYW5kYm94IGJ5IHNlbmRpbmcgbWVzc2FnZSB0byBnaXZlbiBzYW5kYm94LiBUaGlzIEFQSSdzIHJlc3BvbnNlIGlzIGhhbmRsZWQgaW4gX2hhbmRsZU1lc3NhZ2VcbiAgICAgICAgICogbWV0aG9kLiBUaGlzIGRlbGVnYXRlcyBpdCB0byB0aGUgSUZyYW1lQ3JlYXRpb25TdHJhdGVneS5cbiAgICAgICAgICogQHBhcmFtIHRhYklkIHRoZSB7c3RyaW5nfSBpZCBvZiB0aGUgdGFiXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzYW5kYm94U2VsZWN0b3IgLSBzZWxlY3RvciB0byBmaW5kIHRoZSBzYW5kYm94IHRvIHdoaWNoIHdlIGludGVuZCB0byBpbnN0cnVtZW50LiBFeDogXCJpZnJhbWVbc3JjKj1wY29tcHN0cmlwZV1cIlxuICAgICAgICAgKiBAcGFyYW0ge2FueX0gbWVzc2FnZSAtIG1lc3NhZ2UgdG8gYmUgc2VudCB0byBzYW5kYm94LiBUaGlzIGlzIG5vdCB5ZXQgc3RyaWN0bHkgdHlwZWQsIHRvIGhhbmRsZSBtdWx0aXBsZXMgdHlwZXMgb2ZcbiAgICAgICAgICogRE9NIGluc3RydW1lbnRhdGlvbnMgaW4gdGhlIHNpbmdsZSBBUEkuXG4gICAgICAgICAqIEBwYXJhbSB7UHJvbWlzZX0gcHJvbWlzZSAtIHJldHVybnMgYSBwcm9taXNlIHRvIHRoZSBjYWxsZXIgc28gdGhhdCBjYWxsZXIgY2FuIHdhaXQgdGlsbCBpdCBnZXRzIHJlc3BvbnNlIGZyb20gdGhlXG4gICAgICAgICAqIHNhbmRib3guIFdoaWNoKHRoZSByZXNvbHV0aW9uIG9mIHRoZSBwcm9taXNlKSBpcyBoYW5kbGVkIGluIF9oYW5kbGVNZXNzYWdlLlxuICAgICAgICAgKi9cbiAgICAgICAgaW5zdHJ1bWVudFNhbmRib3godGFiSWQ6c3RyaW5nLCBzYW5kYm94U2VsZWN0b3I6c3RyaW5nLCBtZXNzYWdlOmFueSk6UHJvbWlzZTxhbnk+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmF0ZWd5Lmluc3RydW1lbnRTYW5kYm94KHRhYklkLCBzYW5kYm94U2VsZWN0b3IsIG1lc3NhZ2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFQSSBmb3IgZ2V0dGluZyB0aGUgYXR0cmlidXRlIG9mIHRoZSBzYW5kYm94IGl0c2VsZlxuICAgICAgICAgKlxuICAgICAgICAgKiBDYW5ub3QgdXNlIHtAbGluayBpbnN0cnVtZW50U2FuZGJveH0gc2luY2UgdGhhdCByZXRyaWV2ZXMgcHJvcGVydGllcyBvZiB0aGUgZG9jdW1lbnQgaW5zaWRlIHRoZSBzYW5kYm94XG4gICAgICAgICAqIEBwYXJhbSB0YWJJZCB0aGUge0BsaW5rIHN0cmluZ30gaWQgb2YgdGhlIHRhYlxuICAgICAgICAgKiBAcGFyYW0gc2FuZGJveFNlbGVjdG9yIHRoZSB7QGxpbmsgc3RyaW5nfSBzZWxlY3RvciB0aGF0IGlkZW50aWZpZXMgdGhlIHNhbmRib3ggRXg6IFwiaWZyYW1lW3NyYyo9cGNvbXBzdHJpcGVdXCJcbiAgICAgICAgICogQHBhcmFtIG1lc3NhZ2UgdGhlIG1lc3NhZ2UgY29udGFpbmluZyB0aGUgYWN0aW9uIGFuZCBhdHRyaWJ1dGVcbiAgICAgICAgICogQHJldHVybiB0aGUgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZVxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0U2FuZGJveEF0dHJpYnV0ZSh0YWJJZDpzdHJpbmcsIHNhbmRib3hTZWxlY3RvcjpzdHJpbmcsIG1lc3NhZ2U6YW55KTpzdHJpbmcge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyYXRlZ3kuZ2V0U2FuZGJveEF0dHJpYnV0ZSh0YWJJZCwgc2FuZGJveFNlbGVjdG9yLCBtZXNzYWdlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnRlcm5hbCBtZXRob2QgZm9yIGZvcndhcmRpbmcgbWVzc2FnZXMgZnJvbSBzYW5kYm94ZXNcbiAgICAgICAgICogdXAgdG8gdGhlIFVCUCBieSBpbnZva2luZyB0aGUgZm9yd2FyZE1lc3NhZ2VGdW5jdGlvblxuICAgICAgICAgKiBwYXNzZWQgaW4gYXQgaW5zdGFudGlhdGlvbi5cbiAgICAgICAgICogQHBhcmFtIG1zZ1xuICAgICAgICAgKi9cbiAgICAgICAgX2hhbmRsZU1lc3NhZ2UobXNnOklFeHRlcm5hbFNhbmRib3hNZXNzYWdlKTp2b2lkIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogSXQgaW50ZXJjZXB0cyBhbGwgXCJJbnN0cnVtZW50TWVzc2FnZVwiIG1lc3NhZ2VzIGFuZCBiYXNlZCBvbiAnaW5zdHJ1bWVudE1lc3NhZ2VJZCcgaXQgY2FsbHMgcmVzcGVjdGl2ZSBoYW5kbGVyc1xuICAgICAgICAgICAgICogd2hpY2ggYXJlIGFscmVhZHkgcmVnaXN0ZXJlZCBpbiBTYW5kYm94TGlicmFyeS5pbnN0cnVtZW50TWVzc2FnZXMgbWFwLCB3aGljaCBpbiB0dXJuIGZvcndhcmRzIHRoZSBtZXNzYWdlIGJhY2tcbiAgICAgICAgICAgICAqIHRvIFVCUC5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWYobXNnLmRhdGEgJiYgbXNnLmRhdGEubVR5cGUgPT09IFwiSW5zdHJ1bWVudE1lc3NhZ2VcIikge1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBTYW5kYm94TGlicmFyeS5pbnN0cnVtZW50TWVzc2FnZXNbbXNnLmRhdGFbJ2luc3RydW1lbnRNZXNzYWdlSWQnXV0gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICBTYW5kYm94TGlicmFyeS5pbnN0cnVtZW50TWVzc2FnZXNbbXNnLmRhdGFbJ2luc3RydW1lbnRNZXNzYWdlSWQnXV0obXNnLmRhdGFbJ2RhdGEnXSk7XG4gICAgICAgICAgICAgICAgICAgIC8vd2UgcmVtb3ZlIHRoZSBoYW5kbGVyIGFmdGVyIGNhbGxpbmcgaXQgb25jZS5cbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIFNhbmRib3hMaWJyYXJ5Lmluc3RydW1lbnRNZXNzYWdlc1ttc2cuZGF0YVsnaW5zdHJ1bWVudE1lc3NhZ2VJZCddXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZm9yd2FyZE1lc3NhZ2VGdW5jdGlvbihtc2cuZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZHNoYWtpbmcgbWVzc2FnZXMgbGV0cyB1cyBzYXZlIGEgcmVmZXJlbmNlIHRvIHRoZSB3aW5kb3dcbiAgICAgICAgICogb2JqZWN0IG9mIHRoZSBzYW5kYm94IGZvciBsYXRlciB2ZXJpZmljYXRpb24gdGhhdCBpdHMgbWVzc2FnZXNcbiAgICAgICAgICogc2hvdWxkIGJlIHJlY29nbml6ZWQ7IHJlZnJlc2hlcyB0aGUgc291cmNlIGlmIHRoZSBzYW5kYm94IGhhc1xuICAgICAgICAgKiBoYW5kc2hha2VkIGJlZm9yZS5cbiAgICAgICAgICogQHBhcmFtIG1zZ1xuICAgICAgICAgKi9cbiAgICAgICAgX2hhbmRsZUhhbmRzaGFrZShtc2c6SUV4dGVybmFsU2FuZGJveE1lc3NhZ2UpOnZvaWQge1xuICAgICAgICAgICAgdmFyIGhhbmRsZSA9IG1zZy5kYXRhLmhhbmRsZTtcbiAgICAgICAgICAgIC8vaXNSZWxldmFudE1lc3NhZ2UgbWFrZXMgc3VyZSB0aGF0IHRoZSBtZXNzYWdlIGlzXG4gICAgICAgICAgICAvL2VpdGhlciBwZW5kaW5nIG9yIGVzdGFibGlzaGVkLlxuICAgICAgICAgICAgdGhpcy5lc3RhYmxpc2hlZFNhbmRib3hlc1toYW5kbGVdID0gbXNnLnNvdXJjZTsvL3JlZnJlc2ggcmVmIGlmIGhhbmRsZSBpcyBhbHJlYWR5IGVzdGFibGlzaGVkLlxuICAgICAgICAgICAgZGVsZXRlIHRoaXMucGVuZGluZ1NhbmRib3hlc1toYW5kbGVdO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrcyBpZiB0aGUgb3JpZ2luIGlzIHdoaXRlbGlzdGVkLlxuICAgICAgICAgKiBAcGFyYW0gb3JpZ2luXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgX2lzVmFsaWRPcmlnaW4ob3JpZ2luKTpib29sZWFuIHtcbiAgICAgICAgICAgIHJldHVybiAhIXRoaXMud2hpdGVsaXN0ZWRPcmlnaW5zW29yaWdpbl07XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogRGV0ZXJtaW5lcyBpZiBhIG1lc3NhZ2UgaXMgcmVsZXZhbnQgdG8gdGhlIFNhbmRib3hMaWJyYXJ5IGJ5IGRvaW5nXG4gICAgICAgICAqIGZvcm1hdCBjaGVja3MgYXMgd2VsbCBhcyBjaGVja2luZyBpZiBpdHMgaGFuZGxlIGlzIGluIG9uZSBvZiB0aGUgdHdvXG4gICAgICAgICAqIG1hcHMgZm9yIHRyYWNraW5nIHNhbmRib3hlcy5cbiAgICAgICAgICogQHBhcmFtIG1zZ1xuICAgICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIF9pc1JlbGV2YW50TWVzc2FnZShtc2c6YW55KTpib29sZWFuIHtcbiAgICAgICAgICAgIHJldHVybiAhISgvL0NvbnZlcnRzIHRoZSBmaW5hbCBldmFsIHJlc3VsdCB0byBib29sZWFuXG4gICAgICAgICAgICAgICAgbXNnICAgICAgICAgICAgICYmLy9tc2cgaXMgbm9uLW51bGwvdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgbXNnLnNvdXJjZSAgICAgICYmXG4gICAgICAgICAgICAgICAgbXNnLmRhdGEgICAgICAgICYmLy9mb3JtYXQgY2hlY2tzXG4gICAgICAgICAgICAgICAgbXNnLmRhdGEubVR5cGUgICYmXG4gICAgICAgICAgICAgICAgbXNnLmRhdGEuaGFuZGxlICYmXG4gICAgICAgICAgICAgICAgdGhpcy5faXNWYWxpZE9yaWdpbih0aGlzLnN0cmF0ZWd5Lmdyb2tPcmlnaW4obXNnLm9yaWdpbikpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrcyBpZiB0aGUgbWVzc2FnZSB0eXBlIG9mIGlzIG9mIGEgc2FuZGJveCBoYW5kc2hha2UuIFNob3VsZFxuICAgICAgICAgKiBiZSBjYWxsZWQgb25jZSB0aGUgbWVzc2FnZSBoYXMgYmVlbiBkZXRlcm1pbmVkIHRvIGJlIHJlbGV2YW50XG4gICAgICAgICAqIHZpYSBcImlzUmVsZXZhbnRNZXNzYWdlXCIuXG4gICAgICAgICAqIEBwYXJhbSBtc2dcbiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICBfaXNIYW5kc2hha2VNZXNzYWdlKG1zZzpJRXh0ZXJuYWxTYW5kYm94TWVzc2FnZSk6Ym9vbGVhbiB7XG4gICAgICAgICAgICByZXR1cm4gbXNnLmRhdGEubVR5cGUgPT09IFNhbmRib3hNYW5hZ2VyLlNBTkRCT1hfSEFORFNIQUtFO1xuICAgICAgICB9XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogR2VuZXJhdGVzIHRoZSBpZnJhbWUncyBpZCwgd2hpY2ggd2lsbCBiZSB1c2VkIGFzIGEgdW5pcXVlIGlkZW50aWZpZXIgYWNyb3NzIG11bHRpcGxlIHRhYnNcbiAgICAgICAgICogQHJldHVybnMge3N0cmluZ31cbiAgICAgICAgICpcbiAgICAgICAgICogU2FuZGJveEhhbmRsZSBsb29rcyBsaWtlIFwiVUJQTm90aWYraWlkPTE5MDM0NTYrc2lkPS01NDM1NTYzK3RpbWU9MTQyNTcxODI4MTk2MFwiXG4gICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBcIjxQUkVGSVg+K2lpZD08SU5TVEFOQ0U+K3NpZD08U0FOREJPWD4rdGltZT08VElNRVNUQU1QPlwiXG4gICAgICAgICAqIFVzZSBcIitcIiBhcyB0aGUgZGVsaW1pdGVyIGJlY2F1c2UgXCItXCIgd2lsbCBiZSBpbnNlcnRlZCB3aGVuIHdlIGhhdmUgbmVnYXRpdmUgaW50ZWdlcnMuXG4gICAgICAgICAqIFNlcGFyYXRlIGtleXMgYW5kIHRoZWlyIHZhbHVlcyB3aXRoIGFuIFwiPVwiLlxuICAgICAgICAgKlxuICAgICAgICAgKiBDb21iaW5lcyBhIHJhbmRvbWx5IGdlbmVyYXRlZCBpbnRlZ2VyIGZvciB0aGF0IHNhbmRib3ggYXMgd2VsbCBhcyB0aGUgaW5zdGFuY2UgaWQgZm9yXG4gICAgICAgICAqIHRoZSBjdXJyZW50IGluc3RhbmNlIG9mIFNhbmRib3hNYW5hZ2VyLiBUaW1lc3RhbXAgcHJvdmlkZXMgc29tZSBzZXF1ZW5jZSBpbmZvcm1hdGlvblxuICAgICAgICAgKiBndWFyYW50ZWVpbmcgdW5pcXVlbmVzcy4gKGFzdHJvbm9taWNhbGx5IGxvdyBwcm9iYWJpbGl0eSBmb3IgYSBoYW5kbGUgaWQgY29sbGlzaW9uXG4gICAgICAgICAqIGFtb25nIGN1cnJlbnQsIGFjdGl2ZSBzYW5kYm94ZXMgaW4gYSBzaW5nbGUgYnJvd3NlciBpbnN0YW5jZSkuIE9uZSBjb29sIHRoaW5nIGlzIHdlXG4gICAgICAgICAqIGNhbiBzdGFydCB0byBtZWFzdXJlIHRoZSBhY2N1cmFjeSBvZiBjbGllbnRzJyBcIkRhdGUubm93KCknc1wiIHNpbmNlIGl0J2xsIGJlIHByb3ZpZGVkXG4gICAgICAgICAqIGFzIGEgcXVlcnkgc3RyaW5nIGFyZyB0byB0aGUgaWZyYW1lIDopXG4gICAgICAgICAqL1xuICAgICAgICBfZ2VuZXJhdGVTYW5kYm94SGFuZGxlKCk6c3RyaW5nIHtcbiAgICAgICAgICAgIHJldHVybiBTYW5kYm94TWFuYWdlci5TQU5EQk9YX1BSRUZJWCArXG4gICAgICAgICAgICAgICAgXCJfaWlkPVwiICsgdGhpcy5pbnN0YW5jZUlkICtcbiAgICAgICAgICAgICAgICBcIl9zaWQ9XCIgKyByYW5kb21JbnRlZ2VyKCkgK1xuICAgICAgICAgICAgICAgIFwiX3RpbWU9XCIrIERhdGUubm93KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJRnJhbWVDcmVhdGlvblN0cmF0ZWd5IGhpZGVzIHRoZSBpbnRlcm5hbHMgb2YgYWN0dWFsbHlcbiAgICAgKiBjcmVhdGluZywgbW9kaWZ5aW5nLCBhbmQgZGVzdHJveWluZyBzYW5kYm94ZXMgZnJvbSB0aGVcbiAgICAgKiBTYW5kYm94TWFuYWdlci5cbiAgICAgKlxuICAgICAqIFRoZSBzdHJhdGVneSB1c2VzIFNoYWRvd0RPTSB0byBhY2NvbXBsaXNoIHRoZSBzYW5kYm94IGNyZWF0aW9uXG4gICAgICogVGhpcyBnaXZlcyBtb3JlIHByb3RlY3Rpb24gdG8gb3VyIGV4dGVuc2lvbiBlbGVtZW50IGZyb20gYmVpbmcgcmVtb3ZlZCBieSB0aGlyZCBwYXJ0aWVzXG4gICAgICogTW9yZSBkZXRhaWxzIGNhbiBiZSBmb3VuZCBpbiBodHRwczovL3cuYW1hem9uLmNvbS9iaW4vdmlldy9BbWF6b25Bc3Npc3RhbnQvUENvbXAvRGVzaWduRG9jcy9UZWNobmljYWxQcm90ZWN0aW9uQWdhaW5zdEV4dGVuc2lvbkVsZW1lbnRSZW1vdmFsL1xuICAgICAqL1xuICAgIGV4cG9ydCBjbGFzcyBJRnJhbWVDcmVhdGlvblN0cmF0ZWd5IHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUHJlZml4IG9mIHRoZSBzdHlsZSBoYW5kbGUuXG4gICAgICAgICAqIFByZWZpeCBjb21iaW5lZCB3aXRoIHNhbmRib3ggaGFuZGxlIHdpbGwgaWQgb2YgdGhlIHN0eWxlIHRhZy5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHN0YXRpYyBTVFlMRV9IQU5ETEVfUFJFRklYOiBzdHJpbmcgPSBcIlVCUFN0eWxlXCI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBsaXN0IG9mIHNlbGVjdG9ycyB0aGF0IHdlIGNhbiB1c2UgdG8gcXVlcnlcbiAgICAgICAgICogTmVlZCB0byBiZSBlbGVtZW50cyB0aGF0IGNhbiBhdHRhY2ggc2hhZG93RE9NIHRvXG4gICAgICAgICAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9FbGVtZW50L2F0dGFjaFNoYWRvdyNFbGVtZW50c195b3VfY2FuX2F0dGFjaF9hX3NoYWRvd190b1xuICAgICAgICAgKlxuICAgICAgICAgKiBTZWxlY3RlZCBkaXYgYW5kIHNwYW4gYXMgdGhleSBhcmUgdGhlIG1vc3QgY29tbW9uIGFuZCBhcHBlYXIgaW4gaGlnaCBvY2N1cmVuY2VcbiAgICAgICAgICovXG4gICAgICAgIHN0YXRpYyBTRUxFQ1RPUlNfVE9fUVVFUlk6c3RyaW5nW10gPSBbXCJkaXY6bm90KDplbXB0eSlcIiwgXCJzcGFuOm5vdCg6ZW1wdHkpXCJdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZWxlbWVudHMgdGhhdCB3ZSBjYW4gY3JlYXRlIHRvIGF0dGFjaCBzaGFkb3cgdG8gaW4gY2FzZSB0aGVyZSdzIG5vIGVsaWdpYmxlIGVsZW1lbnRzIG9uIHRoZSBwYWdlXG4gICAgICAgICAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9FbGVtZW50L2F0dGFjaFNoYWRvdyNFbGVtZW50c195b3VfY2FuX2F0dGFjaF9hX3NoYWRvd190b1xuICAgICAgICAgKlxuICAgICAgICAgKiBTZWxlY3RlZCBkaXYgYW5kIHNwYW4gYXMgaXQncyBjb21tb24gdG8gc2VlIG11bHRpcGxlIG9mIHRoZXNlXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgRUxFTUVOVF9UT19DUkVBVEVfQVNfRkFMTEJBQ0s6c3RyaW5nW10gPSBbXCJkaXZcIiwgXCJzcGFuXCJdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2VkIHRvIHN0b3JlLCByZXRyaWV2ZSBhbmQgZGVzdHJveSBzYW5kYm94ZXMgY3JlYXRlZFxuICAgICAgICAgKi9cbiAgICAgICAgX3NhbmRib3hJbk1lbW9yeVN0b3JhZ2U6U2FuZGJveEluTWVtb3J5U3RvcmFnZTtcblxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgICAgIHRoaXMuX3NhbmRib3hJbk1lbW9yeVN0b3JhZ2UgPSBuZXcgU2FuZGJveEluTWVtb3J5U3RvcmFnZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldHMgdGhlIG9yaWdpbiBieSBjcmVhdGluZyBhIGxpbmsgSFRNTCB0YWcgYW5kIHRoZW5cbiAgICAgICAgICogcmVhZGluZyB0aGUgcHJvcGVydGllcyBhZnRlciBzZXR0aW5nIHRoZSBocmVmIHRvIHRoZSBVUkwuXG4gICAgICAgICAqIEluIGNhc2UgaWYgdGhlIFVSTCBwcm92aWRlZCBoYXMgdXBwZXIgY2FzZSBsZXR0ZXJzLChlZy4gaW4gc2FmYXJpKVxuICAgICAgICAgKiB0aGlzIG1ldGhvZCBkb2VzIGNvbnZlcnQgdG8gbG93ZXIgY2FzZS5cbiAgICAgICAgICogQHBhcmFtIHVybFxuICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgZ3Jva09yaWdpbih1cmw6c3RyaW5nKTpzdHJpbmd7XG4gICAgICAgICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgICAgICAgICAgYS5ocmVmID0gdXJsO1xuICAgICAgICAgICAgcmV0dXJuIChhLnByb3RvY29sICsgXCIvL1wiICsgYS5ob3N0KS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZXMgYSBzYW5kYm94IGJ5IGF0dGFjaGluZyBhIHNoYWRvd0RPTSBjb250YWluaW5nIGFuIGlmcmFtZSB0byBhIHJhbmRvbSBlbGVtZW50IG9uIHRoZSBwYWdlXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB0YWJJZCBOZWVkZWQgdG8gY29ycmVsYXRlIHNhbmRib3hlcyB0byB0YWJJZCBmb3IgaW5zdHJ1bWVudGF0aW9uIHB1cnBvc2VzIG9ubHlcbiAgICAgICAgICogQHBhcmFtIHNhbmRib3hJZCB0aGUgaWRlbnRpZmllciBmb3IgdGhlIHNhbmRib3hcbiAgICAgICAgICogQHBhcmFtIHByb3h5VXJsIHRoZSB1cmwgdG8gc2V0IHNhbmRib3ggdG9cbiAgICAgICAgICogQHBhcmFtIGNzc1NwZWMgdGhlIGNzcyBzcGVjaWZpY2F0aW9uIHRvIGFkZCB0byBzYW5kYm94XG4gICAgICAgICAqL1xuICAgICAgICBjcmVhdGVTYW5kYm94KHRhYklkOnN0cmluZywgc2FuZGJveElkOiBzdHJpbmcsIHByb3h5VXJsOiBzdHJpbmcsIGNzc1NwZWM6IElTYW5kYm94Q1NTU3BlY2lmaWNhdGlvbik6IHZvaWQge1xuICAgICAgICAgICAgLy8gUXVlcmllcyBmb3IgYWxsIG5vbi1lbXB0eSBkaXYgb24gdGhlIHBhZ2VcbiAgICAgICAgICAgIHZhciBzZWxlY3RvclRvVXNlID0gSUZyYW1lQ3JlYXRpb25TdHJhdGVneS5TRUxFQ1RPUlNfVE9fUVVFUllbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogSUZyYW1lQ3JlYXRpb25TdHJhdGVneS5TRUxFQ1RPUlNfVE9fUVVFUlkubGVuZ3RoKV07XG4gICAgICAgICAgICB2YXIgb3JpZ2luYWxOb2Rlc09uUGFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3JUb1VzZSk7XG5cbiAgICAgICAgICAgIC8vIEZhbGxiYWNrIGxvZ2ljIGlmIGNhbm5vdCBmaW5kIGVsZW1lbnQgdG8gYXR0YWNoIHNoYWRvd0RPTVxuICAgICAgICAgICAgaWYgKCFvcmlnaW5hbE5vZGVzT25QYWdlIHx8IG9yaWdpbmFsTm9kZXNPblBhZ2UubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRUYWdUb1VzZSA9IElGcmFtZUNyZWF0aW9uU3RyYXRlZ3kuRUxFTUVOVF9UT19DUkVBVEVfQVNfRkFMTEJBQ0tbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogSUZyYW1lQ3JlYXRpb25TdHJhdGVneS5FTEVNRU5UX1RPX0NSRUFURV9BU19GQUxMQkFDSy5sZW5ndGgpXTtcbiAgICAgICAgICAgICAgICB2YXIgbmV3Tm9kZVRvSW5zZXJ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbGVtZW50VGFnVG9Vc2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2F0dGFjaFNoYWRvd0RPTUFuZEFwcGVuZFRvQm9keShuZXdOb2RlVG9JbnNlcnQsIHRhYklkLCBzYW5kYm94SWQsIHByb3h5VXJsLCBjc3NTcGVjKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBlbGVtZW50IGFuZCBhdHRhY2ggc2hhZG93RE9NXG4gICAgICAgICAgICB2YXIgcmFuZG9tTnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogb3JpZ2luYWxOb2Rlc09uUGFnZS5sZW5ndGgpO1xuICAgICAgICAgICAgdmFyIG9yaWdpbmFsTm9kZSA9IG9yaWdpbmFsTm9kZXNPblBhZ2VbcmFuZG9tTnVtYmVyXTtcbiAgICAgICAgICAgIHZhciBjbG9uZUVsZW1lbnRUb0F0dGFjaFRvOkVsZW1lbnQgPSB0aGlzLl9jcmVhdGVBbmRTYW5pdGl6ZUNsb25lRWxlbWVudChvcmlnaW5hbE5vZGUpO1xuICAgICAgICAgICAgdGhpcy5fYXR0YWNoU2hhZG93RE9NQW5kQXBwZW5kVG9Cb2R5KGNsb25lRWxlbWVudFRvQXR0YWNoVG8sIHRhYklkLCBzYW5kYm94SWQsIHByb3h5VXJsLCBjc3NTcGVjKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaXRoIHRoZSBvcmlnaW5hbCBlbGVtZW50LCBjcmVhdGUgYSBzYW5pdGl6ZWQgZGVlcCBjbG9uZSBvZiB0aGUgZWxlbWVudCB0aGF0IHdpbGwgZXZlbnR1YWxseSBob3N0IHRoZSBzaGFkb3dET01cbiAgICAgICAgICpcbiAgICAgICAgICogTm90ZSB0aGF0IHRoZSBjbG9uZSBuZWVkcyB0byBiZSBzYW5pdGl6ZWQgaW4gb3JkZXIgdG8gbm90IHJ1biBpbnRvIGVycm9ycyBvciBub3QgaGF2aW5nIHByb3BlcnRpZXMgYWZmZWN0aW5nIHRoZSBzaGFkb3dET01cbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIG9yaWdpbmFsTm9kZSB0aGUgb3JpZ2luYWwgbm9kZSB0byBjbG9uZVxuICAgICAgICAgKiBAcmV0dXJuIHRoZSBjbG9uZWQgZWxlbWVudCB0aGF0IGlzIGNhbmRpZGF0ZSBmb3IgaG9zdGluZyBzaGFkb3dET01cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9jcmVhdGVBbmRTYW5pdGl6ZUNsb25lRWxlbWVudChvcmlnaW5hbE5vZGU6Tm9kZSk6RWxlbWVudCB7XG4gICAgICAgICAgICB2YXIgY2xvbmVFbGVtZW50OkVsZW1lbnQgPSA8RWxlbWVudD4gb3JpZ2luYWxOb2RlLmNsb25lTm9kZSh0cnVlKTtcblxuICAgICAgICAgICAgLy8gQ2xlYW4gdXAgaW1wb3J0YW50IGF0dHJpYnV0ZXNcbiAgICAgICAgICAgIC8vIE5vIGlkIG9yIGNsYXNzIHRvIHByZXZlbnQgcGFyZW50IHBhZ2UncyBjc3MgZnJvbSBiZWluZyBhcHBsaWVkIG9uIGlkIG9yIGNsYXNzXG4gICAgICAgICAgICAvLyBObyBzdHlsZSB0byBwcmV2ZW50IGRpc3BsYXkgb3IgdmlzaWJpbGl0eSBmcm9tIGFmZmVjdGluZyBpZnJhbWVcbiAgICAgICAgICAgIC8vIE5vIGhpZGRlbiB0byBwcmV2ZW50IGhpZGRlbiBmcm9tIGFmZmVjdGluZyBpZnJhbWVcbiAgICAgICAgICAgIGNsb25lRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoXCJpZFwiKTtcbiAgICAgICAgICAgIGNsb25lRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoXCJjbGFzc1wiKTtcbiAgICAgICAgICAgIGNsb25lRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoXCJzdHlsZVwiKTtcbiAgICAgICAgICAgIGNsb25lRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoXCJoaWRkZW5cIik7XG5cbiAgICAgICAgICAgIC8vIENsZWFuIHVwIGFsbCBvdGhlciBhdHRyaWJ1dGVzXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNsb25lRWxlbWVudC5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY2xvbmVFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShjbG9uZUVsZW1lbnQuYXR0cmlidXRlc1tpXS5uYW1lKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUmVtb3ZlIGFsbCBjaGlsZHJlbiB3aXRoIGlkcyB0byBwcmV2ZW50IGR1cGxpY2F0ZSBpZHNcbiAgICAgICAgICAgIC8vIE5vdCBjbGVhbmluZyBhdHRyaWJ1dGUgc2luY2UgaXQgd2lsbCBiZSBoZWF2eSB0byBsb2FkIHRoZSBzdHJpcGUgaWYgd2UgYXBwZW5kZWQgbG90cyBvZiBET00gZWxlbWVudHMgdG8gdHJlZVxuICAgICAgICAgICAgdmFyIGNoaWxkcmVuV2l0aElkcyA9IGNsb25lRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2lkXVwiKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW5XaXRoSWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgKDxFbGVtZW50PmNoaWxkcmVuV2l0aElkc1tpXSkucmVtb3ZlQXR0cmlidXRlKFwiaWRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY2xvbmVFbGVtZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdlbmVyYXRlcyBhIHJhbmRvbSBjbGFzcyBuYW1lIG9mIHJhbmRvbSBsZW5ndGhcbiAgICAgICAgICogQHJldHVybnMge3N0cmluZ30gdGhlIHJhbmRvbSBjbGFzcyBuYW1lIGJldHdlZW4gbGVuZ3RoIG9mIDQtMTVcbiAgICAgICAgICovXG4gICAgICAgIF9nZW5lcmF0ZVJhbmRvbUNsYXNzTmFtZSgpOiBzdHJpbmcge1xuICAgICAgICAgICAgLy8gR2VuZXJhdGUgYSBVVUlEVjQgYmFzZWQgc3RyaW5nXG4gICAgICAgICAgICAvLyBTZWU6IGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVW5pdmVyc2FsbHlfdW5pcXVlX2lkZW50aWZpZXIjVmVyc2lvbl80Xy4yOHJhbmRvbS4yOVxuICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9ICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgICAgICB2YXIgciA9IE1hdGgucmFuZG9tKCkgKiAxNiB8IDA7XG5cbiAgICAgICAgICAgICAgICAvLyByICYgMHgzIHwgMHg4IGNvZXJjZXMgYW55IFIgdmFsdWUgdG8gb25lIG9mOlxuICAgICAgICAgICAgICAgIC8vIDBiMDEwMDAgKDB4OClcbiAgICAgICAgICAgICAgICAvLyAwYjAxMDAxICgweDkpXG4gICAgICAgICAgICAgICAgLy8gMGIwMTAxMCAoMHhBKVxuICAgICAgICAgICAgICAgIC8vIDBiMDEwMTEgKDB4QilcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIEJlY2F1c2U6XG4gICAgICAgICAgICAgICAgLy8gMHgzICAgICAgID0gMGIwMDAxMVxuICAgICAgICAgICAgICAgIC8vIDB4OCAgICAgICA9IDBiMDEwMDBcbiAgICAgICAgICAgICAgICAvLyAweDMgfCAweDggPSAwYjAxMDExXG4gICAgICAgICAgICAgICAgLy8gciAmIDB4MyAgID0gKDBiMDAwMDAgfCAwYjAwMDAxIHwgMGIwMDAxMCB8IDBiMDAwMTEpXG5cbiAgICAgICAgICAgICAgICB2YXIgdiA9IChjID09ICd4JyA/IHIgOiAociAmIDB4MyB8IDB4OCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gYmFzZTY0IGVuY29kZSB0aGUgc3RyaW5nXG4gICAgICAgICAgICBjbGFzc05hbWUgPSB3aW5kb3cuYnRvYShjbGFzc05hbWUpO1xuICAgICAgICAgICAgLy8gR2VuZXJhdGUgYSBzdWJzdHJpbmcgb2YgcmFuZG9tIGxlbmd0aCwgYmV0d2VlbiBsZW5ndGggb2YgNCBhbmQgMTVcbiAgICAgICAgICAgIGlmIChjbGFzc05hbWUubGVuZ3RoID49IDE1KSB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lLnN1YnN0cmluZygwLCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBNYXRoLm1pbigxMSwgKGNsYXNzTmFtZS5sZW5ndGggLSA0KSkpICsgNCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY2xhc3NOYW1lO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEF0dGFjaCBhIGNsb3NlZCBzaGFkb3dET00gdG8gdGhlIGVsZW1lbnQgaW5wdXR0ZWQgYW5kIHRoZW4gYWRkIHRoZSBlbGVtZW50IHRvIHRoZSBET00ncyBib2R5XG4gICAgICAgICAqXG4gICAgICAgICAqIEJ5IGF0dGFjaGluZyBhIGNsb3NlZCBzaGFkb3dET00sIHlvdSBhcmUgbWFraW5nIGFueXRoaW5nIGluc2lkZSB0aGUgc2hhZG93RE9NIHVuZGV0ZWN0YWJsZSBieSB0aGUgcGFnZSBvd25lclxuICAgICAgICAgKiB3aGlsZSB0aGUgY29udGVudCBvZiB0aGUgc2hhZG93RE9NIGlzIHN0aWxsIGJlaW5nIHJlbmRlcmVkLlxuICAgICAgICAgKiBTZWUgZGVzaWduIGRvYyBpbiBodHRwczovL3cuYW1hem9uLmNvbS9iaW4vdmlldy9BbWF6b25Bc3Npc3RhbnQvUENvbXAvRGVzaWduRG9jcy9UZWNobmljYWxQcm90ZWN0aW9uQWdhaW5zdEV4dGVuc2lvbkVsZW1lbnRSZW1vdmFsL1xuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gZWxlbWVudFRvQXR0YWNoU2hhZG93IHRoZSB7RWxlbWVudH0gdG8gYXR0YWNoIHNoYWRvd0RPTSB0bywgdGhpcyBzaG91bGQgYmUgYSBjbGVhbiB1bmF0dGFjaGVkIGVsZW1lbnRcbiAgICAgICAgICogQHBhcmFtIHRhYklkIHRoZSB7c3RyaW5nfSBpZCBvZiB0aGUgdGFiLCBuZWVkZWQgc2luY2Ugd2Ugb25seSBoYXZlIHRhYklkIGR1cmluZyBzYW5kYm94IGluc3RydW1lbnRhdGlvblxuICAgICAgICAgKiBAcGFyYW0gc2FuZGJveElkIHRoZSB7c3RyaW5nfSBzYW5kYm94IGlkIHRvIGNyZWF0ZSBzYW5kYm94IHVuZGVyIGFuZCB0byBzdG9yZSBzaGFkb3dSb290IHVuZGVyXG4gICAgICAgICAqIEBwYXJhbSBwcm94eVVybCB0aGUgcHJveHkgdXJsIHRvIHNldCBzYW5kYm94IHRvXG4gICAgICAgICAqIEBwYXJhbSBjc3NTcGVjIHRoZSBjc3NTcGVjIHRvIGFkZCB0byBzYW5kYm94XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfYXR0YWNoU2hhZG93RE9NQW5kQXBwZW5kVG9Cb2R5KGVsZW1lbnRUb0F0dGFjaFNoYWRvdzogRWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJJZDogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbmRib3hJZDogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5VXJsOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzU3BlYzogSVNhbmRib3hDU1NTcGVjaWZpY2F0aW9uKTogdm9pZCB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIC8vIEFkZCBjbGFzcyBuYW1lIHRvIGhvc3QgZWxlbWVudCwgcmFuZG9taXplZCBzbyBpdCBjYW5ub3QgYmUgdGFyZ2V0ZWRcbiAgICAgICAgICAgICAgICBlbGVtZW50VG9BdHRhY2hTaGFkb3cuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgdGhpcy5fZ2VuZXJhdGVSYW5kb21DbGFzc05hbWUoKSk7XG5cbiAgICAgICAgICAgICAgICAvLyBBdHRhY2ggYSBzaGFkb3cgcm9vdCB0byBjcmVhdGUgYSBzaGFkb3dET01cbiAgICAgICAgICAgICAgICB2YXIgc2hhZG93Um9vdDpBQURvY3VtZW50RnJhZ21lbnQgPSBlbGVtZW50VG9BdHRhY2hTaGFkb3cuYXR0YWNoU2hhZG93KHttb2RlOiBcImNsb3NlZFwifSk7XG4gICAgICAgICAgICAgICAgc2hhZG93Um9vdC5faG9zdEVsZW1lbnRPZlNoYWRvd1Jvb3QgPSBlbGVtZW50VG9BdHRhY2hTaGFkb3c7XG5cbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIGlmcmFtZSBhbmQgY3VzdG9taXplIGl0XG4gICAgICAgICAgICAgICAgdmFyIHNhbmRib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xuICAgICAgICAgICAgICAgIHNhbmRib3guc3R5bGUuY3NzVGV4dCA9IHRoaXMuX2J1aWxkQ3NzU3RyaW5nKHRoaXMuX2RlZmF1bHRDU1NSdWxlcykuY29uY2F0KHRoaXMuX2J1aWxkQ3NzU3RyaW5nKGNzc1NwZWMpKTtcbiAgICAgICAgICAgICAgICBzYW5kYm94LnNyYyA9IHByb3h5VXJsOy8vc2V0IHRoZSBzb3VyY2VcbiAgICAgICAgICAgICAgICBzYW5kYm94LnNldEF0dHJpYnV0ZShcImlkXCIsIHNhbmRib3hJZCk7Ly9zZXQgdGhlIGlkXG5cbiAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIGlmcmFtZSB0byB0aGUgc2hhZG93IHJvb3RcbiAgICAgICAgICAgICAgICBzaGFkb3dSb290LmFwcGVuZENoaWxkKHNhbmRib3gpO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbWVudFRvQXR0YWNoU2hhZG93KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX3NhbmRib3hJbk1lbW9yeVN0b3JhZ2Uuc3RvcmVTaGFkb3dSb290KHNoYWRvd1Jvb3QsIHRhYklkLCBzYW5kYm94SWQsIHByb3h5VXJsKTtcblxuICAgICAgICAgICAgfSBjYXRjaChlcnIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFcnJvciBvY2N1cnJlZCB3aGlsZSBhdHRhY2hpbmcgc2hhZG93OiBcIiArIGVyci50b1N0cmluZygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcHBlbmRzIGEgY3NzIHN0eWxlIHN0cmluZyB0byB0aGUgY3NzVGV4dCBwcm9wZXJ0eVxuICAgICAgICAgKiBvZiB0aGUgaWZyYW1lLlxuICAgICAgICAgKiBAcGFyYW0gc2FuZGJveElkIHRoZSB7c3RyaW5nfSBpZCBvZiB0aGUgc2FuZGJveFxuICAgICAgICAgKiBAcGFyYW0gY3NzU3BlYyB0aGUge0lTYW5kYm94Q1NTU3BlY2lmaWNhdGlvbn0gdG8gYWRkIHRvIHRoZSBzYW5kYm94J3MgY3NzIHN0eWxlIHN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgbW9kaWZ5U2FuZGJveChzYW5kYm94SWQ6IHN0cmluZywgY3NzU3BlYzogSVNhbmRib3hDU1NTcGVjaWZpY2F0aW9uKTogdm9pZCB7XG4gICAgICAgICAgICB2YXIgc2FuZGJveCA9IHRoaXMuX3NhbmRib3hJbk1lbW9yeVN0b3JhZ2UucmV0cmlldmVTYW5kYm94QnlTYW5kYm94SWQoc2FuZGJveElkKTtcbiAgICAgICAgICAgIGlmICghc2FuZGJveCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBtb2RpZnkgc2FuZGJveDsgd2Fzbid0IGZvdW5kXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2FuZGJveC5zdHlsZS5jc3NUZXh0ICs9IHRoaXMuX2J1aWxkQ3NzU3RyaW5nKGNzc1NwZWMpO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgQVBJIGFwcGxpZXMgZ2l2ZW4gc2FuZGJveCBjc3Mgc3BlYyB0byB0aGUgU2FuZGJveCBhbmQgYWxzbyBhcHBsaWVzIHBhZ2Ugc3R5bGUgdG8gZ2l2ZW5cbiAgICAgICAgICogcGFnZUVsZW1lbnRTZWxlY3RvclxuICAgICAgICAgKiBAcGFyYW0gc2FuZGJveElkIC0gSUQgb2YgdGhlIHNhbmRib3ggd2hpY2ggbmVlZHMgdG8gYmUgc2hvd25cbiAgICAgICAgICogQHBhcmFtIGNzc1NwZWMgLSBjc3NTcGVjIG9mIHRoZSBzYW5kYm94IHdoaWNoIHdpbGwgYmUgYXBwbGllZCB0byBET01cbiAgICAgICAgICogQHBhcmFtIHBhZ2VTdHlsZVNwZWNpZmljYXRpb24gLSBvcHRpb25hbCBwYWdlIHN0eWxlIHNwZWNpZmljYXRpb24gd2hpY2ggd2lsbCBiZSBhcHBsaWVkIHRvIHBhZ2UgYmVmb3JlXG4gICAgICAgICAqIHNob3dpbmcgdGhlIHNhbmRib3hcbiAgICAgICAgICovXG4gICAgICAgIHNob3dTYW5kYm94KHNhbmRib3hJZDogc3RyaW5nLCBjc3NTcGVjOiBJU2FuZGJveENTU1NwZWNpZmljYXRpb24sIHBhZ2VTdHlsZVNwZWNpZmljYXRpb24/OiBJU3R5bGVTcGVjaWZpY2F0aW9uKTogdm9pZCB7XG4gICAgICAgICAgICB2YXIgc2FuZGJveCA9IHRoaXMuX3NhbmRib3hJbk1lbW9yeVN0b3JhZ2UucmV0cmlldmVTYW5kYm94QnlTYW5kYm94SWQoc2FuZGJveElkKTtcbiAgICAgICAgICAgIGlmICghc2FuZGJveCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzaG93IHNhbmRib3g7IHdhc24ndCBmb3VuZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHBhcmVudCBwYWdlIHN0eWxlIGFwcGxpY2F0aW9uIGlzIG9wdGlvbmFsLCBhcHBseSBvbmx5IGlmIGV4aXRzXG4gICAgICAgICAgICBpZiAocGFnZVN0eWxlU3BlY2lmaWNhdGlvbiAmJlxuICAgICAgICAgICAgICAgIHBhZ2VTdHlsZVNwZWNpZmljYXRpb24uZWxlbWVudENzc1NlbGVjdG9yICYmXG4gICAgICAgICAgICAgICAgcGFnZVN0eWxlU3BlY2lmaWNhdGlvbi5pbmxpbmVDc3MgJiZcbiAgICAgICAgICAgICAgICBwYWdlU3R5bGVTcGVjaWZpY2F0aW9uLnN0eWxlSGFuZGxlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQ6SFRNTEVsZW1lbnQgPSB0aGlzLl9nZXRQYXJlbnRQYWdlRWxlbWVudChwYWdlU3R5bGVTcGVjaWZpY2F0aW9uLmVsZW1lbnRDc3NTZWxlY3Rvcik7XG4gICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50LmRhdGFzZXRbXCJ1YnBPbGRTdHlsZVwiXSkge1xuICAgICAgICAgICAgICAgICAgICAvL3dlIHN0b3JlIG9yaWdpbmFsIHBhZ2Ugc3R5bGUgZmlyc3QgdGltZSwgaWYgbm90IGZvdW5kIHdlIHNob3VsZG4ndCBnZXQgbmV4dCB0aW1lXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZGF0YXNldFtcInVicE9sZFN0eWxlXCJdID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJzdHlsZVwiKSB8fCBcIi1jdXN0b20tbm9vcDogbm9vcDtcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhc2V0W1widWJwU3R5bGVIYW5kbGVcIl0gPSBwYWdlU3R5bGVTcGVjaWZpY2F0aW9uLnN0eWxlSGFuZGxlO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN0eWxlVG9TZXQgPSBudWxsO1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmRhdGFzZXRbXCJ1YnBPbGRTdHlsZVwiXSkge1xuICAgICAgICAgICAgICAgICAgICBzdHlsZVRvU2V0ID0gW2VsZW1lbnQuZGF0YXNldFtcInVicE9sZFN0eWxlXCJdLCBwYWdlU3R5bGVTcGVjaWZpY2F0aW9uLmlubGluZUNzc10uam9pbihcIjsgXCIpICsgXCI7IFwiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlVG9TZXQgPSBwYWdlU3R5bGVTcGVjaWZpY2F0aW9uLmlubGluZUNzcyArIFwiOyBcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBzdHlsZVRvU2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gRm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCBpbmNsdWRlIGJvdGggdGhlIHNpbmd1bGFyIGFuZCB0aGUgYXJyYXkgb2YgcnVsZXMuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gSWYgdGhlIHNpbmdsZSBydWxlIHNlbGVjdHMgdGhlIHNhbWUgZWxlbWVudChzKSBhcyBhbnkgcnVsZSBpbiB0aGUgYXJyYXksXG4gICAgICAgICAgICAvLyB0aGUgZGVjbGFyYXRpb25zIGluIHRoZSBzaW5nbGUgcnVsZSB3aWxsIG92ZXJyaWRlIGFueSBjb25mbGljdGluZyBkZWNsYXJhdGlvbnNcbiAgICAgICAgICAgIC8vIGluIHRoZSBydWxlIGZyb20gdGhlIGFycmF5LiBEZWNsYXJhdGlvbnMgdGhhdCBkbyBub3QgY29uZmxpY3Qgd2lsbCBib3RoIGFwcGx5LlxuICAgICAgICAgICAgLy8gXG4gICAgICAgICAgICAvLyBGb3IgZXhhbXBsZTpcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBwYWdlU3R5bGVTcGVjaWZpY2F0aW9uLnN0eWxlU2hlZXRDU1NSdWxlID0gXCIubXlDbGFzcyB7IGNvbG9yOiAjMDAwOyBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOyB9XCJcbiAgICAgICAgICAgIC8vIHBhZ2VTdHlsZVNwZWNpZmljYXRpb24uc3R5bGVTaGVldENTU1J1bGVzID0gW1wiLm15Q2xhc3MgeyBjb2xvcjogI2ZmZjsgYm9yZGVyOiBzb2xpZCAxcHggIzAwMDsgfVwiXVxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIHdpbGwgcmVzdWx0IGluIGJlaGF2aW9yIGVxdWl2YWxlbnQgdG86IFwiLm15Q2xhc3MgeyBjb2xvcjogIzAwMDsgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsgYm9yZGVyOiBzb2xpZCAxcHggIzAwMDsgfVwiXG4gICAgICAgICAgICBpZiAocGFnZVN0eWxlU3BlY2lmaWNhdGlvbikge1xuICAgICAgICAgICAgICAgIHZhciBjc3NSdWxlcyA9IHBhZ2VTdHlsZVNwZWNpZmljYXRpb24uc3R5bGVTaGVldENTU1J1bGVzIHx8IFtdO1xuICAgICAgICAgICAgICAgIGlmICghIXBhZ2VTdHlsZVNwZWNpZmljYXRpb24uc3R5bGVTaGVldENTU1J1bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY3NzUnVsZXMucHVzaChwYWdlU3R5bGVTcGVjaWZpY2F0aW9uLnN0eWxlU2hlZXRDU1NSdWxlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoY3NzUnVsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9hcHBseVN0eWxlU2hlZXRDU1NSdWxlKHNhbmRib3hJZCwgY3NzUnVsZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNhbmRib3guc3R5bGUuY3NzVGV4dCArPSB0aGlzLl9idWlsZENzc1N0cmluZyhjc3NTcGVjKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQb3N0cyBnaXZlbiBtZXNzYWdlIHRvIGlmcmFtZS9zYW5kYm94IHVzaW5nIHBvc3RNZXNzYWdlIHN0cmF0ZWd5LlxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2FuZGJveElkIC0gdW5pcXVlIGlkZW50aWZpZXIgdG8gc2VuZCBtZXNzYWdlIHRvIGNvcnJlY3QgdGFiLiBzZWUge0BsaW5rIFNhbmRib3hNYW5hZ2VyI19nZW5lcmF0ZVNhbmRib3hIYW5kbGV9XG4gICAgICAgICAqIEBwYXJhbSB7YW55fSBtZXNzYWdlIC0gbWVzc2FnZSB0byBiZSBzZW50IHRvIHNhbmRib3ggLSB7QGxpbmsgSVNhbmRib3hNZXNzYWdlV2l0aFBheWxvYWR9XG4gICAgICAgICAqL1xuICAgICAgICBzZW5kTWVzc2FnZVRvU2FuZGJveChzYW5kYm94SWQ6c3RyaW5nLCBtZXNzYWdlOklTYW5kYm94TWVzc2FnZVdpdGhQYXlsb2FkKTp2b2lkIHtcbiAgICAgICAgICAgIHZhciBzYW5kYm94ID0gPEhUTUxJRnJhbWVFbGVtZW50PnRoaXMuX3NhbmRib3hJbk1lbW9yeVN0b3JhZ2UucmV0cmlldmVTYW5kYm94QnlTYW5kYm94SWQoc2FuZGJveElkKTtcbiAgICAgICAgICAgIGlmICghc2FuZGJveCB8fCAhc2FuZGJveC5jb250ZW50V2luZG93KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHNlbmQgbWVzc2FnZSB0byBzYW5kYm94OyBTYW5kYm94IHdpdGggaWQ6ICdcIiArIHNhbmRib3hJZCArIFwiJyBpcyBub3QgdmFsaWRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHNhbmRib3guY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZShtZXNzYWdlLCBcIipcIik7IC8vWFhYOiBGSVhNRTogcGFzcyBwcm94eSBVUkwgYXMgdGFyZ2V0T3JpZ2luXG4gICAgICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3I6RXJyb3IgPSBuZXcgRXJyb3IoXCJFcnJvciB3aGlsZSBzZW5kaW5nIG1lc3NhZ2UgdG8gc2FuZGJveDogXCIgKyBlKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBUEkgZm9yIGluc3RydW1lbnRpbmcgYSBzYW5kYm94IGJ5IHNlbmRpbmcgbWVzc2FnZSB0byBnaXZlbiBzYW5kYm94LiBUaGlzIEFQSSdzIHJlc3BvbnNlIGlzIGhhbmRsZWQgaW4gX2hhbmRsZU1lc3NhZ2VcbiAgICAgICAgICogbWV0aG9kLiBUaGlzIG1ldGhvZCBnZW5lcmF0ZXMgYSB1bmlxdWUgbWVzc2FnZUlkLCBhdHRhY2hlcyBpdCB0byB0aGUgbWVzc2FnZSBhbmQgdGhlbiBzZW5kcyB0aGUgbWVzc2FnZSB0byB0aGVcbiAgICAgICAgICogcmlnaHQgc2FuZGJveCBiYXNlZCBvbiBnaXZlbiBzZWxlY3Rvci4gVGhpcyBtZXRob2QgcmV0dXJucyBhIHByb21pc2UgdG8gdGhlIGNhbGxlciwgdGhlIHByb21pc2UgcmVzb2x1dGlvbiBoYXBwZW5zXG4gICAgICAgICAqIGluIF9oYW5kbGVNZXNzYWdlIHdoZW4gaXQgcmVjZWl2ZXMgdGhlIG1lc3NhZ2UgYmFjayBmcm9tIHRoZSBzYW5kYm94IHdpdGggdGhlIHNhbWUgbWVzc2FnZUlkLlxuICAgICAgICAgKiBAcGFyYW0gdGFiSWQgdGhlIHtzdHJpbmd9IGlkIG9mIHRoZSB0YWJcbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHNhbmRCb3hTZWxlY3RvciAtIHNlbGVjdG9yIHRvIGZpbmQgdGhlIHNhbmRib3ggdG8gd2hpY2ggd2UgaW50ZW5kIHRvIGluc3RydW1lbnQuIEV4OiBcImlmcmFtZVtzcmMqPXBjb21wc3RyaXBlXVwiXG4gICAgICAgICAqIEBwYXJhbSB7YW55fSBtZXNzYWdlIC0gbWVzc2FnZSB0byBiZSBzZW50IHRvIHNhbmRib3guIFRoaXMgaXMgbm90IHlldCBzdHJpY3RseSB0eXBlZCwgdG8gaGFuZGxlIG11bHRpcGxlcyB0eXBlcyBvZlxuICAgICAgICAgKiBET00gaW5zdHJ1bWVudGF0aW9ucyBpbiB0aGUgc2luZ2xlIEFQSS5cbiAgICAgICAgICogQHJldHVybnMge1Byb21pc2V9IHByb21pc2UgLSByZXR1cm5zIGEgcHJvbWlzZSB0byB0aGUgY2FsbGVyIHNvIHRoYXQgY2FsbGVyIGNhbiB3YWl0IHRpbGwgaXQgZ2V0cyByZXNwb25zZSBmcm9tIHRoZVxuICAgICAgICAgKiBzYW5kYm94LiBXaGljaCh0aGUgcmVzb2x1dGlvbiBvZiB0aGUgcHJvbWlzZSkgaXMgaGFuZGxlZCBpbiBfaGFuZGxlTWVzc2FnZS5cbiAgICAgICAgICovXG4gICAgICAgIGluc3RydW1lbnRTYW5kYm94KHRhYklkOnN0cmluZywgc2FuZEJveFNlbGVjdG9yOnN0cmluZywgbWVzc2FnZTphbnkpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+KHRoaXMuX3NhbmRib3hJbk1lbW9yeVN0b3JhZ2UucmV0cmlldmVTYW5kYm94QnlUYWJJZFNhbmRib3hTZWxlY3Rvcih0YWJJZCwgc2FuZEJveFNlbGVjdG9yKSk7XG4gICAgICAgICAgICBpZiAoIWVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnN0cnVtZW50U2FuZGJveDogRWxlbWVudE5vdEZvdW5kXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB2YXIgaW5zdHJ1bWVudE1lc3NhZ2VJZCA9IHJhbmRvbUludGVnZXIoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXtcbiAgICAgICAgICAgICAgICAgICAgU2FuZGJveExpYnJhcnkuaW5zdHJ1bWVudE1lc3NhZ2VzW2luc3RydW1lbnRNZXNzYWdlSWRdID0gcmVzb2x2ZTtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5tZXNzYWdlTmFtZSA9IFwiSW5zdHJ1bWVudE1lc3NhZ2VcIjtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5pbnN0cnVtZW50TWVzc2FnZUlkID0gaW5zdHJ1bWVudE1lc3NhZ2VJZDtcbiAgICAgICAgICAgICAgICAgICAgaWYoISg8SFRNTElGcmFtZUVsZW1lbnQ+ZWxlbWVudCkuY29udGVudFdpbmRvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiRWxlbWVudE5vdEFuSUZyYW1lXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgKDxIVE1MSUZyYW1lRWxlbWVudD5lbGVtZW50KS5jb250ZW50V2luZG93LnBvc3RNZXNzYWdlKG1lc3NhZ2UsIFwiKlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yOkVycm9yID0gbmV3IEVycm9yKFwiRXJyb3Igd2hpbGUgc2VuZGluZyBtZXNzYWdlIHRvIGluc3RydW1lbnQgc2FuZGJveDogXCIgKyBlKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBUEkgZm9yIGdldHRpbmcgdGhlIGF0dHJpYnV0ZSBvZiB0aGUgc2FuZGJveCBpdHNlbGZcbiAgICAgICAgICpcbiAgICAgICAgICogQ2Fubm90IHVzZSB7QGxpbmsgaW5zdHJ1bWVudFNhbmRib3h9IHNpbmNlIHRoYXQgcmV0cmlldmVzIHByb3BlcnRpZXMgb2YgdGhlIGRvY3VtZW50IGluc2lkZSB0aGUgc2FuZGJveFxuICAgICAgICAgKiBAcGFyYW0gdGFiSWQgdGhlIHtAbGluayBzdHJpbmd9IGlkIG9mIHRoZSB0YWJcbiAgICAgICAgICogQHBhcmFtIHNhbmRib3hTZWxlY3RvciB0aGUge0BsaW5rIHN0cmluZ30gc2VsZWN0b3IgdGhhdCBpZGVudGlmaWVzIHRoZSBzYW5kYm94IEV4OiBcImlmcmFtZVtzcmMqPXBjb21wc3RyaXBlXVwiXG4gICAgICAgICAqIEBwYXJhbSBtZXNzYWdlIHRoZSBtZXNzYWdlIGNvbnRhaW5pbmcgdGhlIGFjdGlvbiBhbmQgYXR0cmlidXRlXG4gICAgICAgICAqIEByZXR1cm4gdGhlIHtzdHJpbmd9IGF0dHJpYnV0ZSB2YWx1ZSBvZiB0aGUgZWxlbWVudCBzcGVjaWZpZWQgYnkgdGhlIHNhbmRib3hTZWxlY3RvciBhbmQgdGhlIGF0dHJpYnV0ZU5hbWVcbiAgICAgICAgICovXG4gICAgICAgIGdldFNhbmRib3hBdHRyaWJ1dGUodGFiSWQ6c3RyaW5nLCBzYW5kYm94U2VsZWN0b3I6c3RyaW5nLCBtZXNzYWdlOnthY3Rpb246e2F0dHJpYnV0ZU5hbWU6c3RyaW5nfX0pOiBzdHJpbmcge1xuICAgICAgICAgICAgaWYgKCFtZXNzYWdlIHx8ICFtZXNzYWdlLmFjdGlvbiB8fCAhbWVzc2FnZS5hY3Rpb24uYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWRNZXNzYWdlIGZvciBnZXRTYW5kYm94QXR0cmlidXRlXCIgKyBtZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gPEhUTUxFbGVtZW50Pih0aGlzLl9zYW5kYm94SW5NZW1vcnlTdG9yYWdlLnJldHJpZXZlU2FuZGJveEJ5VGFiSWRTYW5kYm94U2VsZWN0b3IodGFiSWQsIHNhbmRib3hTZWxlY3RvcikpO1xuICAgICAgICAgICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRWxlbWVudE5vdEZvdW5kIHRvIHJldHJpZXZlIHNhbmRib3ggYXR0cmlidXRlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0QXR0cmlidXRlKG1lc3NhZ2UuYWN0aW9uLmF0dHJpYnV0ZU5hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbW92ZXMgdGhlIGlmcmFtZSBlbGVtZW50IHdpdGggdGhhdCBpZCBmcm9tIHRoZSBET00uXG4gICAgICAgICAqIEBwYXJhbSBzYW5kYm94SWRcbiAgICAgICAgICovXG4gICAgICAgIGRlc3Ryb3lTYW5kYm94KHNhbmRib3hJZDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgICAgICB2YXIgc2hhZG93Um9vdCA9IHRoaXMuX3NhbmRib3hJbk1lbW9yeVN0b3JhZ2UucmV0cmlldmVTaGFkb3dSb290QnlTYW5kYm94SWQoc2FuZGJveElkKTtcbiAgICAgICAgICAgIGlmICghc2hhZG93Um9vdCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNhbmRib3ggPSB0aGlzLl9zYW5kYm94SW5NZW1vcnlTdG9yYWdlLnJldHJpZXZlU2FuZGJveEJ5U2FuZGJveElkKHNhbmRib3hJZCk7XG4gICAgICAgICAgICAvLyBXZSBzaG91bGRuJ3QgdGhyb3cgYW4gZXJyb3IgaW4gY2FzZSBvZiBpbnZhbGlkIHNhbmRib3hcbiAgICAgICAgICAgIC8vIFRoZSBzYW5kYm94IGNhbiBiZSBpbnZhbGlkIGlmIGEgcmVsb2FkIGhhcHBlbnMgd2hlbiB0aGUgc2FuZGJveCBzdGlsbCBleGlzdHMgb24gdGhlIHBhZ2Ugd2hpY2ggaXMgYSB2YWxpZCB1c2UgY2FzZS5cbiAgICAgICAgICAgIGlmIChzYW5kYm94KSB7XG4gICAgICAgICAgICAgICAgc2hhZG93Um9vdC5yZW1vdmVDaGlsZChzYW5kYm94KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBzdHlsZSB0YWcgY3JlYXRlZCBvbiBQYWdlIERPTVxuICAgICAgICAgICAgdmFyIHN0eWxlRWxlbWVudCA9IHNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoSUZyYW1lQ3JlYXRpb25TdHJhdGVneS5TVFlMRV9IQU5ETEVfUFJFRklYICsgc2FuZGJveElkKTtcbiAgICAgICAgICAgIGlmIChzdHlsZUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBzaGFkb3dSb290LnJlbW92ZUNoaWxkKHN0eWxlRWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzaGFkb3dSb290Ll9ob3N0RWxlbWVudE9mU2hhZG93Um9vdCkge1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgZWxlbWVudCB0aGF0J3MgaG9zdGluZyB0aGUgc2hhZG93Um9vdFxuICAgICAgICAgICAgICAgIHNoYWRvd1Jvb3QuX2hvc3RFbGVtZW50T2ZTaGFkb3dSb290LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2hhZG93Um9vdC5faG9zdEVsZW1lbnRPZlNoYWRvd1Jvb3QpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9zYW5kYm94SW5NZW1vcnlTdG9yYWdlLmRlbGV0ZVNoYWRvd1Jvb3Qoc2FuZGJveElkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZWZhdWx0IGNzcyBydWxlcyBmb3Igc2FuZGJveGVzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBUT0RPOiByZWV2YWx1YXRlIGRlZmF1bHRzIGFuZCBhZGQgR09UQ0hBJ3NcbiAgICAgICAgICovXG4gICAgICAgIF9kZWZhdWx0Q1NTUnVsZXM6SVNhbmRib3hDU1NTcGVjaWZpY2F0aW9uID0ge1xuICAgICAgICAgICAgLy9YWFg6IFRoZXNlIGFyZSBub3QgaW4gYWxwaGFiZXRpY2FsIG9yZGVyIGJ5IGFjY2lkZW50IVxuICAgICAgICAgICAgXCJiYWNrZ3JvdW5kXCIgICA6IFwidHJhbnNwYXJlbnRcIixcbiAgICAgICAgICAgIFwiYm9yZGVyXCIgICAgICAgOiBcIjBcIixcbiAgICAgICAgICAgIC8vXCJib3JkZXItcmFkaXVzXCI6IFwiMFwiLFxuICAgICAgICAgICAgXCJib3gtc2hhZG93XCIgICA6IFwibm9uZVwiLFxuICAgICAgICAgICAgXCJkaXNwbGF5XCIgICAgICA6IFwiYmxvY2tcIixcbiAgICAgICAgICAgIFwiaGVpZ2h0XCIgICAgICAgOiBcIjBweFwiLFxuICAgICAgICAgICAgXCJsZWZ0XCIgICAgICAgICA6IFwiMFwiLFxuICAgICAgICAgICAgXCJvdmVyZmxvdy14XCIgICA6IFwidmlzaWJsZVwiLFxuICAgICAgICAgICAgXCJvdmVyZmxvdy15XCIgICA6IFwidmlzaWJsZVwiLFxuICAgICAgICAgICAgXCJwYWRkaW5nXCIgICAgICA6IFwiMFwiLFxuICAgICAgICAgICAgXCJwb3NpdGlvblwiICAgICA6IFwiYWJzb2x1dGVcIixcbiAgICAgICAgICAgIFwicmlnaHRcIiAgICAgICAgOiBcImF1dG9cIixcbiAgICAgICAgICAgIFwidG9wXCIgICAgICAgICAgOiBcIjBcIixcbiAgICAgICAgICAgIFwid2lkdGhcIiAgICAgICAgOiBcIjBweFwiLFxuICAgICAgICAgICAgXCJ6LWluZGV4XCIgICAgICA6IFwiOTk5OTlcIlxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCdWlsZHMgYSBjc3Mgc3RyaW5nIGdpdmVuIGEgSlMgb2JqZWN0IG9mIGNzcy1ydWxlc1xuICAgICAgICAgKiBiZWluZyB0aGUga2V5cyBhbmQgY3NzLXZhbHVlcyBiZWluZyB0aGUgdmFsdWVzLlxuICAgICAgICAgKiBAcGFyYW0gY3NzU3BlY1xuICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgX2J1aWxkQ3NzU3RyaW5nKGNzc1NwZWM6SVNhbmRib3hDU1NTcGVjaWZpY2F0aW9uKTpzdHJpbmcge1xuICAgICAgICAgICAgdmFyIHN0eWxlUnVsZXNBcnJheSA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgc3R5bGVOYW1lIGluIGNzc1NwZWMpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3NzU3BlYy5oYXNPd25Qcm9wZXJ0eShzdHlsZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlUnVsZXNBcnJheS5wdXNoKFtzdHlsZU5hbWUsY3NzU3BlY1tzdHlsZU5hbWVdXS5qb2luKFwiOlwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN0eWxlUnVsZXNBcnJheS5qb2luKFwiO1wiKS5jb25jYXQoXCI7XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHVybnMgdGhlIGVsZW1lbnQgb24gdGhlIHBhcmVudCBwYWdlIGJhc2VkIG9uIHRoZSBDU1Mgc2VsZWN0b3IgcHJvdmlkZWQuXG4gICAgICAgICAqIEBwYXJhbSBlbGVtZW50Q3NzU2VsZWN0b3IgVXN1YWxseSBcImh0bWxcIlxuICAgICAgICAgKiBAcmV0dXJucyB7SFRNTEVsZW1lbnR9XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfZ2V0UGFyZW50UGFnZUVsZW1lbnQoZWxlbWVudENzc1NlbGVjdG9yOnN0cmluZyk6SFRNTEVsZW1lbnQge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQ6SFRNTEVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50Q3NzU2VsZWN0b3IpO1xuICAgICAgICAgICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3R5bGVMaWJyYXJ5IGNvdWxkbid0IGZpbmQgdGhlIHNwZWNpZmllZCBlbGVtZW50LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZSBhIHN0eWxlIHRhZy5cbiAgICAgICAgICogQXR0YWNoIHRoZSBzdHlsZSB0YWcgdG8gdGhlIHBhZ2UgRE9NIGhlYWRlciBhbmQgYWRkIENTUyBydWxlIHRvIHN0eWxlc2hlZXQgb2YgdGhlIHN0eWxlIHRhZy5cbiAgICAgICAgICogQHBhcmFtIGhhbmRsZSAtIGhhbmRsZSB3aGljaCB3aWxsIGJlIHVzZSB0byBjcmVhdGUgc3R5bGUgdGFnXG4gICAgICAgICAqIEBwYXJhbSBzdHlsZVNoZWV0Q1NTUnVsZXMgLSBDU1MgcnVsZXMgdGhhdCBuZWVkIHRvIGJlIGFwcGxpZWQgb24gdGhlIHBhZ2Ugc3R5bGVzaGVldFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2FwcGx5U3R5bGVTaGVldENTU1J1bGUoaGFuZGxlOiBzdHJpbmcsIHN0eWxlU2hlZXRDU1NSdWxlczogQXJyYXk8c3RyaW5nPik6IHZvaWQge1xuICAgICAgICAgICAgdmFyIHN0eWxlSGFuZGxlOnN0cmluZyA9IElGcmFtZUNyZWF0aW9uU3RyYXRlZ3kuU1RZTEVfSEFORExFX1BSRUZJWCArIGhhbmRsZTsgLy8gY3JlYXRlIGEgc3R5bGUgaGFuZGxlXG4gICAgICAgICAgICB2YXIgc3R5bGVTaGVldDogQ1NTU3R5bGVTaGVldCA9IHRoaXMuX2NyZWF0ZVN0eWxlU2hlZXQoaGFuZGxlLCBzdHlsZUhhbmRsZSk7XG4gICAgICAgICAgICBzdHlsZVNoZWV0Q1NTUnVsZXMuZm9yRWFjaCgoc3R5bGVTaGVldENTU1J1bGU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIHN0eWxlU2hlZXQuaW5zZXJ0UnVsZShzdHlsZVNoZWV0Q1NTUnVsZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDcmVhdGUgYSBzdHlsZSB0YWcgYW5kIGF0dGFjaCBpdCB0byB0aGUgcGFnZSBET00uXG4gICAgICAgICAqIFJldHVybnMgc3R5bGVzaGVldCBvZiB0aGUgc3R5bGUgdGFnLlxuICAgICAgICAgKiBAcGFyYW0gc3R5bGVIYW5kbGUgLSBzdHlsZSBoYW5kbGUgb2YgdGhlIHN0eWxlIHRhZ1xuICAgICAgICAgKiBAcmV0dXJucyB7U3R5bGVTaGVldH0gLSBzdHlsZXNoZWV0IG9mIHRoZSBzdHlsZSB0YWdcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9jcmVhdGVTdHlsZVNoZWV0KGhhbmRsZTpzdHJpbmcsIHN0eWxlSGFuZGxlOiBzdHJpbmcpOiBDU1NTdHlsZVNoZWV0IHtcbiAgICAgICAgICAgIHZhciBzaGFkb3dSb290OkFBRG9jdW1lbnRGcmFnbWVudCA9IHRoaXMuX3NhbmRib3hJbk1lbW9yeVN0b3JhZ2UucmV0cmlldmVTaGFkb3dSb290QnlTYW5kYm94SWQoaGFuZGxlKTtcbiAgICAgICAgICAgIHZhciBzdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7Ly9jcmVhdGUgdGhlIHN0eWxlIHRhZ1xuICAgICAgICAgICAgc3R5bGVFbGVtZW50LnNldEF0dHJpYnV0ZShcImlkXCIsc3R5bGVIYW5kbGUpOy8vc2V0IHRoZSBpZFxuICAgICAgICAgICAgc2hhZG93Um9vdC5hcHBlbmRDaGlsZChzdHlsZUVsZW1lbnQpO1xuICAgICAgICAgICAgcmV0dXJuIDxDU1NTdHlsZVNoZWV0PnN0eWxlRWxlbWVudC5zaGVldDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgY3VzdG9tIHtAbGluayBEb2N1bWVudEZyYWdtZW50fSB1c2VkIHdpdGhpbiB7QGxpbmsgU2FuZGJveEluTWVtb3J5U3RvcmFnZX1cbiAgICAgKi9cbiAgICBleHBvcnQgaW50ZXJmYWNlIEFBRG9jdW1lbnRGcmFnbWVudCBleHRlbmRzIERvY3VtZW50RnJhZ21lbnQge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUge0BsaW5rIEVsZW1lbnR9IHRoYXQgaXMgaG9zdGluZyB0aGUge0BsaW5rIERvY3VtZW50RnJhZ21lbnR9IHNoYWRvdyByb290XG4gICAgICAgICAqL1xuICAgICAgICBfaG9zdEVsZW1lbnRPZlNoYWRvd1Jvb3Q/OiBFbGVtZW50O1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogU3RvcmFnZSBzb2x1dGlvbiBmb3Igc3RvcmluZyBzaGFkb3dET00gc2FuZGJveGVzIGluIG1lbW9yeVxuICAgICAqIFRoaXMgaXMgbmVlZGVkIGJlY2F1c2Ugb25jZSBhIGNsb3NlZCBzaGFkb3dET00gaXMgYXR0YWNoZWQgdG8gdGhlIHBhcmVudCBET00sIGl0IGNhbm5vdCBiZSByZXRyaWV2ZWQgYWdhaW4gdW5sZXNzIHlvdSBrZWVwIHRoZSByZWZlcmVuY2UgdG8gdGhlXG4gICAgICogc2hhZG93IHJvb3QuIEhlbmNlLCB3ZSBoYXZlIGEgaW4gbWVtb3J5IHN0b3JhZ2Ugc29sdXRpb24gZm9yIGtlZXBpbmcgdGhlIHNoYWRvdyByb290IHJlZmVyZW5jZXNcbiAgICAgKlxuICAgICAqIFRoZSBzdG9yYWdlIGlzIHN0b3JpbmcgdGhlIHNoYWRvd1Jvb3QgdXNpbmcgdGhlIHNhbmRib3ggaWQsIHdlIGNhbiB0aGVuIHJldHJpZXZlIHRoZSBzYW5kYm94IGZyb20gdGhlIHNoYWRvd1Jvb3QgdmlhIHRoZSBzYW5kYm94SWQgYXMgd2VsbFxuICAgICAqXG4gICAgICogV2Ugd2lsbCBhbHNvIGJlIGtlZXBpbmcgdGhlIHJlZmVyZW5jZXMgdG8gdGhlIHNhbmRib3ggaWQgZnJvbSB0YWJJZCBhbmQgY29udHJvbGxlclBhdGguIFRoaXMgaXMgbmVlZGVkIGZvciBpbnN0cnVtZW50YXRpb24gcHVycG9zZSBzaW5jZSBzYW5kYm94SWQgaXNcbiAgICAgKiBub3Qga25vd24gZHVyaW5nIGluc3RydW1lbnRhdGlvblxuICAgICAqL1xuICAgIGV4cG9ydCBjbGFzcyBTYW5kYm94SW5NZW1vcnlTdG9yYWdlIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGN1cnJlbnQgYWN0aXZlIHNoYWRvdyByb290cyBrZXllZCBieSB0aGUge0BsaW5rIHN0cmluZ30gc2FuZGJveElkXG4gICAgICAgICAqL1xuICAgICAgICBfY3VycmVudFNoYWRvd1Jvb3RzTWFwOiB7IFtzYW5kYm94SWQ6IHN0cmluZ106IEFBRG9jdW1lbnRGcmFnbWVudCB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOZWVkZWQgYmVjYXVzZSBkdXJpbmcgaW5zdHJ1bWVudGF0aW9uLCB3ZSBvbmx5IGhhdmUgdGhlIHRhYiBpZCBhbmQgdGhlIGNvbnRyb2xsZXIgcGF0aFxuICAgICAgICAgKiBOZWVkIHRvIHN0b3JlIHRoZSB0YWJJZCAmIGNvbnRyb2xsZXJQYXRoIGZyb20ge0BsaW5rIF9jcmVhdGVUYWJJZENvbnRyb2xsZXJQYXRoS2V5fSB0byBpdHMgY29ycmVzcG9uZGluZyBzYW5kYm94SWRcbiAgICAgICAgICovXG4gICAgICAgIF90YWJJZENvbnRyb2xsZXJQYXRoVG9TYW5kYm94SWQ6IHsgW3RhYklkQ29udHJvbGxlclBhdGg6IHN0cmluZ106IHN0cmluZyB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaW52ZXJzZSBvZiB7QGxpbmsgX3RhYklkQ29udHJvbGxlclBhdGhUb1NhbmRib3hJZH0uIFRoaXMgaXMgbmVlZGVkIGJlY2F1c2UgZHVyaW5nIGRlc3Ryb3lpbmcgb2Ygc2FuZGJveCwgd2Ugb25seSBoYXZlIHRoZSBzYW5kYm94SWQuIFNvIHRvXG4gICAgICAgICAqIHByZXZlbnQgbWVtb3J5IGxlYWtzLCB3ZSBuZWVkIHRvIGNsZWFyIHRoZSB7QGxpbmsgX3RhYklkQ29udHJvbGxlclBhdGhUb1NhbmRib3hJZH0sIHdoaWNoIHJlcXVpcmVzIGtub3dsZWRnZSBvZiB0aGUgdGFiSWQgYW5kIGNvbnRyb2xsZXJQYXRoXG4gICAgICAgICAqL1xuICAgICAgICBfc2FuZEJveElkVG9UYWJJZENvbnRyb2xsZXJQYXRoOiB7IFtzYW5kYm94SWQ6IHN0cmluZ106IHN0cmluZyB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcmVnZXggZm9yIGdyYWJiaW5nIHRoZSBjb250cm9sbGVyIHBhdGggZnJvbSBhIHByb3h5IHVybFxuICAgICAgICAgKiBFeCBvZiBwcm94eSB1cmw6XG4gICAgICAgICAqIGNocm9tZS1leHRlbnNpb246Ly9rcG1rbWRsZm5taWxiZG9nYW1nZWduY2hlYmdkbmVibC9zdGF0aWMvaHRtbC9sb2NhbFByb3h5Lmh0bWw/dWJwU2FuZGJveEhhbmRsZT1QQ29tcC1VQlBOb3RpZl9paWQlM0QxMDAzMDc3MDU4NjE2NzEzX3NpZCUzRC0zMTQ0NDI2Mjk2NjI0OTgzX3RpbWUlM0QxNTgwNDE5NDM1Njk3JnRhcmdldD1odHRwcyUzQSUyRiUyRm1hdGNoLmFtYXpvbmJyb3dzZXJhcHAuY29tJTJGc2NvbXBzdHJpcGUlM0Z0YWclM0RhbXotbWt0LWNoci11cy0yMCUyNmFzY3N1YnRhZyUzRDFiYTAwLTAxMDAwLW9yZzAwLW1hYzAwLW90aGVyLXNtaWxlLXVzMDAwLXBjb21wLWZlYXR1cmUtc2NvbXAtd20tNSUyNnUlM0RodHRwcyUyNTNBJTI1MkYlMjUyRnNtaWxlLmFtYXpvbi5jb20lMjZtJTNEc21pbGUlMjZmJTNEc3JkZ19UMiUyNm1wJTNEVXMlMjZlYSUzRFYxXzEtJTI1MkZmQlJJbGVHZlM3bmE4N0dkNUNodzJHU3ZERkVLJTI1MkZRWk5FR0FyU2VuT01RUHh5b0JlVGpyJTI1MkJVTDdDWU5hNHdaRnUlMjUyRkVaQlpTYm12RHR2JTI1MkJxbiUyNTJCM0xpeVB3VFVWNUNIYWVUTUJZV0loVUpBVzVtQWxITjRNV0hXU0lOa2JJbXNHT3N0dHlVMndXMXNmJTI1MkZJcUFCd0R3S2hON3pNcVptUmRoMno2c3R2NlM0bVhsVSUyNTNEJTI2ZWElM0RWMV8xLUJlR0NTWHBXUTJPa1dpUEV3STdicDFsOHYwanN1T00wYlRJaVRhU0JoYlV5VWJYVFViVXdkcXA5ODZoYiUyNTJGS3czMnpxMmV1V1lVRmhXejFzYWFCejM5dHo4b1RnYWVYUUJDJTI1MkIxWG4lMjUyRnlXJTI1MkJEUCUyNTJCRFFwTCUyNTJGN21pRG9YdmtyTXZmZzZsaU9zam9DSGlxbnVoVGJzak81VjgzV2FoQVFrdVd6NUxqQWNQbCUyNTJGdzVmeU0lMjUzRCUyNmVhJTNEVjFfMS1Ob01YanhDVlBsQnhwcmR5QlpHTm8xWkNHY05VTGxBOHQxOWZRQWptaGhTdmFEbiUyNTJGd2NVVWhFbGdjSE9NWHl2JTI1MkJRRkhxMWZmc3g3UUNxN1FmS3ZYYUJVM2JtamY2SVpmbnJLVmE5QTl4MHBuR0xLM0NUc0MwWG9IZlMlMjUyRlptRjdCaiUyNTJCJTI1MkYyQjFGc3NYTGJqJTI1MkJPaVgzYnpNbFJQTE5QU09vcUh4N2VOMkc1Z2RXd2MlMjUzRCUyNmVhJTNEVjFfMS1jSXlxYTM1UnJYJTI1MkZ3Sm5YdTlzVVVsQyUyNTJGSlFhZzhYM0NXYVJGWUJoQyUyNTJGZGRoWWxZa2gwRDV6eXdYd2xIS3R3eGdka213WUpSVmFqUFI4cDF3ZlRmZUhGVCUyNTJGM2duV0x0SGlPQTZUVm8yVUhCZyUyNTJGJTI1MkYwVXc4cFV2TElYaWRtckFSczdkQkRIbjlyRG9CUUdSVkJReHVBd1VTMjVibHB3ZkdVODZUNVBzeDhuRFdMeXMlMjUzRCUyNmVhJTNEVjFfMS1jdzJuQWc5VVRDekhHZiUyNTJGck14QU90THVuZHhVU1A0dlpFVDRFJTI1MkJHZEIxZHhHZzNXSFJuQ0pRWmg1Mmt4bDl2bnhVNzRhQjBEeThYUUdRcmxCS0JKWEtzJTI1MkJUUWVXJTI1MkZUTE5xdXNEQjFXcVp0SzFSR2lFVkxjZXRhcDQlMjUyQjJkJTI1MkZZT08xN1FQTEQxcm43N3pWVENYSjdmM0lIRlZ5bEdNQVRqd2dlcnNyUzhvT2NSWVklMjUzRCUyNmVhJTNEVjFfMS10VlBVVkp6dUh2NXVmRndCeWpueWx5NTBjeWxFODAwYWxPQTA3VU1oOURNNDlyTEtKd0UyazFzayUyNTJGTWY2QXp4aGppYmo4MTRCTERVenRHJTI1MkI3dVdnJTI1MkIlMjUyQk1NdE5GanU5UE9MZzZnbk1qZkFrUHNFdFlvRnh4WWJwcXBKbnZhQ1Q2dFYlMjUyRm9kakFNMkVWN0o2JTI1MkYlMjUyQjRFVm11YWd0RXg3N1laeHVEbHVvd01SRHVUT1ZrJTI1M0QlMjZlYSUzRFYxXzEtZmxSOXdqQlg2VWl2eUVEbWYxdkk2WGt1eWtDZEElMjUyRlNBdVJ6JTI1MkIxcGtCdWJsMyUyNTJCJTI1MkI1bUprbDNVZ0JodjF2MUcyaGQ2N2pDVHFydDl5WDY0SGV3eFRSSjVCcERodVdTdlR1bnBNMndXR2lRdWVPMUslMjUyQlp3JTI1MkJydXJVemFhbndPQzBTOXZXcVhjQjNYRDUyVjByeGNwVGhPZ2pWazJpZGd0OUYwUElVJTI1MkJ1UWFCT2tvWSUyNTNEJTI2ZWElM0RWMV8xLTBkQzVYMExzUU9KJTI1MkZuJTI1MkY0bUdPV3hER0UlMjUyQiUyNTJCUUY3eiUyNTJCcmIlMjUyRkFTUnl3Qzd6UUxVbW1jV2FSWmN2OVIlMjUyQnhzUHFpWG9VcTQwdEJPTWVJbkozeUZKaUI5TWo2RXI2dXRWYmt6NnA2aFJBengwSGptVjdBUkFXbkljUkRJdmpCSDklMjUyQjZrRWs1SXhyZ2hXVkJFSG9SVHhQUFBURHN3SlVJMXM1czFkQW1hOWlsbjFZJTI1MkJoQSUyNTNEJTI2Y3ElM0RwczQlMjZyYyUzRDMwNjk5MiUyNmwlM0Rlbl9VUyUyNmMlM0RVU0QlMjZ1YnBTYW5kYm94SGFuZGxlJTNEMVxuICAgICAgICAgKlxuICAgICAgICAgKiBFeHBlY3RlZCBjb250cm9sbGVyIHBhdGggZnJvbSBhcHBseWluZyByZWdleDogcGNvbXBzdHJpcGVcbiAgICAgICAgICovXG4gICAgICAgIF9QUk9YWV9VUkxfVE9fQ09OVFJPTExFUl9QQVRIX1JFR0VYOiBzdHJpbmcgPSBcIiUyRihbYS16XSopKCUzRnwmKVwiO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcmVnZXggZm9yIGdyYWJiaW5nIHRoZSBjb250cm9sbGVyIHBhdGggZnJvbSBhIHNhbmRib3ggc2VsZWN0b3JcbiAgICAgICAgICogRXggb2Ygc2FuZGJveCBzZWxlY3RvcjogaWZyYW1lW3NyYyo9cGNvbXBzdHJpcGVdXG4gICAgICAgICAqXG4gICAgICAgICAqIEV4cGVjdGVkIGNvbnRyb2xsZXIgcGF0aCBmcm9tIGFwcGx5aW5nIHJlZ2V4OiBwY29tcHN0cmlwZVxuICAgICAgICAgKi9cbiAgICAgICAgX1NBTkRCT1hfU0VMRUNUT1JfVE9fQ09OVFJPTExFUl9QQVRIX1JFR0VYOiBzdHJpbmcgPSBcInNyY1xcXFwqPShbYS16XSopXCI7XG5cbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50U2hhZG93Um9vdHNNYXAgPSB7fTtcbiAgICAgICAgICAgIHRoaXMuX3RhYklkQ29udHJvbGxlclBhdGhUb1NhbmRib3hJZCA9IHt9O1xuICAgICAgICAgICAgdGhpcy5fc2FuZEJveElkVG9UYWJJZENvbnRyb2xsZXJQYXRoID0ge307XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogU3RvcmVzIHRoZSBzaGFkb3cgcm9vdFxuICAgICAgICAgKiBAcGFyYW0gc2hhZG93Um9vdCB0aGUgc2hhZG93Um9vdCB7QGxpbmsgQUFEb2N1bWVudEZyYWdtZW50fSB0aGF0IGNvbnRhaW5zIHRoZSBzYW5kYm94XG4gICAgICAgICAqIEBwYXJhbSB0YWJJZCB0aGUgaWQgb2YgdGhlIHRhYlxuICAgICAgICAgKiBAcGFyYW0gcHJveHlVcmwgdGhlIHByb3h5IHVybFxuICAgICAgICAgKiBFeDogY2hyb21lLWV4dGVuc2lvbjovL2VsaGVicGlva21vZGhmZmZvaG9vcGNpb25oYWtjZ3BkL3N0YXRpYy9odG1sL2xvY2FsUHJveHkuaHRtbD91YnBTYW5kYm94SGFuZGxlPVBDb21wLVVCUE5vdGlmX2lpZCUzRC01NTIxNDMyNTY3MjU3NV9zaWQlM0QtNDcwMTk5NjQ4OTI1Mzk3NV90aW1lJTNEMTU3OTgxNjQ5ODI4NSZ0YXJnZXQ9aHR0cHMlM0ElMkYlMkZtYXRjaC1icm93c2VyYXBwLXByZXByb2QuYW1hem9uLmNvbSUyRnBjb21wc3RyaXBlJTNGdGFnJTNEYW16LW1rdC1jaHItdXMtMjAlMjZhc2NzdWJ0YWclM0QxYmEwMC0wMTAwMC1vcmcwMC1tYWMwMC1vdGhlci1zbWlsZS11czAwMC1wY29tcC1mZWF0dXJlLXBjb21wLXdtLTYlMjZ1JTNEaHR0cHMlMjUzQSUyNTJGJTI1MkZzbWlsZS1wcmVwcm9kLmFtYXpvbi5jb20lMjZtJTNEc21pbGUlMjZmJTNEcHJjX1QxJTI2bXAlM0RVcyUyNmVhJTNEVjFfMS1HMVRrR3cxeFdEZFdCUTdQU3NPRnBWb1dSYWVEc05OazZuSWZ2Sk04WHBENVRDZ1A2elV3UFNxbEFPZ2k2bEpmUHhaRE94VkRBZXQ1UlRLWmtiQyUyNTJGQ2JpamFwTEE4QkdBUUgxNWZ4WWE4NkZtdXRTcWgyZUslMjUyQnYzZ1BhODEwSVFIdGZwdjJhT2Jpd0hTUjRjJTI1MkZxcHdRVkNBYlpZYkslMjUyQjA1NVkwWkklMjUyQmc3M1NXTSUyNTNEJTI2bCUzRGVuX1VTJTI2YyUzRFVTRCUyNnVicFNhbmRib3hIYW5kbGUlM0QxXG4gICAgICAgICAqIEV4OiBodHRwczovL21hdGNoLWJyb3dzZXJhcHAtcHJlcHJvZC5hbWF6b24uY29tL2Fzc2V0cy9SZW5kZXJlclByb3h5Lmh0bWw/dWJwU2FuZGJveEhhbmRsZT1VQlBOb3RpZl9paWQlM0QtNDc5NzM2NDAwMTcwMjcxM19zaWQlM0QtNzcyMDI4MzcwNDYxNTk5X3RpbWUlM0QxNTc5ODE2Nzk0MzUyJnRhcmdldD1odHRwcyUzQSUyRiUyRm1hdGNoLWJyb3dzZXJhcHAtcHJlcHJvZC5hbWF6b24uY29tJTJGcGNvbXBzdHJpcGUlM0Z0YWclM0RhbXotbWt0LWNoci11cy0yMCUyNmFzY3N1YnRhZyUzRDFiYTAwLTAxMDAwLW9yZzAwLW1hYzAwLW90aGVyLXNtaWxlLXVzMDAwLXBjb21wLWZlYXR1cmUtcGNvbXAtd20tNiUyNnUlM0RodHRwcyUyNTNBJTI1MkYlMjUyRnNtaWxlLXByZXByb2QuYW1hem9uLmNvbSUyNm0lM0RzbWlsZSUyNmYlM0RwcmNfVDElMjZtcCUzRFVzJTI2ZWElM0RWMV8xLUcxVGtHdzF4V0RkV0JRN1BTc09GcFZvV1JhZURzTk5rNm5JZnZKTThYcEQ1VENnUDZ6VXdQU3FsQU9naTZsSmZQeFpET3hWREFldDVSVEtaa2JDJTI1MkZDYmlqYXBMQThCR0FRSDE1ZnhZYTg2Rm11dFNxaDJlSyUyNTJCdjNnUGE4MTBJUUh0ZnB2MmFPYml3SFNSNGMlMjUyRnFwd1FWQ0FiWlliSyUyNTJCMDU1WTBaSSUyNTJCZzczU1dNJTI1M0QlMjZsJTNEZW5fVVMlMjZjJTNEVVNEJTI2dWJwU2FuZGJveEhhbmRsZSUzRDFcbiAgICAgICAgICogQHBhcmFtIHNhbmRib3hJZCB0aGUgaWQgb2YgdGhlIHNhbmRib3hcbiAgICAgICAgICovXG4gICAgICAgIHN0b3JlU2hhZG93Um9vdChzaGFkb3dSb290OiBBQURvY3VtZW50RnJhZ21lbnQsIHRhYklkOiBzdHJpbmcsIHNhbmRib3hJZDogc3RyaW5nLCBwcm94eVVybDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgICAgICAvLyBTdG9yZSB0aGUgc2hhZG93IHJvb3Qga2V5ZWQgYnkgdGhlIHNhbmRib3ggaWRcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTaGFkb3dSb290c01hcFtzYW5kYm94SWRdID0gc2hhZG93Um9vdDtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBOZWVkIHRvIGtlZXAgcmVmZXJlbmNlIGZyb20gdGFiSWQgJiBjb250cm9sbGVyIHBhdGggdG8gc2FuZGJveElkIGZvciBpbnN0cnVtZW50YXRpb24gcHVycG9zZVxuICAgICAgICAgICAgICogU2luY2Ugd2Ugd2lsbCBvbmx5IGhhdmUgdGFiSWQgJiBjb250cm9sbGVyIHBhdGggZHVyaW5nIGluc3RydW1lbnRhdGlvbiB0byByZXRyaWV2ZSB0aGUgc2FuZGJveFxuICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgIC8vIEF0dGVtcHQgdG8gZXh0cmFjdCB0aGUgY29udHJvbGxlciBwYXRoIGZyb20gdGhlIHByb3h5IHVybFxuICAgICAgICAgICAgdmFyIHJlZ2V4TWF0Y2hSZXN1bHQgPSBwcm94eVVybC5tYXRjaCh0aGlzLl9QUk9YWV9VUkxfVE9fQ09OVFJPTExFUl9QQVRIX1JFR0VYKTtcbiAgICAgICAgICAgIGlmICghcmVnZXhNYXRjaFJlc3VsdCB8fFxuICAgICAgICAgICAgICAgIHJlZ2V4TWF0Y2hSZXN1bHRbMV0gPT09IG51bGwgfHwgcmVnZXhNYXRjaFJlc3VsdFsxXSA9PT0gdW5kZWZpbmVkKSB7IC8vc2FuZGJveCAxcHgqMXB4IG1pZ2h0IHJldHVybiBjb250cm9sbGVyIHBhdGggb2YgZW1wdHkgc3RyaW5nXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgY29udHJvbGxlclBhdGg6IHN0cmluZyA9IHJlZ2V4TWF0Y2hSZXN1bHRbMV07XG4gICAgICAgICAgICB2YXIgdGFiSWRDb250cm9sbGVyUGF0aEtleSA9IHRoaXMuX2NyZWF0ZVRhYklkQ29udHJvbGxlclBhdGhLZXkodGFiSWQsIGNvbnRyb2xsZXJQYXRoKTtcbiAgICAgICAgICAgIHRoaXMuX3RhYklkQ29udHJvbGxlclBhdGhUb1NhbmRib3hJZFt0YWJJZENvbnRyb2xsZXJQYXRoS2V5XSA9IHNhbmRib3hJZDtcbiAgICAgICAgICAgIHRoaXMuX3NhbmRCb3hJZFRvVGFiSWRDb250cm9sbGVyUGF0aFtzYW5kYm94SWRdID0gdGFiSWRDb250cm9sbGVyUGF0aEtleTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIHNoYWRvd1Jvb3QgaW4gd2hpY2ggZXZlcnl0aGluZyBpcyBhdHRhY2hlZCB0b1xuICAgICAgICAgKiBAcGFyYW0gc2FuZGJveElkIHRoZSB7QGxpbmsgc3RyaW5nfSBpZCBvZiB0aGUgdGFiXG4gICAgICAgICAqIEByZXR1cm4gdGhlIHtBQURvY3VtZW50RnJhZ21lbnR9IHNoYWRvd1Jvb3Qgd2hlcmUgdGhlIHNhbmRib3ggaXMgYXBwZW5kZWQgdG9cbiAgICAgICAgICovXG4gICAgICAgIHJldHJpZXZlU2hhZG93Um9vdEJ5U2FuZGJveElkKHNhbmRib3hJZDogc3RyaW5nKTogQUFEb2N1bWVudEZyYWdtZW50IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50U2hhZG93Um9vdHNNYXBbc2FuZGJveElkXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIHNoYWRvd1Jvb3QganVzdCBsaWtlIHtAbGluayByZXRyaWV2ZVNoYWRvd1Jvb3RCeVNhbmRib3hJZH0sXG4gICAgICAgICAqIGV4Y2VwdCBieSB0YWJJZCBhbmQgc2FuZGJveFNlbGVjdG9yIHNpbmNlIHRoYXQgaXMgYWxsIHdlIGhhdmUgZHVyaW5nIGluc3RydW1lbnRhdGlvblxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gdGFiSWQgdGhlIHtAbGluayBzdHJpbmd9IGlkIG9mIHRoZSB0YWJcbiAgICAgICAgICogQHBhcmFtIHNhbmRib3hTZWxlY3RvciB0aGUge0BsaW5rIHN0cmluZ30gc2VsZWN0b3Igb2YgdGhlIHNhbmRib3gsIG5vdCBpZC4gRXg6IGlmcmFtZVtzcmMqPXBjb21wc3RyaXBlXVxuICAgICAgICAgKiBAcmV0dXJuIHRoZSB7QUFEb2N1bWVudEZyYWdtZW50fSBzaGFkb3dSb290IHdoZXJlIHRoZSBzYW5kYm94IGlzIGFwcGVuZGVkIHRvXG4gICAgICAgICAqL1xuICAgICAgICByZXRyaWV2ZVNoYWRvd1Jvb3RCeVRhYklkU2FuZGJveFNlbGVjdG9yKHRhYklkOiBzdHJpbmcsIHNhbmRib3hTZWxlY3Rvcjogc3RyaW5nKTogQUFEb2N1bWVudEZyYWdtZW50IHtcbiAgICAgICAgICAgIC8vIFJldHJpZXZlIHRoZSBzYW5kYm94SWQgZnJvbSB0aGUgdGFiSWQgYW5kIHRoZSBzYW5kYm94U2VsZWN0b3JcbiAgICAgICAgICAgIHZhciBzYW5kYm94SWQgPSB0aGlzLl9nZXRTYW5kYm94SWQodGFiSWQsIHNhbmRib3hTZWxlY3Rvcik7XG4gICAgICAgICAgICBpZiAoIXNhbmRib3hJZCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInJldHJpZXZlU2hhZG93Um9vdDogU2FuZGJveElkIG5vdCBmb3VuZCBmb3IgdGFiSWQgOlwiICsgdGFiSWQgKyBcIiBhbmQgc2FuZGJveFNlbGVjdG9yOiBcIiArIHNhbmRib3hTZWxlY3Rvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZXRyaWV2ZVNoYWRvd1Jvb3RCeVNhbmRib3hJZChzYW5kYm94SWQpXG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIGEgc2FuZGJveCBiYXNlZCBvbiB0aGUgc2FuZGJveElkXG4gICAgICAgICAqIEBwYXJhbSBzYW5kYm94SWQgdGhlIGlkIG9mIHRoZSBzYW5kYm94XG4gICAgICAgICAqIEByZXR1cm4gdGhlIGlmcmFtZSBzYW5kYm94IGl0c2VsZlxuICAgICAgICAgKi9cbiAgICAgICAgcmV0cmlldmVTYW5kYm94QnlTYW5kYm94SWQoc2FuZGJveElkOiBzdHJpbmcpOiBIVE1MRWxlbWVudCB7XG4gICAgICAgICAgICB2YXIgc2hhZG93Um9vdCA9IHRoaXMucmV0cmlldmVTaGFkb3dSb290QnlTYW5kYm94SWQoc2FuZGJveElkKTtcbiAgICAgICAgICAgIGlmIChzaGFkb3dSb290KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNoYWRvd1Jvb3QuZ2V0RWxlbWVudEJ5SWQoc2FuZGJveElkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIGEgc2FuZGJveCBqdXN0IGxpa2Uge0BsaW5rIHJldHJpZXZlU2FuZGJveEJ5U2FuZGJveElkfVxuICAgICAgICAgKiBAcGFyYW0gdGFiSWQgdGhlIGlkIG9mIHRoZSB0YWJcbiAgICAgICAgICogQHBhcmFtIHNhbmRib3hTZWxlY3RvciB0aGUgc2VsZWN0b3IgdGhhdCBxdWVyaWVzIHRoZSBzYW5kYm94LiBFeDogaWZyYW1lW3NyYyo9cGNvbXBzdHJpcGVdXG4gICAgICAgICAqIEByZXR1cm4gdGhlIGlmcmFtZSBzYW5kYm94IGl0c2VsZlxuICAgICAgICAgKi9cbiAgICAgICAgcmV0cmlldmVTYW5kYm94QnlUYWJJZFNhbmRib3hTZWxlY3Rvcih0YWJJZDogc3RyaW5nLCBzYW5kYm94U2VsZWN0b3I6IHN0cmluZyk6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgICAgIC8vIFJldHJpZXZlIHRoZSBzYW5kYm94SWQgZnJvbSB0aGUgdGFiSWQgYW5kIHRoZSBzYW5kYm94U2VsZWN0b3JcbiAgICAgICAgICAgIHZhciBzYW5kYm94SWQgPSB0aGlzLl9nZXRTYW5kYm94SWQodGFiSWQsIHNhbmRib3hTZWxlY3Rvcik7XG4gICAgICAgICAgICBpZiAoIXNhbmRib3hJZCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInJldHJpZXZlU2FuZGJveDogU2FuZGJveElkIG5vdCBmb3VuZCBmb3IgdGFiSWQgOlwiICsgdGFiSWQgKyBcIiBhbmQgc2FuZGJveFNlbGVjdG9yOiBcIiArIHNhbmRib3hTZWxlY3Rvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZXRyaWV2ZVNhbmRib3hCeVNhbmRib3hJZChzYW5kYm94SWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlbGV0ZSB0aGUgc2hhZG93Um9vdCBmcm9tIHN0b3JhZ2VcbiAgICAgICAgICogQHBhcmFtIHNhbmRib3hJZCB0aGUgaWQgb2YgdGhlIHNhbmRib3hcbiAgICAgICAgICovXG4gICAgICAgIGRlbGV0ZVNoYWRvd1Jvb3Qoc2FuZGJveElkOiBzdHJpbmcpIHtcbiAgICAgICAgICAgIC8vIERlbGV0ZSB0aGUgc2hhZG93IHJvb3QgaXRzZWxmXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fY3VycmVudFNoYWRvd1Jvb3RzTWFwW3NhbmRib3hJZF07XG5cbiAgICAgICAgICAgIC8vIERlbGV0ZSB0aGUgbWFwIHRoYXQgYXJlIHN0b3JpbmcgdGFiSWRDb250cm9sbGVyUGF0aCB0byBzYW5kYm94SWQgaXRzZWxmIGFuZCB2aWNlIHZlcnNhXG4gICAgICAgICAgICB2YXIgdGFiSWRDb250cm9sbGVyUGF0aCA9IHRoaXMuX3NhbmRCb3hJZFRvVGFiSWRDb250cm9sbGVyUGF0aFtzYW5kYm94SWRdO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3RhYklkQ29udHJvbGxlclBhdGhUb1NhbmRib3hJZFt0YWJJZENvbnRyb2xsZXJQYXRoXTtcblxuICAgICAgICAgICAgLy8gQ2Fubm90IGRlbGV0ZSBiZWZvcmUgcmV0cmlldmluZyB0aGUgdGFiSWRDb250cm9sbGVyUGF0aCB1cCBhYm92ZVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3NhbmRCb3hJZFRvVGFiSWRDb250cm9sbGVyUGF0aFtzYW5kYm94SWRdO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZXMgdGhlIHRhYklkQ29udHJvbGxlclBhdGggc3RyaW5nIHRoYXQgd2UgYXJlIHVzaW5nIGluIHtAbGluayBfdGFiSWRDb250cm9sbGVyUGF0aFRvU2FuZGJveElkfSBhbmQge0BsaW5rIF9zYW5kQm94SWRUb1RhYklkQ29udHJvbGxlclBhdGh9XG4gICAgICAgICAqIEBwYXJhbSB0YWJJZCB0aGUgaWQgb2YgdGhlIHRhYlxuICAgICAgICAgKiBAcGFyYW0gY29udHJvbGxlclBhdGggdGhlIHBhdGggdG8gdGhlIGNvbnRyb2xsZXIuIEV4OiBwY29tcHN0cmlwZVxuICAgICAgICAgKiBAcmV0dXJuIHRoZSB0YWJJZENvbnRyb2xsZXJQYXRoIHN0cmluZyBkZWxpbWl0ZWQgYnkgXCJfXCJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9jcmVhdGVUYWJJZENvbnRyb2xsZXJQYXRoS2V5KHRhYklkOiBzdHJpbmcsIGNvbnRyb2xsZXJQYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICAgICAgcmV0dXJuIHRhYklkICsgXCJfXCIgKyBjb250cm9sbGVyUGF0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgdGhlIHNhbmRib3hJZCBmcm9tIHRhYklkIGFuZCBzYW5kYm94U2VsZWN0b3IgdXNpbmcgdGhlIHtAbGluayB0YWJJZENvbnRyb2xsZXJQYXRoS2V5fVxuICAgICAgICAgKiBAcGFyYW0gdGFiSWQgdGhlIGlkIG9mIHRoZSB0YWJcbiAgICAgICAgICogQHBhcmFtIHNhbmRib3hTZWxlY3RvciB0aGUgc2VsZWN0b3Igb2YgdGhlIHNhbmRib3guIEV4OiBpZnJhbWVbc3JjKj1wY29tcHN0cmlwZV1cbiAgICAgICAgICogQHJldHVybiB0aGUgc2FuZGJveCBpZFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2dldFNhbmRib3hJZCh0YWJJZDogc3RyaW5nLCBzYW5kYm94U2VsZWN0b3I6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgICAgICAvLyBVc2UgcmVnZXggdG8gZXh0cmFjdCB0aGUgY29udHJvbGxlciBwYXRoIGZyb20gdGhlXG4gICAgICAgICAgICB2YXIgcmVnZXhNYXRjaFJlc3VsdCA9IHNhbmRib3hTZWxlY3Rvci5tYXRjaCh0aGlzLl9TQU5EQk9YX1NFTEVDVE9SX1RPX0NPTlRST0xMRVJfUEFUSF9SRUdFWCk7XG4gICAgICAgICAgICBpZiAoIXJlZ2V4TWF0Y2hSZXN1bHQgfHxcbiAgICAgICAgICAgICAgICByZWdleE1hdGNoUmVzdWx0WzFdID09PSBudWxsIHx8IHJlZ2V4TWF0Y2hSZXN1bHRbMV0gPT09IHVuZGVmaW5lZCkgeyAvL3NhbmRib3ggMVgxIG1pZ2h0IHJldHVybiBjb250cm9sbGVyIHBhdGggb2YgZW1wdHkgc3RyaW5nXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNvbnRyb2xsZXJQYXRoOiBzdHJpbmcgPSByZWdleE1hdGNoUmVzdWx0WzFdO1xuICAgICAgICAgICAgdmFyIHRhYklkQ29udHJvbGxlclBhdGhLZXkgPSB0aGlzLl9jcmVhdGVUYWJJZENvbnRyb2xsZXJQYXRoS2V5KHRhYklkLCBjb250cm9sbGVyUGF0aCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdGFiSWRDb250cm9sbGVyUGF0aFRvU2FuZGJveElkW3RhYklkQ29udHJvbGxlclBhdGhLZXldO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZXhwb3J0IGludGVyZmFjZSBTYW5kYm94SGFuZGxlVG9XaW5kb3dNYXB7XG4gICAgICAgIFtpbmRleDogc3RyaW5nXTpXaW5kb3c7XG4gICAgfVxuXG4gICAgZXhwb3J0IGludGVyZmFjZSBTYW5kYm94SGFuZGxlRXhpc3RlbmNlTWFwe1xuICAgICAgICBbaW5kZXg6IHN0cmluZ106Ym9vbGVhbjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBtYXhpbXVtIGludGVnZXIgdmFsdWUgdGhhdCBjYW4gYmUgdXNlZCB3aXRob3V0IGxvc2luZyBwcmVjaXNpb24uXG4gICAgICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvTnVtYmVyL01BWF9TQUZFX0lOVEVHRVJcbiAgICAgKi9cbiAgICB2YXIgTUFYX1NBRkVfSU5URUdFUjpudW1iZXIgPSBOdW1iZXJbXCJNQVhfU0FGRV9JTlRFR0VSXCJdIHx8IDkwMDcxOTkyNTQ3NDA5OTE7Ly9UT0RPOiB1c2UgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVJcblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIG1pbmltdW0gaW50ZWdlciB2YWx1ZSB0aGF0IGNhbiBiZSB1c2VkIHdpdGhvdXQgbG9zaW5nIHByZWNpc2lvbi5cbiAgICAgKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9OdW1iZXIvTUlOX1NBRkVfSU5URUdFUlxuICAgICAqL1xuICAgIHZhciBNSU5fU0FGRV9JTlRFR0VSOm51bWJlciA9IE51bWJlcltcIk1JTl9TQUZFX0lOVEVHRVJcIl0gfHwgLTkwMDcxOTkyNTQ3NDA5OTE7Ly9UT0RPOiB1c2UgTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVJcblxuICAgIC8qKlxuICAgICAqIFdlIHVzZSB0aGUgc2lnbiBiaXQgaWYgd2UgY2FuIHJlbGlhYmx5IHNheSB0aGF0IGZvciBlYWNoIHBvc2l0aXZlIGludGVnZXJcbiAgICAgKiB0aGVyZSBpcyBhIG5lZ2F0aXZlIG9uZSwgYW5kIG5laXRoZXIgbG9zZSBwcmVjaXNpb24gd2hlbiB1c2VkIGkuZS4gYmVoYXZlXG4gICAgICogbGlrZSBcInRydWVcIiBpbnRlZ2Vycy5cbiAgICAgKi9cbiAgICB2YXIgVVNFX1NJR05fQklUOmJvb2xlYW4gPSAoTUFYX1NBRkVfSU5URUdFUiAqIC0xKSA9PT0gTUlOX1NBRkVfSU5URUdFUjtcblxuICAgIC8qKlxuICAgICAqIEdlbmVyYXRlcyBhIHJhbmRvbSwgNTMgb3IgNTQtYml0IGludGVnZXIgKGNhc3QgdG8gYSBzdHJpbmcpIGRlcGVuZGluZ1xuICAgICAqIG9uIGlmIHdlIGNhbiB1c2UgdGhlIHNpZ24tYml0LiBBbnkgbGFyZ2VyIGFuZCB3ZSdkIHN0YXJ0IHRvIGxvc2UgcHJlY2lzaW9uLlxuICAgICAqIFNpbmNlIHdlIHVzZSBNYXRoLmZsb29yLCB3ZSBhY3R1YWxseSBsb3NlIHRoZSBsYXN0IGludGVnZXIsIHN1Y2ggdGhhdFxuICAgICAqIG5vcm1hbGx5IChlLmcuIGJvdGggTUlOIGFuZCBNQVggYXJlIGRlZmluZWQgb24gdGhlIE51bWJlciBvYmplY3QgYW5kIHRoZWlyIGFic29sdXRlXG4gICAgICogdmFsdWVzIGFyZSB0aGUgc2FtZSkgd2UgcmV0dXJuIGEgbnVtYmVyIGJldHdlZW4gLTkwMDcxOTkyNTQ3NDA5OTAgYW5kIDkwMDcxOTkyNTQ3NDA5OTBcbiAgICAgKiBzZWUgaHR0cDovL2VjbWEyNjItNS5jb20vRUxTNV9IVE1MLmh0bSNTZWN0aW9uXzguNVxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgZnVuY3Rpb24gcmFuZG9tSW50ZWdlcigpOnN0cmluZyB7XG4gICAgICAgIHZhciByYW5kb21JbnRlZ2VyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKk1BWF9TQUZFX0lOVEVHRVIpO1xuXG4gICAgICAgIGlmIChVU0VfU0lHTl9CSVQpIHsvL2FsbC1jYXBzIG1lYW5zIHRoaXMgc2hvdWxkIGJlIGludmFyaWFudCB3aXRoaW4gYSBzaW5nbGUgSlJFXG4gICAgICAgICAgICB2YXIgaGVhZHMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKTsgLy9cImNvaW4gZmxpcFwiOiBoZWFkcz09MSBhbmQgdGFpbHM9PTBcblxuICAgICAgICAgICAgaWYgKGhlYWRzKSB7XG4gICAgICAgICAgICAgICAgLy9JZiBcImhlYWRzXCIsIG1ha2UgdGhlIG51bWJlciBuZWdhdGl2ZS5cbiAgICAgICAgICAgICAgICByYW5kb21JbnRlZ2VyICo9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJhbmRvbUludGVnZXIudG9TdHJpbmcoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYXAgb2YgaW5zdHVybWVudE1lc3NhZ2VJZHMgYW5kIHByb21pc2UgcmVzb2x2ZXJzIG9mIGVhY2ggSW5zdHJ1bWVudFNhbmRib3ggbWVzc2FnZVxuICAgICAqIHdlIHNlbmQgdG8gc2FuZGJveC4gU2VlIHtAbGluayBpbnN0cnVtZW50U2FuZGJveH0gZm9yIG1vcmUgaW5mby5cbiAgICAgKi9cbiAgICBleHBvcnQgdmFyIGluc3RydW1lbnRNZXNzYWdlczp7W2luc3RydW1lbnRNZXNzYWdlSWQ6c3RyaW5nXTogRnVuY3Rpb259ID0ge307XG5cbiAgICAvKipcbiAgICAgKiBBcHBlbmRzIGEgc2ltcGxlIGtleS12YWx1ZSBtYXAgb2Ygc3RyaW5ncyBhcyBxdWVyeSBzdHJpbmcgcGFyYW1ldGVyc1xuICAgICAqIHRvIGEgdXJsLiBVcmwgY2FuIGFscmVhZHkgY29udGFpbiBxdWVyeS1zdHJpbmcgcGFyYW1ldGVycywgb3IgaGF2ZSBub25lXG4gICAgICogYXQgYWxsLiBJbiBhZGRpdGlvbiwgaWYgVVJMIGhhcyBoYXNoKCMgZnJhZ21lbnQpIGluIGl0LCBleHRyYWN0IGl0IG91dFxuICAgICAqIGFuZCBhcHBlbmRzIGl0IGF0IHRoZSBlbmQuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybFxuICAgICAqIEBwYXJhbSB7YW55fSBwYXJhbXNcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBhcHBlbmRRdWVyeVBhcmFtcyh1cmw6c3RyaW5nLHBhcmFtczp7W2luZGV4OnN0cmluZ106c3RyaW5nfSkge1xuICAgICAgICAvL2FwcGVuZHMgdmVyeSBiYXNpYywgc3RyaW5nIHF1ZXJ5IHBhcmFtcyAobm8gb2JqZWN0cykuXG4gICAgICAgIHZhciBzb3VyY2VVcmw6c3RyaW5nID0gXCJcIiwgcXVlcnlTdHJpbmc6c3RyaW5nID0gXCJcIiwgdXJsaGFzaDpzdHJpbmcgPSBcIlwiO1xuXG4gICAgICAgIGZvciAodmFyIGtleSBpbiBwYXJhbXMpIHtcbiAgICAgICAgICAgIGlmIChwYXJhbXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIHF1ZXJ5U3RyaW5nICs9IFwiJlwiICsgZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyBcIj1cIiArIGVuY29kZVVSSUNvbXBvbmVudChwYXJhbXNba2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy9pZiBVUkwgaGFzIGhhc2goIyBmcmFnbWVudCkgaW4gaXQsIGV4dHJhY3QgaXQgb3V0IGFuZCBhcHBlbmRzIGl0IGF0IHRoZSBlbmQuXG4gICAgICAgIGlmKHVybC5pbmRleE9mKCcjJykgPiAwKXtcbiAgICAgICAgICAgIHZhciBjbCA9IHVybC5pbmRleE9mKCcjJyk7XG4gICAgICAgICAgICB1cmxoYXNoID0gdXJsLnN1YnN0cmluZyh1cmwuaW5kZXhPZignIycpLHVybC5sZW5ndGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdXJsaGFzaCA9ICcnO1xuICAgICAgICAgICAgY2wgPSB1cmwubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHNvdXJjZVVybCA9IHVybC5zdWJzdHJpbmcoMCxjbCk7XG5cbiAgICAgICAgLy9xdWVyeVN0cmluZyBsb29rcyBsaWtlOiBcIiZrZXk9dmFsdWUma2V5Mj12YWx1ZVwiXG4gICAgICAgIGlmIChzb3VyY2VVcmwuaW5kZXhPZihcIj9cIikgPiAtMSkgey8vYXBwZW5kaW5nIHRvIGEgdXJsIHdpdGggcXVlcnkgcGFyYW1zXG4gICAgICAgICAgICBpZiAoc291cmNlVXJsLmNoYXJBdChzb3VyY2VVcmwubGVuZ3RoLTEpID09PSBcIiZcIiB8fCBzb3VyY2VVcmwuY2hhckF0KHNvdXJjZVVybC5sZW5ndGgtMSkgPT09IFwiP1wiKSB7XG4gICAgICAgICAgICAgICAgLy90cmFpbGluZyBhbXBlcnNhbmQgb3IgcXVlc3Rpb24tbWFyayBwcmVzZW50LCBzbyB3ZSByZW1vdmUgb3VyIGxlYWRpbmcgYW1wZXJzYW5kLlxuICAgICAgICAgICAgICAgIC8vZS5nLiB1cmwgPSAuY29tL3BhdGg/IG9yIC5jb20vcGF0aD9rZXk9dmFsdWUmXG4gICAgICAgICAgICAgICAgcXVlcnlTdHJpbmcgPSBxdWVyeVN0cmluZy5zbGljZSgxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vbm90aGluZyB0byBkbyBmb3IgZWxzZS4gdXJsIGxvb2tzIGxpa2U6IFwiaHR0cDovL2hvc3QuY29tL3BhdGg/a2V5PXZhbHVlXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL3VybCBsb29rcyBsaWtlOiBodHRwOi8vaG9zdC5jb20vcGF0aFxuICAgICAgICAgICAgLy9wcmVwZW5kID8gYW5kIHJlbW92ZSBsZWFkaW5nIGFtcGVyc2FuZC5cbiAgICAgICAgICAgIHF1ZXJ5U3RyaW5nID0gXCI/XCIgKyBxdWVyeVN0cmluZy5zbGljZSgxKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc291cmNlVXJsICsgcXVlcnlTdHJpbmcgKyB1cmxoYXNoO1xuICAgIH1cbn1cbiJdfQ==