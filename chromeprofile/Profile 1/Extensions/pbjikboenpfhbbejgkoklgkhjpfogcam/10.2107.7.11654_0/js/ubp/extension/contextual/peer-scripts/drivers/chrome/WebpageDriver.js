var ChromeWebpagePeerDriver;
(function (ChromeWebpagePeerDriver) {
    ChromeWebpagePeerDriver.ExtensionNamespace = typeof browser != 'undefined' ? browser : chrome;
    ChromeWebpagePeerDriver.library = new Instrumentor.WebpageLibrary(document);
    function getTime() {
        return (window.performance) ? window.performance.now() : Date.now();
    }
    ChromeWebpagePeerDriver.getTime = getTime;
    function createNewResponse(messageId) {
        return {
            msgId: messageId,
            error: undefined,
            payload: undefined,
            performanceTiming: {
                requestStart: undefined,
                requestEnd: undefined
            }
        };
    }
    function handleMessage(request, sender, sendResponse) {
        if (request && this.library.canHandle(request.type)) {
            var response = createNewResponse(request.msgId);
            try {
                response.performanceTiming.requestStart = this.getTime();
                response.payload = this.library.handle(request.type, request.payload);
                response.performanceTiming.requestEnd = this.getTime();
            }
            catch (e) {
                response.error = (e && typeof e.toString === "function") ? e.toString() : "Error object in ChromeInstrumentWebpagePeerDriver is undefined or has no toString method";
            }
            finally {
                if (response.payload && typeof response.payload.then === "function") {
                    response.payload.then(function (result) {
                        response.payload = result;
                        sendResponse(response);
                    }).catch(function (error) {
                        response.payload = null;
                        response.error = error.toString();
                        sendResponse(response);
                    });
                    return true;
                }
                else {
                    sendResponse(response);
                }
            }
        }
    }
    ChromeWebpagePeerDriver.handleMessage = handleMessage;
    function bootstrap() {
        if (!this.initialized) {
            this.initialized = true;
            ChromeWebpagePeerDriver.ExtensionNamespace.runtime.onMessage.addListener(this.handleMessage.bind(this));
            window.addEventListener("message", function () {
            });
        }
    }
    ChromeWebpagePeerDriver.bootstrap = bootstrap;
    ChromeWebpagePeerDriver.bootstrap.call(ChromeWebpagePeerDriver);
})(ChromeWebpagePeerDriver || (ChromeWebpagePeerDriver = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2VicGFnZURyaXZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy91YnAvZXh0ZW5zaW9uL2NvbnRleHR1YWwvcGVlci1zY3JpcHRzL2RyaXZlcnMvY2hyb21lL1dlYnBhZ2VEcml2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBV0EsSUFBVSx1QkFBdUIsQ0ErSWhDO0FBL0lELFdBQVUsdUJBQXVCO0lBUXBCLDBDQUFrQixHQUFRLE9BQU8sT0FBTyxJQUFJLFdBQVcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7SUFhM0UsK0JBQU8sR0FBK0IsSUFBSSxZQUFZLENBQUMsY0FBYyxDQUM5RSxRQUFRLENBQ1QsQ0FBQztJQVdGLFNBQWdCLE9BQU87UUFDbkIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQ3hFLENBQUM7SUFGZSwrQkFBTyxVQUV0QixDQUFBO0lBWUQsU0FBUyxpQkFBaUIsQ0FBQyxTQUFnQjtRQUN2QyxPQUFPO1lBQ0gsS0FBSyxFQUFRLFNBQVM7WUFDdEIsS0FBSyxFQUFRLFNBQVM7WUFDdEIsT0FBTyxFQUFNLFNBQVM7WUFDdEIsaUJBQWlCLEVBQUU7Z0JBQ2YsWUFBWSxFQUFFLFNBQVM7Z0JBQ3ZCLFVBQVUsRUFBSSxTQUFTO2FBQzFCO1NBQ0osQ0FBQztJQUNOLENBQUM7SUFlRCxTQUFnQixhQUFhLENBQUMsT0FBOEIsRUFDOUIsTUFBb0MsRUFDcEMsWUFBdUQ7UUFDakYsSUFBSSxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBRWpELElBQUksUUFBUSxHQUEyQixpQkFBaUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFeEUsSUFBSTtnQkFDQSxRQUFRLENBQUMsaUJBQWlCLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFJekQsUUFBUSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFFckUsUUFBUSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7YUFDMUQ7WUFDRCxPQUFNLENBQUMsRUFBRTtnQkFHTCxRQUFRLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxDQUFDLFFBQVEsS0FBSyxVQUFVLENBQUMsQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQywwRkFBMEYsQ0FBQzthQUN2SztvQkFDTztnQkFNSixJQUFHLFFBQVEsQ0FBQyxPQUFPLElBQUksT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxVQUFVLEVBQUU7b0JBQ2hFLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVMsTUFBTTt3QkFDakMsUUFBUSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7d0JBQzFCLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDM0IsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVMsS0FBSzt3QkFDbkIsUUFBUSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7d0JBQ3hCLFFBQVEsQ0FBQyxLQUFLLEdBQUksS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO3dCQUNuQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBQzNCLENBQUMsQ0FBQyxDQUFDO29CQUtILE9BQU8sSUFBSSxDQUFDO2lCQUNmO3FCQUFNO29CQUNKLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztpQkFDekI7YUFDSjtTQUNKO0lBQ0wsQ0FBQztJQTlDZSxxQ0FBYSxnQkE4QzVCLENBQUE7SUFRRCxTQUFnQixTQUFTO1FBRXJCLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ25CLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1lBRXhCLHdCQUFBLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFFaEYsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRTtZQUduQyxDQUFDLENBQUMsQ0FBQztTQUNOO0lBQ0wsQ0FBQztJQVplLGlDQUFTLFlBWXhCLENBQUE7SUFHRCx1QkFBdUIsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFDbEUsQ0FBQyxFQS9JUyx1QkFBdUIsS0FBdkIsdUJBQXVCLFFBK0loQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGhpcyBib290c3RyYXBzIHtAbGluayBXZWJwYWdlSW5zdHJ1bWVudExpYnJhcnl9IHVuZGVyIENocm9tZSdzIGNvbnRlbnQgc2NyaXB0XG4gKiBlbnZpcm9ubWVudCBvbmx5IE9OQ0U6IFRvIGF2b2lkIGR1cGxpY2F0ZSBsaXN0ZW5lcnMgb24gY2hyb21lIHJ1bnRpbWVcbiAqIG1lc3NhZ2VzLCB7QGxpbmsgQ2hyb21lSW5zdHJ1bWVudFdlYnBhZ2VQZWVyRHJpdmVyI2Jvb3RzdHJhcH0gd2lsbCBvbmx5IHJlZ2lzdGVyIHRoZSBsaXN0ZW5lciBvbmNlXG4gKiB3aXRoaW4gdGhlIGNvbnRlbnQgc2NyaXB0IEpSRSBsaWZldGltZSBieSBpZ25vcmluZyBhbGwgc3Vic2VxdWVudCBjYWxscy5cbiAqIEhvd2V2ZXIsIHtAbGluayBXZWJwYWdlSW5zdHJ1bWVudExpYnJhcnl9IHdpbGwgYmUgcmVuZXdlZCBpZiBpbmplY3RlZCBhZ2FpblxuICogdG8gZW5zdXJlIHRoZSBsaWJyYXJ5IGlzIHVwIHRvIGRhdGUgaW4gY2FzZSBvZiBleHRlbnNpb24gdXBkYXRlcy9yZXN0YXJ0cy5cbiAqXG4gKiBYWFg6IHBlZXIgc2NyaXB0cyBjYW5ub3QgdXNlIHRoZSBtb2R1bGUgbG9hZGVyIGFzIHRoZXkgYXJlIHRvIGJlIGluamVjdGVkXG4gKiBvbnRvIHRoZSBwYWdlIGRpcmVjdGx5IGFuZCB0aHVzIG5lZWQgdG8gbGlnaHQtd2VpZ2h0LlxuICovXG5uYW1lc3BhY2UgQ2hyb21lV2VicGFnZVBlZXJEcml2ZXIge1xuICAvKipcbiAgICogR2V0IHRoZSBydW50aW1lIGV4dGVuc2lvbiBuYW1lc3BhY2UsIHdoaWNoIGlzIHRoZSBleHRlbnNpb24gQXBpIG5hbWVzcGFjZVxuICAgKiBmb3IgY2hyb21lLCBpdCBpcyBjaHJvbWVcbiAgICogZm9yIGVkZ2UsIGl0IGlzIGVkZ2VcbiAgICogSXQgd2lsbCBiZSBpZGVhbCB3ZSBjYW4gZ2V0IHRoaXMgZnJvbSBSdW50aW1tZVxuICAgKiBAdHlwZSB7YnJvd3NlcnxjaHJvbWV9XG4gICAqL1xuICBleHBvcnQgdmFyIEV4dGVuc2lvbk5hbWVzcGFjZTogYW55ID0gdHlwZW9mIGJyb3dzZXIgIT0gJ3VuZGVmaW5lZCcgPyBicm93c2VyIDogY2hyb21lO1xuICBcbiAgLyoqXG4gICAqIEZsYWcgdG8gZW5zdXJlIGJvb3RzdHJhcHBpbmcgb25seSBoYXBwZW5zIG9uY2VcbiAgICovXG4gIGV4cG9ydCB2YXIgaW5pdGlhbGl6ZWQ6Ym9vbGVhbjtcblxuICAvKipcbiAgICogRGVsZWdhdGUgdG8gdGhlIGJyb3dzZXItYWdub3N0aWMgY29udGV4dHVhbCBwZWVyIGxpYnJhcnkgZm9yIHNjcmFwaW5nLlxuICAgKiBOb3RlOiBDaHJvbWVJbnN0cnVtZW50V2VicGFnZVBlZXJEcml2ZXIgaXMgYSBnbG9iYWwgbmFtZXNwYWNlIGFuZCB0aGlzIHdpbGwgcmVwbGFjZSBpdHNcbiAgICogcmVmZXJlbmNlIGV2ZXJ5IHRpbWUgdGhlIGRyaXZlciBzY3JpcHQgaXMgaW5qZWN0ZWRcbiAgICogQHR5cGUge1dlYnBhZ2VJbnN0cnVtZW50b3IuV2VicGFnZUluc3RydW1lbnRvckxpYnJhcnl9XG4gICAqL1xuICBleHBvcnQgdmFyIGxpYnJhcnk6SW5zdHJ1bWVudG9yLldlYnBhZ2VMaWJyYXJ5ID0gbmV3IEluc3RydW1lbnRvci5XZWJwYWdlTGlicmFyeShcbiAgICBkb2N1bWVudFxuICApO1xuXG4gIC8qKlxuICAgKiBSZXR1cm4gY3VycmVudCB0aW1lIHN0YW1wIGZvciBwcm9maWxpbmdcbiAgICpcbiAgICogcGVyZm9ybWFuY2Uubm93KCkgcmV0dXJucyBhIGhpZ2ggcmVzb2x1dGlvbiB0aW1lIHN0YW1wIGluIG1pbGxpb25cbiAgICogc2Vjb25kcy4gVW5saWtlIERhdGUubm93KCksIGl0IHJldHVybnMgYSBmbG9hdGluZyBwb2ludCBudW1iZXIgd2l0aCB1cFxuICAgKiB0byBtaWNyb3NlY29uZCBwcmVjaXNpb24uXG4gICAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9QZXJmb3JtYW5jZS5ub3dcbiAgICogQHJldHVybnMge251bWJlcn1cbiAgICovXG4gIGV4cG9ydCBmdW5jdGlvbiBnZXRUaW1lKCkge1xuICAgICAgcmV0dXJuICh3aW5kb3cucGVyZm9ybWFuY2UpID8gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpIDogRGF0ZS5ub3coKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZCBhbmQgcmV0dXJuIGFuIGVtcHR5IHtAbGluayBJQ29udGV4dHVhbFBlZXJSZXNwb25zZX0gb2JqZWN0XG4gICAqXG4gICAqIE5vdGU6IHBlcmZvcm1hbmNlVGltaW5nIGlzIGEgcGxhY2UgaG9sZGVyIGZvciBzdG9yaW5nIHByb2ZpbGluZ1xuICAgKiBkYXRhIG9mIHRoZSBleGVjdXRpb24gKGVhY2ggc3RhcnQvZW5kIHBhaXIgcmVjb3JkcyB0aGUgdGltZSBzdGFtcHNcbiAgICogYmVmb3JlL2FmdGVyIHJlcXVlc3QgZXhlY3V0aW9uKVxuICAgKlxuICAgKiBAcGFyYW0gbWVzc2FnZUlkXG4gICAqIEByZXR1cm5zIHt7bXNnSWQ6IHN0cmluZywgZXJyb3I6IHVuZGVmaW5lZCwgcGF5bG9hZDogdW5kZWZpbmVkLCBwZXJmb3JtYW5jZVRpbWluZzoge3JlcXVlc3RTdGFydDogdW5kZWZpbmVkLCByZXF1ZXN0RW5kOiB1bmRlZmluZWR9fX1cbiAgICovXG4gIGZ1bmN0aW9uIGNyZWF0ZU5ld1Jlc3BvbnNlKG1lc3NhZ2VJZDpzdHJpbmcpOklDb250ZXh0dWFsUGVlclJlc3BvbnNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICAgbXNnSWQgICAgICA6IG1lc3NhZ2VJZCxcbiAgICAgICAgICBlcnJvciAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICAgIHBheWxvYWQgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgcGVyZm9ybWFuY2VUaW1pbmc6IHtcbiAgICAgICAgICAgICAgcmVxdWVzdFN0YXJ0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIHJlcXVlc3RFbmQgIDogdW5kZWZpbmVkXG4gICAgICAgICAgfVxuICAgICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsZWQgd2hlbiByZWNlaXZlZCBhIHJ1bnRpbWUgbWVzc2FnZSBmcm9tIHRoZSBleHRlbnNpb24uXG4gICAqIEZpcnN0IGNoZWNrIGlmIHRoZSBsaWJyYXJ5IGNhbiBoYW5kbGUgdGhlIG1lc3NhZ2UvcmVxdWVzdCBhbmQgb25seSBmb3J3YXJkXG4gICAqIGl0IHRvIHRoZSBsaWJyYXJ5IGlmIHllcy4gSXQgbG9ncyB0aGUgdGltZSB0b29rIGZvciB0aGUgbGlicmFyeSB0b1xuICAgKiBleGVjdXRlIHRoZSByZXF1ZXN0IGFuZCBvbmNlIGl0IGlzIGRvbmUsIHNlbmQgdGhlIHJlc3VsdCBiYWNrXG4gICAqIHRvIHRoZSBleHRlbnNpb24gYnkgZXhlY3V0aW5nIHRoZSBjYWxsYmFjayBwcm92aWRlZCBieSBydW50aW1lXG4gICAqXG4gICAqIE5vdGU6IFwidGhpc1wiIGlzIHN1cHBvc2UgdG8gYmluZCB0byB0aGUgbW9kdWxlIG5hbWVzcGFjZVxuICAgKlxuICAgKiBAcGFyYW0gcmVxdWVzdFxuICAgKiBAcGFyYW0gc2VuZGVyXG4gICAqIEBwYXJhbSBzZW5kUmVzcG9uc2VcbiAgICovXG4gIGV4cG9ydCBmdW5jdGlvbiBoYW5kbGVNZXNzYWdlKHJlcXVlc3Q6SUNvbnRleHR1YWxQZWVyUmVxdWVzdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyOiBjaHJvbWUucnVudGltZS5NZXNzYWdlU2VuZGVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2U6KHJlc3BvbnNlOklDb250ZXh0dWFsUGVlclJlc3BvbnNlKSA9PiB2b2lkKTp2b2lkfGJvb2xlYW4ge1xuICAgICAgaWYgKHJlcXVlc3QgJiYgdGhpcy5saWJyYXJ5LmNhbkhhbmRsZShyZXF1ZXN0LnR5cGUpKSB7XG5cbiAgICAgICAgICB2YXIgcmVzcG9uc2U6SUNvbnRleHR1YWxQZWVyUmVzcG9uc2UgPSBjcmVhdGVOZXdSZXNwb25zZShyZXF1ZXN0Lm1zZ0lkKTtcblxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHJlc3BvbnNlLnBlcmZvcm1hbmNlVGltaW5nLnJlcXVlc3RTdGFydCA9IHRoaXMuZ2V0VGltZSgpO1xuXG4gICAgICAgICAgICAgIC8vIFRPRE86IGFsbG93IHRvIGFjY2VwdCBhbiBhcnJheSBvZiBJQ29udGV4dHVhbFBlZXJSZXF1ZXN0XG4gICAgICAgICAgICAgIC8vIGFuZCByZXR1cm4gYW4gYXJyYXkgb2YgcmVzcG9uc2VzIGZyb20gYWxsIHJlcXVlc3RcbiAgICAgICAgICAgICAgcmVzcG9uc2UucGF5bG9hZCA9IHRoaXMubGlicmFyeS5oYW5kbGUocmVxdWVzdC50eXBlLHJlcXVlc3QucGF5bG9hZCk7XG5cbiAgICAgICAgICAgICAgcmVzcG9uc2UucGVyZm9ybWFuY2VUaW1pbmcucmVxdWVzdEVuZCA9IHRoaXMuZ2V0VGltZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXRjaChlKSB7XG4gICAgICAgICAgICAgIC8vIFBhc3Npbmcgd2hvbGUgZXJyb3Igb2JqZWN0IHRvIGV4dGVuc2lvbiByZXN1bHRzIGluIGVtcHR5IG9iamVjdCBpbiB0aGUgZXh0ZW5zaW9uLlxuICAgICAgICAgICAgICAvLyBTbyBvbmx5IHBhc3MgdGhlIGVycm9yIG1lc3NhZ2UuXG4gICAgICAgICAgICAgIHJlc3BvbnNlLmVycm9yID0gKGUgJiYgdHlwZW9mIGUudG9TdHJpbmcgPT09IFwiZnVuY3Rpb25cIik/IGUudG9TdHJpbmcoKSA6IFwiRXJyb3Igb2JqZWN0IGluIENocm9tZUluc3RydW1lbnRXZWJwYWdlUGVlckRyaXZlciBpcyB1bmRlZmluZWQgb3IgaGFzIG5vIHRvU3RyaW5nIG1ldGhvZFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAqIFdoaWxlIHNlbmRpbmcgYXN5bmNocm9ub3VzIHJlc3BvbnNlcywgdGhpcy5saWJyYXJ5LmhhbmRsZSB3aWxsIHJldHVybiBhIHByb21pc2UuIEJlbG93IGNoZWNrXG4gICAgICAgICAgICAgICAqIG1ha2VzIHN1cmUgaWYgdGhlIHJldHVybiB2YWx1ZSBpcyBhIHByb21pc2UsIGl0IHdhaXRzIHRpbGwgaXQgZ2V0cyByZXNvbHZlZCBhbmQgc2VuZHMgdGhlXG4gICAgICAgICAgICAgICAqIHJlc3VsdCBvZiBwcm9taXNlIGFzIHJlc3BvbnNlJ3MgcGF5bG9hZC5cbiAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIGlmKHJlc3BvbnNlLnBheWxvYWQgJiYgdHlwZW9mIHJlc3BvbnNlLnBheWxvYWQudGhlbiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICByZXNwb25zZS5wYXlsb2FkLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcbiAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5wYXlsb2FkID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgIHNlbmRSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UucGF5bG9hZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZXJyb3IgPSAgZXJyb3IudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAqIFJldHVybmluZyAndHJ1ZScgaW5kaWNhdGVzIGl0cyBhbiBhc3luY2hyb25vdXMgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL0FkZC1vbnMvV2ViRXh0ZW5zaW9ucy9BUEkvcnVudGltZS9vbk1lc3NhZ2UjU2VuZGluZ19hbl9hc3luY2hyb25vdXNfcmVzcG9uc2VfdXNpbmdfc2VuZFJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOyBcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgc2VuZFJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBCb290c3RyYXBzIHRoZSBjb250ZXh0dWFsIHBlZXIgbGlicmFyeSB0byB0aGUgY29udGV4dCBzY3JpcHQgcnVudGltZVxuICAgKlxuICAgKiBOb3RlOiBcInRoaXNcIiBpcyBzdXBwb3NlIHRvIGJpbmQgdG8gdGhlIG1vZHVsZSBuYW1lc3BhY2VcbiAgICpcbiAgICovXG4gIGV4cG9ydCBmdW5jdGlvbiBib290c3RyYXAoKSB7XG4gICAgICAvLyBBbGxvdyBib290c3RyYXAgdG8gaGFwcGVuIG9ubHkgb25jZSBwZXIgSlJFXG4gICAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgICAgICAgIEV4dGVuc2lvbk5hbWVzcGFjZS5ydW50aW1lLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcih0aGlzLmhhbmRsZU1lc3NhZ2UuYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy9UT0RPOiBoYW5kbGUgbWVzc2FnZSBmcm9tIHdlYnBhZ2UgZnJhbWVzLiBUaGlzIGlzIG5lZWRlZCBpbiBjYXNlIG9mIGluc3RydW1lbnRpbmcgXG4gICAgICAgICAgICAvL2lubmVyIGZyYW1lcyBvZiBhIHdlYnBhZ2UuXG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gIH1cblxuICAvLyBjYWxsIGV2ZXJ5IHRpbWUgdGhlIGRyaXZlciBpcyBpbmplY3RlZCBidXQgb25seSB0aGUgZmlyc3Qgd2lsbCBzdWNjZWVkXG4gIENocm9tZVdlYnBhZ2VQZWVyRHJpdmVyLmJvb3RzdHJhcC5jYWxsKENocm9tZVdlYnBhZ2VQZWVyRHJpdmVyKTtcbn1cbiJdfQ==