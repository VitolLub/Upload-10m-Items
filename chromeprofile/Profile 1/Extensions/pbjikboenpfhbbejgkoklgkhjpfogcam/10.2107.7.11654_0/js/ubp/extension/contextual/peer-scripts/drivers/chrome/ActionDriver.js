var ChromeActionPeerDriver;
(function (ChromeActionPeerDriver) {
    ChromeActionPeerDriver.ExtensionNamespace = typeof browser != 'undefined' ? browser : chrome;
    ChromeActionPeerDriver.actionHandler = function (msg) {
        ChromeActionPeerDriver.ExtensionNamespace.runtime.sendMessage({
            type: "UBPExternalMessage.Action",
            payload: msg
        });
    };
    ChromeActionPeerDriver.library = new Action.ActionLibrary(document, ChromeActionPeerDriver.actionHandler);
    function getTime() {
        return (window.performance) ? window.performance.now() : Date.now();
    }
    ChromeActionPeerDriver.getTime = getTime;
    function createNewResponse(messageId) {
        return {
            msgId: messageId,
            error: undefined,
            payload: undefined,
            performanceTiming: {
                requestStart: undefined,
                requestEnd: undefined
            }
        };
    }
    function handleMessage(request, sender, sendResponse) {
        if (request && this.library.canHandle(request.type)) {
            var response = createNewResponse(request.msgId);
            try {
                response.performanceTiming.requestStart = this.getTime();
                response.payload = this.library.handle(request.type, request.payload);
                response.performanceTiming.requestEnd = this.getTime();
            }
            catch (e) {
                response.error = (e && typeof e.toString === "function") ? e.toString() : "Error object in ChromeActionDriver is undefined or has no toString" +
                    " method";
            }
            finally {
                sendResponse(response);
            }
        }
    }
    ChromeActionPeerDriver.handleMessage = handleMessage;
    function bootstrap() {
        if (!this.initialized) {
            this.initialized = true;
            ChromeActionPeerDriver.ExtensionNamespace.runtime.onMessage.addListener(this.handleMessage.bind(this));
        }
    }
    ChromeActionPeerDriver.bootstrap = bootstrap;
    ChromeActionPeerDriver.bootstrap.call(ChromeActionPeerDriver);
})(ChromeActionPeerDriver || (ChromeActionPeerDriver = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWN0aW9uRHJpdmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3VicC9leHRlbnNpb24vY29udGV4dHVhbC9wZWVyLXNjcmlwdHMvZHJpdmVycy9jaHJvbWUvQWN0aW9uRHJpdmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWFBLElBQVUsc0JBQXNCLENBZ0kvQjtBQWhJRCxXQUFVLHNCQUFzQjtJQVNqQix5Q0FBa0IsR0FBUSxPQUFPLE9BQU8sSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBTzNFLG9DQUFhLEdBQVksVUFBQyxHQUFPO1FBQ3hDLHVCQUFBLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7WUFDbkMsSUFBSSxFQUFFLDJCQUEyQjtZQUNqQyxPQUFPLEVBQUUsR0FBRztTQUNmLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQztJQVFTLDhCQUFPLEdBQXdCLElBQUksTUFBTSxDQUFDLGFBQWEsQ0FDOUQsUUFBUSxFQUNSLHVCQUFBLGFBQWEsQ0FDaEIsQ0FBQztJQVdGLFNBQWdCLE9BQU87UUFDbkIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQ3hFLENBQUM7SUFGZSw4QkFBTyxVQUV0QixDQUFBO0lBWUQsU0FBUyxpQkFBaUIsQ0FBQyxTQUFnQjtRQUN2QyxPQUFPO1lBQ0gsS0FBSyxFQUFRLFNBQVM7WUFDdEIsS0FBSyxFQUFRLFNBQVM7WUFDdEIsT0FBTyxFQUFNLFNBQVM7WUFDdEIsaUJBQWlCLEVBQUU7Z0JBQ2YsWUFBWSxFQUFFLFNBQVM7Z0JBQ3ZCLFVBQVUsRUFBSSxTQUFTO2FBQzFCO1NBQ0osQ0FBQztJQUNOLENBQUM7SUFlRCxTQUFnQixhQUFhLENBQUMsT0FBOEIsRUFDOUIsTUFBbUMsRUFDbkMsWUFBdUQ7UUFDakYsSUFBSSxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBRWpELElBQUksUUFBUSxHQUEyQixpQkFBaUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFeEUsSUFBSTtnQkFDQSxRQUFRLENBQUMsaUJBQWlCLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFJekQsUUFBUSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFFdEUsUUFBUSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7YUFDMUQ7WUFDRCxPQUFNLENBQUMsRUFBRTtnQkFHTCxRQUFRLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxDQUFDLFFBQVEsS0FBSyxVQUFVLENBQUMsQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQyxvRUFBb0U7b0JBQzdJLFNBQVMsQ0FBQzthQUViO29CQUNPO2dCQUNKLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUMxQjtTQUNKO0lBQ0wsQ0FBQztJQTNCZSxvQ0FBYSxnQkEyQjVCLENBQUE7SUFRRCxTQUFnQixTQUFTO1FBRXJCLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ25CLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1lBRXhCLHVCQUFBLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDbkY7SUFDTCxDQUFDO0lBUGUsZ0NBQVMsWUFPeEIsQ0FBQTtJQUdELHNCQUFzQixDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUNsRSxDQUFDLEVBaElTLHNCQUFzQixLQUF0QixzQkFBc0IsUUFnSS9CIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUaGlzIGJvb3RzdHJhcHMge0BsaW5rIEFjdGlvbkxpYnJhcnl9IHVuZGVyIENocm9tZSdzIGNvbnRlbnQgc2NyaXB0XG4gKiBlbnZpcm9ubWVudCBvbmx5IE9OQ0U6IFRvIGF2b2lkIGR1cGxpY2F0ZSBsaXN0ZW5lcnMgb24gY2hyb21lIHJ1bnRpbWVcbiAqIG1lc3NhZ2VzLCB7QGxpbmsgQ2hyb21lQWN0aW9uUGVlckRyaXZlciNib290c3RyYXB9IHdpbGwgb25seSByZWdpc3RlciB0aGUgbGlzdGVuZXIgb25jZVxuICogd2l0aGluIHRoZSBjb250ZW50IHNjcmlwdCBKUkUgbGlmZXRpbWUgYnkgaWdub3JpbmcgYWxsIHN1YnNlcXVlbnQgY2FsbHMuXG4gKiBIb3dldmVyLCB7QGxpbmsgQWN0aW9uTGlicmFyeX0gd2lsbCBiZSByZW5ld2VkIGlmIGluamVjdGVkIGFnYWluXG4gKiB0byBlbnN1cmUgdGhlIGxpYnJhcnkgaXMgdXAgdG8gZGF0ZSBpbiBjYXNlIG9mIGV4dGVuc2lvbiB1cGRhdGVzL3Jlc3RhcnRzLlxuICpcbiAqIFhYWDogcGVlciBzY3JpcHRzIGNhbm5vdCB1c2UgdGhlIG1vZHVsZSBsb2FkZXIgYXMgdGhleSBhcmUgdG8gYmUgaW5qZWN0ZWRcbiAqIG9udG8gdGhlIHBhZ2UgZGlyZWN0bHkgYW5kIHRodXMgbmVlZCB0byBsaWdodC13ZWlnaHQuXG4gKlxuICogQGF1dGhvciBqZWV0dWJcbiAqL1xubmFtZXNwYWNlIENocm9tZUFjdGlvblBlZXJEcml2ZXIge1xuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBydW50aW1lIGV4dGVuc2lvbiBuYW1lc3BhY2UsIHdoaWNoIGlzIHRoZSBleHRlbnNpb24gQXBpIG5hbWVzcGFjZVxuICAgICAqIGZvciBjaHJvbWUsIGl0IGlzIGNocm9tZVxuICAgICAqIGZvciBlZGdlLCBpdCBpcyBlZGdlXG4gICAgICogSXQgd2lsbCBiZSBpZGVhbCB3ZSBjYW4gZ2V0IHRoaXMgZnJvbSBSdW50aW1tZVxuICAgICAqIEB0eXBlIHticm93c2VyfGNocm9tZX1cbiAgICAgKi9cbiAgICBleHBvcnQgdmFyIEV4dGVuc2lvbk5hbWVzcGFjZTogYW55ID0gdHlwZW9mIGJyb3dzZXIgIT0gJ3VuZGVmaW5lZCcgPyBicm93c2VyIDogY2hyb21lO1xuICAgIFxuICAgIC8qKlxuICAgICAqIEZsYWcgdG8gZW5zdXJlIGJvb3RzdHJhcHBpbmcgb25seSBoYXBwZW5zIG9uY2UuXG4gICAgICovXG4gICAgZXhwb3J0IHZhciBpbml0aWFsaXplZDpib29sZWFuO1xuXG4gICAgZXhwb3J0IHZhciBhY3Rpb25IYW5kbGVyOkZ1bmN0aW9uID0gKG1zZzphbnkpID0+IHtcbiAgICAgICAgRXh0ZW5zaW9uTmFtZXNwYWNlLnJ1bnRpbWUuc2VuZE1lc3NhZ2Uoe1xuICAgICAgICAgICAgdHlwZTogXCJVQlBFeHRlcm5hbE1lc3NhZ2UuQWN0aW9uXCIsXG4gICAgICAgICAgICBwYXlsb2FkOiBtc2dcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlbGVnYXRlIHRvIHRoZSBicm93c2VyLWFnbm9zdGljIGNvbnRleHR1YWwgcGVlciBsaWJyYXJ5IGZvciBzY3JhcGluZy5cbiAgICAgKiBOb3RlOiBDaHJvbWVBY3Rpb25QZWVyRHJpdmVyIGlzIGEgZ2xvYmFsIG5hbWVzcGFjZSBhbmQgdGhpcyB3aWxsIHJlcGxhY2UgaXRzXG4gICAgICogcmVmZXJlbmNlIGV2ZXJ5IHRpbWUgdGhlIGRyaXZlciBzY3JpcHQgaXMgaW5qZWN0ZWRcbiAgICAgKiBAdHlwZSB7QWN0aW9uLkFjdGlvbkxpYnJhcnl9XG4gICAgICovXG4gICAgZXhwb3J0IHZhciBsaWJyYXJ5OkFjdGlvbi5BY3Rpb25MaWJyYXJ5ID0gbmV3IEFjdGlvbi5BY3Rpb25MaWJyYXJ5KFxuICAgICAgICBkb2N1bWVudCxcbiAgICAgICAgYWN0aW9uSGFuZGxlclxuICAgICk7XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gY3VycmVudCB0aW1lIHN0YW1wIGZvciBwcm9maWxpbmdcbiAgICAgKlxuICAgICAqIHBlcmZvcm1hbmNlLm5vdygpIHJldHVybnMgYSBoaWdoIHJlc29sdXRpb24gdGltZSBzdGFtcCBpbiBtaWxsaW9uXG4gICAgICogc2Vjb25kcy4gVW5saWtlIERhdGUubm93KCksIGl0IHJldHVybnMgYSBmbG9hdGluZyBwb2ludCBudW1iZXIgd2l0aCB1cFxuICAgICAqIHRvIG1pY3Jvc2Vjb25kIHByZWNpc2lvbi5cbiAgICAgKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvUGVyZm9ybWFuY2Uubm93XG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICBleHBvcnQgZnVuY3Rpb24gZ2V0VGltZSgpIHtcbiAgICAgICAgcmV0dXJuICh3aW5kb3cucGVyZm9ybWFuY2UpID8gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpIDogRGF0ZS5ub3coKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCdWlsZCBhbmQgcmV0dXJuIGFuIGVtcHR5IHtAbGluayBJQ29udGV4dHVhbFBlZXJSZXNwb25zZX0gb2JqZWN0XG4gICAgICpcbiAgICAgKiBOb3RlOiBwZXJmb3JtYW5jZVRpbWluZyBpcyBhIHBsYWNlIGhvbGRlciBmb3Igc3RvcmluZyBwcm9maWxpbmdcbiAgICAgKiBkYXRhIG9mIHRoZSBleGVjdXRpb24gKGVhY2ggc3RhcnQvZW5kIHBhaXIgcmVjb3JkcyB0aGUgdGltZSBzdGFtcHNcbiAgICAgKiBiZWZvcmUvYWZ0ZXIgcmVxdWVzdCBleGVjdXRpb24pXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWVzc2FnZUlkXG4gICAgICogQHJldHVybnMge3ttc2dJZDogc3RyaW5nLCBlcnJvcjogdW5kZWZpbmVkLCBwYXlsb2FkOiB1bmRlZmluZWQsIHBlcmZvcm1hbmNlVGltaW5nOiB7cmVxdWVzdFN0YXJ0OiB1bmRlZmluZWQsIHJlcXVlc3RFbmQ6IHVuZGVmaW5lZH19fVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZU5ld1Jlc3BvbnNlKG1lc3NhZ2VJZDpzdHJpbmcpOklDb250ZXh0dWFsUGVlclJlc3BvbnNlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1zZ0lkICAgICAgOiBtZXNzYWdlSWQsXG4gICAgICAgICAgICBlcnJvciAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgcGF5bG9hZCAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHBlcmZvcm1hbmNlVGltaW5nOiB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdFN0YXJ0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgcmVxdWVzdEVuZCAgOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiByZWNlaXZlZCBhIHJ1bnRpbWUgbWVzc2FnZSBmcm9tIHRoZSBleHRlbnNpb24uXG4gICAgICogRmlyc3QgY2hlY2sgaWYgdGhlIGxpYnJhcnkgY2FuIGhhbmRsZSB0aGUgbWVzc2FnZS9yZXF1ZXN0IGFuZCBvbmx5IGZvcndhcmRcbiAgICAgKiBpdCB0byB0aGUgbGlicmFyeSBpZiB5ZXMuIEl0IGxvZ3MgdGhlIHRpbWUgdG9vayBmb3IgdGhlIGxpYnJhcnkgdG9cbiAgICAgKiBleGVjdXRlIHRoZSByZXF1ZXN0IGFuZCBvbmNlIGl0IGlzIGRvbmUsIHNlbmQgdGhlIHJlc3VsdCBiYWNrXG4gICAgICogdG8gdGhlIGV4dGVuc2lvbiBieSBleGVjdXRpbmcgdGhlIGNhbGxiYWNrIHByb3ZpZGVkIGJ5IHJ1bnRpbWVcbiAgICAgKlxuICAgICAqIE5vdGU6IFwidGhpc1wiIGlzIHN1cHBvc2UgdG8gYmluZCB0byB0aGUgbW9kdWxlIG5hbWVzcGFjZVxuICAgICAqXG4gICAgICogQHBhcmFtIHJlcXVlc3RcbiAgICAgKiBAcGFyYW0gc2VuZGVyXG4gICAgICogQHBhcmFtIHNlbmRSZXNwb25zZVxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBoYW5kbGVNZXNzYWdlKHJlcXVlc3Q6SUNvbnRleHR1YWxQZWVyUmVxdWVzdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kZXI6Y2hyb21lLnJ1bnRpbWUuTWVzc2FnZVNlbmRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2U6KHJlc3BvbnNlOklDb250ZXh0dWFsUGVlclJlc3BvbnNlKSA9PiB2b2lkKTp2b2lkIHtcbiAgICAgICAgaWYgKHJlcXVlc3QgJiYgdGhpcy5saWJyYXJ5LmNhbkhhbmRsZShyZXF1ZXN0LnR5cGUpKSB7XG5cbiAgICAgICAgICAgIHZhciByZXNwb25zZTpJQ29udGV4dHVhbFBlZXJSZXNwb25zZSA9IGNyZWF0ZU5ld1Jlc3BvbnNlKHJlcXVlc3QubXNnSWQpO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnBlcmZvcm1hbmNlVGltaW5nLnJlcXVlc3RTdGFydCA9IHRoaXMuZ2V0VGltZSgpO1xuXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogYWxsb3cgdG8gYWNjZXB0IGFuIGFycmF5IG9mIElDb250ZXh0dWFsUGVlclJlcXVlc3RcbiAgICAgICAgICAgICAgICAvLyBhbmQgcmV0dXJuIGFuIGFycmF5IG9mIHJlc3BvbnNlcyBmcm9tIGFsbCByZXF1ZXN0XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UucGF5bG9hZCA9IHRoaXMubGlicmFyeS5oYW5kbGUocmVxdWVzdC50eXBlLCByZXF1ZXN0LnBheWxvYWQpO1xuXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UucGVyZm9ybWFuY2VUaW1pbmcucmVxdWVzdEVuZCA9IHRoaXMuZ2V0VGltZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2goZSkge1xuICAgICAgICAgICAgICAgIC8vIFBhc3Npbmcgd2hvbGUgZXJyb3Igb2JqZWN0IHRvIGV4dGVuc2lvbiByZXN1bHRzIGluIGVtcHR5IG9iamVjdCBpbiB0aGUgZXh0ZW5zaW9uLlxuICAgICAgICAgICAgICAgIC8vIFNvIG9ubHkgcGFzcyB0aGUgZXJyb3IgbWVzc2FnZS5cbiAgICAgICAgICAgICAgICByZXNwb25zZS5lcnJvciA9IChlICYmIHR5cGVvZiBlLnRvU3RyaW5nID09PSBcImZ1bmN0aW9uXCIpPyBlLnRvU3RyaW5nKCkgOiBcIkVycm9yIG9iamVjdCBpbiBDaHJvbWVBY3Rpb25Ecml2ZXIgaXMgdW5kZWZpbmVkIG9yIGhhcyBubyB0b1N0cmluZ1wiICtcbiAgICAgICAgICAgICAgICBcIiBtZXRob2RcIjtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICAgICAgc2VuZFJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJvb3RzdHJhcHMgdGhlIGNvbnRleHR1YWwgcGVlciBsaWJyYXJ5IHRvIHRoZSBjb250ZXh0IHNjcmlwdCBydW50aW1lXG4gICAgICpcbiAgICAgKiBOb3RlOiBcInRoaXNcIiBpcyBzdXBwb3NlIHRvIGJpbmQgdG8gdGhlIG1vZHVsZSBuYW1lc3BhY2VcbiAgICAgKlxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBib290c3RyYXAoKSB7XG4gICAgICAgIC8vIEFsbG93IGJvb3RzdHJhcCB0byBoYXBwZW4gb25seSBvbmNlIHBlciBKUkVcbiAgICAgICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgRXh0ZW5zaW9uTmFtZXNwYWNlLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKHRoaXMuaGFuZGxlTWVzc2FnZS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBjYWxsIGV2ZXJ5IHRpbWUgdGhlIGRyaXZlciBpcyBpbmplY3RlZCBidXQgb25seSB0aGUgZmlyc3Qgd2lsbCBzdWNjZWVkXG4gICAgQ2hyb21lQWN0aW9uUGVlckRyaXZlci5ib290c3RyYXAuY2FsbChDaHJvbWVBY3Rpb25QZWVyRHJpdmVyKTtcbn1cbiJdfQ==