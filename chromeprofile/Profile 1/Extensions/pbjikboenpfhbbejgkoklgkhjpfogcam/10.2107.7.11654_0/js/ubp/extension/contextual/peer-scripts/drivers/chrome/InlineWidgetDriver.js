var ChromeInlineWidgetDriver;
(function (ChromeInlineWidgetDriver) {
    ChromeInlineWidgetDriver.ExtensionNamespace = typeof browser != 'undefined' ? browser : chrome;
    ChromeInlineWidgetDriver.library = new InlineWidgetLibrary.InlineWidgetHandler();
    function getTime() {
        return (window.performance) ? window.performance.now() : Date.now();
    }
    ChromeInlineWidgetDriver.getTime = getTime;
    function createNewResponse(messageId) {
        return {
            msgId: messageId,
            error: undefined,
            payload: undefined,
            performanceTiming: {
                requestStart: undefined,
                requestEnd: undefined
            }
        };
    }
    function handleMessage(request, sender, sendResponse) {
        if (request && this.library.canHandle(request.type)) {
            var response = createNewResponse(request.msgId);
            var functionString = "function";
            try {
                response.performanceTiming.requestStart = this.getTime();
                response.payload = this.library.handle(request.type, request.payload);
                response.performanceTiming.requestEnd = this.getTime();
            }
            catch (e) {
                response.error = (e && typeof e.toString === functionString) ? e.toString() : "Error object in ChromeInlineWidgetDriver is undefined or has no toString method";
            }
            finally {
                if (response.payload && typeof response.payload.then === functionString) {
                    response.payload.then(function (result) {
                        response.payload = result;
                        sendResponse(response);
                    }).catch(function (error) {
                        response.payload = null;
                        response.error = error.toString();
                        sendResponse(response);
                    });
                    return true;
                }
                else {
                    sendResponse(response);
                }
            }
        }
    }
    ChromeInlineWidgetDriver.handleMessage = handleMessage;
    function bootstrap() {
        if (!this.initialized) {
            this.initialized = true;
            ChromeInlineWidgetDriver.ExtensionNamespace.runtime.onMessage.addListener(this.handleMessage.bind(this));
        }
    }
    ChromeInlineWidgetDriver.bootstrap = bootstrap;
    ChromeInlineWidgetDriver.bootstrap.call(ChromeInlineWidgetDriver);
})(ChromeInlineWidgetDriver || (ChromeInlineWidgetDriver = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5saW5lV2lkZ2V0RHJpdmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3VicC9leHRlbnNpb24vY29udGV4dHVhbC9wZWVyLXNjcmlwdHMvZHJpdmVycy9jaHJvbWUvSW5saW5lV2lkZ2V0RHJpdmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVdBLElBQVUsd0JBQXdCLENBeUlqQztBQXpJRCxXQUFVLHdCQUF3QjtJQVFuQiwyQ0FBa0IsR0FBUSxPQUFPLE9BQU8sSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBYTNFLGdDQUFPLEdBQTJDLElBQUksbUJBQW1CLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztJQVczRyxTQUFnQixPQUFPO1FBQ25CLE9BQU8sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUN4RSxDQUFDO0lBRmUsZ0NBQU8sVUFFdEIsQ0FBQTtJQVlELFNBQVMsaUJBQWlCLENBQUMsU0FBZ0I7UUFDdkMsT0FBTztZQUNILEtBQUssRUFBUSxTQUFTO1lBQ3RCLEtBQUssRUFBUSxTQUFTO1lBQ3RCLE9BQU8sRUFBTSxTQUFTO1lBQ3RCLGlCQUFpQixFQUFFO2dCQUNmLFlBQVksRUFBRSxTQUFTO2dCQUN2QixVQUFVLEVBQUksU0FBUzthQUMxQjtTQUNKLENBQUM7SUFDTixDQUFDO0lBZUQsU0FBZ0IsYUFBYSxDQUFDLE9BQThCLEVBQzlCLE1BQW9DLEVBQ3BDLFlBQXVEO1FBQ2pGLElBQUksT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUVqRCxJQUFJLFFBQVEsR0FBMkIsaUJBQWlCLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3hFLElBQUksY0FBYyxHQUFHLFVBQVUsQ0FBQztZQUVoQyxJQUFJO2dCQUNBLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO2dCQUl6RCxRQUFRLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUVyRSxRQUFRLENBQUMsaUJBQWlCLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQzthQUMxRDtZQUNELE9BQU0sQ0FBQyxFQUFFO2dCQUdMLFFBQVEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLENBQUMsUUFBUSxLQUFLLGNBQWMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLGlGQUFpRixDQUFDO2FBQ2xLO29CQUNPO2dCQU1KLElBQUcsUUFBUSxDQUFDLE9BQU8sSUFBSSxPQUFPLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLGNBQWMsRUFBRTtvQkFDcEUsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBUyxNQUFNO3dCQUNqQyxRQUFRLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQzt3QkFDMUIsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUMzQixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBUyxLQUFLO3dCQUNuQixRQUFRLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQzt3QkFDeEIsUUFBUSxDQUFDLEtBQUssR0FBSSxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7d0JBQ25DLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDM0IsQ0FBQyxDQUFDLENBQUM7b0JBS0gsT0FBTyxJQUFJLENBQUM7aUJBQ2Y7cUJBQU07b0JBQ0osWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2lCQUN6QjthQUNKO1NBQ0o7SUFDTCxDQUFDO0lBL0NlLHNDQUFhLGdCQStDNUIsQ0FBQTtJQVFELFNBQWdCLFNBQVM7UUFFckIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDbkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7WUFFeEIseUJBQUEsa0JBQWtCLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztTQUNuRjtJQUNMLENBQUM7SUFQZSxrQ0FBUyxZQU94QixDQUFBO0lBR0Qsd0JBQXdCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0FBQ3RFLENBQUMsRUF6SVMsd0JBQXdCLEtBQXhCLHdCQUF3QixRQXlJakMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRoaXMgYm9vdHN0cmFwcyB7QGxpbmsgSW5saW5lV2lkZ2V0TGlicmFyeX0gdW5kZXIgQ2hyb21lJ3MgY29udGVudCBzY3JpcHRcbiAqIGVudmlyb25tZW50IG9ubHkgT05DRTogVG8gYXZvaWQgZHVwbGljYXRlIGxpc3RlbmVycyBvbiBjaHJvbWUgcnVudGltZVxuICogbWVzc2FnZXMsIHtAbGluayBDaHJvbWVJbmxpbmVXaWRnZXREcml2ZXIjYm9vdHN0cmFwfSB3aWxsIG9ubHkgcmVnaXN0ZXIgdGhlIGxpc3RlbmVyIG9uY2VcbiAqIHdpdGhpbiB0aGUgY29udGVudCBzY3JpcHQgSlJFIGxpZmV0aW1lIGJ5IGlnbm9yaW5nIGFsbCBzdWJzZXF1ZW50IGNhbGxzLlxuICogSG93ZXZlciwge0BsaW5rIElubGluZVdpZGdldExpYnJhcnl9IHdpbGwgYmUgcmVuZXdlZCBpZiBpbmplY3RlZCBhZ2FpblxuICogdG8gZW5zdXJlIHRoZSBsaWJyYXJ5IGlzIHVwIHRvIGRhdGUgaW4gY2FzZSBvZiBleHRlbnNpb24gdXBkYXRlcy9yZXN0YXJ0cy5cbiAqXG4gKiBYWFg6IHBlZXIgc2NyaXB0cyBjYW5ub3QgdXNlIHRoZSBtb2R1bGUgbG9hZGVyIGFzIHRoZXkgYXJlIHRvIGJlIGluamVjdGVkXG4gKiBvbnRvIHRoZSBwYWdlIGRpcmVjdGx5IGFuZCB0aHVzIG5lZWQgdG8gbGlnaHQtd2VpZ2h0LlxuICovXG5uYW1lc3BhY2UgQ2hyb21lSW5saW5lV2lkZ2V0RHJpdmVyIHtcbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHJ1bnRpbWUgZXh0ZW5zaW9uIG5hbWVzcGFjZSwgd2hpY2ggaXMgdGhlIGV4dGVuc2lvbiBBcGkgbmFtZXNwYWNlXG4gICAgICogZm9yIGNocm9tZSwgaXQgaXMgY2hyb21lXG4gICAgICogZm9yIGVkZ2UsIGl0IGlzIGVkZ2VcbiAgICAgKiBJdCB3aWxsIGJlIGlkZWFsIHdlIGNhbiBnZXQgdGhpcyBmcm9tIFJ1bnRpbW1lXG4gICAgICogQHR5cGUge2Jyb3dzZXJ8Y2hyb21lfVxuICAgICAqL1xuICAgIGV4cG9ydCB2YXIgRXh0ZW5zaW9uTmFtZXNwYWNlOiBhbnkgPSB0eXBlb2YgYnJvd3NlciAhPSAndW5kZWZpbmVkJyA/IGJyb3dzZXIgOiBjaHJvbWU7XG4gICAgXG4gICAgLyoqXG4gICAgICogRmxhZyB0byBlbnN1cmUgYm9vdHN0cmFwcGluZyBvbmx5IGhhcHBlbnMgb25jZVxuICAgICAqL1xuICAgIGV4cG9ydCB2YXIgaW5pdGlhbGl6ZWQ6Ym9vbGVhbjtcblxuICAgIC8qKlxuICAgICAqIERlbGVnYXRlIHRvIHRoZSBicm93c2VyLWFnbm9zdGljIGNvbnRleHR1YWwgcGVlciBsaWJyYXJ5IGZvciBzY3JhcGluZy5cbiAgICAgKiBOb3RlOiBDaHJvbWVJbmxpbmVXaWRnZXREcml2ZXIgaXMgYSBnbG9iYWwgbmFtZXNwYWNlIGFuZCB0aGlzIHdpbGwgcmVwbGFjZSBpdHNcbiAgICAgKiByZWZlcmVuY2UgZXZlcnkgdGltZSB0aGUgZHJpdmVyIHNjcmlwdCBpcyBpbmplY3RlZFxuICAgICAqIEB0eXBlIHtJbmxpbmVXaWRnZXRMaWJyYXJ5LklubGluZVdpZGdldEhhbmRsZXJ9XG4gICAgICovXG4gICAgZXhwb3J0IHZhciBsaWJyYXJ5OklubGluZVdpZGdldExpYnJhcnkuSW5saW5lV2lkZ2V0SGFuZGxlciA9IG5ldyBJbmxpbmVXaWRnZXRMaWJyYXJ5LklubGluZVdpZGdldEhhbmRsZXIoKTtcblxuICAgIC8qKlxuICAgICAqIFJldHVybiBjdXJyZW50IHRpbWUgc3RhbXAgZm9yIHByb2ZpbGluZ1xuICAgICAqXG4gICAgICogcGVyZm9ybWFuY2Uubm93KCkgcmV0dXJucyBhIGhpZ2ggcmVzb2x1dGlvbiB0aW1lIHN0YW1wIGluIG1pbGxpb25cbiAgICAgKiBzZWNvbmRzLiBVbmxpa2UgRGF0ZS5ub3coKSwgaXQgcmV0dXJucyBhIGZsb2F0aW5nIHBvaW50IG51bWJlciB3aXRoIHVwXG4gICAgICogdG8gbWljcm9zZWNvbmQgcHJlY2lzaW9uLlxuICAgICAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9QZXJmb3JtYW5jZS5ub3dcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBnZXRUaW1lKCkge1xuICAgICAgICByZXR1cm4gKHdpbmRvdy5wZXJmb3JtYW5jZSkgPyB3aW5kb3cucGVyZm9ybWFuY2Uubm93KCkgOiBEYXRlLm5vdygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ1aWxkIGFuZCByZXR1cm4gYW4gZW1wdHkge0BsaW5rIElDb250ZXh0dWFsUGVlclJlc3BvbnNlfSBvYmplY3RcbiAgICAgKlxuICAgICAqIE5vdGU6IHBlcmZvcm1hbmNlVGltaW5nIGlzIGEgcGxhY2UgaG9sZGVyIGZvciBzdG9yaW5nIHByb2ZpbGluZ1xuICAgICAqIGRhdGEgb2YgdGhlIGV4ZWN1dGlvbiAoZWFjaCBzdGFydC9lbmQgcGFpciByZWNvcmRzIHRoZSB0aW1lIHN0YW1wc1xuICAgICAqIGJlZm9yZS9hZnRlciByZXF1ZXN0IGV4ZWN1dGlvbilcbiAgICAgKlxuICAgICAqIEBwYXJhbSBtZXNzYWdlSWRcbiAgICAgKiBAcmV0dXJucyB7e21zZ0lkOiBzdHJpbmcsIGVycm9yOiB1bmRlZmluZWQsIHBheWxvYWQ6IHVuZGVmaW5lZCwgcGVyZm9ybWFuY2VUaW1pbmc6IHtyZXF1ZXN0U3RhcnQ6IHVuZGVmaW5lZCwgcmVxdWVzdEVuZDogdW5kZWZpbmVkfX19XG4gICAgICovXG4gICAgZnVuY3Rpb24gY3JlYXRlTmV3UmVzcG9uc2UobWVzc2FnZUlkOnN0cmluZyk6SUNvbnRleHR1YWxQZWVyUmVzcG9uc2Uge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbXNnSWQgICAgICA6IG1lc3NhZ2VJZCxcbiAgICAgICAgICAgIGVycm9yICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBwYXlsb2FkICAgIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgcGVyZm9ybWFuY2VUaW1pbmc6IHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0U3RhcnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICByZXF1ZXN0RW5kICA6IHVuZGVmaW5lZFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGxlZCB3aGVuIHJlY2VpdmVkIGEgcnVudGltZSBtZXNzYWdlIGZyb20gdGhlIGV4dGVuc2lvbi5cbiAgICAgKiBGaXJzdCBjaGVjayBpZiB0aGUgbGlicmFyeSBjYW4gaGFuZGxlIHRoZSBtZXNzYWdlL3JlcXVlc3QgYW5kIG9ubHkgZm9yd2FyZFxuICAgICAqIGl0IHRvIHRoZSBsaWJyYXJ5IGlmIHllcy4gSXQgbG9ncyB0aGUgdGltZSB0b29rIGZvciB0aGUgbGlicmFyeSB0b1xuICAgICAqIGV4ZWN1dGUgdGhlIHJlcXVlc3QgYW5kIG9uY2UgaXQgaXMgZG9uZSwgc2VuZCB0aGUgcmVzdWx0IGJhY2tcbiAgICAgKiB0byB0aGUgZXh0ZW5zaW9uIGJ5IGV4ZWN1dGluZyB0aGUgY2FsbGJhY2sgcHJvdmlkZWQgYnkgcnVudGltZVxuICAgICAqXG4gICAgICogTm90ZTogXCJ0aGlzXCIgaXMgc3VwcG9zZSB0byBiaW5kIHRvIHRoZSBtb2R1bGUgbmFtZXNwYWNlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFxuICAgICAqIEBwYXJhbSBzZW5kZXJcbiAgICAgKiBAcGFyYW0gc2VuZFJlc3BvbnNlXG4gICAgICovXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZU1lc3NhZ2UocmVxdWVzdDpJQ29udGV4dHVhbFBlZXJSZXF1ZXN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRlcjogY2hyb21lLnJ1bnRpbWUuTWVzc2FnZVNlbmRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2U6KHJlc3BvbnNlOklDb250ZXh0dWFsUGVlclJlc3BvbnNlKSA9PiB2b2lkKTp2b2lkfGJvb2xlYW4ge1xuICAgICAgICBpZiAocmVxdWVzdCAmJiB0aGlzLmxpYnJhcnkuY2FuSGFuZGxlKHJlcXVlc3QudHlwZSkpIHtcblxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlOklDb250ZXh0dWFsUGVlclJlc3BvbnNlID0gY3JlYXRlTmV3UmVzcG9uc2UocmVxdWVzdC5tc2dJZCk7XG4gICAgICAgICAgICB2YXIgZnVuY3Rpb25TdHJpbmcgPSBcImZ1bmN0aW9uXCI7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UucGVyZm9ybWFuY2VUaW1pbmcucmVxdWVzdFN0YXJ0ID0gdGhpcy5nZXRUaW1lKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBhbGxvdyB0byBhY2NlcHQgYW4gYXJyYXkgb2YgSUNvbnRleHR1YWxQZWVyUmVxdWVzdFxuICAgICAgICAgICAgICAgIC8vIGFuZCByZXR1cm4gYW4gYXJyYXkgb2YgcmVzcG9uc2VzIGZyb20gYWxsIHJlcXVlc3RcbiAgICAgICAgICAgICAgICByZXNwb25zZS5wYXlsb2FkID0gdGhpcy5saWJyYXJ5LmhhbmRsZShyZXF1ZXN0LnR5cGUscmVxdWVzdC5wYXlsb2FkKTtcblxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnBlcmZvcm1hbmNlVGltaW5nLnJlcXVlc3RFbmQgPSB0aGlzLmdldFRpbWUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgICAvLyBQYXNzaW5nIHdob2xlIGVycm9yIG9iamVjdCB0byBleHRlbnNpb24gcmVzdWx0cyBpbiBlbXB0eSBvYmplY3QgaW4gdGhlIGV4dGVuc2lvbi5cbiAgICAgICAgICAgICAgICAvLyBTbyBvbmx5IHBhc3MgdGhlIGVycm9yIG1lc3NhZ2UuXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuZXJyb3IgPSAoZSAmJiB0eXBlb2YgZS50b1N0cmluZyA9PT0gZnVuY3Rpb25TdHJpbmcpPyBlLnRvU3RyaW5nKCkgOiBcIkVycm9yIG9iamVjdCBpbiBDaHJvbWVJbmxpbmVXaWRnZXREcml2ZXIgaXMgdW5kZWZpbmVkIG9yIGhhcyBubyB0b1N0cmluZyBtZXRob2RcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFdoaWxlIHNlbmRpbmcgYXN5bmNocm9ub3VzIHJlc3BvbnNlcywgdGhpcy5saWJyYXJ5LmhhbmRsZSB3aWxsIHJldHVybiBhIHByb21pc2UuIEJlbG93IGNoZWNrXG4gICAgICAgICAgICAgICAgICogbWFrZXMgc3VyZSBpZiB0aGUgcmV0dXJuIHZhbHVlIGlzIGEgcHJvbWlzZSwgaXQgd2FpdHMgdGlsbCBpdCBnZXRzIHJlc29sdmVkIGFuZCBzZW5kcyB0aGVcbiAgICAgICAgICAgICAgICAgKiByZXN1bHQgb2YgcHJvbWlzZSBhcyByZXNwb25zZSdzIHBheWxvYWQuXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgaWYocmVzcG9uc2UucGF5bG9hZCAmJiB0eXBlb2YgcmVzcG9uc2UucGF5bG9hZC50aGVuID09PSBmdW5jdGlvblN0cmluZykge1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5wYXlsb2FkLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnBheWxvYWQgPSByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5wYXlsb2FkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmVycm9yID0gIGVycm9yLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIFJldHVybmluZyAndHJ1ZScgaW5kaWNhdGVzIGl0cyBhbiBhc3luY2hyb25vdXMgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvQWRkLW9ucy9XZWJFeHRlbnNpb25zL0FQSS9ydW50aW1lL29uTWVzc2FnZSNTZW5kaW5nX2FuX2FzeW5jaHJvbm91c19yZXNwb25zZV91c2luZ19zZW5kUmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOyBcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgIHNlbmRSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQm9vdHN0cmFwcyB0aGUgY29udGV4dHVhbCBwZWVyIGxpYnJhcnkgdG8gdGhlIGNvbnRleHQgc2NyaXB0IHJ1bnRpbWVcbiAgICAgKlxuICAgICAqIE5vdGU6IFwidGhpc1wiIGlzIHN1cHBvc2UgdG8gYmluZCB0byB0aGUgbW9kdWxlIG5hbWVzcGFjZVxuICAgICAqXG4gICAgICovXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGJvb3RzdHJhcCgpIHtcbiAgICAgICAgLy8gQWxsb3cgYm9vdHN0cmFwIHRvIGhhcHBlbiBvbmx5IG9uY2UgcGVyIEpSRVxuICAgICAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICBFeHRlbnNpb25OYW1lc3BhY2UucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIodGhpcy5oYW5kbGVNZXNzYWdlLmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gY2FsbCBldmVyeSB0aW1lIHRoZSBkcml2ZXIgaXMgaW5qZWN0ZWQgYnV0IG9ubHkgdGhlIGZpcnN0IHdpbGwgc3VjY2VlZFxuICAgIENocm9tZUlubGluZVdpZGdldERyaXZlci5ib290c3RyYXAuY2FsbChDaHJvbWVJbmxpbmVXaWRnZXREcml2ZXIpO1xufVxuIl19