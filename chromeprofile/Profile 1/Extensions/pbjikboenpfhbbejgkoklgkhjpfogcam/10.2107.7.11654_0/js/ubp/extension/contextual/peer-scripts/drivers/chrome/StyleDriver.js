var ChromeStylePeerDriver;
(function (ChromeStylePeerDriver) {
    ChromeStylePeerDriver.ExtensionNamespace = typeof browser != 'undefined' ? browser : chrome;
    ChromeStylePeerDriver.library = new Style.StyleLibrary(document);
    function getTime() {
        return (window.performance) ? window.performance.now() : Date.now();
    }
    ChromeStylePeerDriver.getTime = getTime;
    function createNewResponse(messageId) {
        return {
            msgId: messageId,
            error: undefined,
            payload: undefined,
            performanceTiming: {
                requestStart: undefined,
                requestEnd: undefined
            }
        };
    }
    function handleMessage(request, sender, sendResponse) {
        if (request && this.library.canHandle(request.type)) {
            var response = createNewResponse(request.msgId);
            try {
                response.performanceTiming.requestStart = this.getTime();
                response.payload = this.library.handle(request.type, request.payload);
                response.performanceTiming.requestEnd = this.getTime();
            }
            catch (e) {
                response.error = (e && typeof e.toString === "function") ? e.toString() : "Error object in ChromeStylePeerDriver is undefined or has no toString method";
            }
            finally {
                sendResponse(response);
            }
        }
    }
    ChromeStylePeerDriver.handleMessage = handleMessage;
    function bootstrap() {
        if (!this.initialized) {
            this.initialized = true;
            ChromeStylePeerDriver.ExtensionNamespace.runtime.onMessage.addListener(this.handleMessage.bind(this));
        }
    }
    ChromeStylePeerDriver.bootstrap = bootstrap;
    ChromeStylePeerDriver.bootstrap.call(ChromeStylePeerDriver);
})(ChromeStylePeerDriver || (ChromeStylePeerDriver = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3R5bGVEcml2ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvdWJwL2V4dGVuc2lvbi9jb250ZXh0dWFsL3BlZXItc2NyaXB0cy9kcml2ZXJzL2Nocm9tZS9TdHlsZURyaXZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFhQSxJQUFVLHFCQUFxQixDQXNIOUI7QUF0SEQsV0FBVSxxQkFBcUI7SUFTaEIsd0NBQWtCLEdBQVEsT0FBTyxPQUFPLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztJQWEzRSw2QkFBTyxHQUFzQixJQUFJLEtBQUssQ0FBQyxZQUFZLENBQzFELFFBQVEsQ0FDWCxDQUFDO0lBV0YsU0FBZ0IsT0FBTztRQUNuQixPQUFPLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDeEUsQ0FBQztJQUZlLDZCQUFPLFVBRXRCLENBQUE7SUFZRCxTQUFTLGlCQUFpQixDQUFDLFNBQWdCO1FBQ3ZDLE9BQU87WUFDSCxLQUFLLEVBQVEsU0FBUztZQUN0QixLQUFLLEVBQVEsU0FBUztZQUN0QixPQUFPLEVBQU0sU0FBUztZQUN0QixpQkFBaUIsRUFBRTtnQkFDZixZQUFZLEVBQUUsU0FBUztnQkFDdkIsVUFBVSxFQUFJLFNBQVM7YUFDMUI7U0FDSixDQUFDO0lBQ04sQ0FBQztJQWVELFNBQWdCLGFBQWEsQ0FBQyxPQUE4QixFQUM5QixNQUFvQyxFQUNwQyxZQUF1RDtRQUNqRixJQUFJLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFFakQsSUFBSSxRQUFRLEdBQTJCLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUV4RSxJQUFJO2dCQUNBLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO2dCQUl6RCxRQUFRLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUV0RSxRQUFRLENBQUMsaUJBQWlCLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQzthQUMxRDtZQUNELE9BQU0sQ0FBQyxFQUFFO2dCQUdMLFFBQVEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLENBQUMsUUFBUSxLQUFLLFVBQVUsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLDhFQUE4RSxDQUFDO2FBQzNKO29CQUNPO2dCQUNKLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUMxQjtTQUNKO0lBQ0wsQ0FBQztJQXpCZSxtQ0FBYSxnQkF5QjVCLENBQUE7SUFRRCxTQUFnQixTQUFTO1FBRXJCLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ25CLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1lBRXhCLHNCQUFBLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDbkY7SUFDTCxDQUFDO0lBUGUsK0JBQVMsWUFPeEIsQ0FBQTtJQUdELHFCQUFxQixDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUNoRSxDQUFDLEVBdEhTLHFCQUFxQixLQUFyQixxQkFBcUIsUUFzSDlCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUaGlzIGJvb3RzdHJhcHMge0BsaW5rIFN0eWxlTGlicmFyeX0gdW5kZXIgQ2hyb21lJ3MgY29udGVudCBzY3JpcHRcbiAqIGVudmlyb25tZW50IG9ubHkgT05DRTogVG8gYXZvaWQgZHVwbGljYXRlIGxpc3RlbmVycyBvbiBjaHJvbWUgcnVudGltZVxuICogbWVzc2FnZXMsIHtAbGluayBDaHJvbWVTdHlsZVBlZXJEcml2ZXIjYm9vdHN0cmFwfSB3aWxsIG9ubHkgcmVnaXN0ZXIgdGhlIGxpc3RlbmVyIG9uY2VcbiAqIHdpdGhpbiB0aGUgY29udGVudCBzY3JpcHQgSlJFIGxpZmV0aW1lIGJ5IGlnbm9yaW5nIGFsbCBzdWJzZXF1ZW50IGNhbGxzLlxuICogSG93ZXZlciwge0BsaW5rIFN0eWxlTGlicmFyeX0gd2lsbCBiZSByZW5ld2VkIGlmIGluamVjdGVkIGFnYWluXG4gKiB0byBlbnN1cmUgdGhlIGxpYnJhcnkgaXMgdXAgdG8gZGF0ZSBpbiBjYXNlIG9mIGV4dGVuc2lvbiB1cGRhdGVzL3Jlc3RhcnRzLlxuICpcbiAqIFhYWDogcGVlciBzY3JpcHRzIGNhbm5vdCB1c2UgdGhlIG1vZHVsZSBsb2FkZXIgYXMgdGhleSBhcmUgdG8gYmUgaW5qZWN0ZWRcbiAqIG9udG8gdGhlIHBhZ2UgZGlyZWN0bHkgYW5kIHRodXMgbmVlZCB0byBsaWdodC13ZWlnaHQuXG4gKlxuICogQGF1dGhvciBqZWV0dWJcbiAqL1xubmFtZXNwYWNlIENocm9tZVN0eWxlUGVlckRyaXZlciB7XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHJ1bnRpbWUgZXh0ZW5zaW9uIG5hbWVzcGFjZSwgd2hpY2ggaXMgdGhlIGV4dGVuc2lvbiBBcGkgbmFtZXNwYWNlXG4gICAgICogZm9yIGNocm9tZSwgaXQgaXMgY2hyb21lXG4gICAgICogZm9yIGVkZ2UsIGl0IGlzIGVkZ2VcbiAgICAgKiBJdCB3aWxsIGJlIGlkZWFsIHdlIGNhbiBnZXQgdGhpcyBmcm9tIFJ1bnRpbW1lXG4gICAgICogQHR5cGUge2Jyb3dzZXJ8Y2hyb21lfVxuICAgICAqL1xuICAgIGV4cG9ydCB2YXIgRXh0ZW5zaW9uTmFtZXNwYWNlOiBhbnkgPSB0eXBlb2YgYnJvd3NlciAhPSAndW5kZWZpbmVkJyA/IGJyb3dzZXIgOiBjaHJvbWU7XG4gICAgXG4gICAgLyoqXG4gICAgICogRmxhZyB0byBlbnN1cmUgYm9vdHN0cmFwcGluZyBvbmx5IGhhcHBlbnMgb25jZS5cbiAgICAgKi9cbiAgICBleHBvcnQgdmFyIGluaXRpYWxpemVkOmJvb2xlYW47XG5cbiAgICAvKipcbiAgICAgKiBEZWxlZ2F0ZSB0byB0aGUgYnJvd3Nlci1hZ25vc3RpYyBjb250ZXh0dWFsIHBlZXIgbGlicmFyeSBmb3Igc2NyYXBpbmcuXG4gICAgICogTm90ZTogQ2hyb21lU3R5bGVQZWVyRHJpdmVyIGlzIGEgZ2xvYmFsIG5hbWVzcGFjZSBhbmQgdGhpcyB3aWxsIHJlcGxhY2UgaXRzXG4gICAgICogcmVmZXJlbmNlIGV2ZXJ5IHRpbWUgdGhlIGRyaXZlciBzY3JpcHQgaXMgaW5qZWN0ZWRcbiAgICAgKiBAdHlwZSB7U3R5bGUuU3R5bGVMaWJyYXJ5fVxuICAgICAqL1xuICAgIGV4cG9ydCB2YXIgbGlicmFyeTpTdHlsZS5TdHlsZUxpYnJhcnkgPSBuZXcgU3R5bGUuU3R5bGVMaWJyYXJ5KFxuICAgICAgICBkb2N1bWVudFxuICAgICk7XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gY3VycmVudCB0aW1lIHN0YW1wIGZvciBwcm9maWxpbmdcbiAgICAgKlxuICAgICAqIHBlcmZvcm1hbmNlLm5vdygpIHJldHVybnMgYSBoaWdoIHJlc29sdXRpb24gdGltZSBzdGFtcCBpbiBtaWxsaW9uXG4gICAgICogc2Vjb25kcy4gVW5saWtlIERhdGUubm93KCksIGl0IHJldHVybnMgYSBmbG9hdGluZyBwb2ludCBudW1iZXIgd2l0aCB1cFxuICAgICAqIHRvIG1pY3Jvc2Vjb25kIHByZWNpc2lvbi5cbiAgICAgKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvUGVyZm9ybWFuY2Uubm93XG4gICAgICogQHJldHVybnMge251bWJlcn1cbiAgICAgKi9cbiAgICBleHBvcnQgZnVuY3Rpb24gZ2V0VGltZSgpIHtcbiAgICAgICAgcmV0dXJuICh3aW5kb3cucGVyZm9ybWFuY2UpID8gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpIDogRGF0ZS5ub3coKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCdWlsZCBhbmQgcmV0dXJuIGFuIGVtcHR5IHtAbGluayBJQ29udGV4dHVhbFBlZXJSZXNwb25zZX0gb2JqZWN0XG4gICAgICpcbiAgICAgKiBOb3RlOiBwZXJmb3JtYW5jZVRpbWluZyBpcyBhIHBsYWNlIGhvbGRlciBmb3Igc3RvcmluZyBwcm9maWxpbmdcbiAgICAgKiBkYXRhIG9mIHRoZSBleGVjdXRpb24gKGVhY2ggc3RhcnQvZW5kIHBhaXIgcmVjb3JkcyB0aGUgdGltZSBzdGFtcHNcbiAgICAgKiBiZWZvcmUvYWZ0ZXIgcmVxdWVzdCBleGVjdXRpb24pXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWVzc2FnZUlkXG4gICAgICogQHJldHVybnMge3ttc2dJZDogc3RyaW5nLCBlcnJvcjogdW5kZWZpbmVkLCBwYXlsb2FkOiB1bmRlZmluZWQsIHBlcmZvcm1hbmNlVGltaW5nOiB7cmVxdWVzdFN0YXJ0OiB1bmRlZmluZWQsIHJlcXVlc3RFbmQ6IHVuZGVmaW5lZH19fVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNyZWF0ZU5ld1Jlc3BvbnNlKG1lc3NhZ2VJZDpzdHJpbmcpOklDb250ZXh0dWFsUGVlclJlc3BvbnNlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1zZ0lkICAgICAgOiBtZXNzYWdlSWQsXG4gICAgICAgICAgICBlcnJvciAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgcGF5bG9hZCAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHBlcmZvcm1hbmNlVGltaW5nOiB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdFN0YXJ0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgcmVxdWVzdEVuZCAgOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiByZWNlaXZlZCBhIHJ1bnRpbWUgbWVzc2FnZSBmcm9tIHRoZSBleHRlbnNpb24uXG4gICAgICogRmlyc3QgY2hlY2sgaWYgdGhlIGxpYnJhcnkgY2FuIGhhbmRsZSB0aGUgbWVzc2FnZS9yZXF1ZXN0IGFuZCBvbmx5IGZvcndhcmRcbiAgICAgKiBpdCB0byB0aGUgbGlicmFyeSBpZiB5ZXMuIEl0IGxvZ3MgdGhlIHRpbWUgdG9vayBmb3IgdGhlIGxpYnJhcnkgdG9cbiAgICAgKiBleGVjdXRlIHRoZSByZXF1ZXN0IGFuZCBvbmNlIGl0IGlzIGRvbmUsIHNlbmQgdGhlIHJlc3VsdCBiYWNrXG4gICAgICogdG8gdGhlIGV4dGVuc2lvbiBieSBleGVjdXRpbmcgdGhlIGNhbGxiYWNrIHByb3ZpZGVkIGJ5IHJ1bnRpbWVcbiAgICAgKlxuICAgICAqIE5vdGU6IFwidGhpc1wiIGlzIHN1cHBvc2UgdG8gYmluZCB0byB0aGUgbW9kdWxlIG5hbWVzcGFjZVxuICAgICAqXG4gICAgICogQHBhcmFtIHJlcXVlc3RcbiAgICAgKiBAcGFyYW0gc2VuZGVyXG4gICAgICogQHBhcmFtIHNlbmRSZXNwb25zZVxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBoYW5kbGVNZXNzYWdlKHJlcXVlc3Q6SUNvbnRleHR1YWxQZWVyUmVxdWVzdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kZXI6IGNocm9tZS5ydW50aW1lLk1lc3NhZ2VTZW5kZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZFJlc3BvbnNlOihyZXNwb25zZTpJQ29udGV4dHVhbFBlZXJSZXNwb25zZSkgPT4gdm9pZCk6dm9pZCB7XG4gICAgICAgIGlmIChyZXF1ZXN0ICYmIHRoaXMubGlicmFyeS5jYW5IYW5kbGUocmVxdWVzdC50eXBlKSkge1xuXG4gICAgICAgICAgICB2YXIgcmVzcG9uc2U6SUNvbnRleHR1YWxQZWVyUmVzcG9uc2UgPSBjcmVhdGVOZXdSZXNwb25zZShyZXF1ZXN0Lm1zZ0lkKTtcblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXNwb25zZS5wZXJmb3JtYW5jZVRpbWluZy5yZXF1ZXN0U3RhcnQgPSB0aGlzLmdldFRpbWUoKTtcblxuICAgICAgICAgICAgICAgIC8vIFRPRE86IGFsbG93IHRvIGFjY2VwdCBhbiBhcnJheSBvZiBJQ29udGV4dHVhbFBlZXJSZXF1ZXN0XG4gICAgICAgICAgICAgICAgLy8gYW5kIHJldHVybiBhbiBhcnJheSBvZiByZXNwb25zZXMgZnJvbSBhbGwgcmVxdWVzdFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnBheWxvYWQgPSB0aGlzLmxpYnJhcnkuaGFuZGxlKHJlcXVlc3QudHlwZSwgcmVxdWVzdC5wYXlsb2FkKTtcblxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnBlcmZvcm1hbmNlVGltaW5nLnJlcXVlc3RFbmQgPSB0aGlzLmdldFRpbWUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgICAvLyBQYXNzaW5nIHdob2xlIGVycm9yIG9iamVjdCB0byBleHRlbnNpb24gcmVzdWx0cyBpbiBlbXB0eSBvYmplY3QgaW4gdGhlIGV4dGVuc2lvbi5cbiAgICAgICAgICAgICAgICAvLyBTbyBvbmx5IHBhc3MgdGhlIGVycm9yIG1lc3NhZ2UuXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuZXJyb3IgPSAoZSAmJiB0eXBlb2YgZS50b1N0cmluZyA9PT0gXCJmdW5jdGlvblwiKT8gZS50b1N0cmluZygpIDogXCJFcnJvciBvYmplY3QgaW4gQ2hyb21lU3R5bGVQZWVyRHJpdmVyIGlzIHVuZGVmaW5lZCBvciBoYXMgbm8gdG9TdHJpbmcgbWV0aG9kXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQm9vdHN0cmFwcyB0aGUgY29udGV4dHVhbCBwZWVyIGxpYnJhcnkgdG8gdGhlIGNvbnRleHQgc2NyaXB0IHJ1bnRpbWVcbiAgICAgKlxuICAgICAqIE5vdGU6IFwidGhpc1wiIGlzIHN1cHBvc2UgdG8gYmluZCB0byB0aGUgbW9kdWxlIG5hbWVzcGFjZVxuICAgICAqXG4gICAgICovXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGJvb3RzdHJhcCgpIHtcbiAgICAgICAgLy8gQWxsb3cgYm9vdHN0cmFwIHRvIGhhcHBlbiBvbmx5IG9uY2UgcGVyIEpSRVxuICAgICAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICBFeHRlbnNpb25OYW1lc3BhY2UucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIodGhpcy5oYW5kbGVNZXNzYWdlLmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gY2FsbCBldmVyeSB0aW1lIHRoZSBkcml2ZXIgaXMgaW5qZWN0ZWQgYnV0IG9ubHkgdGhlIGZpcnN0IHdpbGwgc3VjY2VlZFxuICAgIENocm9tZVN0eWxlUGVlckRyaXZlci5ib290c3RyYXAuY2FsbChDaHJvbWVTdHlsZVBlZXJEcml2ZXIpO1xufVxuIl19