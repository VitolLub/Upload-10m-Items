var ChromeMetaDataDriver;
(function (ChromeMetaDataDriver) {
    ChromeMetaDataDriver.ExtensionNamespace = typeof browser != 'undefined' ? browser : chrome;
    ChromeMetaDataDriver.library = new MetaDataLibrary.MetaData(window);
    function getTime() {
        return (window.performance) ? window.performance.now() : Date.now();
    }
    ChromeMetaDataDriver.getTime = getTime;
    function createNewResponse(messageId) {
        return {
            msgId: messageId,
            error: undefined,
            payload: undefined,
            performanceTiming: {
                requestStart: undefined,
                requestEnd: undefined
            }
        };
    }
    function handleMessage(request, sender, sendResponse) {
        if (request && this.library.canHandle(request.type)) {
            var response = createNewResponse(request.msgId);
            try {
                response.performanceTiming.requestStart = this.getTime();
                response.payload = this.library.handle(request.type, request.payload);
                response.performanceTiming.requestEnd = this.getTime();
            }
            catch (e) {
                response.error = (e && typeof e.toString === "function") ? e.toString() : "Error object in ChromeMetaDataDriver is undefined or has no toString method";
            }
            finally {
                sendResponse(response);
            }
        }
    }
    ChromeMetaDataDriver.handleMessage = handleMessage;
    function bootstrap() {
        if (!this.initialized) {
            this.initialized = true;
            ChromeMetaDataDriver.ExtensionNamespace.runtime.onMessage.addListener(this.handleMessage.bind(this));
        }
    }
    ChromeMetaDataDriver.bootstrap = bootstrap;
    ChromeMetaDataDriver.bootstrap.call(ChromeMetaDataDriver);
})(ChromeMetaDataDriver || (ChromeMetaDataDriver = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWV0YURhdGFEcml2ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvdWJwL2V4dGVuc2lvbi9jb250ZXh0dWFsL3BlZXItc2NyaXB0cy9kcml2ZXJzL2Nocm9tZS9NZXRhRGF0YURyaXZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFXQSxJQUFVLG9CQUFvQixDQWtIN0I7QUFsSEQsV0FBVSxvQkFBb0I7SUFTZix1Q0FBa0IsR0FBUSxPQUFPLE9BQU8sSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBVzNFLDRCQUFPLEdBQTJCLElBQUksZUFBZSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQVdsRixTQUFnQixPQUFPO1FBQ25CLE9BQU8sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUN4RSxDQUFDO0lBRmUsNEJBQU8sVUFFdEIsQ0FBQTtJQVlELFNBQVMsaUJBQWlCLENBQUMsU0FBaUI7UUFDeEMsT0FBTztZQUNILEtBQUssRUFBRSxTQUFTO1lBQ2hCLEtBQUssRUFBRSxTQUFTO1lBQ2hCLE9BQU8sRUFBRSxTQUFTO1lBQ2xCLGlCQUFpQixFQUFFO2dCQUNmLFlBQVksRUFBRSxTQUFTO2dCQUN2QixVQUFVLEVBQUUsU0FBUzthQUN4QjtTQUNKLENBQUM7SUFDTixDQUFDO0lBZUQsU0FBZ0IsYUFBYSxDQUFDLE9BQStCLEVBQy9CLE1BQW9DLEVBQ3BDLFlBQXlEO1FBQ25GLElBQUksT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUVqRCxJQUFJLFFBQVEsR0FBNEIsaUJBQWlCLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRXpFLElBQUk7Z0JBQ0EsUUFBUSxDQUFDLGlCQUFpQixDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBSXpELFFBQVEsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBRXRFLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO2FBQzFEO1lBQ0QsT0FBTyxDQUFDLEVBQUU7Z0JBR04sUUFBUSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsSUFBSSxPQUFPLENBQUMsQ0FBQyxRQUFRLEtBQUssVUFBVSxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsNkVBQTZFLENBQUM7YUFDMUo7b0JBQ087Z0JBQ0osWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQzFCO1NBQ0o7SUFDTCxDQUFDO0lBekJlLGtDQUFhLGdCQXlCNUIsQ0FBQTtJQVFELFNBQWdCLFNBQVM7UUFFckIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDbkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7WUFFeEIscUJBQUEsa0JBQWtCLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztTQUNuRjtJQUNMLENBQUM7SUFQZSw4QkFBUyxZQU94QixDQUFBO0lBR0Qsb0JBQW9CLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBQzlELENBQUMsRUFsSFMsb0JBQW9CLEtBQXBCLG9CQUFvQixRQWtIN0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRoaXMgYm9vdHN0cmFwcyB7QGxpbmsgTWV0YURhdGFEcml2ZXJ9IHVuZGVyIENocm9tZSdzIGNvbnRlbnQgc2NyaXB0XG4gKiBlbnZpcm9ubWVudCBvbmx5IE9OQ0U6IFRvIGF2b2lkIGR1cGxpY2F0ZSBsaXN0ZW5lcnMgb24gY2hyb21lIHJ1bnRpbWVcbiAqIG1lc3NhZ2VzLCB7QGxpbmsgQ2hyb21lTWV0YURhdGFEcml2ZXIjYm9vdHN0cmFwfSB3aWxsIG9ubHkgcmVnaXN0ZXIgdGhlIGxpc3RlbmVyIG9uY2VcbiAqIHdpdGhpbiB0aGUgY29udGVudCBzY3JpcHQgSlJFIGxpZmV0aW1lIGJ5IGlnbm9yaW5nIGFsbCBzdWJzZXF1ZW50IGNhbGxzLlxuICogSG93ZXZlciwge0BsaW5rIE1ldGFEYXRhTGlicmFyeX0gd2lsbCBiZSByZW5ld2VkIGlmIGluamVjdGVkIGFnYWluXG4gKiB0byBlbnN1cmUgdGhlIGxpYnJhcnkgaXMgdXAgdG8gZGF0ZSBpbiBjYXNlIG9mIGV4dGVuc2lvbiB1cGRhdGVzL3Jlc3RhcnRzLlxuICpcbiAqIFhYWDogcGVlciBzY3JpcHRzIGNhbm5vdCB1c2UgdGhlIG1vZHVsZSBsb2FkZXIgYXMgdGhleSBhcmUgdG8gYmUgaW5qZWN0ZWRcbiAqIG9udG8gdGhlIHBhZ2UgZGlyZWN0bHkgYW5kIHRodXMgbmVlZCB0byBsaWdodC13ZWlnaHQuXG4gKi9cbm5hbWVzcGFjZSBDaHJvbWVNZXRhRGF0YURyaXZlciB7XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHJ1bnRpbWUgZXh0ZW5zaW9uIG5hbWVzcGFjZSwgd2hpY2ggaXMgdGhlIGV4dGVuc2lvbiBBcGkgbmFtZXNwYWNlXG4gICAgICogZm9yIGNocm9tZSwgaXQgaXMgY2hyb21lXG4gICAgICogZm9yIGVkZ2UsIGl0IGlzIGVkZ2VcbiAgICAgKiBJdCB3aWxsIGJlIGlkZWFsIHdlIGNhbiBnZXQgdGhpcyBmcm9tIFJ1bnRpbW1lXG4gICAgICogQHR5cGUge2Jyb3dzZXJ8Y2hyb21lfVxuICAgICAqL1xuICAgIGV4cG9ydCB2YXIgRXh0ZW5zaW9uTmFtZXNwYWNlOiBhbnkgPSB0eXBlb2YgYnJvd3NlciAhPSAndW5kZWZpbmVkJyA/IGJyb3dzZXIgOiBjaHJvbWU7XG5cbiAgICAvKipcbiAgICAgKiBHbG9iYWwgRmxhZyB0byBlbnN1cmUgYm9vdHN0cmFwcGluZyBvbmx5IGhhcHBlbnMgb25jZS5cbiAgICAgKi9cbiAgICBleHBvcnQgdmFyIGluaXRpYWxpemVkOiBib29sZWFuO1xuXG4gICAgLyoqXG4gICAgICogRGVsZWdhdGUgdG8gdGhlIGJyb3dzZXItYWdub3N0aWMgY29udGV4dHVhbCBwZWVyIGxpYnJhcnkgZm9yIGdhdGhlcmluZyBNZXRhRGF0YS5cbiAgICAgKiBAdHlwZSB7TWV0YURhdGFMaWJyYXJ5Lk1ldGFEYXRhfVxuICAgICAqL1xuICAgIGV4cG9ydCB2YXIgbGlicmFyeTogSUNvbnRleHR1YWxQZWVyTGlicmFyeSA9IG5ldyBNZXRhRGF0YUxpYnJhcnkuTWV0YURhdGEod2luZG93KTtcblxuICAgIC8qKlxuICAgICAqIFJldHVybiBjdXJyZW50IHRpbWUgc3RhbXAgZm9yIHByb2ZpbGluZ1xuICAgICAqXG4gICAgICogcGVyZm9ybWFuY2Uubm93KCkgcmV0dXJucyBhIGhpZ2ggcmVzb2x1dGlvbiB0aW1lIHN0YW1wIGluIG1pbGxpb25cbiAgICAgKiBzZWNvbmRzLiBVbmxpa2UgRGF0ZS5ub3coKSwgaXQgcmV0dXJucyBhIGZsb2F0aW5nIHBvaW50IG51bWJlciB3aXRoIHVwXG4gICAgICogdG8gbWljcm9zZWNvbmQgcHJlY2lzaW9uLlxuICAgICAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9QZXJmb3JtYW5jZS5ub3dcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAqL1xuICAgIGV4cG9ydCBmdW5jdGlvbiBnZXRUaW1lKCkge1xuICAgICAgICByZXR1cm4gKHdpbmRvdy5wZXJmb3JtYW5jZSkgPyB3aW5kb3cucGVyZm9ybWFuY2Uubm93KCkgOiBEYXRlLm5vdygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ1aWxkIGFuZCByZXR1cm4gYW4gZW1wdHkge0BsaW5rIElDb250ZXh0dWFsUGVlclJlc3BvbnNlfSBvYmplY3RcbiAgICAgKlxuICAgICAqIE5vdGU6IHBlcmZvcm1hbmNlVGltaW5nIGlzIGEgcGxhY2UgaG9sZGVyIGZvciBzdG9yaW5nIHByb2ZpbGluZ1xuICAgICAqIGRhdGEgb2YgdGhlIGV4ZWN1dGlvbiAoZWFjaCBzdGFydC9lbmQgcGFpciByZWNvcmRzIHRoZSB0aW1lIHN0YW1wc1xuICAgICAqIGJlZm9yZS9hZnRlciByZXF1ZXN0IGV4ZWN1dGlvbilcbiAgICAgKlxuICAgICAqIEBwYXJhbSBtZXNzYWdlSWRcbiAgICAgKiBAcmV0dXJucyB7e21zZ0lkOiBzdHJpbmcsIGVycm9yOiB1bmRlZmluZWQsIHBheWxvYWQ6IHVuZGVmaW5lZCwgcGVyZm9ybWFuY2VUaW1pbmc6IHtyZXF1ZXN0U3RhcnQ6IHVuZGVmaW5lZCwgcmVxdWVzdEVuZDogdW5kZWZpbmVkfX19XG4gICAgICovXG4gICAgZnVuY3Rpb24gY3JlYXRlTmV3UmVzcG9uc2UobWVzc2FnZUlkOiBzdHJpbmcpOiBJQ29udGV4dHVhbFBlZXJSZXNwb25zZSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtc2dJZDogbWVzc2FnZUlkLFxuICAgICAgICAgICAgZXJyb3I6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHBheWxvYWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHBlcmZvcm1hbmNlVGltaW5nOiB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdFN0YXJ0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgcmVxdWVzdEVuZDogdW5kZWZpbmVkXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIHdoZW4gcmVjZWl2ZWQgYSBydW50aW1lIG1lc3NhZ2UgZnJvbSB0aGUgZXh0ZW5zaW9uLlxuICAgICAqIEZpcnN0IGNoZWNrIGlmIHRoZSBsaWJyYXJ5IGNhbiBoYW5kbGUgdGhlIG1lc3NhZ2UvcmVxdWVzdCBhbmQgb25seSBmb3J3YXJkXG4gICAgICogaXQgdG8gdGhlIGxpYnJhcnkgaWYgeWVzLiBJdCBsb2dzIHRoZSB0aW1lIHRvb2sgZm9yIHRoZSBsaWJyYXJ5IHRvXG4gICAgICogZXhlY3V0ZSB0aGUgcmVxdWVzdCBhbmQgb25jZSBpdCBpcyBkb25lLCBzZW5kIHRoZSByZXN1bHQgYmFja1xuICAgICAqIHRvIHRoZSBleHRlbnNpb24gYnkgZXhlY3V0aW5nIHRoZSBjYWxsYmFjayBwcm92aWRlZCBieSBydW50aW1lXG4gICAgICpcbiAgICAgKiBOb3RlOiBcInRoaXNcIiBpcyBzdXBwb3NlIHRvIGJpbmQgdG8gdGhlIG1vZHVsZSBuYW1lc3BhY2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSByZXF1ZXN0XG4gICAgICogQHBhcmFtIHNlbmRlclxuICAgICAqIEBwYXJhbSBzZW5kUmVzcG9uc2VcbiAgICAgKi9cbiAgICBleHBvcnQgZnVuY3Rpb24gaGFuZGxlTWVzc2FnZShyZXF1ZXN0OiBJQ29udGV4dHVhbFBlZXJSZXF1ZXN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRlcjogY2hyb21lLnJ1bnRpbWUuTWVzc2FnZVNlbmRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2U6IChyZXNwb25zZTogSUNvbnRleHR1YWxQZWVyUmVzcG9uc2UpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgaWYgKHJlcXVlc3QgJiYgdGhpcy5saWJyYXJ5LmNhbkhhbmRsZShyZXF1ZXN0LnR5cGUpKSB7XG5cbiAgICAgICAgICAgIHZhciByZXNwb25zZTogSUNvbnRleHR1YWxQZWVyUmVzcG9uc2UgPSBjcmVhdGVOZXdSZXNwb25zZShyZXF1ZXN0Lm1zZ0lkKTtcblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXNwb25zZS5wZXJmb3JtYW5jZVRpbWluZy5yZXF1ZXN0U3RhcnQgPSB0aGlzLmdldFRpbWUoKTtcblxuICAgICAgICAgICAgICAgIC8vIFRPRE86IGFsbG93IHRvIGFjY2VwdCBhbiBhcnJheSBvZiBJQ29udGV4dHVhbFBlZXJSZXF1ZXN0XG4gICAgICAgICAgICAgICAgLy8gYW5kIHJldHVybiBhbiBhcnJheSBvZiByZXNwb25zZXMgZnJvbSBhbGwgcmVxdWVzdFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnBheWxvYWQgPSB0aGlzLmxpYnJhcnkuaGFuZGxlKHJlcXVlc3QudHlwZSwgcmVxdWVzdC5wYXlsb2FkKTtcblxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnBlcmZvcm1hbmNlVGltaW5nLnJlcXVlc3RFbmQgPSB0aGlzLmdldFRpbWUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgLy8gUGFzc2luZyB3aG9sZSBlcnJvciBvYmplY3QgdG8gZXh0ZW5zaW9uIHJlc3VsdHMgaW4gZW1wdHkgb2JqZWN0IGluIHRoZSBleHRlbnNpb24uXG4gICAgICAgICAgICAgICAgLy8gU28gb25seSBwYXNzIHRoZSBlcnJvciBtZXNzYWdlLlxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmVycm9yID0gKGUgJiYgdHlwZW9mIGUudG9TdHJpbmcgPT09IFwiZnVuY3Rpb25cIik/IGUudG9TdHJpbmcoKSA6IFwiRXJyb3Igb2JqZWN0IGluIENocm9tZU1ldGFEYXRhRHJpdmVyIGlzIHVuZGVmaW5lZCBvciBoYXMgbm8gdG9TdHJpbmcgbWV0aG9kXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQm9vdHN0cmFwcyB0aGUgY29udGV4dHVhbCBwZWVyIGxpYnJhcnkgdG8gdGhlIGNvbnRleHQgc2NyaXB0IHJ1bnRpbWVcbiAgICAgKlxuICAgICAqIE5vdGU6IFwidGhpc1wiIGlzIHN1cHBvc2UgdG8gYmluZCB0byB0aGUgbW9kdWxlIG5hbWVzcGFjZVxuICAgICAqXG4gICAgICovXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGJvb3RzdHJhcCgpIHtcbiAgICAgICAgLy8gQWxsb3cgYm9vdHN0cmFwIHRvIGhhcHBlbiBvbmx5IG9uY2UgcGVyIEpSRVxuICAgICAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICBFeHRlbnNpb25OYW1lc3BhY2UucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIodGhpcy5oYW5kbGVNZXNzYWdlLmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gY2FsbCBldmVyeSB0aW1lIHRoZSBkcml2ZXIgaXMgaW5qZWN0ZWQgYnV0IG9ubHkgdGhlIGZpcnN0IHdpbGwgc3VjY2VlZFxuICAgIENocm9tZU1ldGFEYXRhRHJpdmVyLmJvb3RzdHJhcC5jYWxsKENocm9tZU1ldGFEYXRhRHJpdmVyKTtcbn1cbiJdfQ==