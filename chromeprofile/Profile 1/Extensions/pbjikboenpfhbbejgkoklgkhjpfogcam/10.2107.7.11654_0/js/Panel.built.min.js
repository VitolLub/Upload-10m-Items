/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.3.6 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, https://github.com/requirejs/requirejs/blob/master/LICENSE
 */

/**
 * @preserve Copyright (c) 2014 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:</p>
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */

/**
 * Copyright (c) 2014 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:</p>
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */

/**
 * @license
 * lodash 3.10.1 (Custom Build) <https://lodash.com/>
 * Build: `lodash modern -o ./lodash.js`
 * Copyright 2012-2015 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <https://lodash.com/license>
 */

/*
 * @license Underscore.js 1.6.0
 * http://underscorejs.org
 * (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Underscore may be freely distributed under the MIT license.
 */

/*
 * @license parseUri 1.2.2
 * (c) Steven Levithan <stevenlevithan.com>
 * MIT License
 */

function parseUri(e){for(var t=parseUri.options,n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},o=14;o--;)r[t.key[o]]=n[o]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,o){n&&(r[t.q.name][n]=o)}),r}var requirejs,require,define;!function(global,setTimeout){function commentReplace(e,t){return t||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1&&(!e[n]||!t(e[n],n,e));n-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,r){return t&&eachProp(t,function(t,o){!n&&hasProp(e,o)||(!r||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[o]=t:(e[o]||(e[o]={}),mixin(e[o],t,n,r)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,r){var o=new Error(t+"\nhttps://requirejs.org/docs/errors.html#"+e);return o.requireType=e,o.requireModules=r,n&&(o.originalError=n),o}function newContext(e){function t(e){var t,n;for(t=0;t<e.length;t++)if("."===(n=e[t]))e.splice(t,1),t-=1;else if(".."===n){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function n(e,n,r){var o,i,s,a,u,c,l,p,f,d,h,_=n&&n.split("/"),m=w.map,g=m&&m["*"];if(e&&(e=e.split("/"),c=e.length-1,w.nodeIdCompat&&jsSuffixRegExp.test(e[c])&&(e[c]=e[c].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&_&&(h=_.slice(0,_.length-1),e=h.concat(e)),t(e),e=e.join("/")),r&&m&&(_||g)){i=e.split("/");e:for(s=i.length;s>0;s-=1){if(u=i.slice(0,s).join("/"),_)for(a=_.length;a>0;a-=1)if((o=getOwn(m,_.slice(0,a).join("/")))&&(o=getOwn(o,u))){l=o,p=s;break e}!f&&g&&getOwn(g,u)&&(f=getOwn(g,u),d=s)}!l&&f&&(l=f,p=d),l&&(i.splice(0,p,l),e=i.join("/"))}return getOwn(w.pkgs,e)||e}function r(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===v.contextName)return t.parentNode.removeChild(t),!0})}function o(e){var t=getOwn(w.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),v.require.undef(e),v.makeRequire(null,{skipMap:!0})([e]),!0}function i(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function s(e,t,r,o){var s,a,u,c,l=null,p=t?t.name:null,f=e,d=!0,h="";return e||(d=!1,e="_@r"+(C+=1)),c=i(e),l=c[0],e=c[1],l&&(l=n(l,p,o),a=getOwn(P,l)),e&&(l?h=r?e:a&&a.normalize?a.normalize(e,function(e){return n(e,p,o)}):-1===e.indexOf("!")?n(e,p,o):e:(h=n(e,p,o),c=i(h),l=c[0],h=c[1],r=!0,s=v.nameToUrl(h))),u=!l||a||r?"":"_unnormalized"+(L+=1),{prefix:l,name:h,parentMap:t,unnormalized:!!u,url:s,originalName:f,isDefine:d,id:(l?l+"!"+h:h)+u}}function a(e){var t=e.id,n=getOwn(T,t);return n||(n=T[t]=new v.Module(e)),n}function u(e,t,n){var r=e.id,o=getOwn(T,r);!hasProp(P,r)||o&&!o.defineEmitComplete?(o=a(e),o.error&&"error"===t?n(o.error):o.on(t,n)):"defined"===t&&n(P[r])}function c(e,t){var n=e.requireModules,r=!1;t?t(e):(each(n,function(t){var n=getOwn(T,t);n&&(n.error=e,n.events.error&&(r=!0,n.emit("error",e)))}),r||req.onError(e))}function l(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(v.defQueueMap[t]=!0),S.push(e)}),globalDefQueue=[])}function p(e){delete T[e],delete x[e]}function f(e,t,n){var r=e.map.id;e.error?e.emit("error",e.error):(t[r]=!0,each(e.depMaps,function(r,o){var i=r.id,s=getOwn(T,i);!s||e.depMatched[o]||n[i]||(getOwn(t,i)?(e.defineDep(o,P[i]),e.check()):f(s,t,n))}),n[r]=!0)}function d(){var e,t,n=1e3*w.waitSeconds,i=n&&v.startTime+n<(new Date).getTime(),s=[],a=[],u=!1,l=!0;if(!y){if(y=!0,eachProp(x,function(e){var n=e.map,c=n.id;if(e.enabled&&(n.isDefine||a.push(e),!e.error))if(!e.inited&&i)o(c)?(t=!0,u=!0):(s.push(c),r(c));else if(!e.inited&&e.fetched&&n.isDefine&&(u=!0,!n.prefix))return l=!1}),i&&s.length)return e=makeError("timeout","Load timeout for modules: "+s,null,s),e.contextName=v.contextName,c(e);l&&each(a,function(e){f(e,{},{})}),i&&!t||!u||!isBrowser&&!isWebWorker||R||(R=setTimeout(function(){R=0,d()},50)),y=!1}}function h(e){hasProp(P,e[0])||a(s(e[0],null,!0)).init(e[1],e[2])}function _(e,t,n,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(n,t,!1)}function m(e){var t=e.currentTarget||e.srcElement;return _(t,v.onScriptLoad,"load","onreadystatechange"),_(t,v.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function g(){var e;for(l();S.length;){if(e=S.shift(),null===e[0])return c(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));h(e)}v.defQueueMap={}}var y,b,v,E,R,w={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},T={},x={},A={},S=[],P={},I={},O={},C=1,L=1;return E={require:function(e){return e.require?e.require:e.require=v.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?P[e.map.id]=e.exports:e.exports=P[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(w.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},b=function(e){this.events=getOwn(A,e.id)||{},this.map=e,this.shim=getOwn(w.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},b.prototype={init:function(e,t,n,r){r=r||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,v.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();v.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;I[e]||(I[e]=!0,v.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id,r=this.depExports,o=this.exports,i=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(i)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{o=v.execCb(n,i,r,o)}catch(t){e=t}else o=v.execCb(n,i,r,o);if(this.map.isDefine&&void 0===o&&(t=this.module,t?o=t.exports:this.usingExports&&(o=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",c(this.error=e)}else o=i;if(this.exports=o,this.map.isDefine&&!this.ignore&&(P[n]=o,req.onResourceLoad)){var s=[];each(this.depMaps,function(e){s.push(e.normalizedMap||e)}),req.onResourceLoad(v,this.map,s)}p(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(v.defQueueMap,n)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,r=s(e.prefix);this.depMaps.push(r),u(r,"defined",bind(this,function(r){var o,i,l,f=getOwn(O,this.map.id),d=this.map.name,h=this.map.parentMap?this.map.parentMap.name:null,_=v.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(r.normalize&&(d=r.normalize(d,function(e){return n(e,h,!0)})||""),i=s(e.prefix+"!"+d,this.map.parentMap,!0),u(i,"defined",bind(this,function(e){this.map.normalizedMap=i,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),void((l=getOwn(T,i.id))&&(this.depMaps.push(i),this.events.error&&l.on("error",bind(this,function(e){this.emit("error",e)})),l.enable()))):f?(this.map.url=v.nameToUrl(f),void this.load()):(o=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),o.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(T,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&p(e.map.id)}),c(e)}),o.fromText=bind(this,function(n,r){var i=e.name,u=s(i),l=useInteractive;r&&(n=r),l&&(useInteractive=!1),a(u),hasProp(w.config,t)&&(w.config[i]=w.config[t]);try{req.exec(n)}catch(e){return c(makeError("fromtexteval","fromText eval for "+t+" failed: "+e,e,[t]))}l&&(useInteractive=!0),this.depMaps.push(u),v.completeLoad(i),_([i],o)}),void r.load(e.name,_,o,w))})),v.enable(r,this),this.pluginMaps[r.id]=r},enable:function(){x[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,r,o;if("string"==typeof e){if(e=s(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,o=getOwn(E,e.id))return void(this.depExports[t]=o(this));this.depCount+=1,u(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?u(e,"error",bind(this,this.errback)):this.events.error&&u(e,"error",bind(this,function(e){this.emit("error",e)}))}n=e.id,r=T[n],hasProp(E,n)||!r||r.enabled||v.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(T,e.id);t&&!t.enabled&&v.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},v={config:w,contextName:e,registry:T,defined:P,urlFetched:I,defQueue:S,defQueueMap:{},Module:b,makeModuleMap:s,nextTick:req.nextTick,onError:c,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,n){return(-1===n.indexOf("?")?"?":"&")+t}}var n=w.shim,r={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){r[t]?(w[t]||(w[t]={}),mixin(w[t],e,!0,!0)):w[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(O[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=v.makeShimExports(e)),n[t]=e}),w.shim=n),e.packages&&each(e.packages,function(e){var t,n;e="string"==typeof e?{name:e}:e,n=e.name,t=e.location,t&&(w.paths[n]=e.location),w.pkgs[n]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(T,function(e,t){e.inited||e.map.unnormalized||(e.map=s(t,null,!0))}),(e.deps||e.callback)&&v.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,o){function i(n,r,u){var l,p,f;return o.enableBuildCallback&&r&&isFunction(r)&&(r.__requireJsBuild=!0),"string"==typeof n?isFunction(r)?c(makeError("requireargs","Invalid require call"),u):t&&hasProp(E,n)?E[n](T[t.id]):req.get?req.get(v,n,t,i):(p=s(n,t,!1,!0),l=p.id,hasProp(P,l)?P[l]:c(makeError("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(g(),v.nextTick(function(){g(),f=a(s(null,t)),f.skipMap=o.skipMap,f.init(n,r,u,{enabled:!0}),d()}),i)}return o=o||{},mixin(i,{isBrowser:isBrowser,toUrl:function(e){var r,o=e.lastIndexOf("."),i=e.split("/")[0],s="."===i||".."===i;return-1!==o&&(!s||o>1)&&(r=e.substring(o,e.length),e=e.substring(0,o)),v.nameToUrl(n(e,t&&t.id,!0),r,!0)},defined:function(e){return hasProp(P,s(e,t,!1,!0).id)},specified:function(e){return e=s(e,t,!1,!0).id,hasProp(P,e)||hasProp(T,e)}}),t||(i.undef=function(e){l();var n=s(e,t,!0),o=getOwn(T,e);o.undefed=!0,r(e),delete P[e],delete I[n.url],delete A[e],eachReverse(S,function(t,n){t[0]===e&&S.splice(n,1)}),delete v.defQueueMap[e],o&&(o.events.defined&&(A[e]=o.events),p(e))}),i},enable:function(e){getOwn(T,e.id)&&a(e).enable()},completeLoad:function(e){var t,n,r,i=getOwn(w.shim,e)||{},s=i.exports;for(l();S.length;){if(n=S.shift(),null===n[0]){if(n[0]=e,t)break;t=!0}else n[0]===e&&(t=!0);h(n)}if(v.defQueueMap={},r=getOwn(T,e),!t&&!hasProp(P,e)&&r&&!r.inited){if(!(!w.enforceDefine||s&&getGlobal(s)))return o(e)?void 0:c(makeError("nodefine","No define call for "+e,null,[e]));h([e,i.deps||[],i.exportsFn])}d()},nameToUrl:function(e,t,n){var r,o,i,s,a,u,c,l=getOwn(w.pkgs,e);if(l&&(e=l),c=getOwn(O,e))return v.nameToUrl(c,t,n);if(req.jsExtRegExp.test(e))a=e+(t||"");else{for(r=w.paths,o=e.split("/"),i=o.length;i>0;i-=1)if(s=o.slice(0,i).join("/"),u=getOwn(r,s)){isArray(u)&&(u=u[0]),o.splice(0,i,u);break}a=o.join("/"),a+=t||(/^data\:|^blob\:|\?/.test(a)||n?"":".js"),a=("/"===a.charAt(0)||a.match(/^[\w\+\.\-]+:/)?"":w.baseUrl)+a}return w.urlArgs&&!/^blob\:/.test(a)?a+w.urlArgs(e,a):a},load:function(e,t){req.load(v,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=m(e);v.completeLoad(t.id)}},onScriptError:function(e){var t=m(e);if(!o(t.id)){var n=[];return eachProp(T,function(e,r){0!==r.indexOf("_@r")&&each(e.depMaps,function(e){if(e.id===t.id)return n.push(r),!0})}),c(makeError("scripterror",'Script error for "'+t.id+(n.length?'", needed by: '+n.join(", "):'"'),e,[t.id]))}}},v.require=v.makeRequire(),v}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.6",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,n,r){var o,i,s=defContextName;return isArray(e)||"string"==typeof e||(i=e,isArray(t)?(e=t,t=n,n=r):e=[]),i&&i.context&&(s=i.context),o=getOwn(contexts,s),o||(o=contexts[s]=req.s.newContext(s)),i&&o.configure(i),o.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick=void 0!==setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],(baseElement=document.getElementsByTagName("base")[0])&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,n){var r=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return r.type=e.scriptType||"text/javascript",r.charset="utf-8",r.async=!0,r},req.load=function(e,t,n){var r,o=e&&e.config||{};if(isBrowser)return r=req.createNode(o,t,n),r.setAttribute("data-requirecontext",e.contextName),r.setAttribute("data-requiremodule",t),!r.attachEvent||r.attachEvent.toString&&r.attachEvent.toString().indexOf("[native code")<0||isOpera?(r.addEventListener("load",e.onScriptLoad,!1),r.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,r.attachEvent("onreadystatechange",e.onScriptLoad)),r.src=n,o.onNodeCreated&&o.onNodeCreated(r,o,t,n),currentlyAddingScript=r,baseElement?head.insertBefore(r,baseElement):head.appendChild(r),currentlyAddingScript=null,r;if(isWebWorker)try{setTimeout(function(){},0),importScripts(n),e.completeLoad(t)}catch(r){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,r,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,n){var r,o;"string"!=typeof e&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(r=currentlyAddingScript||getInteractiveScript())&&(e||(e=r.getAttribute("data-requiremodule")),o=contexts[r.getAttribute("data-requirecontext")]),o?(o.defQueue.push([e,t,n]),o.defQueueMap[e]=!0):globalDefQueue.push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this,"undefined"==typeof setTimeout?void 0:setTimeout),define("requirejs",function(){}),function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("lib/bluebird",e):"undefined"!=typeof window?window.Promise=e():"undefined"!=typeof global?global.Promise=e():"undefined"!=typeof self&&(self.Promise=e())}(function(){var e,t,n;return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n||e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){t.exports=function(t,n,r){function o(e,t){var r=n(e,i,!0===t&&e._isBound()?e._boundTo:void 0),o=r.promise();return o.isRejected()?o:(r.setHowMany(1),r.setUnwrap(),r.init(),o)}var i=e("./some_promise_array.js")(r);t.any=function(e){return o(e,!1)},t.prototype.any=function(){return o(this,!0)}}},{"./some_promise_array.js":33}],2:[function(e,t,n){function r(){this._isTickUsed=!1,this._length=0,this._lateBuffer=new i,this._functionBuffer=new i(75e3);var e=this;this.consumeFunctionBuffer=function(){e._consumeFunctionBuffer()}}var o=e("./schedule.js"),i=e("./queue.js"),s=e("./util.js").errorObj,a=e("./util.js").tryCatch1,u=e("./global.js").process;r.prototype.haveItemsQueued=function(){return this._length>0},r.prototype.invokeLater=function(e,t,n){void 0===u||null==u.domain||e.domain||(e=u.domain.bind(e)),this._lateBuffer.push(e,t,n),this._queueTick()},r.prototype.invoke=function(e,t,n){void 0===u||null==u.domain||e.domain||(e=u.domain.bind(e));var r=this._functionBuffer;r.push(e,t,n),this._length=r.length(),this._queueTick()},r.prototype._consumeFunctionBuffer=function(){for(var e=this._functionBuffer;e.length()>0;){var t=e.shift(),n=e.shift(),r=e.shift();t.call(n,r)}this._reset(),this._consumeLateBuffer()},r.prototype._consumeLateBuffer=function(){for(var e=this._lateBuffer;e.length()>0;){var t=e.shift(),n=e.shift(),r=e.shift(),o=a(t,n,r);if(o===s){if(this._queueTick(),null==t.domain)throw o.e;t.domain.emit("error",o.e)}}},r.prototype._queueTick=function(){this._isTickUsed||(o(this.consumeFunctionBuffer),this._isTickUsed=!0)},r.prototype._reset=function(){this._isTickUsed=!1,this._length=0},t.exports=new r},{"./global.js":15,"./queue.js":26,"./schedule.js":29,"./util.js":37}],3:[function(e,t,n){var r=e("./promise.js")();t.exports=r},{"./promise.js":19}],4:[function(e,t,n){t.exports=function(e){function t(e){return e["string"==typeof this?this:""+this]}e.prototype.call=function(e){for(var t=arguments.length,n=new Array(t-1),r=1;r<t;++r)n[r-1]=arguments[r];return this._then(function(t){return t[e].apply(t,n)},void 0,void 0,void 0,void 0)},e.prototype.get=function(e){return this._then(t,void 0,void 0,e,void 0)}}},{}],5:[function(e,t,n){t.exports=function(t,n){var r=e("./errors.js"),o=e("./async.js"),i=r.CancellationError;t.prototype._cancel=function(){if(!this.isCancellable())return this;for(var e,t=this;void 0!==(e=t._cancellationParent)&&e.isCancellable();)t=e;var n=new i;t._attachExtraTrace(n),t._rejectUnchecked(n)},t.prototype.cancel=function(){return this.isCancellable()?(o.invokeLater(this._cancel,this,void 0),this):this},t.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},t.prototype.uncancellable=function(){var e=new t(n);return e._setTrace(this),e._follow(this),e._unsetCancellable(),this._isBound()&&e._setBoundTo(this._boundTo),e},t.prototype.fork=function(e,t,n){var r=this._then(e,t,n,void 0,void 0);return r._setCancellable(),r._cancellationParent=void 0,r}}},{"./async.js":2,"./errors.js":9}],6:[function(e,t,n){t.exports=function(){function t(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e.toString();if(/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+n(t)+">, no stack trace)"}function n(e){return e.length<41?e:e.substr(0,38)+"..."}function r(e,t){this.captureStackTrace(r,t)}var o=e("./util.js").inherits,i=e("./es5.js").defineProperty,s=new RegExp("\\b(?:[a-zA-Z0-9.]+\\$_\\w+|tryCatch(?:1|2|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),a=null,u=null;o(r,Error),r.prototype.captureStackTrace=function(e,t){c(this,e,t)},r.possiblyUnhandledRejection=function(e){if("object"==typeof console){var t;if("object"==typeof e||"function"==typeof e){var n=e.stack;t="Possibly unhandled "+u(n,e)}else t="Possibly unhandled "+String(e);"function"==typeof console.error||"object"==typeof console.error?console.error(t):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(t)}},r.combine=function(e,t){for(var n=e.length-1,r=t.length-1;r>=0;--r){var o=t[r];if(e[n]!==o)break;e.pop(),n--}e.push("From previous event:");for(var i=e.concat(t),u=[],r=0,c=i.length;r<c;++r)s.test(i[r])||r>0&&!a.test(i[r])&&"From previous event:"!==i[r]||u.push(i[r]);return u},r.isSupported=function(){return"function"==typeof c};var c=function e(){if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){a=/^\s*at\s*/,u=function(e,n){return"string"==typeof e?e:void 0!==n.name&&void 0!==n.message?n.name+". "+n.message:t(n)};var n=Error.captureStackTrace;return function(e,t){n(e,t)}}var r=new Error;if("string"==typeof r.stack&&"function"==typeof"".startsWith&&r.stack.startsWith("stackDetection@")&&"stackDetection"===e.name){i(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),a=/@/;var o=/[@\n]/;return u=function(e,n){return"string"==typeof e?n.name+". "+n.message+"\n"+e:void 0!==n.name&&void 0!==n.message?n.name+". "+n.message:t(n)},function(e){for(var t=(new Error).stack,n=t.split(o),r=n.length,i="",s=0;s<r;s+=2)i+=n[s],i+="@",i+=n[s+1],i+="\n";e.stack=i}}return u=function(e,n){return"string"==typeof e?e:"object"!=typeof n&&"function"!=typeof n||void 0===n.name||void 0===n.message?t(n):n.name+". "+n.message},null}();return r}},{"./es5.js":11,"./util.js":37}],7:[function(e,t,n){t.exports=function(t){function n(e,t,n){this._instances=e,this._callback=t,this._promise=n}function r(e,t){var n={},r=s(e,n,t);return r===a?r:u(n).length?(a.e=new c("Catch filter must inherit from Error or be a simple predicate function"),a):r}var o=e("./util.js"),i=e("./errors.js"),s=o.tryCatch1,a=o.errorObj,u=e("./es5.js").keys,c=i.TypeError;return n.prototype.doFilter=function(e){for(var n=this._callback,o=this._promise,u=o._isBound()?o._boundTo:void 0,c=0,l=this._instances.length;c<l;++c){var p=this._instances[c],f=p===Error||null!=p&&p.prototype instanceof Error;if(f&&e instanceof p){var d=s(n,u,e);return d===a?(t.e=d.e,t):d}if("function"==typeof p&&!f){var h=r(p,e);if(h===a){var _=i.canAttach(a.e)?a.e:new Error(a.e+"");this._promise._attachExtraTrace(_),e=a.e;break}if(h){var d=s(n,u,e);return d===a?(t.e=d.e,t):d}}}return t.e=e,t},n}},{"./errors.js":9,"./es5.js":11,"./util.js":37}],8:[function(e,t,n){var r=e("./util.js"),o=r.isPrimitive,i=r.wrapsPrimitiveReceiver;t.exports=function(e){var t=function(){return this},n=function(){throw this},r=function(e,t){return 1===t?function(){throw e}:2===t?function(){return e}:void 0};e.prototype.return=e.prototype.thenReturn=function(e){return i&&o(e)?this._then(r(e,2),void 0,void 0,void 0,void 0):this._then(t,void 0,void 0,e,void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return i&&o(e)?this._then(r(e,1),void 0,void 0,void 0,void 0):this._then(n,void 0,void 0,e,void 0)}}},{"./util.js":37}],9:[function(e,t,n){function r(e){try{d(e,"isAsync",!0)}catch(e){}}function o(e){return null!=e&&(e instanceof u||!0===e.isAsync)}function i(e){return e instanceof h}function s(e){return i(e)}function a(e,t){function n(r){if(!(this instanceof n))return new n(r);this.message="string"==typeof r?r:t,this.name=e,h.captureStackTrace&&h.captureStackTrace(this,this.constructor)}return f(n,h),n}function u(e){this.name="RejectionError",this.message=e,this.cause=e,this.isAsync=!0,e instanceof h?(this.message=e.message,this.stack=e.stack):h.captureStackTrace&&h.captureStackTrace(this,this.constructor)}var c=e("./global.js"),l=e("./es5.js").freeze,p=e("./util.js"),f=p.inherits,d=p.notEnumerableProp,h=c.Error,_=c.TypeError;"function"!=typeof _&&(_=a("TypeError","type error"));var m=c.RangeError;"function"!=typeof m&&(m=a("RangeError","range error"));var g=a("CancellationError","cancellation error"),y=a("TimeoutError","timeout error");f(u,h);var b="__BluebirdErrorTypes__",v=c[b];v||(v=l({CancellationError:g,TimeoutError:y,RejectionError:u}),d(c,b,v)),t.exports={Error:h,TypeError:_,RangeError:m,CancellationError:v.CancellationError,RejectionError:v.RejectionError,TimeoutError:v.TimeoutError,originatesFromRejection:o,markAsOriginatingFromRejection:r,canAttach:s}},{"./es5.js":11,"./global.js":15,"./util.js":37}],10:[function(e,t,n){t.exports=function(t){function n(e){var n=new r(e),o=t.rejected(n),i=o._peekContext();return null!=i&&i._attachExtraTrace(n),o}var r=e("./errors.js").TypeError;return n}},{"./errors.js":9}],11:[function(e,t,n){var r=function(){"use strict";return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r};else{var o={}.hasOwnProperty,i={}.toString,s={}.constructor.prototype,a=function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t},u=function(e,t,n){return e[t]=n.value,e},c=function(e){return e},l=function(e){try{return Object(e).constructor.prototype}catch(e){return s}},p=function(e){try{return"[object Array]"===i.call(e)}catch(e){return!1}};t.exports={isArray:p,keys:a,defineProperty:u,freeze:c,getPrototypeOf:l,isES5:r}}},{}],12:[function(e,t,n){t.exports=function(t){function n(e){for(var n=this instanceof t?this._settledValue:this,r=n.length,o=new Array(r),i=0,s=0;s<r;++s)e[s]&&(o[i++]=n[s]);return o.length=i,o}var r=(e("./util.js").isArray,{ref:null});t.filter=function(e,o){return t.map(e,o,r)._then(n,void 0,void 0,r.ref,void 0)},t.prototype.filter=function(e){return this.map(e,r)._then(n,void 0,void 0,r.ref,void 0)}}},{"./util.js":37}],13:[function(e,t,n){t.exports=function(t,n){function r(){return this}function o(){throw this}function i(e){return function(){return e}}function s(e){return function(){throw e}}function a(e,t,n){var a;return a=p&&f(t)?n?i(t):s(t):n?r:o,e._then(a,d,void 0,t,void 0)}function u(e){var r=this.promise,o=this.handler,i=r._isBound()?o.call(r._boundTo):o();if(void 0!==i){var s=t._cast(i,void 0);if(s instanceof t)return a(s,e,r.isFulfilled())}return r.isRejected()?(n.e=e,n):e}function c(e){var n=this.promise,r=this.handler,o=n._isBound()?r.call(n._boundTo,e):r(e);if(void 0!==o){var i=t._cast(o,void 0);if(i instanceof t)return a(i,e,!0)}return e}var l=e("./util.js"),p=l.wrapsPrimitiveReceiver,f=l.isPrimitive,d=l.thrower;t.prototype._passThroughHandler=function(e,t){if("function"!=typeof e)return this.then();var n={promise:this,handler:e};return this._then(t?u:c,t?u:void 0,void 0,n,void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThroughHandler(e,!0)},t.prototype.tap=function(e){return this._passThroughHandler(e,!1)}}},{"./util.js":37}],14:[function(e,t,n){t.exports=function(t,n,r){var o=e("./promise_spawn.js")(t,r),i=e("./errors.js"),s=i.TypeError,a=e("./util.js").deprecated;t.coroutine=function(e){if("function"!=typeof e)throw new s("generatorFunction must be a function");var t=o;return function(){var n=e.apply(this,arguments),r=new t(void 0,void 0);return r._generator=n,r._next(void 0),r.promise()}},t.coroutine.addYieldHandler=o.addYieldHandler,t.spawn=function(e){if(a("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof e)return n("generatorFunction must be a function");var r=new o(e,this),i=r.promise();return r._run(t.spawn),i}}},{"./errors.js":9,"./promise_spawn.js":22,"./util.js":37}],15:[function(e,t,n){t.exports=function(){if(void 0!==this)return this;try{return global}catch(e){}try{return window}catch(e){}try{return self}catch(e){}}()},{}],16:[function(e,t,n){t.exports=function(t,n,r,o){function i(e){return s(e,this[0],this[1],this[2])}function s(e,n,s,u){if("function"!=typeof n)return o("fn must be a function");var c=void 0;!0===s?e._isBound()&&(c=e._boundTo):!1!==s&&(c=s);var l=void 0!==u;if(l&&(u.ref=e),e instanceof t){var f=[n,c,u];return e._then(i,void 0,void 0,f,void 0)}if(!p(e))return o("expecting an array, a promise or a thenable");var d=new t(r);return void 0!==c&&d._setBoundTo(c),d._setTrace(void 0),new a(d,n,e,c,l).init(),d}function a(e,t,n,r,o){this.shouldUnwrapItems=o,this.index=0,this.items=n,this.callback=t,this.receiver=r,this.promise=e,this.result=new Array(n.length)}var u=t.all,c=e("./util.js"),l=e("./errors.js").canAttach,p=c.isArray,f=t._cast,d={};c.inherits(a,n),a.prototype.init=function(){for(var e=this.items,n=e.length,r=this.result,o=!1,i=0;i<n;++i){var s=f(e[i],void 0);s instanceof t?s.isPending()?(r[i]=d,s._proxyPromiseArray(this,i)):s.isFulfilled()?r[i]=s.value():(s._unsetRejectionIsUnhandled(),o||(this.reject(s.reason()),o=!0)):r[i]=s}o||this.iterate()},a.prototype.isResolved=function(){return null===this.promise},a.prototype._promiseProgressed=function(e){this.isResolved()||this.promise._progress(e)},a.prototype._promiseFulfilled=function(e,t){this.isResolved()||(this.result[t]=e,this.shouldUnwrapItems&&(this.items[t]=e),this.index===t&&this.iterate())},a.prototype._promiseRejected=function(e){this.reject(e)},a.prototype.reject=function(e){if(!this.isResolved()){var t=l(e)?e:new Error(e+"");this.promise._attachExtraTrace(t),this.promise._reject(e,t)}},a.prototype.iterate=function(){for(var e=this.index,t=this.items,n=this.result,r=t.length,n=this.result,o=this.receiver,i=this.callback;e<r;++e){var s=n[e];if(s===d)return void(this.index=e);try{n[e]=i.call(o,s,e,r)}catch(e){return this.reject(e)}}this.promise._follow(u(n)),this.items=this.result=this.callback=this.promise=null},t.prototype.map=function(e,t){
return s(this,e,!0,t)},t.map=function(e,t,n){return s(e,t,!1,n)}}},{"./errors.js":9,"./util.js":37}],17:[function(e,t,n){t.exports=function(t){function n(e){throw e}function r(e,t){var r=this,o=void 0===e?u(r,t,null):a(r,t,null,e);o===c&&s.invokeLater(n,void 0,o.e)}function o(e,t){var r=this,o=u(r,t,e);o===c&&s.invokeLater(n,void 0,o.e)}var i=e("./util.js"),s=e("./async.js"),a=i.tryCatch2,u=i.tryCatch1,c=i.errorObj;t.prototype.nodeify=function(e){return"function"==typeof e&&this._then(r,o,void 0,e,this._isBound()?this._boundTo:null),this}}},{"./async.js":2,"./util.js":37}],18:[function(e,t,n){t.exports=function(t,n){var r=e("./util.js"),o=e("./async.js"),i=e("./errors.js"),s=r.tryCatch1,a=r.errorObj;t.prototype.progressed=function(e){return this._then(void 0,void 0,e,void 0,void 0)},t.prototype._progress=function(e){this._isFollowingOrFulfilledOrRejected()||this._progressUnchecked(e)},t.prototype._progressHandlerAt=function(e){return 0===e?this._progressHandler0:this[e+2-5]},t.prototype._doProgressWith=function(e){var n=e.value,r=e.handler,o=e.promise,u=e.receiver;this._pushContext();var c=s(r,u,n);if(this._popContext(),c===a){if(null!=c.e&&"StopProgressPropagation"!==c.e.name){var l=i.canAttach(c.e)?c.e:new Error(c.e+"");o._attachExtraTrace(l),o._progress(c.e)}}else c instanceof t?c._then(o._progress,null,null,o,void 0):o._progress(c)},t.prototype._progressUnchecked=function(e){if(this.isPending())for(var r=this._length(),i=this._progress,s=0;s<r;s+=5){var a=this._progressHandlerAt(s),u=this._promiseAt(s);if(u instanceof t)"function"==typeof a?o.invoke(this._doProgressWith,this,{handler:a,promise:u,receiver:this._receiverAt(s),value:e}):o.invoke(i,u,e);else{var c=this._receiverAt(s);"function"==typeof a?a.call(c,e,u):c instanceof t&&c._isProxied()?c._progressUnchecked(e):n(c,u)&&c._promiseProgressed(e,u)}}}}},{"./async.js":2,"./errors.js":9,"./util.js":37}],19:[function(e,t,n){t.exports=function(){function t(e){return void 0!==e&&e instanceof r}function n(e,t){return e instanceof d&&t>=0}function r(e){if("function"!=typeof e)throw new w("the promise constructor requires a resolver function");if(this.constructor!==r)throw new w("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,e!==l&&this._resolveFromResolver(e)}function o(e,t){return i(e,d,!0===t&&e._isBound()?e._boundTo:void 0).promise()}function i(e,n,o){var i=null;return g(e)?i=e:(i=r._cast(e,void 0),i!==e?i._setBoundTo(o):t(i)||(i=null)),null!==i?new n(i,o):{promise:function(){return C("expecting an array, a promise or a thenable")}}}var s=e("./global.js"),a=e("./util.js"),u=e("./async.js"),c=e("./errors.js"),l=function(){},p={},f={e:null},d=e("./promise_array.js")(r,l),h=e("./captured_trace.js")(),_=e("./catch_filter.js")(f),m=e("./promise_resolver.js"),g=a.isArray,y=a.errorObj,b=a.tryCatch1,v=a.tryCatch2,E=a.tryCatchApply,R=c.RangeError,w=c.TypeError,T=c.CancellationError,x=c.TimeoutError,A=c.RejectionError,S=c.originatesFromRejection,P=c.markAsOriginatingFromRejection,I=c.canAttach,O=a.thrower,C=e("./errors_api_rejection")(r),L=function(){return new w("circular promise resolution chain")};r.prototype.bind=function(e){var t=new r(l);return t._setTrace(this),t._follow(this),t._setBoundTo(e),this._cancellable()&&(t._setCancellable(),t._cancellationParent=this),t},r.prototype.toString=function(){return"[object Promise]"},r.prototype.caught=r.prototype.catch=function(e){var t=arguments.length;if(t>1){var n,r=new Array(t-1),o=0;for(n=0;n<t-1;++n){var i=arguments[n];if("function"!=typeof i){var s=new w("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(s),void u.invoke(this._reject,this,s)}r[o++]=i}r.length=o,e=arguments[n],this._resetTrace();var a=new _(r,e,this);return this._then(void 0,a.doFilter,void 0,a,void 0)}return this._then(void 0,e,void 0,void 0,void 0)},r.prototype.then=function(e,t,n){return this._then(e,t,n,void 0,void 0)},r.prototype.done=function(e,t,n){this._then(e,t,n,void 0,void 0)._setIsFinal()},r.prototype.spread=function(e,t){return this._then(e,t,void 0,p,void 0)},r.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},r.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this._settledValue,e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this._settledValue,e.isRejected=!0),e},r.prototype.all=function(){return o(this,!0)},r.is=t,r.all=function(e){return o(e,!1)},r.join=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;++n)t[n]=arguments[n];return i(t,d,void 0).promise()},r.resolve=r.fulfilled=function(e){var t=new r(l);return t._setTrace(void 0),t._tryFollow(e)?t:(t._cleanValues(),t._setFulfilled(),t._settledValue=e,t)},r.reject=r.rejected=function(e){var t=new r(l);if(t._setTrace(void 0),P(e),t._cleanValues(),t._setRejected(),t._settledValue=e,!I(e)){var n=new Error(e+"");t._setCarriedStackTrace(n)}return t._ensurePossibleRejectionHandled(),t},r.prototype.error=function(e){return this.caught(S,e)},r.prototype._resolveFromSyncValue=function(e){if(e===y)this._cleanValues(),this._setRejected(),this._settledValue=e.e,this._ensurePossibleRejectionHandled();else{var t=r._cast(e,void 0);t instanceof r?this._follow(t):(this._cleanValues(),this._setFulfilled(),this._settledValue=e)}},r.method=function(e){if("function"!=typeof e)throw new w("fn must be a function");return function(){var t;switch(arguments.length){case 0:t=b(e,this,void 0);break;case 1:t=b(e,this,arguments[0]);break;case 2:t=v(e,this,arguments[0],arguments[1]);break;default:for(var n=arguments.length,o=new Array(n),i=0;i<n;++i)o[i]=arguments[i];t=E(e,o,this)}var s=new r(l);return s._setTrace(void 0),s._resolveFromSyncValue(t),s}},r.attempt=r.try=function(e,t,n){if("function"!=typeof e)return C("fn must be a function");var o=g(t)?E(e,t,n):b(e,n,t),i=new r(l);return i._setTrace(void 0),i._resolveFromSyncValue(o),i},r.defer=r.pending=function(){var e=new r(l);return e._setTrace(void 0),new m(e)},r.bind=function(e){var t=new r(l);return t._setTrace(void 0),t._setFulfilled(),t._setBoundTo(e),t},r.cast=function(e){var t=r._cast(e,void 0);return t instanceof r?t:r.resolve(t)},r.onPossiblyUnhandledRejection=function(e){h.possiblyUnhandledRejection="function"==typeof e?e:void 0};var B;r.onUnhandledRejectionHandled=function(e){B="function"==typeof e?e:void 0};var M=!("undefined"==typeof process||"string"!=typeof process.execPath||"object"!=typeof process.env||!process.env.BLUEBIRD_DEBUG&&"development"!==process.env.NODE_ENV);r.longStackTraces=function(){if(u.haveItemsQueued()&&!1===M)throw new Error("cannot enable long stack traces after promises have been created");M=h.isSupported()},r.hasLongStackTraces=function(){return M&&h.isSupported()},r.prototype._setProxyHandlers=function(e,t){var n=this._length();if(n>=524282&&(n=0,this._setLength(0)),0===n)this._promise0=t,this._receiver0=e;else{var r=n-5;this[r+3]=t,this[r+4]=e,this[r+0]=this[r+1]=this[r+2]=void 0}this._setLength(n+5)},r.prototype._proxyPromiseArray=function(e,t){this._setProxyHandlers(e,t)},r.prototype._proxyPromise=function(e){e._setProxied(),this._setProxyHandlers(e,-1)},r.prototype._then=function(e,t,n,o,i){var s=void 0!==i,a=s?i:new r(l);if(M&&!s){var c=this._peekContext()===this._traceParent;a._traceParent=c?this._traceParent:this,a._setTrace(this)}!s&&this._isBound()&&a._setBoundTo(this._boundTo);var p=this._addCallbacks(e,t,n,a,o);return!s&&this._cancellable()&&(a._setCancellable(),a._cancellationParent=this),this.isResolved()&&u.invoke(this._queueSettleAt,this,p),a},r.prototype._length=function(){return 524287&this._bitField},r.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},r.prototype._isFollowing=function(){return 536870912==(536870912&this._bitField)},r.prototype._setLength=function(e){this._bitField=-524288&this._bitField|524287&e},r.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},r.prototype._setRejected=function(){this._bitField=134217728|this._bitField},r.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},r.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},r.prototype._isFinal=function(){return(33554432&this._bitField)>0},r.prototype._cancellable=function(){return(67108864&this._bitField)>0},r.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},r.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},r.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},r.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},r.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},r.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},r.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},r.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},r.prototype._setCarriedStackTrace=function(e){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=e},r.prototype._unsetCarriedStackTrace=function(){this._bitField=-1048577&this._bitField,this._fulfillmentHandler0=void 0},r.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},r.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},r.prototype._receiverAt=function(e){var t;return t=0===e?this._receiver0:this[e+4-5],this._isBound()&&void 0===t?this._boundTo:t},r.prototype._promiseAt=function(e){return 0===e?this._promise0:this[e+3-5]},r.prototype._fulfillmentHandlerAt=function(e){return 0===e?this._fulfillmentHandler0:this[e+0-5]},r.prototype._rejectionHandlerAt=function(e){return 0===e?this._rejectionHandler0:this[e+1-5]},r.prototype._unsetAt=function(e){0===e?(this._rejectionHandler0=this._progressHandler0=this._promise0=this._receiver0=void 0,this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0)):this[e-5+0]=this[e-5+1]=this[e-5+2]=this[e-5+3]=this[e-5+4]=void 0},r.prototype._resolveFromResolver=function(e){function t(e){r._tryFollow(e)||r._fulfill(e)}function n(e){var t=I(e)?e:new Error(e+"");r._attachExtraTrace(t),P(e),r._reject(e,t===e?void 0:t)}var r=this;this._setTrace(void 0),this._pushContext();var o=v(e,void 0,t,n);if(this._popContext(),void 0!==o&&o===y){var i=o.e,s=I(i)?i:new Error(i+"");r._reject(i,s)}},r.prototype._addCallbacks=function(e,t,n,r,o){var i=this._length();if(i>=524282&&(i=0,this._setLength(0)),0===i)this._promise0=r,void 0!==o&&(this._receiver0=o),"function"!=typeof e||this._isCarryingStackTrace()||(this._fulfillmentHandler0=e),"function"==typeof t&&(this._rejectionHandler0=t),"function"==typeof n&&(this._progressHandler0=n);else{var s=i-5;this[s+3]=r,this[s+4]=o,this[s+0]="function"==typeof e?e:void 0,this[s+1]="function"==typeof t?t:void 0,this[s+2]="function"==typeof n?n:void 0}return this._setLength(i+5),i},r.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=8388608|this._bitField,this._boundTo=e):this._bitField=-8388609&this._bitField},r.prototype._isBound=function(){return 8388608==(8388608&this._bitField)},r.prototype._spreadSlowCase=function(e,t,n,r){var o=i(n,d,r).promise()._then(function(){return e.apply(r,arguments)},void 0,void 0,p,void 0);t._follow(o)},r.prototype._callSpread=function(e,n,o,i){var s=this._isBound()?this._boundTo:void 0;if(g(o))for(var a=0,u=o.length;a<u;++a)if(t(r._cast(o[a],void 0)))return void this._spreadSlowCase(e,n,o,s);return i&&n._pushContext(),E(e,o,s)},r.prototype._callHandler=function(e,t,n,r,o){var i;return t!==p||this.isRejected()?(o&&n._pushContext(),i=b(e,t,r)):i=this._callSpread(e,n,r,o),o&&n._popContext(),i},r.prototype._settlePromiseFromHandler=function(e,n,o,i){if(!t(i))return void e.call(n,o,i);var s=M,a=this._callHandler(e,n,i,o,s);if(!i._isFollowing())if(a===y||a===i||a===f){var u=a===i?L():a.e,c=I(u)?u:new Error(u+"");a!==f&&i._attachExtraTrace(c),i._rejectUnchecked(u,c)}else{var l=r._cast(a,i);if(t(l)){if(l.isRejected()&&!l._isCarryingStackTrace()&&!I(l._settledValue)){var c=new Error(l._settledValue+"");i._attachExtraTrace(c),l._setCarriedStackTrace(c)}i._follow(l),l._cancellable()&&(i._cancellationParent=l,i._setCancellable())}else i._fulfillUnchecked(a)}},r.prototype._follow=function(e){this._setFollowing(),e.isPending()?(e._cancellable()&&(this._cancellationParent=e,this._setCancellable()),e._proxyPromise(this)):e.isFulfilled()?this._fulfillUnchecked(e._settledValue):this._rejectUnchecked(e._settledValue,e._getCarriedStackTrace()),e._isRejectionUnhandled()&&e._unsetRejectionIsUnhandled(),M&&null==e._traceParent&&(e._traceParent=this)},r.prototype._tryFollow=function(e){if(this._isFollowingOrFulfilledOrRejected()||e===this)return!1;var n=r._cast(e,void 0);return!!t(n)&&(this._follow(n),!0)},r.prototype._resetTrace=function(){M&&(this._trace=new h(void 0===this._peekContext()))},r.prototype._setTrace=function(e){if(M){var t=this._peekContext();this._traceParent=t;var n=void 0===t;void 0!==e&&e._traceParent===t?this._trace=e._trace:this._trace=new h(n)}return this},r.prototype._attachExtraTrace=function(e){if(M){var t=this,n=e.stack;n="string"==typeof n?n.split("\n"):[];for(;null!=t&&null!=t._trace;)n=h.combine(n,t._trace.stack.split("\n")),t=t._traceParent;var r=Error.stackTraceLimit+1;n.length>r&&(n.length=r),n.length<=1?e.stack="(No stack trace)":e.stack=n.join("\n")}},r.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},r.prototype._fulfill=function(e){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(e)},r.prototype._reject=function(e,t){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(e,t)},r.prototype._settlePromiseAt=function(e){var t=this.isFulfilled()?this._fulfillmentHandlerAt(e):this._rejectionHandlerAt(e),o=this._settledValue,i=this._receiverAt(e),s=this._promiseAt(e);if("function"==typeof t)this._settlePromiseFromHandler(t,i,o,s);else{var a=!1,u=this.isFulfilled();void 0!==i&&(i instanceof r&&i._isProxied()?(i._unsetProxied(),u?i._fulfillUnchecked(o):i._rejectUnchecked(o,this._getCarriedStackTrace()),a=!0):n(i,s)&&(u?i._promiseFulfilled(o,s):i._promiseRejected(o,s),a=!0)),a||(u?s._fulfill(o):s._reject(o,this._getCarriedStackTrace()))}e>=256&&this._queueGC()},r.prototype._isProxied=function(){return 4194304==(4194304&this._bitField)},r.prototype._setProxied=function(){this._bitField=4194304|this._bitField},r.prototype._unsetProxied=function(){this._bitField=-4194305&this._bitField},r.prototype._isGcQueued=function(){return-1073741824==(-1073741824&this._bitField)},r.prototype._setGcQueued=function(){this._bitField=-1073741824|this._bitField},r.prototype._unsetGcQueued=function(){this._bitField=1073741823&this._bitField},r.prototype._queueGC=function(){this._isGcQueued()||(this._setGcQueued(),u.invokeLater(this._gc,this,void 0))},r.prototype._gc=function(){var e=this._length();this._unsetAt(0);for(var t=0;t<e;t++)delete this[t];this._setLength(0),this._unsetGcQueued()},r.prototype._queueSettleAt=function(e){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),u.invoke(this._settlePromiseAt,this,e)},r.prototype._fulfillUnchecked=function(e){if(this.isPending()){if(e===this){var t=L();return this._attachExtraTrace(t),this._rejectUnchecked(t,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=e;var n=this._length();n>0&&u.invoke(this._settlePromises,this,n)}},r.prototype._rejectUncheckedCheckError=function(e){var t=I(e)?e:new Error(e+"");this._rejectUnchecked(e,t===e?void 0:t)},r.prototype._rejectUnchecked=function(e,t){if(this.isPending()){if(e===this){var n=L();return this._attachExtraTrace(n),this._rejectUnchecked(n)}if(this._cleanValues(),this._setRejected(),this._settledValue=e,this._isFinal())return void u.invokeLater(O,void 0,void 0===t?e:t);var r=this._length();void 0!==t&&this._setCarriedStackTrace(t),r>0?u.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()}},r.prototype._rejectPromises=function(){this._settlePromises(),this._unsetCarriedStackTrace()},r.prototype._settlePromises=function(){for(var e=this._length(),t=0;t<e;t+=5)this._settlePromiseAt(t)},r.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),void 0!==h.possiblyUnhandledRejection&&u.invokeLater(this._notifyUnhandledRejection,this,void 0)},r.prototype._notifyUnhandledRejectionIsHandled=function(){"function"==typeof B&&u.invokeLater(B,void 0,this)},r.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue,t=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified(),void 0!==t&&(this._unsetCarriedStackTrace(),e=t),"function"==typeof h.possiblyUnhandledRejection&&h.possiblyUnhandledRejection(e,this)}};var j=[];r.prototype._peekContext=function(){var e=j.length-1;if(e>=0)return j[e]},r.prototype._pushContext=function(){M&&j.push(this)},r.prototype._popContext=function(){M&&j.pop()};var q=s.Promise;return r.noConflict=function(){return s.Promise===r&&(s.Promise=q),r},h.isSupported()||(r.longStackTraces=function(){},M=!1),r._makeSelfResolutionError=L,e("./finally.js")(r,f),e("./direct_resolve.js")(r),e("./thenables.js")(r,l),e("./synchronous_inspection.js")(r),r.RangeError=R,r.CancellationError=T,r.TimeoutError=x,r.TypeError=w,r.RejectionError=A,a.toFastProperties(r),a.toFastProperties(r.prototype),e("./timers.js")(r,l),e("./any.js")(r,i,d),e("./race.js")(r,l),e("./call_get.js")(r),e("./filter.js")(r,i,d,C),e("./generators.js")(r,C,l),e("./map.js")(r,d,l,C),e("./nodeify.js")(r),e("./promisify.js")(r,l),e("./props.js")(r,d),e("./reduce.js")(r,i,d,C,l),e("./settle.js")(r,i,d),e("./some.js")(r,i,d,C),e("./progress.js")(r,n),e("./cancel.js")(r,l),r.prototype=r.prototype,r}},{"./any.js":1,"./async.js":2,"./call_get.js":4,"./cancel.js":5,"./captured_trace.js":6,"./catch_filter.js":7,"./direct_resolve.js":8,"./errors.js":9,"./errors_api_rejection":10,"./filter.js":12,"./finally.js":13,"./generators.js":14,"./global.js":15,"./map.js":16,"./nodeify.js":17,"./progress.js":18,"./promise_array.js":20,"./promise_resolver.js":21,"./promisify.js":23,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":32,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./util.js":37}],20:[function(e,t,n){t.exports=function(t,n){function r(e){switch(e){case-1:return;case-2:return[];case-3:return{}}}function o(e,r){var o=this._promise=new t(n),i=void 0;e instanceof t&&(i=e,e._cancellable()&&(o._setCancellable(),o._cancellationParent=e),e._isBound()&&o._setBoundTo(r)),o._setTrace(i),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var i=e("./errors.js").canAttach,s=e("./util.js"),a=e("./async.js"),u={}.hasOwnProperty,c=s.isArray;return o.PropertiesPromiseArray=function(){},o.prototype.length=function(){return this._length},o.prototype.promise=function(){return this._promise},o.prototype._init=function(e,n){var i=this._values;if(i instanceof t){if(!i.isFulfilled())return i.isPending()?void i._then(this._init,this._reject,void 0,this,n):(i._unsetRejectionIsUnhandled(),void this._reject(i._settledValue));if(i=i._settledValue,!c(i)){var s=new t.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(s)}this._values=i}if(0===i.length)return void this._resolve(r(n));var l,p=i.length,f=p;l=this instanceof o.PropertiesPromiseArray?this._values:new Array(p);for(var d=!1,h=0;h<p;++h){var _=i[h];if(void 0!==_||u.call(i,h)){var m=t._cast(_,void 0);m instanceof t?m.isPending()?m._proxyPromiseArray(this,h):(m._unsetRejectionIsUnhandled(),d=!0):d=!0,l[h]=m}else f--}if(0===f)return void(-2===n?this._resolve(l):this._resolve(r(n)));if(this._values=l,this._length=f,d){var g=f===p?this._scanDirectValues:this._scanDirectValuesHoled;a.invoke(g,this,p)}},o.prototype._settlePromiseAt=function(e){var n=this._values[e];n instanceof t?n.isFulfilled()?this._promiseFulfilled(n._settledValue,e):n.isRejected()&&this._promiseRejected(n._settledValue,e):this._promiseFulfilled(n,e)},o.prototype._scanDirectValuesHoled=function(e){for(var t=0;t<e&&!this._isResolved();++t)u.call(this._values,t)&&this._settlePromiseAt(t)},o.prototype._scanDirectValues=function(e){for(var t=0;t<e&&!this._isResolved();++t)this._settlePromiseAt(t)},o.prototype._isResolved=function(){return null===this._values},o.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},o.prototype.__hardReject__=o.prototype._reject=function(e){this._values=null;var t=i(e)?e:new Error(e+"");this._promise._attachExtraTrace(t),this._promise._reject(e,t)},o.prototype._promiseProgressed=function(e,t){this._isResolved()||this._promise._progress({index:t,value:e})},o.prototype._promiseFulfilled=function(e,t){if(!this._isResolved()){this._values[t]=e;++this._totalResolved>=this._length&&this._resolve(this._values)}},o.prototype._promiseRejected=function(e,t){this._isResolved()||(this._totalResolved++,this._reject(e))},o}},{"./async.js":2,"./errors.js":9,"./util.js":37}],21:[function(e,t,n){function r(e){return e instanceof Error&&h.getPrototypeOf(e)===Error.prototype}function o(e){var t;return t=r(e)?new p(e):e,c.markAsOriginatingFromRejection(t),t}function i(e){function t(t,n){if(null!==e){if(t){var r=o(u(t));e._attachExtraTrace(r),e._reject(r)}else if(arguments.length>2){for(var i=arguments.length,s=new Array(i-1),a=1;a<i;++a)s[a-1]=arguments[a];e._fulfill(s)}else e._fulfill(n);e=null}}return t}var s,a=e("./util.js"),u=a.maybeWrapAsError,c=e("./errors.js"),l=c.TimeoutError,p=c.RejectionError,f=e("./async.js"),d=a.haveGetters,h=e("./es5.js");if(s=d?function(e){this.promise=e}:function(e){this.promise=e,this.asCallback=i(e),this.callback=this.asCallback},d){var _={get:function(){return i(this.promise)}};h.defineProperty(s.prototype,"asCallback",_),h.defineProperty(s.prototype,"callback",_)}s._nodebackForPromise=i,s.prototype.toString=function(){return"[object PromiseResolver]"},s.prototype.resolve=s.prototype.fulfill=function(e){var t=this.promise;if(void 0===t||void 0===t._tryFollow)throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");t._tryFollow(e)||f.invoke(t._fulfill,t,e)},s.prototype.reject=function(e){var t=this.promise;if(void 0===t||void 0===t._attachExtraTrace)throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");c.markAsOriginatingFromRejection(e);var n=c.canAttach(e)?e:new Error(e+"");t._attachExtraTrace(n),f.invoke(t._reject,t,e),n!==e&&f.invoke(this._setCarriedStackTrace,this,n)},s.prototype.progress=function(e){f.invoke(this.promise._progress,this.promise,e)},s.prototype.cancel=function(){f.invoke(this.promise.cancel,this.promise,void 0)},s.prototype.timeout=function(){this.reject(new l("timeout"))},s.prototype.isResolved=function(){return this.promise.isResolved()},s.prototype.toJSON=function(){return this.promise.toJSON()},s.prototype._setCarriedStackTrace=function(e){this.promise.isRejected()&&this.promise._setCarriedStackTrace(e)},t.exports=s},{"./async.js":2,"./errors.js":9,"./es5.js":11,"./util.js":37}],22:[function(e,t,n){t.exports=function(t,n){function r(e){for(var n=p,o=c,i=t,s=n.length,a=0;a<s;++a){var u=l(n[a],void 0,e);if(u===o)return i.reject(o.e);var f=i._cast(u,r,void 0);if(f instanceof i)return f}return null}function o(e,r){(this._promise=new t(n))._setTrace(void 0),this._generatorFunction=e,this._receiver=r,this._generator=void 0}var i=e("./errors.js"),s=i.TypeError,a=e("./util.js"),u=a.isArray,c=a.errorObj,l=a.tryCatch1,p=[];return o.prototype.promise=function(){return this._promise},o.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},o.prototype._continue=function e(n){if(n===c){this._generator=void 0;var o=i.canAttach(n.e)?n.e:new Error(n.e+"");return this._promise._attachExtraTrace(o),void this._promise._reject(n.e,o)}var a=n.value;if(!0===n.done)this._generator=void 0,this._promise._tryFollow(a)||this._promise._fulfill(a);else{var l=t._cast(a,e,void 0);if(!(l instanceof t)&&null===(l=u(l)?t.all(l):r(l)))return void this._throw(new s("A value was yielded that could not be treated as a promise"));l._then(this._next,this._throw,void 0,this,null)}},o.prototype._throw=function(e){i.canAttach(e)&&this._promise._attachExtraTrace(e),this._continue(l(this._generator.throw,this._generator,e))},o.prototype._next=function(e){this._continue(l(this._generator.next,this._generator,e))},o.addYieldHandler=function(e){if("function"!=typeof e)throw new s("fn must be a function");p.push(e)},o}},{"./errors.js":9,"./util.js":37}],23:[function(e,t,n){t.exports=function(t,n){function r(e){return!0===e.__isPromisified__}function o(e,t){return!!(t+"Async"in e)&&r(e[t+"Async"])}function i(e){for(var t=0;t<e.length;t+=2){var n=e[t];if(R.test(n))for(var r=n.replace(R,""),o=0;o<e.length;o+=2)if(e[o]===r)throw new E("Cannot promisify an API that has normal methods with Async-suffix")}}function s(e){for(var t=[e],n=Math.max(0,e-1-5),r=e-1;r>=n;--r)r!==e&&t.push(r);for(var r=e+1;r<=5;++r)t.push(r);return t}function a(e){for(var t=new Array(e),n=0;n<t.length;++n)t[n]="_arg"+n;return t.join(", ")}function u(e){return"number"==typeof e.length?Math.max(Math.min(e.length,1024),0):0}function c(e){return T.test(e)?"."+e:"['"+e.replace(/(['\\])/g,"\\$1")+"']"}function l(e,r,o,i){function l(t){for(var n=new Array(t),o=0,i=n.length;o<i;++o)n[o]="arguments["+o+"]";var s=t>0?",":"";return"string"==typeof e&&r===d?"this"+c(e)+"("+n.join(",")+s+" fn);break;":(void 0===r?"callback("+n.join(",")+s+" fn);":"callback.call("+(r===d?"this":"receiver")+", "+n.join(",")+s+" fn);")+"break;"}var p=Math.max(0,u(i)-1),f=s(p),h="string"==typeof o?o+"Async":"promisified";return T.test(h)||(h="promisified"),new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","var ret = function "+h+"("+a(p)+') {"use strict";var len = arguments.length;var promise = new Promise(INTERNAL);promise._setTrace(void 0);var fn = nodebackForPromise(promise);try {switch(len) {'+function(){for(var t="",n=0;n<f.length;++n)t+="case "+f[n]+":"+l(f[n]);return t+="default: var args = new Array(len + 1);var i = 0;for (var i = 0; i < len; ++i) {    args[i] = arguments[i];}args[i] = fn;"+("string"==typeof e?"this"+c(e)+".apply(":"callback.apply(")+(r===d?"this":"receiver")+", args); break;"}()+"}}catch(e){ var wrapped = maybeWrapAsError(e);promise._attachExtraTrace(wrapped);promise._reject(wrapped);}return promise;}; ret.__isPromisified__ = true; return ret;")(t,e,r,g,y,m,n)}function p(e,r){function o(){var o=r;r===d&&(o=this),"string"==typeof e&&(e=o[e]);var i=new t(n);i._setTrace(void 0);var s=m(i);try{e.apply(o,g(arguments,s))}catch(e){var a=y(e);i._attachExtraTrace(a),i._reject(a)}return i}return o.__isPromisified__=!0,o}function f(e,t,n){if(n){for(var r=w(e),o=0,i=r.length;o<i;o+=2){var s=r[o],a=r[o+1];e[s+"Async"]=x(s,d,s,a)}return h.toFastProperties(e),e}return x(e,t,void 0,e)}var d={},h=e("./util.js"),_=e("./es5.js"),m=e("./promise_resolver.js")._nodebackForPromise,g=h.withAppended,y=h.maybeWrapAsError,b=h.canEvaluate,v=h.deprecated,E=e("./errors").TypeError,R=new RegExp("Async$"),w=function(){if(_.isES5){var e=Object.create,t=Object.getOwnPropertyDescriptor;return function(n){for(var s=[],a=e(null),u=n;null!==n;){for(var c=_.keys(n),l=0,p=c.length;l<p;++l){var f=c[l];if(!a[f]){a[f]=!0;var d=t(n,f);null==d||"function"!=typeof d.value||r(d.value)||o(u,f)||s.push(f,d.value)}}n=_.getPrototypeOf(n)}return i(s),s}}return function(e){var t=[];for(var n in e){var s=e[n];"function"!=typeof s||r(s)||o(e,n)||t.push(n,s)}return i(t),t}}(),T=/^[a-z$_][a-z$_0-9]*$/i,x=b?l:p;t.promisify=function(e,t){if("object"==typeof e&&null!==e)return v("Promise.promisify for promisifying entire objects is deprecated. Use Promise.promisifyAll instead."),f(e,t,!0);if("function"!=typeof e)throw new E("fn must be a function");return r(e)?e:f(e,arguments.length<2?d:t,!1)},t.promisifyAll=function(e){if("function"!=typeof e&&"object"!=typeof e)throw new E("the target of promisifyAll must be an object or a function");return f(e,void 0,!0)}}},{"./errors":9,"./es5.js":11,"./promise_resolver.js":21,"./util.js":37}],24:[function(e,t,n){t.exports=function(t,n){function r(e,t){for(var n=s.keys(e),r=new Array(n.length),o=0,i=r.length;o<i;++o)r[o]=e[n[o]];if(this.constructor$(r,t),!this._isResolved())for(var o=0,i=n.length;o<i;++o)r.push(n[o])}var o=e("./util.js"),i=o.inherits,s=e("./es5.js");return i(r,n),r.prototype._init=function(){this._init$(void 0,-3)},r.prototype._promiseFulfilled=function(e,t){if(!this._isResolved()){this._values[t]=e;if(++this._totalResolved>=this._length){for(var n={},r=this.length(),o=0,i=this.length();o<i;++o)n[this._values[o+r]]=this._values[o];this._resolve(n)}}},r.prototype._promiseProgressed=function(e,t){this._isResolved()||this._promise._progress({key:this._values[t+this.length()],value:e})},n.PropertiesPromiseArray=r,r}},{"./es5.js":11,"./util.js":37}],25:[function(e,t,n){t.exports=function(t,n){function r(e,n){var r,i=t._cast(e,void 0);return a(i)?(i instanceof t?r=i._then(t.props,void 0,void 0,void 0,void 0):(r=new o(i,!0===n&&i._isBound()?i._boundTo:void 0).promise(),n=!1),!0===n&&i._isBound()&&r._setBoundTo(i._boundTo),r):s("cannot await properties of a non-object")}var o=e("./properties_promise_array.js")(t,n),i=e("./util.js"),s=e("./errors_api_rejection")(t),a=i.isObject;t.prototype.props=function(){return r(this,!0)},t.props=function(e){return r(e,!1)}}},{"./errors_api_rejection":10,"./properties_promise_array.js":24,"./util.js":37}],26:[function(e,t,n){function r(e,t,n,r,o){for(var i=0;i<o;++i)n[i+r]=e[i+t]}function o(e){return e>>>=0,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}function i(e){return"number"!=typeof e?16:o(Math.min(Math.max(16,e),1073741824))}function s(e){this._capacity=i(e),this._length=0,this._front=0,this._makeCapacity()}s.prototype._willBeOverCapacity=function(e){return this._capacity<e},s.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},s.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var o=this._front+r-3;this._checkCapacity(r);var i=this._capacity-1;this[o+0&i]=e,this[o+1&i]=t,this[o+2&i]=n,this._length=r},s.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},s.prototype.length=function(){return this._length},s.prototype._makeCapacity=function(){for(var e=this._capacity,t=0;t<e;++t)this[t]=void 0},s.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<3)},s.prototype._resizeTo=function(e){var t=this._front,n=this._capacity,o=new Array(n),i=this.length();if(r(this,0,o,0,n),this._capacity=e,this._makeCapacity(),this._front=0,t+i<=n)r(o,t,this,0,i);else{var s=i-(t+i&n-1);r(o,t,this,0,s),r(o,0,this,s,i-s)}},t.exports=s},{}],27:[function(e,t,n){t.exports=function(t,n){function r(e,r){var u=t._cast(e,void 0);if(u instanceof t)return s(u);if(!i(e))return o("expecting an array, a promise or a thenable");var c=new t(n);c._setTrace(r),void 0!==r&&(r._isBound()&&c._setBoundTo(r._boundTo),r._cancellable()&&(c._setCancellable(),c._cancellationParent=r))
;for(var l=c._fulfill,p=c._reject,f=0,d=e.length;f<d;++f){var h=e[f];(void 0!==h||a.call(e,f))&&t.cast(h)._then(l,p,void 0,c,null)}return c}var o=e("./errors_api_rejection.js")(t),i=e("./util.js").isArray,s=function(e){return e.then(function(t){return r(t,e)})},a={}.hasOwnProperty;t.race=function(e){return r(e,void 0)},t.prototype.race=function(){return r(this,void 0)}}},{"./errors_api_rejection.js":10,"./util.js":37}],28:[function(e,t,n){t.exports=function(e,t,n,r,o){function i(t,n,r,i,s){this.promise=new e(o),this.index=n,this.length=i.length,this.items=i,this.callback=t,this.receiver=s,this.accum=r}function s(e,t){var n=this,r=void 0;"function"!=typeof n&&(r=n.receiver,n=n.fn);var o=e.length,s=void 0,a=0;void 0!==t?(s=t,a=0):(a=1,o>0&&(s=e[0]));var u=a;if(u>=o)return s;var c=new i(n,u,s,e,r);return c.iterate(),c.promise}function a(e){var t=this.fn,n=this.initialValue;return s.call(t,e,n)}function u(e,t,n,r){return n._then(function(n){return c(e,t,n,r)},void 0,void 0,void 0,void 0)}function c(o,i,c,l){if("function"!=typeof i)return r("fn must be a function");if(!0===l&&o._isBound()&&(i={fn:i,receiver:o._boundTo}),void 0!==c){if(c instanceof e){if(!c.isFulfilled())return u(o,i,c,l);c=c._settledValue}return t(o,n,!0===l&&o._isBound()?o._boundTo:void 0).promise()._then(a,void 0,void 0,{fn:i,initialValue:c},void 0)}return t(o,n,!0===l&&o._isBound()?o._boundTo:void 0).promise()._then(s,void 0,void 0,i,void 0)}i.prototype.reject=function(e){this.promise._reject(e)},i.prototype.fulfill=function(e,t){this.accum=e,this.index=t+1,this.iterate()},i.prototype.iterate=function(){for(var t=this.index,n=this.length,r=this.items,o=this.accum,i=this.receiver,s=this.callback;t<n;++t)if(o=s.call(i,o,r[t],t,n),(o=e._cast(o,void 0))instanceof e)return void o._then(this.fulfill,this.reject,void 0,this,t);this.promise._fulfill(o)},e.reduce=function(e,t,n){return c(e,t,n,!1)},e.prototype.reduce=function(e,t){return c(this,e,t,!0)}}},{}],29:[function(e,t,n){var r,o=e("./global.js");if("undefined"!=typeof process&&null!==process&&"function"==typeof process.cwd&&"function"==typeof process.nextTick&&"string"==typeof process.version)r=function(e){process.nextTick(e)};else if("function"!=typeof o.MutationObserver&&"function"!=typeof o.WebkitMutationObserver&&"function"!=typeof o.WebKitMutationObserver||"undefined"==typeof document||"function"!=typeof document.createElement)if("function"==typeof o.postMessage&&"function"!=typeof o.importScripts&&"function"==typeof o.addEventListener&&"function"==typeof o.removeEventListener){var i="bluebird_message_key_"+Math.random();r=function(){function e(e){if(e.source===o&&e.data===i){var n=t;t=void 0,n()}}var t=void 0;return o.addEventListener("message",e,!1),function(e){t=e,o.postMessage(i,"*")}}()}else r="function"==typeof o.MessageChannel?function(){var e=void 0,t=new o.MessageChannel;return t.port1.onmessage=function(){var t=e;e=void 0,t()},function(n){e=n,t.port2.postMessage(null)}}():o.setTimeout?function(e){setTimeout(e,4)}:function(e){e()};else r=function(){var e=o.MutationObserver||o.WebkitMutationObserver||o.WebKitMutationObserver,t=document.createElement("div"),n=void 0;return new e(function(){var e=n;n=void 0,e()}).observe(t,{attributes:!0}),function(e){n=e,t.setAttribute("class","foo")}}();t.exports=r},{"./global.js":15}],30:[function(e,t,n){t.exports=function(t,n,r){function o(e,t){return n(e,i,!0===t&&e._isBound()?e._boundTo:void 0).promise()}var i=e("./settled_promise_array.js")(t,r);t.settle=function(e){return o(e,!1)},t.prototype.settle=function(){return o(this,!0)}}},{"./settled_promise_array.js":31}],31:[function(e,t,n){t.exports=function(t,n){function r(e,t){this.constructor$(e,t)}var o=t.PromiseInspection;return(0,e("./util.js").inherits)(r,n),r.prototype._promiseResolved=function(e,t){this._values[e]=t,++this._totalResolved>=this._length&&this._resolve(this._values)},r.prototype._promiseFulfilled=function(e,t){if(!this._isResolved()){var n=new o;n._bitField=268435456,n._settledValue=e,this._promiseResolved(t,n)}},r.prototype._promiseRejected=function(e,t){if(!this._isResolved()){var n=new o;n._bitField=134217728,n._settledValue=e,this._promiseResolved(t,n)}},r}},{"./util.js":37}],32:[function(e,t,n){t.exports=function(t,n,r,o){function i(e,t,r){if((0|t)!==t||t<0)return o("expecting a positive integer");var i=n(e,s,!0===r&&e._isBound()?e._boundTo:void 0),a=i.promise();return a.isRejected()?a:(i.setHowMany(t),i.init(),a)}var s=e("./some_promise_array.js")(r);t.some=function(e,t){return i(e,t,!1)},t.prototype.some=function(e){return i(this,e,!0)}}},{"./some_promise_array.js":33}],33:[function(e,t,n){t.exports=function(t){function n(e,t){this.constructor$(e,t),this._howMany=0,this._unwrap=!1,this._initialized=!1}var r=e("./util.js"),o=e("./errors.js").RangeError,i=r.inherits,s=r.isArray;return i(n,t),n.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-2);var e=s(this._values);if(this._holes=e?this._values.length-this.length():0,!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()){var t="(Promise.some) input array contains less than "+this._howMany+" promises";this._reject(new o(t))}}},n.prototype.init=function(){this._initialized=!0,this._init()},n.prototype.setUnwrap=function(){this._unwrap=!0},n.prototype.howMany=function(){return this._howMany},n.prototype.setHowMany=function(e){this._isResolved()||(this._howMany=e)},n.prototype._promiseFulfilled=function(e){this._isResolved()||(this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values)))},n.prototype._promiseRejected=function(e){this._isResolved()||(this._addRejected(e),this.howMany()>this._canPossiblyFulfill()&&(this._values.length===this.length()?this._reject([]):this._reject(this._values.slice(this.length()+this._holes))))},n.prototype._fulfilled=function(){return this._totalResolved},n.prototype._rejected=function(){return this._values.length-this.length()-this._holes},n.prototype._addRejected=function(e){this._values.push(e)},n.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},n.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},n}},{"./errors.js":9,"./util.js":37}],34:[function(e,t,n){t.exports=function(e){function t(e){void 0!==e?(this._bitField=e._bitField,this._settledValue=e.isResolved()?e._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}t.prototype.isFulfilled=e.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},t.prototype.isRejected=e.prototype.isRejected=function(){return(134217728&this._bitField)>0},t.prototype.isPending=e.prototype.isPending=function(){return 0==(402653184&this._bitField)},t.prototype.value=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},t.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._settledValue},t.prototype.isResolved=e.prototype.isResolved=function(){return(402653184&this._bitField)>0},e.prototype.inspect=function(){return new t(this)},e.PromiseInspection=t}},{}],35:[function(e,t,n){t.exports=function(t,n){function r(e){try{return e.then}catch(e){return c.e=e,c}}function o(e,o){if(l(e)){if(e instanceof t)return e;if(i(e)){var a=new t(n);return a._setTrace(void 0),e._then(a._fulfillUnchecked,a._rejectUncheckedCheckError,a._progressUnchecked,a,null),a._setFollowing(),a}var p=r(e);if(p===c)return void 0!==o&&u(p.e)&&o._attachExtraTrace(p.e),t.reject(p.e);if("function"==typeof p)return s(e,p,o)}return e}function i(e){return p.call(e,"_promise0")}function s(e,n,r){function o(n){if(!c){if(c=!0,e===n){var o=t._makeSelfResolutionError();return void 0!==r&&r._attachExtraTrace(o),void a.promise._reject(o,void 0)}a.resolve(n)}}function i(e){if(!c){c=!0;var t=u(e)?e:new Error(e+"");void 0!==r&&r._attachExtraTrace(t),a.promise._reject(e,t)}}function s(e){if(!c){var t=a.promise;"function"==typeof t._progress&&t._progress(e)}}var a=t.defer(),c=!1;try{n.call(e,o,i,s)}catch(e){if(!c){c=!0;var l=u(e)?e:new Error(e+"");void 0!==r&&r._attachExtraTrace(l),a.promise._reject(e,l)}}return a.promise}var a=e("./util.js"),u=e("./errors.js").canAttach,c=a.errorObj,l=a.isObject,p={}.hasOwnProperty;t._cast=o}},{"./errors.js":9,"./util.js":37}],36:[function(e,t,n){var r=e("./global.js"),o=function(e,t){for(var n=arguments.length,o=new Array(n-2),i=2;i<n;++i)o[i-2]=arguments[i];r.setTimeout(function(){e.apply(void 0,o)},t)};t.exports=function(t,n){var r=(e("./util.js"),e("./errors.js")),i=(e("./errors_api_rejection")(t),t.TimeoutError),s=function(e,t,n){if(e.isPending()){"string"!=typeof t&&(t="operation timed out after "+n+" ms");var o=new i(t);r.markAsOriginatingFromRejection(o),e._attachExtraTrace(o),e._rejectUnchecked(o)}},a=function(e,t){t._fulfill(e)},u=t.delay=function(e,r){void 0===r&&(r=e,e=void 0),r=+r;var i=t._cast(e,void 0),s=new t(n);return i instanceof t?(i._isBound()&&s._setBoundTo(i._boundTo),i._cancellable()&&(s._setCancellable(),s._cancellationParent=i),s._setTrace(i),s._follow(i),s.then(function(e){return t.delay(e,r)})):(s._setTrace(void 0),o(a,r,e,s),s)};t.prototype.delay=function(e){return u(this,e)},t.prototype.timeout=function(e,r){e=+e;var i=new t(n);return i._setTrace(this),this._isBound()&&i._setBoundTo(this._boundTo),this._cancellable()&&(i._setCancellable(),i._cancellationParent=this),i._follow(this),o(s,e,i,r,e),i}}},{"./errors.js":9,"./errors_api_rejection":10,"./global.js":15,"./util.js":37}],37:[function(e,t,n){function r(e){"undefined"!=typeof console&&null!==console&&"function"==typeof console.warn&&console.warn("Bluebird: "+e)}function o(e,t,n){try{return e.call(t,n)}catch(e){return b.e=e,b}}function i(e,t,n,r){try{return e.call(t,n,r)}catch(e){return b.e=e,b}}function s(e,t,n){try{return e.apply(n,t)}catch(e){return b.e=e,b}}function a(e){return"string"==typeof e?e:""+e}function u(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function c(e){return!u(e)}function l(e){return u(e)?new Error(a(e)):e}function p(e,t){var n,r=e.length,o=new Array(r+1);for(n=0;n<r;++n)o[n]=e[n];return o[n]=t,o}function f(e,t,n){if(u(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return m.defineProperty(e,t,r),e}function d(e){throw e}function h(e){function t(){}return t.prototype=e,t}var _=e("./global.js"),m=e("./es5.js"),g=function(){try{var e={};return m.defineProperty(e,"f",{get:function(){return 3}}),3===e.f}catch(e){return!1}}(),y=function(){return"undefined"==typeof window||null===window||void 0===window.document||"undefined"==typeof navigator||null===navigator||"string"!=typeof navigator.appName||window!==_}(),b={e:{}},v=function(e,t){function n(){this.constructor=e,this.constructor$=t;for(var n in t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var r={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},E=function(){return"string"!==this}.call("string"),R={thrower:d,isArray:m.isArray,haveGetters:g,notEnumerableProp:f,isPrimitive:u,isObject:c,canEvaluate:y,deprecated:r,errorObj:b,tryCatch1:o,tryCatch2:i,tryCatchApply:s,inherits:v,withAppended:p,asString:a,maybeWrapAsError:l,wrapsPrimitiveReceiver:E,toFastProperties:h};t.exports=R},{"./es5.js":11,"./global.js":15}]},{},[3])(3)}),function(){function e(e,t){if(e!==t){var n=null===e,r=e===R,o=e===e,i=null===t,s=t===R,a=t===t;if(e>t&&!i||!o||n&&!s&&a||r&&a)return 1;if(e<t&&!n||!a||i&&!r&&o||s&&o)return-1}return 0}function t(e,t,n){for(var r=e.length,o=n?r:-1;n?o--:++o<r;)if(t(e[o],o,e))return o;return-1}function n(e,t,n){if(t!==t)return d(e,n);for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}function r(e){return"function"==typeof e||!1}function o(e){return null==e?"":e+""}function i(e,t){for(var n=-1,r=e.length;++n<r&&t.indexOf(e.charAt(n))>-1;);return n}function s(e,t){for(var n=e.length;n--&&t.indexOf(e.charAt(n))>-1;);return n}function a(t,n){return e(t.criteria,n.criteria)||t.index-n.index}function u(t,n,r){for(var o=-1,i=t.criteria,s=n.criteria,a=i.length,u=r.length;++o<a;){var c=e(i[o],s[o]);if(c){if(o>=u)return c;var l=r[o];return c*("asc"===l||!0===l?1:-1)}}return t.index-n.index}function c(e){return ke[e]}function l(e){return Fe[e]}function p(e,t,n){return t?e=Ge[e]:n&&(e=ze[e]),"\\"+e}function f(e){return"\\"+ze[e]}function d(e,t,n){for(var r=e.length,o=t+(n?0:-1);n?o--:++o<r;){var i=e[o];if(i!==i)return o}return-1}function h(e){return!!e&&"object"==typeof e}function _(e){return e<=160&&e>=9&&e<=13||32==e||160==e||5760==e||6158==e||e>=8192&&(e<=8202||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}function m(e,t){for(var n=-1,r=e.length,o=-1,i=[];++n<r;)e[n]===t&&(e[n]=D,i[++o]=n);return i}function g(e,t){for(var n,r=-1,o=e.length,i=-1,s=[];++r<o;){var a=e[r],u=t?t(a,r,e):a;r&&n===u||(n=u,s[++i]=a)}return s}function y(e){for(var t=-1,n=e.length;++t<n&&_(e.charCodeAt(t)););return t}function b(e){for(var t=e.length;t--&&_(e.charCodeAt(t)););return t}function v(e){return Ne[e]}function E(_){function ke(e){if(h(e)&&!Ia(e)&&!(e instanceof De)){if(e instanceof Ne)return e;if(ts.call(e,"__chain__")&&ts.call(e,"__wrapped__"))return dr(e)}return new Ne(e)}function Fe(){}function Ne(e,t,n){this.__wrapped__=e,this.__actions__=n||[],this.__chain__=!!t}function De(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ps,this.__views__=[]}function Ge(){var e=new De(this.__wrapped__);return e.__actions__=nt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=nt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=nt(this.__views__),e}function ze(){if(this.__filtered__){var e=new De(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Ve(){var e=this.__wrapped__.value(),t=this.__dir__,n=Ia(e),r=t<0,o=n?e.length:0,i=Wn(0,o,this.__views__),s=i.start,a=i.end,u=a-s,c=r?a:s-1,l=this.__iteratees__,p=l.length,f=0,d=ws(u,this.__takeCount__);if(!n||o<U||o==u&&d==u)return nn(e,this.__actions__);var h=[];e:for(;u--&&f<d;){c+=t;for(var _=-1,m=e[c];++_<p;){var g=l[_],y=g.iteratee,b=g.type,v=y(m);if(b==F)m=v;else if(!v){if(b==k)continue e;break e}}h[f++]=m}return h}function He(){this.__data__={}}function We(e){return this.has(e)&&delete this.__data__[e]}function Qe(e){return"__proto__"==e?R:this.__data__[e]}function Ke(e){return"__proto__"!=e&&ts.call(this.__data__,e)}function Ye(e,t){return"__proto__"!=e&&(this.__data__[e]=t),this}function $e(e){var t=e?e.length:0;for(this.data={hash:gs(null),set:new ps};t--;)this.push(e[t])}function Ze(e,t){var n=e.data;return("string"==typeof t||jo(t)?n.set.has(t):n.hash[t])?0:-1}function et(e){var t=this.data;"string"==typeof e||jo(e)?t.set.add(e):t.hash[e]=!0}function tt(e,t){for(var n=-1,r=e.length,o=-1,i=t.length,s=Di(r+i);++n<r;)s[n]=e[n];for(;++o<i;)s[n++]=t[o];return s}function nt(e,t){var n=-1,r=e.length;for(t||(t=Di(r));++n<r;)t[n]=e[n];return t}function rt(e,t){for(var n=-1,r=e.length;++n<r&&!1!==t(e[n],n,e););return e}function ot(e,t){for(var n=e.length;n--&&!1!==t(e[n],n,e););return e}function it(e,t){for(var n=-1,r=e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function st(e,t,n,r){for(var o=-1,i=e.length,s=r,a=s;++o<i;){var u=e[o],c=+t(u);n(c,s)&&(s=c,a=u)}return a}function at(e,t){for(var n=-1,r=e.length,o=-1,i=[];++n<r;){var s=e[n];t(s,n,e)&&(i[++o]=s)}return i}function ut(e,t){for(var n=-1,r=e.length,o=Di(r);++n<r;)o[n]=t(e[n],n,e);return o}function ct(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}function lt(e,t,n,r){var o=-1,i=e.length;for(r&&i&&(n=e[++o]);++o<i;)n=t(n,e[o],o,e);return n}function pt(e,t,n,r){var o=e.length;for(r&&o&&(n=e[--o]);o--;)n=t(n,e[o],o,e);return n}function ft(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function dt(e,t){for(var n=e.length,r=0;n--;)r+=+t(e[n])||0;return r}function ht(e,t){return e===R?t:e}function _t(e,t,n,r){return e!==R&&ts.call(r,n)?e:t}function mt(e,t,n){for(var r=-1,o=Na(t),i=o.length;++r<i;){var s=o[r],a=e[s],u=n(a,t[s],s,e,t);(u===u?u===a:a!==a)&&(a!==R||s in e)||(e[s]=u)}return e}function gt(e,t){return null==t?e:bt(t,Na(t),e)}function yt(e,t){for(var n=-1,r=null==e,o=!r&&Xn(e),i=o?e.length:0,s=t.length,a=Di(s);++n<s;){var u=t[n];a[n]=o?$n(u,i)?e[u]:R:r?R:e[u]}return a}function bt(e,t,n){n||(n={});for(var r=-1,o=t.length;++r<o;){var i=t[r];n[i]=e[i]}return n}function vt(e,t,n){var r=typeof e;return"function"==r?t===R?e:sn(e,t,n):null==e?Pi:"object"==r?Ft(e):t===R?Mi(e):Nt(e,t)}function Et(e,t,n,r,o,i,s){var a;if(n&&(a=o?n(e,r,o):n(e)),a!==R)return a;if(!jo(e))return e;var u=Ia(e);if(u){if(a=Qn(e),!t)return nt(e,a)}else{var c=rs.call(e),l=c==Q;if(c!=Y&&c!=G&&(!l||o))return Ue[c]?Yn(e,c,t):o?e:{};if(a=Kn(l?{}:e),!t)return gt(a,e)}i||(i=[]),s||(s=[]);for(var p=i.length;p--;)if(i[p]==e)return s[p];return i.push(e),s.push(a),(u?rt:Ct)(e,function(r,o){a[o]=Et(r,t,n,o,e,i,s)}),a}function Rt(e,t,n){if("function"!=typeof e)throw new Ji(N);return fs(function(){e.apply(R,n)},t)}function wt(e,t){var r=e?e.length:0,o=[];if(!r)return o;var i=-1,s=zn(),a=s===n,u=a&&t.length>=U?_n(t):null,c=t.length;u&&(s=Ze,a=!1,t=u);e:for(;++i<r;){var l=e[i];if(a&&l===l){for(var p=c;p--;)if(t[p]===l)continue e;o.push(l)}else s(t,l,0)<0&&o.push(l)}return o}function Tt(e,t){var n=!0;return qs(e,function(e,r,o){return n=!!t(e,r,o)}),n}function xt(e,t,n,r){var o=r,i=o;return qs(e,function(e,s,a){var u=+t(e,s,a);(n(u,o)||u===r&&u===i)&&(o=u,i=e)}),i}function At(e,t,n,r){var o=e.length;for(n=null==n?0:+n||0,n<0&&(n=-n>o?0:o+n),r=r===R||r>o?o:+r||0,r<0&&(r+=o),o=n>r?0:r>>>0,n>>>=0;n<o;)e[n++]=t;return e}function St(e,t){var n=[];return qs(e,function(e,r,o){t(e,r,o)&&n.push(e)}),n}function Pt(e,t,n,r){var o;return n(e,function(e,n,i){if(t(e,n,i))return o=r?n:e,!1}),o}function It(e,t,n,r){r||(r=[]);for(var o=-1,i=e.length;++o<i;){var s=e[o];h(s)&&Xn(s)&&(n||Ia(s)||Ao(s))?t?It(s,t,n,r):ct(r,s):n||(r[r.length]=s)}return r}function Ot(e,t){return ks(e,t,ti)}function Ct(e,t){return ks(e,t,Na)}function Lt(e,t){return Fs(e,t,Na)}function Bt(e,t){for(var n=-1,r=t.length,o=-1,i=[];++n<r;){var s=t[n];Mo(e[s])&&(i[++o]=s)}return i}function Mt(e,t,n){if(null!=e){n!==R&&n in pr(e)&&(t=[n]);for(var r=0,o=t.length;null!=e&&r<o;)e=e[t[r++]];return r&&r==o?e:R}}function jt(e,t,n,r,o,i){return e===t||(null==e||null==t||!jo(e)&&!h(t)?e!==e&&t!==t:qt(e,t,jt,n,r,o,i))}function qt(e,t,n,r,o,i,s){var a=Ia(e),u=Ia(t),c=z,l=z;a||(c=rs.call(e),c==G?c=Y:c!=Y&&(a=Vo(e))),u||(l=rs.call(t),l==G?l=Y:l!=Y&&(u=Vo(t)));var p=c==Y,f=l==Y,d=c==l;if(d&&!a&&!p)return Fn(e,t,c);if(!o){var h=p&&ts.call(e,"__wrapped__"),_=f&&ts.call(t,"__wrapped__");if(h||_)return n(h?e.value():e,_?t.value():t,r,o,i,s)}if(!d)return!1;i||(i=[]),s||(s=[]);for(var m=i.length;m--;)if(i[m]==e)return s[m]==t;i.push(e),s.push(t);var g=(a?kn:Nn)(e,t,n,r,o,i,s);return i.pop(),s.pop(),g}function Ut(e,t,n){var r=t.length,o=r,i=!n;if(null==e)return!o;for(e=pr(e);r--;){var s=t[r];if(i&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++r<o;){s=t[r];var a=s[0],u=e[a],c=s[1];if(i&&s[2]){if(u===R&&!(a in e))return!1}else{var l=n?n(u,c,a):R;if(!(l===R?jt(c,u,n,!0):l))return!1}}return!0}function kt(e,t){var n=-1,r=Xn(e)?Di(e.length):[];return qs(e,function(e,o,i){r[++n]=t(e,o,i)}),r}function Ft(e){var t=Vn(e);if(1==t.length&&t[0][2]){var n=t[0][0],r=t[0][1];return function(e){return null!=e&&(e[n]===r&&(r!==R||n in pr(e)))}}return function(e){return Ut(e,t)}}function Nt(e,t){var n=Ia(e),r=er(e)&&rr(t),o=e+"";return e=fr(e),function(i){if(null==i)return!1;var s=o;if(i=pr(i),(n||!r)&&!(s in i)){if(null==(i=1==e.length?i:Mt(i,Kt(e,0,-1))))return!1;s=Ar(e),i=pr(i)}return i[s]===t?t!==R||s in i:jt(t,i[s],R,!0)}}function Dt(e,t,n,r,o){if(!jo(e))return e;var i=Xn(t)&&(Ia(t)||Vo(t)),s=i?R:Na(t);return rt(s||t,function(a,u){if(s&&(u=a,a=t[u]),h(a))r||(r=[]),o||(o=[]),Gt(e,t,u,Dt,n,r,o);else{var c=e[u],l=n?n(c,a,u,e,t):R,p=l===R;p&&(l=a),l===R&&(!i||u in e)||!p&&(l===l?l===c:c!==c)||(e[u]=l)}}),e}function Gt(e,t,n,r,o,i,s){for(var a=i.length,u=t[n];a--;)if(i[a]==u)return void(e[n]=s[a]);var c=e[n],l=o?o(c,u,n,e,t):R,p=l===R;p&&(l=u,Xn(u)&&(Ia(u)||Vo(u))?l=Ia(c)?c:Xn(c)?nt(c):[]:Do(u)||Ao(u)?l=Ao(c)?Yo(c):Do(c)?c:{}:p=!1),i.push(u),s.push(l),p?e[n]=r(l,u,o,i,s):(l===l?l!==c:c===c)&&(e[n]=l)}function zt(e){return function(t){return null==t?R:t[e]}}function Vt(e){var t=e+"";return e=fr(e),function(n){return Mt(n,e,t)}}function Ht(e,t){for(var n=e?t.length:0;n--;){var r=t[n];if(r!=o&&$n(r)){var o=r;ds.call(e,r,1)}}return e}function Wt(e,t){return e+ys(As()*(t-e+1))}function Qt(e,t,n,r,o){return o(e,function(e,o,i){n=r?(r=!1,e):t(n,e,o,i)}),n}function Kt(e,t,n){var r=-1,o=e.length;t=null==t?0:+t||0,t<0&&(t=-t>o?0:o+t),n=n===R||n>o?o:+n||0,n<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var i=Di(o);++r<o;)i[r]=e[r+t];return i}function Yt(e,t){var n;return qs(e,function(e,r,o){return!(n=t(e,r,o))}),!!n}function Jt(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}function Xt(e,t,n){var r=Dn(),o=-1;return t=ut(t,function(e){return r(e)}),Jt(kt(e,function(e){return{criteria:ut(t,function(t){return t(e)}),index:++o,value:e}}),function(e,t){return u(e,t,n)})}function $t(e,t){var n=0;return qs(e,function(e,r,o){n+=+t(e,r,o)||0}),n}function Zt(e,t){var r=-1,o=zn(),i=e.length,s=o===n,a=s&&i>=U,u=a?_n():null,c=[];u?(o=Ze,s=!1):(a=!1,u=t?[]:c);e:for(;++r<i;){var l=e[r],p=t?t(l,r,e):l;if(s&&l===l){for(var f=u.length;f--;)if(u[f]===p)continue e;t&&u.push(p),c.push(l)}else o(u,p,0)<0&&((t||a)&&u.push(p),c.push(l))}return c}function en(e,t){for(var n=-1,r=t.length,o=Di(r);++n<r;)o[n]=e[t[n]];return o}function tn(e,t,n,r){for(var o=e.length,i=r?o:-1;(r?i--:++i<o)&&t(e[i],i,e););return n?Kt(e,r?0:i,r?i+1:o):Kt(e,r?i+1:0,r?o:i)}function nn(e,t){var n=e;n instanceof De&&(n=n.value());for(var r=-1,o=t.length;++r<o;){var i=t[r];n=i.func.apply(i.thisArg,ct([n],i.args))}return n}function rn(e,t,n){var r=0,o=e?e.length:r;if("number"==typeof t&&t===t&&o<=Cs){for(;r<o;){var i=r+o>>>1,s=e[i];(n?s<=t:s<t)&&null!==s?r=i+1:o=i}return o}return on(e,t,Pi,n)}function on(e,t,n,r){t=n(t);for(var o=0,i=e?e.length:0,s=t!==t,a=null===t,u=t===R;o<i;){var c=ys((o+i)/2),l=n(e[c]),p=l!==R,f=l===l;if(s)var d=f||r;else d=a?f&&p&&(r||null!=l):u?f&&(r||p):null!=l&&(r?l<=t:l<t);d?o=c+1:i=c}return ws(i,Os)}function sn(e,t,n){if("function"!=typeof e)return Pi;if(t===R)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,o){return e.call(t,n,r,o)};case 4:return function(n,r,o,i){return e.call(t,n,r,o,i)};case 5:return function(n,r,o,i,s){return e.call(t,n,r,o,i,s)}}return function(){return e.apply(t,arguments)}}function an(e){var t=new ss(e.byteLength);return new hs(t).set(new hs(e)),t}function un(e,t,n){for(var r=n.length,o=-1,i=Rs(e.length-r,0),s=-1,a=t.length,u=Di(a+i);++s<a;)u[s]=t[s];for(;++o<r;)u[n[o]]=e[o];for(;i--;)u[s++]=e[o++];return u}function cn(e,t,n){for(var r=-1,o=n.length,i=-1,s=Rs(e.length-o,0),a=-1,u=t.length,c=Di(s+u);++i<s;)c[i]=e[i];for(var l=i;++a<u;)c[l+a]=t[a];for(;++r<o;)c[l+n[r]]=e[i++];return c}function ln(e,t){return function(n,r,o){var i=t?t():{};if(r=Dn(r,o,3),Ia(n))for(var s=-1,a=n.length;++s<a;){var u=n[s];e(i,u,r(u,s,n),n)}else qs(n,function(t,n,o){e(i,t,r(t,n,o),o)});return i}}function pn(e){return yo(function(t,n){var r=-1,o=null==t?0:n.length,i=o>2?n[o-2]:R,s=o>2?n[2]:R,a=o>1?n[o-1]:R;for("function"==typeof i?(i=sn(i,a,5),o-=2):(i="function"==typeof a?a:R,o-=i?1:0),s&&Zn(n[0],n[1],s)&&(i=o<3?R:i,o=1);++r<o;){var u=n[r];u&&e(t,u,i)}return t})}function fn(e,t){return function(n,r){var o=n?Gs(n):0;if(!nr(o))return e(n,r);for(var i=t?o:-1,s=pr(n);(t?i--:++i<o)&&!1!==r(s[i],i,s););return n}}function dn(e){return function(t,n,r){for(var o=pr(t),i=r(t),s=i.length,a=e?s:-1;e?a--:++a<s;){var u=i[a];if(!1===n(o[u],u,o))break}return t}}function hn(e,t){function n(){return(this&&this!==Je&&this instanceof n?r:e).apply(t,arguments)}var r=gn(e);return n}function _n(e){return gs&&ps?new $e(e):null}function mn(e){return function(t){for(var n=-1,r=xi(pi(t)),o=r.length,i="";++n<o;)i=e(i,r[n],n);return i}}function gn(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=js(e.prototype),r=e.apply(n,t);return jo(r)?r:n}}function yn(e){function t(n,r,o){o&&Zn(n,r,o)&&(r=R);var i=Un(n,e,R,R,R,R,R,r);return i.placeholder=t.placeholder,i}return t}function bn(e,t){return yo(function(n){var r=n[0];return null==r?r:(n.push(t),e.apply(R,n))})}function vn(e,t){return function(n,r,o){if(o&&Zn(n,r,o)&&(r=R),r=Dn(r,o,3),1==r.length){n=Ia(n)?n:lr(n);var i=st(n,r,e,t);if(!n.length||i!==t)return i}return xt(n,r,e,t)}}function En(e,n){return function(r,o,i){if(o=Dn(o,i,3),Ia(r)){var s=t(r,o,n);return s>-1?r[s]:R}return Pt(r,o,e)}}function Rn(e){return function(n,r,o){return n&&n.length?(r=Dn(r,o,3),t(n,r,e)):-1}}function wn(e){return function(t,n,r){return n=Dn(n,r,3),Pt(t,n,e,!0)}}function Tn(e){return function(){for(var t,n=arguments.length,r=e?n:-1,o=0,i=Di(n);e?r--:++r<n;){var s=i[o++]=arguments[r];if("function"!=typeof s)throw new Ji(N);!t&&Ne.prototype.thru&&"wrapper"==Gn(s)&&(t=new Ne([],!0))}for(r=t?-1:n;++r<n;){s=i[r];var a=Gn(s),u="wrapper"==a?Ds(s):R;t=u&&tr(u[0])&&u[1]==(C|S|I|L)&&!u[4].length&&1==u[9]?t[Gn(u[0])].apply(t,u[3]):1==s.length&&tr(s)?t[a]():t.thru(s)}return function(){var e=arguments,r=e[0];if(t&&1==e.length&&Ia(r)&&r.length>=U)return t.plant(r).value();for(var o=0,s=n?i[o].apply(this,e):r;++o<n;)s=i[o].call(this,s);return s}}}function xn(e,t){return function(n,r,o){return"function"==typeof r&&o===R&&Ia(n)?e(n,r):t(n,sn(r,o,3))}}function An(e){return function(t,n,r){return"function"==typeof n&&r===R||(n=sn(n,r,3)),e(t,n,ti)}}function Sn(e){return function(t,n,r){return"function"==typeof n&&r===R||(n=sn(n,r,3)),e(t,n)}}function Pn(e){return function(t,n,r){var o={};return n=Dn(n,r,3),Ct(t,function(t,r,i){var s=n(t,r,i);r=e?s:r,t=e?t:s,o[r]=t}),o}}function In(e){return function(t,n,r){return t=o(t),(e?t:"")+Bn(t,n,r)+(e?"":t)}}function On(e){var t=yo(function(n,r){var o=m(r,t.placeholder);return Un(n,e,R,r,o)});return t}function Cn(e,t){return function(n,r,o,i){var s=arguments.length<3;return"function"==typeof r&&i===R&&Ia(n)?e(n,r,o,s):Qt(n,Dn(r,i,4),o,s,t)}}function Ln(e,t,n,r,o,i,s,a,u,c){function l(){for(var b=arguments.length,v=b,E=Di(b);v--;)E[v]=arguments[v];if(r&&(E=un(E,r,o)),i&&(E=cn(E,i,s)),h||g){var w=l.placeholder,A=m(E,w);if((b-=A.length)<c){var S=a?nt(a):R,P=Rs(c-b,0),C=h?A:R,L=h?R:A,B=h?E:R,M=h?R:E;t|=h?I:O,t&=~(h?O:I),_||(t&=~(T|x));var j=[e,t,n,B,C,M,L,S,u,P],q=Ln.apply(R,j);return tr(e)&&zs(q,j),q.placeholder=w,q}}var U=f?n:this,k=d?U[e]:e;return a&&(E=ur(E,a)),p&&u<E.length&&(E.length=u),this&&this!==Je&&this instanceof l&&(k=y||gn(e)),k.apply(U,E)}var p=t&C,f=t&T,d=t&x,h=t&S,_=t&A,g=t&P,y=d?R:gn(e);return l}function Bn(e,t,n){var r=e.length;if(t=+t,r>=t||!vs(t))return"";var o=t-r;return n=null==n?" ":n+"",gi(n,ms(o/n.length)).slice(0,o)}function Mn(e,t,n,r){function o(){for(var t=-1,a=arguments.length,u=-1,c=r.length,l=Di(c+a);++u<c;)l[u]=r[u];for(;a--;)l[u++]=arguments[++t];return(this&&this!==Je&&this instanceof o?s:e).apply(i?n:this,l)}var i=t&T,s=gn(e);return o}function jn(e){var t=Hi[e];return function(e,n){return n=n===R?0:+n||0,n?(n=cs(10,n),t(e*n)/n):t(e)}}function qn(e){return function(t,n,r,o){var i=Dn(r);return null==r&&i===vt?rn(t,n,e):on(t,n,i(r,o,1),e)}}function Un(e,t,n,r,o,i,s,a){var u=t&x;if(!u&&"function"!=typeof e)throw new Ji(N);var c=r?r.length:0;if(c||(t&=~(I|O),r=o=R),c-=o?o.length:0,t&O){var l=r,p=o;r=o=R}var f=u?R:Ds(e),d=[e,t,n,r,o,l,p,i,s,a];if(f&&(or(d,f),t=d[1],a=d[9]),d[9]=null==a?u?0:e.length:Rs(a-c,0)||0,t==T)var h=hn(d[0],d[2]);else h=t!=I&&t!=(T|I)||d[4].length?Ln.apply(R,d):Mn.apply(R,d);return(f?Ns:zs)(h,d)}function kn(e,t,n,r,o,i,s){var a=-1,u=e.length,c=t.length;if(u!=c&&!(o&&c>u))return!1;for(;++a<u;){var l=e[a],p=t[a],f=r?r(o?p:l,o?l:p,a):R;if(f!==R){if(f)continue;return!1}if(o){if(!ft(t,function(e){return l===e||n(l,e,r,o,i,s)}))return!1}else if(l!==p&&!n(l,p,r,o,i,s))return!1}return!0}function Fn(e,t,n){switch(n){case V:case H:return+e==+t;case W:return e.name==t.name&&e.message==t.message;case K:return e!=+e?t!=+t:e==+t;case J:case X:return e==t+""}return!1}function Nn(e,t,n,r,o,i,s){var a=Na(e),u=a.length;if(u!=Na(t).length&&!o)return!1;for(var c=u;c--;){var l=a[c];if(!(o?l in t:ts.call(t,l)))return!1}for(var p=o;++c<u;){l=a[c];var f=e[l],d=t[l],h=r?r(o?d:f,o?f:d,l):R;if(!(h===R?n(f,d,r,o,i,s):h))return!1;p||(p="constructor"==l)}if(!p){var _=e.constructor,m=t.constructor;if(_!=m&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof m&&m instanceof m))return!1}return!0}function Dn(e,t,n){var r=ke.callback||Ai;return r=r===Ai?vt:r,n?r(e,t,n):r}function Gn(e){for(var t=e.name+"",n=Ms[t],r=n?n.length:0;r--;){var o=n[r],i=o.func;if(null==i||i==e)return o.name}return t}function zn(e,t,r){var o=ke.indexOf||Tr;return o=o===Tr?n:o,e?o(e,t,r):o}function Vn(e){for(var t=ni(e),n=t.length;n--;)t[n][2]=rr(t[n][1]);return t}function Hn(e,t){var n=null==e?R:e[t];return ko(n)?n:R}function Wn(e,t,n){for(var r=-1,o=n.length;++r<o;){var i=n[r],s=i.size;switch(i.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=ws(t,e+s);break;case"takeRight":e=Rs(e,t-s)}}return{start:e,end:t}}function Qn(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&ts.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Kn(e){var t=e.constructor;return"function"==typeof t&&t instanceof t||(t=Qi),new t}function Yn(e,t,n){var r=e.constructor;switch(t){case $:return an(e);case V:case H:return new r(+e);case Z:case ee:case te:case ne:case re:case oe:case ie:case se:case ae:var o=e.buffer;return new r(n?an(o):o,e.byteOffset,e.length);case K:case X:return new r(e);case J:var i=new r(e.source,Ae.exec(e));i.lastIndex=e.lastIndex}return i}function Jn(e,t,n){null==e||er(t,e)||(t=fr(t),e=1==t.length?e:Mt(e,Kt(t,0,-1)),t=Ar(t));var r=null==e?e:e[t];return null==r?R:r.apply(e,n)}function Xn(e){return null!=e&&nr(Gs(e))}function $n(e,t){return e="number"==typeof e||Ie.test(e)?+e:-1,t=null==t?Ls:t,e>-1&&e%1==0&&e<t}function Zn(e,t,n){if(!jo(n))return!1;var r=typeof t;if("number"==r?Xn(n)&&$n(t,n.length):"string"==r&&t in n){var o=n[t];return e===e?e===o:o!==o}return!1}function er(e,t){var n=typeof e;return!!("string"==n&&be.test(e)||"number"==n)||!Ia(e)&&(!ye.test(e)||null!=t&&e in pr(t))}function tr(e){var t=Gn(e),n=ke[t];if("function"!=typeof n||!(t in De.prototype))return!1;if(e===n)return!0;var r=Ds(n);return!!r&&e===r[0]}function nr(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Ls}function rr(e){return e===e&&!jo(e)}function or(e,t){var n=e[1],r=t[1],o=n|r,i=o<C,s=r==C&&n==S||r==C&&n==L&&e[7].length<=t[8]||r==(C|L)&&n==S;if(!i&&!s)return e;r&T&&(e[2]=t[2],o|=n&T?0:A);var a=t[3];if(a){var u=e[3];e[3]=u?un(u,a,t[4]):nt(a),e[4]=u?m(e[3],D):nt(t[4])}return a=t[5],a&&(u=e[5],e[5]=u?cn(u,a,t[6]):nt(a),e[6]=u?m(e[5],D):nt(t[6])),a=t[7],a&&(e[7]=nt(a)),r&C&&(e[8]=null==e[8]?t[8]:ws(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=o,e}function ir(e,t){return e===R?t:Oa(e,t,ir)}function sr(e,t){e=pr(e);for(var n=-1,r=t.length,o={};++n<r;){var i=t[n];i in e&&(o[i]=e[i])}return o}function ar(e,t){var n={};return Ot(e,function(e,r,o){t(e,r,o)&&(n[r]=e)}),n}function ur(e,t){for(var n=e.length,r=ws(t.length,n),o=nt(e);r--;){var i=t[r];e[r]=$n(i,n)?o[i]:R}return e}function cr(e){
for(var t=ti(e),n=t.length,r=n&&e.length,o=!!r&&nr(r)&&(Ia(e)||Ao(e)),i=-1,s=[];++i<n;){var a=t[i];(o&&$n(a,r)||ts.call(e,a))&&s.push(a)}return s}function lr(e){return null==e?[]:Xn(e)?jo(e)?e:Qi(e):si(e)}function pr(e){return jo(e)?e:Qi(e)}function fr(e){if(Ia(e))return e;var t=[];return o(e).replace(ve,function(e,n,r,o){t.push(r?o.replace(Te,"$1"):n||e)}),t}function dr(e){return e instanceof De?e.clone():new Ne(e.__wrapped__,e.__chain__,nt(e.__actions__))}function hr(e,t,n){t=(n?Zn(e,t,n):null==t)?1:Rs(ys(t)||1,1);for(var r=0,o=e?e.length:0,i=-1,s=Di(ms(o/t));r<o;)s[++i]=Kt(e,r,r+=t);return s}function _r(e){for(var t=-1,n=e?e.length:0,r=-1,o=[];++t<n;){var i=e[t];i&&(o[++r]=i)}return o}function mr(e,t,n){return(e?e.length:0)?((n?Zn(e,t,n):null==t)&&(t=1),Kt(e,t<0?0:t)):[]}function gr(e,t,n){var r=e?e.length:0;return r?((n?Zn(e,t,n):null==t)&&(t=1),t=r-(+t||0),Kt(e,0,t<0?0:t)):[]}function yr(e,t,n){return e&&e.length?tn(e,Dn(t,n,3),!0,!0):[]}function br(e,t,n){return e&&e.length?tn(e,Dn(t,n,3),!0):[]}function vr(e,t,n,r){var o=e?e.length:0;return o?(n&&"number"!=typeof n&&Zn(e,t,n)&&(n=0,r=o),At(e,t,n,r)):[]}function Er(e){return e?e[0]:R}function Rr(e,t,n){var r=e?e.length:0;return n&&Zn(e,t,n)&&(t=!1),r?It(e,t):[]}function wr(e){return(e?e.length:0)?It(e,!0):[]}function Tr(e,t,r){var o=e?e.length:0;if(!o)return-1;if("number"==typeof r)r=r<0?Rs(o+r,0):r;else if(r){var i=rn(e,t);return i<o&&(t===t?t===e[i]:e[i]!==e[i])?i:-1}return n(e,t,r||0)}function xr(e){return gr(e,1)}function Ar(e){var t=e?e.length:0;return t?e[t-1]:R}function Sr(e,t,n){var r=e?e.length:0;if(!r)return-1;var o=r;if("number"==typeof n)o=(n<0?Rs(r+n,0):ws(n||0,r-1))+1;else if(n){o=rn(e,t,!0)-1;var i=e[o];return(t===t?t===i:i!==i)?o:-1}if(t!==t)return d(e,o,!0);for(;o--;)if(e[o]===t)return o;return-1}function Pr(){var e=arguments,t=e[0];if(!t||!t.length)return t;for(var n=0,r=zn(),o=e.length;++n<o;)for(var i=0,s=e[n];(i=r(t,s,i))>-1;)ds.call(t,i,1);return t}function Ir(e,t,n){var r=[];if(!e||!e.length)return r;var o=-1,i=[],s=e.length;for(t=Dn(t,n,3);++o<s;){var a=e[o];t(a,o,e)&&(r.push(a),i.push(o))}return Ht(e,i),r}function Or(e){return mr(e,1)}function Cr(e,t,n){var r=e?e.length:0;return r?(n&&"number"!=typeof n&&Zn(e,t,n)&&(t=0,n=r),Kt(e,t,n)):[]}function Lr(e,t,n){return(e?e.length:0)?((n?Zn(e,t,n):null==t)&&(t=1),Kt(e,0,t<0?0:t)):[]}function Br(e,t,n){var r=e?e.length:0;return r?((n?Zn(e,t,n):null==t)&&(t=1),t=r-(+t||0),Kt(e,t<0?0:t)):[]}function Mr(e,t,n){return e&&e.length?tn(e,Dn(t,n,3),!1,!0):[]}function jr(e,t,n){return e&&e.length?tn(e,Dn(t,n,3)):[]}function qr(e,t,r,o){if(!(e?e.length:0))return[];null!=t&&"boolean"!=typeof t&&(o=r,r=Zn(e,t,o)?R:t,t=!1);var i=Dn();return null==r&&i===vt||(r=i(r,o,3)),t&&zn()===n?g(e,r):Zt(e,r)}function Ur(e){if(!e||!e.length)return[];var t=-1,n=0;e=at(e,function(e){if(Xn(e))return n=Rs(e.length,n),!0});for(var r=Di(n);++t<n;)r[t]=ut(e,zt(t));return r}function kr(e,t,n){if(!(e?e.length:0))return[];var r=Ur(e);return null==t?r:(t=sn(t,n,4),ut(r,function(e){return lt(e,t,R,!0)}))}function Fr(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(Xn(n))var r=r?ct(wt(r,n),wt(n,r)):n}return r?Zt(r):[]}function Nr(e,t){var n=-1,r=e?e.length:0,o={};for(!r||t||Ia(e[0])||(t=[]);++n<r;){var i=e[n];t?o[i]=t[n]:i&&(o[i[0]]=i[1])}return o}function Dr(e){var t=ke(e);return t.__chain__=!0,t}function Gr(e,t,n){return t.call(n,e),e}function zr(e,t,n){return t.call(n,e)}function Vr(){return Dr(this)}function Hr(){return new Ne(this.value(),this.__chain__)}function Wr(e){for(var t,n=this;n instanceof Fe;){var r=dr(n);t?o.__wrapped__=r:t=r;var o=r;n=n.__wrapped__}return o.__wrapped__=e,t}function Qr(){var e=this.__wrapped__,t=function(e){return e.reverse()};if(e instanceof De){var n=e;return this.__actions__.length&&(n=new De(this)),n=n.reverse(),n.__actions__.push({func:zr,args:[t],thisArg:R}),new Ne(n,this.__chain__)}return this.thru(t)}function Kr(){return this.value()+""}function Yr(){return nn(this.__wrapped__,this.__actions__)}function Jr(e,t,n){var r=Ia(e)?it:Tt;return n&&Zn(e,t,n)&&(t=R),"function"==typeof t&&n===R||(t=Dn(t,n,3)),r(e,t)}function Xr(e,t,n){var r=Ia(e)?at:St;return t=Dn(t,n,3),r(e,t)}function $r(e,t){return oa(e,Ft(t))}function Zr(e,t,n,r){var o=e?Gs(e):0;return nr(o)||(e=si(e),o=e.length),n="number"!=typeof n||r&&Zn(t,n,r)?0:n<0?Rs(o+n,0):n||0,"string"==typeof e||!Ia(e)&&zo(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&zn(e,t,n)>-1}function eo(e,t,n){var r=Ia(e)?ut:kt;return t=Dn(t,n,3),r(e,t)}function to(e,t){return eo(e,Mi(t))}function no(e,t,n){var r=Ia(e)?at:St;return t=Dn(t,n,3),r(e,function(e,n,r){return!t(e,n,r)})}function ro(e,t,n){if(n?Zn(e,t,n):null==t){e=lr(e);var r=e.length;return r>0?e[Wt(0,r-1)]:R}var o=-1,i=Ko(e),r=i.length,s=r-1;for(t=ws(t<0?0:+t||0,r);++o<t;){var a=Wt(o,s),u=i[a];i[a]=i[o],i[o]=u}return i.length=t,i}function oo(e){return ro(e,Ps)}function io(e){var t=e?Gs(e):0;return nr(t)?t:Na(e).length}function so(e,t,n){var r=Ia(e)?ft:Yt;return n&&Zn(e,t,n)&&(t=R),"function"==typeof t&&n===R||(t=Dn(t,n,3)),r(e,t)}function ao(e,t,n){if(null==e)return[];n&&Zn(e,t,n)&&(t=R);var r=-1;return t=Dn(t,n,3),Jt(kt(e,function(e,n,o){return{criteria:t(e,n,o),index:++r,value:e}}),a)}function uo(e,t,n,r){return null==e?[]:(r&&Zn(t,n,r)&&(n=R),Ia(t)||(t=null==t?[]:[t]),Ia(n)||(n=null==n?[]:[n]),Xt(e,t,n))}function co(e,t){return Xr(e,Ft(t))}function lo(e,t){if("function"!=typeof t){if("function"!=typeof e)throw new Ji(N);var n=e;e=t,t=n}return e=vs(e=+e)?e:0,function(){if(--e<1)return t.apply(this,arguments)}}function po(e,t,n){return n&&Zn(e,t,n)&&(t=R),t=e&&null==t?e.length:Rs(+t||0,0),Un(e,C,R,R,R,R,t)}function fo(e,t){var n;if("function"!=typeof t){if("function"!=typeof e)throw new Ji(N);var r=e;e=t,t=r}return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=R),n}}function ho(e,t,n){function r(){d&&as(d),c&&as(c),_=0,c=d=h=R}function o(t,n){n&&as(n),c=d=h=R,t&&(_=_a(),l=e.apply(f,u),d||c||(u=f=R))}function i(){var e=t-(_a()-p);e<=0||e>t?o(h,c):d=fs(i,e)}function s(){o(g,d)}function a(){if(u=arguments,p=_a(),f=this,h=g&&(d||!y),!1===m)var n=y&&!d;else{c||y||(_=p);var r=m-(p-_),o=r<=0||r>m;o?(c&&(c=as(c)),_=p,l=e.apply(f,u)):c||(c=fs(s,r))}return o&&d?d=as(d):d||t===m||(d=fs(i,t)),n&&(o=!0,l=e.apply(f,u)),!o||d||c||(u=f=R),l}var u,c,l,p,f,d,h,_=0,m=!1,g=!0;if("function"!=typeof e)throw new Ji(N);if(t=t<0?0:+t||0,!0===n){var y=!0;g=!1}else jo(n)&&(y=!!n.leading,m="maxWait"in n&&Rs(+n.maxWait||0,t),g="trailing"in n?!!n.trailing:g);return a.cancel=r,a}function _o(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new Ji(N);var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var s=e.apply(this,r);return n.cache=i.set(o,s),s};return n.cache=new _o.Cache,n}function mo(e){if("function"!=typeof e)throw new Ji(N);return function(){return!e.apply(this,arguments)}}function go(e){return fo(2,e)}function yo(e,t){if("function"!=typeof e)throw new Ji(N);return t=Rs(t===R?e.length-1:+t||0,0),function(){for(var n=arguments,r=-1,o=Rs(n.length-t,0),i=Di(o);++r<o;)i[r]=n[t+r];switch(t){case 0:return e.call(this,i);case 1:return e.call(this,n[0],i);case 2:return e.call(this,n[0],n[1],i)}var s=Di(t+1);for(r=-1;++r<t;)s[r]=n[r];return s[t]=i,e.apply(this,s)}}function bo(e){if("function"!=typeof e)throw new Ji(N);return function(t){return e.apply(this,t)}}function vo(e,t,n){var r=!0,o=!0;if("function"!=typeof e)throw new Ji(N);return!1===n?r=!1:jo(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),ho(e,t,{leading:r,maxWait:+t,trailing:o})}function Eo(e,t){return t=null==t?Pi:t,Un(t,I,R,[e],[])}function Ro(e,t,n,r){return t&&"boolean"!=typeof t&&Zn(e,t,n)?t=!1:"function"==typeof t&&(r=n,n=t,t=!1),"function"==typeof n?Et(e,t,sn(n,r,3)):Et(e,t)}function wo(e,t,n){return"function"==typeof t?Et(e,!0,sn(t,n,3)):Et(e,!0)}function To(e,t){return e>t}function xo(e,t){return e>=t}function Ao(e){return h(e)&&Xn(e)&&ts.call(e,"callee")&&!ls.call(e,"callee")}function So(e){return!0===e||!1===e||h(e)&&rs.call(e)==V}function Po(e){return h(e)&&rs.call(e)==H}function Io(e){return!!e&&1===e.nodeType&&h(e)&&!Do(e)}function Oo(e){return null==e||(Xn(e)&&(Ia(e)||zo(e)||Ao(e)||h(e)&&Mo(e.splice))?!e.length:!Na(e).length)}function Co(e,t,n,r){n="function"==typeof n?sn(n,r,3):R;var o=n?n(e,t):R;return o===R?jt(e,t,n):!!o}function Lo(e){return h(e)&&"string"==typeof e.message&&rs.call(e)==W}function Bo(e){return"number"==typeof e&&vs(e)}function Mo(e){return jo(e)&&rs.call(e)==Q}function jo(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function qo(e,t,n,r){return n="function"==typeof n?sn(n,r,3):R,Ut(e,Vn(t),n)}function Uo(e){return No(e)&&e!=+e}function ko(e){return null!=e&&(Mo(e)?is.test(es.call(e)):h(e)&&Pe.test(e))}function Fo(e){return null===e}function No(e){return"number"==typeof e||h(e)&&rs.call(e)==K}function Do(e){var t;if(!h(e)||rs.call(e)!=Y||Ao(e)||!ts.call(e,"constructor")&&"function"==typeof(t=e.constructor)&&!(t instanceof t))return!1;var n;return Ot(e,function(e,t){n=t}),n===R||ts.call(e,n)}function Go(e){return jo(e)&&rs.call(e)==J}function zo(e){return"string"==typeof e||h(e)&&rs.call(e)==X}function Vo(e){return h(e)&&nr(e.length)&&!!qe[rs.call(e)]}function Ho(e){return e===R}function Wo(e,t){return e<t}function Qo(e,t){return e<=t}function Ko(e){var t=e?Gs(e):0;return nr(t)?t?nt(e):[]:si(e)}function Yo(e){return bt(e,ti(e))}function Jo(e,t,n){var r=js(e);return n&&Zn(e,t,n)&&(t=R),t?gt(r,t):r}function Xo(e){return Bt(e,ti(e))}function $o(e,t,n){var r=null==e?R:Mt(e,fr(t),t+"");return r===R?n:r}function Zo(e,t){if(null==e)return!1;var n=ts.call(e,t);if(!n&&!er(t)){if(t=fr(t),null==(e=1==t.length?e:Mt(e,Kt(t,0,-1))))return!1;t=Ar(t),n=ts.call(e,t)}return n||nr(e.length)&&$n(t,e.length)&&(Ia(e)||Ao(e))}function ei(e,t,n){n&&Zn(e,t,n)&&(t=R);for(var r=-1,o=Na(e),i=o.length,s={};++r<i;){var a=o[r],u=e[a];t?ts.call(s,u)?s[u].push(a):s[u]=[a]:s[u]=a}return s}function ti(e){if(null==e)return[];jo(e)||(e=Qi(e));var t=e.length;t=t&&nr(t)&&(Ia(e)||Ao(e))&&t||0;for(var n=e.constructor,r=-1,o="function"==typeof n&&n.prototype===e,i=Di(t),s=t>0;++r<t;)i[r]=r+"";for(var a in e)s&&$n(a,t)||"constructor"==a&&(o||!ts.call(e,a))||i.push(a);return i}function ni(e){e=pr(e);for(var t=-1,n=Na(e),r=n.length,o=Di(r);++t<r;){var i=n[t];o[t]=[i,e[i]]}return o}function ri(e,t,n){var r=null==e?R:e[t];return r===R&&(null==e||er(t,e)||(t=fr(t),e=1==t.length?e:Mt(e,Kt(t,0,-1)),r=null==e?R:e[Ar(t)]),r=r===R?n:r),Mo(r)?r.call(e):r}function oi(e,t,n){if(null==e)return e;var r=t+"";t=null!=e[r]||er(t,e)?[r]:fr(t);for(var o=-1,i=t.length,s=i-1,a=e;null!=a&&++o<i;){var u=t[o];jo(a)&&(o==s?a[u]=n:null==a[u]&&(a[u]=$n(t[o+1])?[]:{})),a=a[u]}return e}function ii(e,t,n,r){var o=Ia(e)||Vo(e);if(t=Dn(t,r,4),null==n)if(o||jo(e)){var i=e.constructor;n=o?Ia(e)?new i:[]:js(Mo(i)?i.prototype:R)}else n={};return(o?rt:Ct)(e,function(e,r,o){return t(n,e,r,o)}),n}function si(e){return en(e,Na(e))}function ai(e){return en(e,ti(e))}function ui(e,t,n){return t=+t||0,n===R?(n=t,t=0):n=+n||0,e>=ws(t,n)&&e<Rs(t,n)}function ci(e,t,n){n&&Zn(e,t,n)&&(t=n=R);var r=null==e,o=null==t;if(null==n&&(o&&"boolean"==typeof e?(n=e,e=1):"boolean"==typeof t&&(n=t,o=!0)),r&&o&&(t=1,o=!1),e=+e||0,o?(t=e,e=0):t=+t||0,n||e%1||t%1){var i=As();return ws(e+i*(t-e+us("1e-"+((i+"").length-1))),t)}return Wt(e,t)}function li(e){return(e=o(e))&&e.charAt(0).toUpperCase()+e.slice(1)}function pi(e){return(e=o(e))&&e.replace(Oe,c).replace(we,"")}function fi(e,t,n){e=o(e),t+="";var r=e.length;return n=n===R?r:ws(n<0?0:+n||0,r),(n-=t.length)>=0&&e.indexOf(t,n)==n}function di(e){return e=o(e),e&&he.test(e)?e.replace(fe,l):e}function hi(e){return e=o(e),e&&Re.test(e)?e.replace(Ee,p):e||"(?:)"}function _i(e,t,n){e=o(e),t=+t;var r=e.length;if(r>=t||!vs(t))return e;var i=(t-r)/2,s=ys(i);return n=Bn("",ms(i),n),n.slice(0,s)+e+n}function mi(e,t,n){return(n?Zn(e,t,n):null==t)?t=0:t&&(t=+t),e=vi(e),xs(e,t||(Se.test(e)?16:10))}function gi(e,t){var n="";if(e=o(e),(t=+t)<1||!e||!vs(t))return n;do{t%2&&(n+=e),t=ys(t/2),e+=e}while(t);return n}function yi(e,t,n){return e=o(e),n=null==n?0:ws(n<0?0:+n||0,e.length),e.lastIndexOf(t,n)==n}function bi(e,t,n){var r=ke.templateSettings;n&&Zn(e,t,n)&&(t=n=R),e=o(e),t=mt(gt({},n||t),r,_t);var i,s,a=mt(gt({},t.imports),r.imports,_t),u=Na(a),c=en(a,u),l=0,p=t.interpolate||Ce,d="__p += '",h=Ki((t.escape||Ce).source+"|"+p.source+"|"+(p===ge?xe:Ce).source+"|"+(t.evaluate||Ce).source+"|$","g"),_="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++je+"]")+"\n";e.replace(h,function(t,n,r,o,a,u){return r||(r=o),d+=e.slice(l,u).replace(Le,f),n&&(i=!0,d+="' +\n__e("+n+") +\n'"),a&&(s=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=u+t.length,t}),d+="';\n";var m=t.variable;m||(d="with (obj) {\n"+d+"\n}\n"),d=(s?d.replace(ue,""):d).replace(ce,"$1").replace(le,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Xa(function(){return Vi(u,_+"return "+d).apply(R,c)});if(g.source=d,Lo(g))throw g;return g}function vi(e,t,n){var r=e;return(e=o(e))?(n?Zn(r,t,n):null==t)?e.slice(y(e),b(e)+1):(t+="",e.slice(i(e,t),s(e,t)+1)):e}function Ei(e,t,n){var r=e;return e=o(e),e?(n?Zn(r,t,n):null==t)?e.slice(y(e)):e.slice(i(e,t+"")):e}function Ri(e,t,n){var r=e;return e=o(e),e?(n?Zn(r,t,n):null==t)?e.slice(0,b(e)+1):e.slice(0,s(e,t+"")+1):e}function wi(e,t,n){n&&Zn(e,t,n)&&(t=R);var r=B,i=M;if(null!=t)if(jo(t)){var s="separator"in t?t.separator:s;r="length"in t?+t.length||0:r,i="omission"in t?o(t.omission):i}else r=+t||0;if(e=o(e),r>=e.length)return e;var a=r-i.length;if(a<1)return i;var u=e.slice(0,a);if(null==s)return u+i;if(Go(s)){if(e.slice(a).search(s)){var c,l,p=e.slice(0,a);for(s.global||(s=Ki(s.source,(Ae.exec(s)||"")+"g")),s.lastIndex=0;c=s.exec(p);)l=c.index;u=u.slice(0,null==l?a:l)}}else if(e.indexOf(s,a)!=a){var f=u.lastIndexOf(s);f>-1&&(u=u.slice(0,f))}return u+i}function Ti(e){return e=o(e),e&&de.test(e)?e.replace(pe,v):e}function xi(e,t,n){return n&&Zn(e,t,n)&&(t=R),e=o(e),e.match(t||Be)||[]}function Ai(e,t,n){return n&&Zn(e,t,n)&&(t=R),h(e)?Ii(e):vt(e,t)}function Si(e){return function(){return e}}function Pi(e){return e}function Ii(e){return Ft(Et(e,!0))}function Oi(e,t){return Nt(e,Et(t,!0))}function Ci(e,t,n){if(null==n){var r=jo(t),o=r?Na(t):R,i=o&&o.length?Bt(t,o):R;(i?i.length:r)||(i=!1,n=t,t=e,e=this)}i||(i=Bt(t,Na(t)));var s=!0,a=-1,u=Mo(e),c=i.length;!1===n?s=!1:jo(n)&&"chain"in n&&(s=n.chain);for(;++a<c;){var l=i[a],p=t[l];e[l]=p,u&&(e.prototype[l]=function(t){return function(){var n=this.__chain__;if(s||n){var r=e(this.__wrapped__);return(r.__actions__=nt(this.__actions__)).push({func:t,args:arguments,thisArg:e}),r.__chain__=n,r}return t.apply(e,ct([this.value()],arguments))}}(p))}return e}function Li(){return Je._=os,this}function Bi(){}function Mi(e){return er(e)?zt(e):Vt(e)}function ji(e){return function(t){return Mt(e,fr(t),t+"")}}function qi(e,t,n){n&&Zn(e,t,n)&&(t=n=R),e=+e||0,n=null==n?1:+n||0,null==t?(t=e,e=0):t=+t||0;for(var r=-1,o=Rs(ms((t-e)/(n||1)),0),i=Di(o);++r<o;)i[r]=e,e+=n;return i}function Ui(e,t,n){if((e=ys(e))<1||!vs(e))return[];var r=-1,o=Di(ws(e,Is));for(t=sn(t,n,1);++r<e;)r<Is?o[r]=t(r):t(r);return o}function ki(e){var t=++ns;return o(e)+t}function Fi(e,t){return(+e||0)+(+t||0)}function Ni(e,t,n){return n&&Zn(e,t,n)&&(t=R),t=Dn(t,n,3),1==t.length?dt(Ia(e)?e:lr(e),t):$t(e,t)}_=_?Xe.defaults(Je.Object(),_,Xe.pick(Je,Me)):Je;var Di=_.Array,Gi=_.Date,zi=_.Error,Vi=_.Function,Hi=_.Math,Wi=_.Number,Qi=_.Object,Ki=_.RegExp,Yi=_.String,Ji=_.TypeError,Xi=Di.prototype,$i=Qi.prototype,Zi=Yi.prototype,es=Vi.prototype.toString,ts=$i.hasOwnProperty,ns=0,rs=$i.toString,os=Je._,is=Ki("^"+es.call(ts).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ss=_.ArrayBuffer,as=_.clearTimeout,us=_.parseFloat,cs=Hi.pow,ls=$i.propertyIsEnumerable,ps=Hn(_,"Set"),fs=_.setTimeout,ds=Xi.splice,hs=_.Uint8Array,_s=Hn(_,"WeakMap"),ms=Hi.ceil,gs=Hn(Qi,"create"),ys=Hi.floor,bs=Hn(Di,"isArray"),vs=_.isFinite,Es=Hn(Qi,"keys"),Rs=Hi.max,ws=Hi.min,Ts=Hn(Gi,"now"),xs=_.parseInt,As=Hi.random,Ss=Wi.NEGATIVE_INFINITY,Ps=Wi.POSITIVE_INFINITY,Is=4294967295,Os=Is-1,Cs=Is>>>1,Ls=9007199254740991,Bs=_s&&new _s,Ms={};ke.support={};ke.templateSettings={escape:_e,evaluate:me,interpolate:ge,variable:"",imports:{_:ke}};var js=function(){function e(){}return function(t){if(jo(t)){e.prototype=t;var n=new e;e.prototype=R}return n||{}}}(),qs=fn(Ct),Us=fn(Lt,!0),ks=dn(),Fs=dn(!0),Ns=Bs?function(e,t){return Bs.set(e,t),e}:Pi,Ds=Bs?function(e){return Bs.get(e)}:Bi,Gs=zt("length"),zs=function(){var e=0,t=0;return function(n,r){var o=_a(),i=q-(o-t);if(t=o,i>0){if(++e>=j)return n}else e=0;return Ns(n,r)}}(),Vs=yo(function(e,t){return h(e)&&Xn(e)?wt(e,It(t,!1,!0)):[]}),Hs=Rn(),Ws=Rn(!0),Qs=yo(function(e){for(var t=e.length,r=t,o=Di(p),i=zn(),s=i===n,a=[];r--;){var u=e[r]=Xn(u=e[r])?u:[];o[r]=s&&u.length>=120?_n(r&&u):null}var c=e[0],l=-1,p=c?c.length:0,f=o[0];e:for(;++l<p;)if(u=c[l],(f?Ze(f,u):i(a,u,0))<0){for(var r=t;--r;){var d=o[r];if((d?Ze(d,u):i(e[r],u,0))<0)continue e}f&&f.push(u),a.push(u)}return a}),Ks=yo(function(t,n){n=It(n);var r=yt(t,n);return Ht(t,n.sort(e)),r}),Ys=qn(),Js=qn(!0),Xs=yo(function(e){return Zt(It(e,!1,!0))}),$s=yo(function(e,t){return Xn(e)?wt(e,t):[]}),Zs=yo(Ur),ea=yo(function(e){var t=e.length,n=t>2?e[t-2]:R,r=t>1?e[t-1]:R;return t>2&&"function"==typeof n?t-=2:(n=t>1&&"function"==typeof r?(--t,r):R,r=R),e.length=t,kr(e,n,r)}),ta=yo(function(e){return e=It(e),this.thru(function(t){return tt(Ia(t)?t:[pr(t)],e)})}),na=yo(function(e,t){return yt(e,It(t))}),ra=ln(function(e,t,n){ts.call(e,n)?++e[n]:e[n]=1}),oa=En(qs),ia=En(Us,!0),sa=xn(rt,qs),aa=xn(ot,Us),ua=ln(function(e,t,n){ts.call(e,n)?e[n].push(t):e[n]=[t]}),ca=ln(function(e,t,n){e[n]=t}),la=yo(function(e,t,n){var r=-1,o="function"==typeof t,i=er(t),s=Xn(e)?Di(e.length):[];return qs(e,function(e){var a=o?t:i&&null!=e?e[t]:R;s[++r]=a?a.apply(e,n):Jn(e,t,n)}),s}),pa=ln(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),fa=Cn(lt,qs),da=Cn(pt,Us),ha=yo(function(e,t){if(null==e)return[];var n=t[2];return n&&Zn(t[0],t[1],n)&&(t.length=1),Xt(e,It(t),[])}),_a=Ts||function(){return(new Gi).getTime()},ma=yo(function(e,t,n){var r=T;if(n.length){var o=m(n,ma.placeholder);r|=I}return Un(e,r,t,n,o)}),ga=yo(function(e,t){t=t.length?It(t):Xo(e);for(var n=-1,r=t.length;++n<r;){var o=t[n];e[o]=Un(e[o],T,e)}return e}),ya=yo(function(e,t,n){var r=T|x;if(n.length){var o=m(n,ya.placeholder);r|=I}return Un(t,r,e,n,o)}),ba=yn(S),va=yn(P),Ea=yo(function(e,t){return Rt(e,1,t)}),Ra=yo(function(e,t,n){return Rt(e,t,n)}),wa=Tn(),Ta=Tn(!0),xa=yo(function(e,t){if(t=It(t),"function"!=typeof e||!it(t,r))throw new Ji(N);var n=t.length;return yo(function(r){for(var o=ws(r.length,n);o--;)r[o]=t[o](r[o]);return e.apply(this,r)})}),Aa=On(I),Sa=On(O),Pa=yo(function(e,t){return Un(e,L,R,R,R,It(t))}),Ia=bs||function(e){return h(e)&&nr(e.length)&&rs.call(e)==z},Oa=pn(Dt),Ca=pn(function(e,t,n){return n?mt(e,t,n):gt(e,t)}),La=bn(Ca,ht),Ba=bn(Oa,ir),Ma=wn(Ct),ja=wn(Lt),qa=An(ks),Ua=An(Fs),ka=Sn(Ct),Fa=Sn(Lt),Na=Es?function(e){var t=null==e?R:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&Xn(e)?cr(e):jo(e)?Es(e):[]}:cr,Da=Pn(!0),Ga=Pn(),za=yo(function(e,t){if(null==e)return{};if("function"!=typeof t[0]){var t=ut(It(t),Yi);return sr(e,wt(ti(e),t))}var n=sn(t[0],t[1],3);return ar(e,function(e,t,r){return!n(e,t,r)})}),Va=yo(function(e,t){return null==e?{}:"function"==typeof t[0]?ar(e,sn(t[0],t[1],3)):sr(e,It(t))}),Ha=mn(function(e,t,n){return t=t.toLowerCase(),e+(n?t.charAt(0).toUpperCase()+t.slice(1):t)}),Wa=mn(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),Qa=In(),Ka=In(!0),Ya=mn(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),Ja=mn(function(e,t,n){return e+(n?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),Xa=yo(function(e,t){try{return e.apply(R,t)}catch(e){return Lo(e)?e:new zi(e)}}),$a=yo(function(e,t){return function(n){return Jn(n,e,t)}}),Za=yo(function(e,t){return function(n){return Jn(e,n,t)}}),eu=jn("ceil"),tu=jn("floor"),nu=vn(To,Ss),ru=vn(Wo,Ps),ou=jn("round");return ke.prototype=Fe.prototype,Ne.prototype=js(Fe.prototype),Ne.prototype.constructor=Ne,De.prototype=js(Fe.prototype),De.prototype.constructor=De,He.prototype.delete=We,He.prototype.get=Qe,He.prototype.has=Ke,He.prototype.set=Ye,$e.prototype.push=et,_o.Cache=He,ke.after=lo,ke.ary=po,ke.assign=Ca,ke.at=na,ke.before=fo,ke.bind=ma,ke.bindAll=ga,ke.bindKey=ya,ke.callback=Ai,ke.chain=Dr,ke.chunk=hr,ke.compact=_r,ke.constant=Si,ke.countBy=ra,ke.create=Jo,ke.curry=ba,ke.curryRight=va,ke.debounce=ho,ke.defaults=La,ke.defaultsDeep=Ba,ke.defer=Ea,ke.delay=Ra,ke.difference=Vs,ke.drop=mr,ke.dropRight=gr,ke.dropRightWhile=yr,ke.dropWhile=br,ke.fill=vr,ke.filter=Xr,ke.flatten=Rr,ke.flattenDeep=wr,ke.flow=wa,ke.flowRight=Ta,ke.forEach=sa,ke.forEachRight=aa,ke.forIn=qa,ke.forInRight=Ua,ke.forOwn=ka,ke.forOwnRight=Fa,ke.functions=Xo,ke.groupBy=ua,ke.indexBy=ca,ke.initial=xr,ke.intersection=Qs,ke.invert=ei,ke.invoke=la,ke.keys=Na,ke.keysIn=ti,ke.map=eo,ke.mapKeys=Da,ke.mapValues=Ga,ke.matches=Ii,ke.matchesProperty=Oi,ke.memoize=_o,ke.merge=Oa,ke.method=$a,ke.methodOf=Za,ke.mixin=Ci,ke.modArgs=xa,ke.negate=mo,ke.omit=za,ke.once=go,ke.pairs=ni,ke.partial=Aa,ke.partialRight=Sa,ke.partition=pa,ke.pick=Va,ke.pluck=to,ke.property=Mi,ke.propertyOf=ji,ke.pull=Pr,ke.pullAt=Ks,ke.range=qi,ke.rearg=Pa,ke.reject=no,ke.remove=Ir,ke.rest=Or,ke.restParam=yo,ke.set=oi,ke.shuffle=oo,ke.slice=Cr,ke.sortBy=ao,ke.sortByAll=ha,ke.sortByOrder=uo,ke.spread=bo,ke.take=Lr,ke.takeRight=Br,ke.takeRightWhile=Mr,ke.takeWhile=jr,ke.tap=Gr,ke.throttle=vo,ke.thru=zr,ke.times=Ui,ke.toArray=Ko,ke.toPlainObject=Yo,ke.transform=ii,ke.union=Xs,ke.uniq=qr,ke.unzip=Ur,ke.unzipWith=kr,ke.values=si,ke.valuesIn=ai,ke.where=co,ke.without=$s,ke.wrap=Eo,ke.xor=Fr,ke.zip=Zs,ke.zipObject=Nr,ke.zipWith=ea,ke.backflow=Ta,ke.collect=eo,ke.compose=Ta,ke.each=sa,ke.eachRight=aa,ke.extend=Ca,ke.iteratee=Ai,ke.methods=Xo,ke.object=Nr,ke.select=Xr,ke.tail=Or,ke.unique=qr,Ci(ke,ke),ke.add=Fi,ke.attempt=Xa,ke.camelCase=Ha,ke.capitalize=li,ke.ceil=eu,ke.clone=Ro,ke.cloneDeep=wo,ke.deburr=pi,ke.endsWith=fi,ke.escape=di,ke.escapeRegExp=hi,ke.every=Jr,ke.find=oa,ke.findIndex=Hs,ke.findKey=Ma,ke.findLast=ia,ke.findLastIndex=Ws,ke.findLastKey=ja,ke.findWhere=$r,ke.first=Er,ke.floor=tu,ke.get=$o,ke.gt=To,ke.gte=xo,ke.has=Zo,ke.identity=Pi,ke.includes=Zr,ke.indexOf=Tr,ke.inRange=ui,ke.isArguments=Ao,ke.isArray=Ia,ke.isBoolean=So,ke.isDate=Po,ke.isElement=Io,ke.isEmpty=Oo,ke.isEqual=Co,ke.isError=Lo,ke.isFinite=Bo,ke.isFunction=Mo,ke.isMatch=qo,ke.isNaN=Uo,ke.isNative=ko,ke.isNull=Fo,ke.isNumber=No,ke.isObject=jo,ke.isPlainObject=Do,ke.isRegExp=Go,ke.isString=zo,ke.isTypedArray=Vo,ke.isUndefined=Ho,ke.kebabCase=Wa,ke.last=Ar,ke.lastIndexOf=Sr,ke.lt=Wo,ke.lte=Qo,ke.max=nu,ke.min=ru,ke.noConflict=Li,ke.noop=Bi,ke.now=_a,ke.pad=_i,ke.padLeft=Qa,ke.padRight=Ka,ke.parseInt=mi,ke.random=ci,ke.reduce=fa,ke.reduceRight=da,ke.repeat=gi,ke.result=ri,ke.round=ou,ke.runInContext=E,ke.size=io,ke.snakeCase=Ya,ke.some=so,ke.sortedIndex=Ys,ke.sortedLastIndex=Js,ke.startCase=Ja,ke.startsWith=yi,ke.sum=Ni,ke.template=bi,ke.trim=vi,ke.trimLeft=Ei,ke.trimRight=Ri,ke.trunc=wi,ke.unescape=Ti,ke.uniqueId=ki,ke.words=xi,ke.all=Jr,ke.any=so,ke.contains=Zr,ke.eq=Co,ke.detect=oa,ke.foldl=fa,ke.foldr=da,ke.head=Er,ke.include=Zr,ke.inject=fa,Ci(ke,function(){var e={};return Ct(ke,function(t,n){ke.prototype[n]||(e[n]=t)}),e}(),!1),ke.sample=ro,ke.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(t){return ro(t,e)}):ro(this.value())},ke.VERSION=w,rt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){ke[e].placeholder=ke}),rt(["drop","take"],function(e,t){De.prototype[e]=function(n){var r=this.__filtered__;if(r&&!t)return new De(this);n=null==n?1:Rs(ys(n)||0,0);var o=this.clone();return r?o.__takeCount__=ws(o.__takeCount__,n):o.__views__.push({size:n,type:e+(o.__dir__<0?"Right":"")}),o},De.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),rt(["filter","map","takeWhile"],function(e,t){var n=t+1,r=n!=F;De.prototype[e]=function(e,t){var o=this.clone();return o.__iteratees__.push({iteratee:Dn(e,t,1),type:n}),o.__filtered__=o.__filtered__||r,o}}),rt(["first","last"],function(e,t){var n="take"+(t?"Right":"");De.prototype[e]=function(){return this[n](1).value()[0]}}),rt(["initial","rest"],function(e,t){var n="drop"+(t?"":"Right");De.prototype[e]=function(){return this.__filtered__?new De(this):this[n](1)}}),rt(["pluck","where"],function(e,t){var n=t?"filter":"map",r=t?Ft:Mi;De.prototype[e]=function(e){return this[n](r(e))}}),De.prototype.compact=function(){return this.filter(Pi)},De.prototype.reject=function(e,t){return e=Dn(e,t,1),this.filter(function(t){return!e(t)})},De.prototype.slice=function(e,t){e=null==e?0:+e||0;var n=this;return n.__filtered__&&(e>0||t<0)?new De(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==R&&(t=+t||0,n=t<0?n.dropRight(-t):n.take(t-e)),n)},De.prototype.takeRightWhile=function(e,t){return this.reverse().takeWhile(e,t).reverse()},De.prototype.toArray=function(){return this.take(Ps)},Ct(De.prototype,function(e,t){var n=/^(?:filter|map|reject)|While$/.test(t),r=/^(?:first|last)$/.test(t),o=ke[r?"take"+("last"==t?"Right":""):t];o&&(ke.prototype[t]=function(){var t=r?[1]:arguments,i=this.__chain__,s=this.__wrapped__,a=!!this.__actions__.length,u=s instanceof De,c=t[0],l=u||Ia(s);l&&n&&"function"==typeof c&&1!=c.length&&(u=l=!1);var p=function(e){return r&&i?o(e,1)[0]:o.apply(R,ct([e],t))},f={func:zr,args:[p],thisArg:R},d=u&&!a;if(r&&!i)return d?(s=s.clone(),s.__actions__.push(f),e.call(s)):o.call(R,this.value())[0];if(!r&&l){s=d?s:new De(this);var h=e.apply(s,t);return h.__actions__.push(f),new Ne(h,i)}return this.thru(p)})}),rt(["join","pop","push","replace","shift","sort","splice","split","unshift"],function(e){var t=(/^(?:replace|split)$/.test(e)?Zi:Xi)[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:join|pop|replace|shift)$/.test(e);ke.prototype[e]=function(){var e=arguments;return r&&!this.__chain__?t.apply(this.value(),e):this[n](function(n){return t.apply(n,e)})}}),Ct(De.prototype,function(e,t){var n=ke[t];if(n){var r=n.name+"";(Ms[r]||(Ms[r]=[])).push({name:t,func:n})}}),Ms[Ln(R,x).name]=[{name:"wrapper",func:R}],De.prototype.clone=Ge,De.prototype.reverse=ze,De.prototype.value=Ve,ke.prototype.chain=Vr,ke.prototype.commit=Hr,ke.prototype.concat=ta,ke.prototype.plant=Wr,ke.prototype.reverse=Qr,ke.prototype.toString=Kr,ke.prototype.run=ke.prototype.toJSON=ke.prototype.valueOf=ke.prototype.value=Yr,ke.prototype.collect=ke.prototype.map,ke.prototype.head=ke.prototype.first,ke.prototype.select=ke.prototype.filter,ke.prototype.tail=ke.prototype.rest,ke}var R,w="3.10.1",T=1,x=2,A=4,S=8,P=16,I=32,O=64,C=128,L=256,B=30,M="...",j=150,q=16,U=200,k=1,F=2,N="Expected a function",D="__lodash_placeholder__",G="[object Arguments]",z="[object Array]",V="[object Boolean]",H="[object Date]",W="[object Error]",Q="[object Function]",K="[object Number]",Y="[object Object]",J="[object RegExp]",X="[object String]",$="[object ArrayBuffer]",Z="[object Float32Array]",ee="[object Float64Array]",te="[object Int8Array]",ne="[object Int16Array]",re="[object Int32Array]",oe="[object Uint8Array]",ie="[object Uint8ClampedArray]",se="[object Uint16Array]",ae="[object Uint32Array]",ue=/\b__p \+= '';/g,ce=/\b(__p \+=) '' \+/g,le=/(__e\(.*?\)|\b__t\)) \+\n'';/g,pe=/&(?:amp|lt|gt|quot|#39|#96);/g,fe=/[&<>"'`]/g,de=RegExp(pe.source),he=RegExp(fe.source),_e=/<%-([\s\S]+?)%>/g,me=/<%([\s\S]+?)%>/g,ge=/<%=([\s\S]+?)%>/g,ye=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,be=/^\w*$/,ve=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,Ee=/^[:!,]|[\\^$.*+?()[\]{}|\/]|(^[0-9a-fA-Fnrtuvx])|([\n\r\u2028\u2029])/g,Re=RegExp(Ee.source),we=/[\u0300-\u036f\ufe20-\ufe23]/g,Te=/\\(\\)?/g,xe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ae=/\w*$/,Se=/^0[xX]/,Pe=/^\[object .+?Constructor\]$/,Ie=/^\d+$/,Oe=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Ce=/($^)/,Le=/['\n\r\u2028\u2029\\]/g,Be=function(){var e="[A-Z\\xc0-\\xd6\\xd8-\\xde]",t="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(e+"+(?="+e+t+")|"+e+"?"+t+"|"+e+"+|[0-9]+","g")}(),Me=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","isFinite","parseFloat","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap"],je=-1,qe={};qe[Z]=qe[ee]=qe[te]=qe[ne]=qe[re]=qe[oe]=qe[ie]=qe[se]=qe[ae]=!0,qe[G]=qe[z]=qe[$]=qe[V]=qe[H]=qe[W]=qe[Q]=qe["[object Map]"]=qe[K]=qe[Y]=qe[J]=qe["[object Set]"]=qe[X]=qe["[object WeakMap]"]=!1;var Ue={};Ue[G]=Ue[z]=Ue[$]=Ue[V]=Ue[H]=Ue[Z]=Ue[ee]=Ue[te]=Ue[ne]=Ue[re]=Ue[K]=Ue[Y]=Ue[J]=Ue[X]=Ue[oe]=Ue[ie]=Ue[se]=Ue[ae]=!0,Ue[W]=Ue[Q]=Ue["[object Map]"]=Ue["[object Set]"]=Ue["[object WeakMap]"]=!1;var ke={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Fe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Ne={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},De={function:!0,object:!0},Ge={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"},ze={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=De[typeof exports]&&exports&&!exports.nodeType&&exports,He=De[typeof module]&&module&&!module.nodeType&&module,We=Ve&&He&&"object"==typeof global&&global&&global.Object&&global,Qe=De[typeof self]&&self&&self.Object&&self,Ke=De[typeof window]&&window&&window.Object&&window,Ye=He&&He.exports===Ve&&Ve,Je=We||Ke!==(this&&this.window)&&Ke||Qe||this,Xe=E();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Je._=Xe,define("lib/lodash",[],function(){return Xe})):Ve&&He?Ye?(He.exports=Xe)._=Xe:Ve._=Xe:Je._=Xe}.call(this),define("ubp/commons/logging/LogLevel",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.OFF=0]="OFF",e[e.FATAL=1]="FATAL",e[e.ERROR=2]="ERROR",e[e.WARN=3]="WARN",e[e.INFO=4]="INFO",e[e.DEBUG=5]="DEBUG",e[e.ALL=6]="ALL"}(n||(n={})),n}),define("ubp/commons/logging/Logger",["require","exports","lib/lodash","./LogLevel"],function(e,t,n,r){"use strict";return function(){function e(t,n){this._appenders={},this._universalContext=[],this._name=t,this._appenders=n||this._appenders,e.root?this._logLevel=e.root._logLevel:this._logLevel=r.ERROR}return e.getLogger=function(t){return new e(t)},e.isMuted=function(t){return e.muted[t]},e.mute=function(t){e.muted[t]=!0},e.unmute=function(t){delete e.muted[t]},e.prototype.setUniversalContext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._universalContext=e},e.prototype.setLogLevel=function(e){this._logLevel=e},e.prototype.addAppender=function(e,t){this._appenders[e]=t},e.prototype.removeAppender=function(e){delete this._appenders[e]},e.prototype.clearAppenders=function(){this._appenders={}},e.prototype._log=function(t,r,o,i){var s=this;if(this._isLevelEnabled(t)&&!e.isMuted(this._name)){
var a=JSON.stringify(i),u=JSON.stringify(n.union(e.root._universalContext,this._universalContext)),c=n.extend({},this._appenders,e.root._appenders);n.each(c,function(e,i){n.isFunction(e.log)&&e.log(t,s._name,r,o,a,u)})}},e.prototype._isLevelEnabled=function(t){return t<=(this._logLevel>e.root._logLevel?this._logLevel:e.root._logLevel)&&e.root._logLevel!==r.OFF&&this._logLevel!==r.OFF},e.prototype.fatal=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];this._log(r.FATAL,e,t,n)},e.prototype.error=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];this._log(r.ERROR,e,t,n)},e.prototype.warn=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];this._log(r.WARN,e,t,n)},e.prototype.info=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];this._log(r.INFO,e,t,n)},e.prototype.debug=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];this._log(r.DEBUG,e,t,n)},e.root=new e("Root"),e.muted={},e}()}),define("ubp/commons/Events/Subscription",["require","exports","../logging/Logger"],function(e,t,n){"use strict";return function(){function e(t,r){this.callback=t,this.context=r,this.disposed=!1,e._Logger=e._Logger||n.getLogger("Subscription")}return e.prototype.matches=function(e,t){return this.callback===e&&this.context===t},e.prototype.notify=function(t){try{this.disposed||this.callback.apply(this.context,t)}catch(t){e._Logger.error("notify","error thrown in callback",t.message)}},e.prototype.dispose=function(){this.disposed=!0},e}()}),define("ubp/commons/Events/EventBucket",["require","exports","lib/lodash","./Subscription"],function(e,t,n,r){"use strict";return function(){function e(){this.subscriptions=[]}return e.prototype.subscriptionExists=function(e,t){return!!n.find(this.subscriptions,function(n){return n.matches(e,t)},this)},e.prototype.subscribe=function(e,t){this.subscriptions.push(new r(e,t))},e.prototype.unsubscribeAll=function(){n.invoke(this.subscriptions,"dispose"),this.subscriptions=[]},e.prototype.unsubscribe=function(e,t){var r=null,o=n.find(this.subscriptions,function(n,o){return!!n.matches(e,t)&&(r=o,!0)},this);o&&(o.dispose(),this.subscriptions.splice(r,1))},e.prototype.notify=function(e){n.invoke(n.clone(this.subscriptions),"notify",e)},e}()}),define("ubp/commons/Events/Events",["require","exports","lib/lodash","./EventBucket"],function(e,t,n,r){"use strict";return function(){function e(){this.eventBuckets={}}return e.prototype.on=function(e,t,n){var r=this.getEventBucket(e);if(r.subscriptionExists(t,n))throw new Error("Cannot register duplicate subscription.");r.subscribe(t,n)},e.prototype.off=function(e,t,n){switch(arguments.length){case 0:this.removeAllSubscriptions();break;case 1:this.getEventBucket(e).unsubscribeAll();break;default:this.getEventBucket(e).unsubscribe(t,n)}},e.prototype.notify=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.getEventBucket(e).notify(t)},e.prototype.getEventBucket=function(e){return this.eventBuckets[e]=this.eventBuckets[e]||new r},e.prototype.removeAllSubscriptions=function(){n.invoke(this.eventBuckets,"unsubscribeAll")},e}()});var factory=function(){"use strict";var e=function(){};return e.getLocalStorageConfiguration=function(){return[{url:"https://horizonte.browserapps.amazon.com/crossdomainlocalstoragereader"}]},e};"undefined"!=typeof module&&module.exports?module.exports=factory():void 0!==define&&define("configuration/LocalStorageConfiguration",[],factory),define("ubp/commons/error/BaseError",["require","exports"],function(e,t){"use strict";return function(){function e(e,t,n,r){this._name=e,this._message=t,this._status=n,this._cause=r||""}return e.prototype.getStatus=function(){return this._status},e.prototype.setStatus=function(e){this._status=e},e.prototype.getMessage=function(){return this._message},e.prototype.setMessage=function(e){this._message=e},e.prototype.getName=function(){return this._name},e.prototype.setName=function(e){this._name=e},e.prototype.getCause=function(){return this._cause},e.prototype.setCause=function(e){this._cause=e},e.prototype.toString=function(){var e=""+this._cause;if("object"==typeof this._cause&&this._cause.toString===Object.prototype.toString)try{e=JSON.stringify(this._cause)}catch(e){}return this._name+": "+this._message+" Status: "+this._status+"; Cause: "+e},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/error/BadRequestError",["require","exports","./BaseError"],function(e,t,n){"use strict";return function(e){function t(t){return e.call(this,"BadRequestError","The request was somehow malformed or missing required arguments.","400",t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/error/ConflictError",["require","exports","./BaseError"],function(e,t,n){"use strict";return function(e){function t(t){return e.call(this,"ConflictError","There was a conflict with the state of the resource.","409",t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/error/FeatureUnavailableError",["require","exports","./BaseError"],function(e,t,n){"use strict";return function(e){function t(t){return e.call(this,"FeatureUnavailableError","The resource is known, but has become unavailable, check if process is still running","503",t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/error/ForbiddenError",["require","exports","./BaseError"],function(e,t,n){"use strict";return function(e){function t(t){return e.call(this,"ForbiddenError","The calling process does not have permission to access to this API","403",t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/error/InternalError",["require","exports","./BaseError"],function(e,t,n){"use strict";return function(e){function t(t){return e.call(this,"InternalError","Something unexpected went wrong while processing the request.","500",t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/error/NotFoundError",["require","exports","./BaseError"],function(e,t,n){"use strict";return function(e){function t(t){return e.call(this,"NotFoundError","The API was never registered by the Platform or any remote process.","404",t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/error/OutOfMemoryError",["require","exports","./BaseError"],function(e,t,n){"use strict";return function(e){function t(t){return e.call(this,"OutOfMemoryError","Not enough memory to support this operation","521",t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/error/RequestTimeoutError",["require","exports","./BaseError"],function(e,t,n){"use strict";return function(e){function t(t){return e.call(this,"RequestTimeoutError","A response was not received before the (specified or default) timeout.","408",t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/error/NoNetworkConnectivityError",["require","exports","./BaseError"],function(e,t,n){"use strict";return function(e){function t(t){return e.call(this,"NoNetworkConnectivityError","There was an error with network connectivity.","470",t)||this}return __extends(t,e),t}(n)}),define("ubp/commons/error/Errors",["require","exports","./BaseError","./BadRequestError","./ConflictError","./FeatureUnavailableError","./ForbiddenError","./InternalError","./NotFoundError","./OutOfMemoryError","./RequestTimeoutError","./NoNetworkConnectivityError"],function(e,t,n,r,o,i,s,a,u,c,l,p){"use strict";var f;return function(e){function t(e,t,n,r){var o;switch(n){case"400":o=this.BadRequest(r);break;case"409":o=this.Conflict(r);break;case"503":o=this.FeatureUnavailable(r);break;case"403":o=this.Forbidden(r);break;case"500":o=this.Internal(r);break;case"404":o=this.NotFound(r);break;case"521":o=this.OutOfMemory(r);break;case"408":o=this.RequestTimeout(r);break;case"470":o=this.NoNetworkConnectivity(r);break;default:o=this.Base(e,t,n,r)}return e&&o.setName(e),t&&o.setMessage(t),o}function f(e,t,r,o){return new n(e,t,r,o)}function d(e){return new r(e)}function h(e){return new o(e)}function _(e){return new i(e)}function m(e){return new s(e)}function g(e){return new a(e)}function y(e){return new u(e)}function b(e){return new c(e)}function v(e){return new l(e)}function E(e){return new p(e)}e.Auto=t,e.Base=f,e.BadRequest=d,e.Conflict=h,e.FeatureUnavailable=_,e.Forbidden=m,e.Internal=g,e.NotFound=y,e.OutOfMemory=b,e.RequestTimeout=v,e.NoNetworkConnectivity=E}(f||(f={})),f});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/BaseRuntime",["require","exports","lib/lodash","lib/bluebird","../../commons/Events/Events","../../commons/logging/Logger","configuration/LocalStorageConfiguration","../../commons/error/Errors"],function(e,t,n,r,o,i,s,a){"use strict";return function(e){function t(){var n=e.call(this)||this;return n.MESSAGE_TIMEOUT=6e4,n.NEW_TAB_TIMEOUT=1e3,n.BADGE_COLOR="#FF5252",n.RUNTIME_EVENT="RuntimeEvent",n.BROWSER_ONLINE_EVENT="onBrowserOnline",n.EXTERNAL_MESSAGE="UBPExternalMessage",n.remoteConfigurationRawDataMap={},t.logger=t.logger||i.getLogger("BaseRuntime"),n}return __extends(t,e),t.prototype.onRuntimeEvent=function(e){this.on(this.RUNTIME_EVENT,e)},t.prototype.unsubscribeRuntimeEvents=function(){this.off(this.RUNTIME_EVENT)},t.prototype.unsubscribeBrowserOnlineEvents=function(){this.off(this.BROWSER_ONLINE_EVENT)},t.prototype._onPageTurn=function(e,n,r,o){t.logger.debug("_onPageTurn","PageTurn event for tabId: "+e+" at url: "+n+" with status: "+r+" with title: "+o),this._isValidUrl(n)&&this.notify(this.RUNTIME_EVENT,{name:"Tabs.PageTurn",eventArgs:{tabId:e,url:n,status:r,title:o}})},t.prototype._onContextMenuClick=function(e){if(this._isValidUrl(e.tabUrl)){var n=e.menuItemId?e.menuItemId.split(".")[0]:"";this.notify(this.RUNTIME_EVENT,{name:t.CONTEXT_MENU_CLICK_RESPONSE_NAME+n,eventArgs:e})}},t.prototype._onTabRemoved=function(e){t.logger.debug("_onTabRemoved","OnTabRemoved event for tabId: "+e),this.notify(this.RUNTIME_EVENT,{name:"Tabs.onRemoved",eventArgs:{tabId:e}})},t.prototype._onExternalMessage=function(e,t){switch(this._determineMessageType(e)){case"Sandbox":e=e.payload,this.notify(this.RUNTIME_EVENT,{name:"Sandbox.Message.".concat(e.mType),eventArgs:n.extend(e,{tabId:t}),tabId:t});break;case"Action":e=e.payload,this.notify(this.RUNTIME_EVENT,{name:"Action.Message",eventArgs:n.extend(e,{tabId:t})})}},t.prototype._determineMessageType=function(e){return e&&e.type&&n.startsWith(e.type,this.EXTERNAL_MESSAGE)&&e.type.replace(this.EXTERNAL_MESSAGE.concat("."),"")},t.prototype._isValidUrl=function(e){return new RegExp("^https?://").test(e)},t.prototype.sendMessageToIFrame=function(e,n){return r.bind(this).then(function(){if(!e)return t.logger.error("sendMessageToIFrame","frame Id is null or empty"),r.reject("child frame Id is null or empty");var o=document.getElementById(e);if(!o)return t.logger.error("sendMessageToIFrame","iFrame with id "+e+" not found"),r.reject("iFrame with id "+e+" not found");var i="*";o.src&&(i=o.src),o.contentWindow.postMessage(n,i)})},t.prototype.setURLForIframe=function(e,n){return r.bind(this).then(function(){if(!e)return t.logger.error("setURLForIframe","frame Id is null or empty"),r.reject("frame Id is null or empty");var o=document.getElementById(e);if(!o)return t.logger.error("setURLForIframe","iFrame with id "+e+" not found"),r.reject("iFrame with id "+e+" not found");o.src=n})},t.prototype.getFromAmazonLocalStorage=function(e){var t,o=this,i=[];return r.bind(this).then(function(){var a=s.getLocalStorageConfiguration(),u=[];return n.each(a,n.bind(function(n){var o=this,s={name:"AmazonLocalStorage",configuration:{url:n.url+"?keys="+e.join(",")}};u.push(new r(function(e){var n=o.createProcessInstance(s,function(n){t=n.payload,e()},{});i.push(n),n.start()}))},o)),r.race(u).timeout(o.MESSAGE_TIMEOUT,"Did not receive local storage message in time")}).finally(function(){n.each(i,n.bind(function(e){this.destroyProcessInstance(e)},o))}).then(function(){return t})},t.prototype.createProcessInstance=function(e,t,n){throw new Error("Not implemented!")},t.prototype.destroyProcessInstance=function(e){throw new Error("Not implemented!")},t.prototype.getExtensionVersion=function(){throw new Error("Not implemented!")},t.prototype.getExtensionResourceURL=function(e){return void 0===e&&(e=""),""},t.prototype.getIFrameAttributes=function(e){return r.bind(this).then(function(){var t={source:""},n=document.getElementById(e);return n&&n.src&&(t.source=n.src),r.resolve(t)})},t.prototype.createDesktopNotification=function(e,t){return r.reject(a.Conflict("createDesktopNotification is not supported for this browser"))},t.prototype.getCookieInfo=function(e,t){return r.reject(a.Conflict("getCookieInfo operation is not supported for this browser"))},t.prototype.bulkGetCookieInfo=function(e,t){return r.reject(a.Conflict("bulkGetCookieInfo operation is not supported for this browser"))},t.prototype.createContextMenuItem=function(e){var t=a.FeatureUnavailable("createContextMenuItem : Operation is not supported for this browser");return r.reject(t)},t.prototype.deleteAllContextMenuItems=function(){var e=a.FeatureUnavailable("deleteAllContextMenuItems : Operation is not supported for this browser");return r.reject(e)},t.prototype.removeTab=function(e){var t=a.FeatureUnavailable("removeTab : Operation is not supported for this browser");return r.reject(t)},t.prototype.isContextMenuApiSupported=function(){return!1},t.prototype.deleteContextMenuItemById=function(e){var t=a.FeatureUnavailable("deleteContextMenuItemById : Operation is not supported for this browser");return r.reject(t)},t.prototype.registerNotificationHandler=function(e){t.logger.info("registerNotificationHandler","Notifications are not supported in this browser")},t.prototype.setRemoteConfigurationRawData=function(e,t){return this.remoteConfigurationRawDataMap[e]=t,r.resolve()},t.prototype.getRemoteConfigurationRawData=function(e){return this.remoteConfigurationRawDataMap[e]},t.prototype.getUAParser=function(){throw new Error("Not implemented!")},t.prototype.getUserAgent=function(){throw new Error("Not implemented!")},t.prototype.getBrowserVersion=function(){return this.getUAParser().parse(this.getUserAgent()).then(function(e){return e.browserVersion})},t.prototype.enableExtensionFeature=function(){return r.resolve(!0)},t.prototype.getBrowserRecSettings=function(e){return t.logger.error("getBrowserRecSettings","This browser does not support getBrowserRecSettings"),r.reject(a.Conflict("This browser does not support getBrowserRecSettings"))},t.prototype.updateBrowserRecSettings=function(e,n){return t.logger.error("updateBrowserRecSettings","This browser does not support updateBrowserRecSettings"),r.reject(a.Conflict("This browser does not support updateBrowserRecSettings"))},t.prototype.registerWhitelist=function(e){return r.resolve()},t.prototype.closePanel=function(){try{window.top.close()}catch(e){t.logger.error("closePanel","Failed to close the panel due to "+e.toString())}},t.prototype.supportAutoCookieSync=function(){return r.resolve(!0)},t.CONTEXT_MENU_CLICK_RESPONSE_NAME="Contextmenu.ItemClicked.",t}(o)}),define("ubp/extension/process/ProcessState",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.NEW=1]="NEW",e[e.STARTING=2]="STARTING",e[e.STABLE=3]="STABLE",e[e.UNRESPONSIVE=4]="UNRESPONSIVE",e[e.TERMINATING=5]="TERMINATING",e[e.TERMINATED=6]="TERMINATED"}(n||(n={})),n}),define("ubp/commons/localization/Locale",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.US=1]="US",e[e.CA=2]="CA",e[e.CN=3]="CN",e[e.JP=4]="JP",e[e.ES=5]="ES",e[e.IT=6]="IT",e[e.FR=7]="FR",e[e.DE=8]="DE",e[e.UK=9]="UK",e[e.IN=10]="IN",e[e.MX=11]="MX",e[e.BR=12]="BR",e[e.AU=13]="AU",e[e.AE=14]="AE",e[e.TR=15]="TR"}(n||(n={})),n}),function(){var e=this,t=e._,n={},r=Array.prototype,o=Object.prototype,i=Function.prototype,s=r.push,a=r.slice,u=r.concat,c=o.toString,l=o.hasOwnProperty,p=r.forEach,f=r.map,d=r.reduce,h=r.reduceRight,_=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,v=Array.isArray,E=Object.keys,R=i.bind,w=function(e){return e instanceof w?e:this instanceof w?void(this._wrapped=e):new w(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):e._=w,w.VERSION="1.6.0";var T=w.each=w.forEach=function(e,t,r){if(null==e)return e;if(p&&e.forEach===p)e.forEach(t,r);else if(e.length===+e.length){for(var o=0,i=e.length;i>o;o++)if(t.call(r,e[o],o,e)===n)return}else for(var s=w.keys(e),o=0,i=s.length;i>o;o++)if(t.call(r,e[s[o]],s[o],e)===n)return;return e};w.map=w.collect=function(e,t,n){var r=[];return null==e?r:f&&e.map===f?e.map(t,n):(T(e,function(e,o,i){r.push(t.call(n,e,o,i))}),r)};var x="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(e,t,n,r){var o=arguments.length>2;if(null==e&&(e=[]),d&&e.reduce===d)return r&&(t=w.bind(t,r)),o?e.reduce(t,n):e.reduce(t);if(T(e,function(e,i,s){o?n=t.call(r,n,e,i,s):(n=e,o=!0)}),!o)throw new TypeError(x);return n},w.reduceRight=w.foldr=function(e,t,n,r){var o=arguments.length>2;if(null==e&&(e=[]),h&&e.reduceRight===h)return r&&(t=w.bind(t,r)),o?e.reduceRight(t,n):e.reduceRight(t);var i=e.length;if(i!==+i){var s=w.keys(e);i=s.length}if(T(e,function(a,u,c){u=s?s[--i]:--i,o?n=t.call(r,n,e[u],u,c):(n=e[u],o=!0)}),!o)throw new TypeError(x);return n},w.find=w.detect=function(e,t,n){var r;return A(e,function(e,o,i){return t.call(n,e,o,i)?(r=e,!0):void 0}),r},w.filter=w.select=function(e,t,n){var r=[];return null==e?r:_&&e.filter===_?e.filter(t,n):(T(e,function(e,o,i){t.call(n,e,o,i)&&r.push(e)}),r)},w.reject=function(e,t,n){return w.filter(e,function(e,r,o){return!t.call(n,e,r,o)},n)},w.every=w.all=function(e,t,r){t||(t=w.identity);var o=!0;return null==e?o:m&&e.every===m?e.every(t,r):(T(e,function(e,i,s){return(o=o&&t.call(r,e,i,s))?void 0:n}),!!o)};var A=w.some=w.any=function(e,t,r){t||(t=w.identity);var o=!1;return null==e?o:g&&e.some===g?e.some(t,r):(T(e,function(e,i,s){return o||(o=t.call(r,e,i,s))?n:void 0}),!!o)};w.contains=w.include=function(e,t){return null!=e&&(y&&e.indexOf===y?-1!=e.indexOf(t):A(e,function(e){return e===t}))},w.invoke=function(e,t){var n=a.call(arguments,2),r=w.isFunction(t);return w.map(e,function(e){return(r?t:e[t]).apply(e,n)})},w.pluck=function(e,t){return w.map(e,w.property(t))},w.where=function(e,t){return w.filter(e,w.matches(t))},w.findWhere=function(e,t){return w.find(e,w.matches(t))},w.max=function(e,t,n){if(!t&&w.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var r=-1/0,o=-1/0;return T(e,function(e,i,s){var a=t?t.call(n,e,i,s):e;a>o&&(r=e,o=a)}),r},w.min=function(e,t,n){if(!t&&w.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var r=1/0,o=1/0;return T(e,function(e,i,s){var a=t?t.call(n,e,i,s):e;o>a&&(r=e,o=a)}),r},w.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=w.random(n++),r[n-1]=r[t],r[t]=e}),r},w.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=w.values(e)),e[w.random(e.length-1)]):w.shuffle(e).slice(0,Math.max(0,t))};var S=function(e){return null==e?w.identity:w.isFunction(e)?e:w.property(e)};w.sortBy=function(e,t,n){return t=S(t),w.pluck(w.map(e,function(e,r,o){return{value:e,index:r,criteria:t.call(n,e,r,o)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index-t.index}),"value")};var P=function(e){return function(t,n,r){var o={};return n=S(n),T(t,function(i,s){var a=n.call(r,i,s,t);e(o,a,i)}),o}};w.groupBy=P(function(e,t,n){w.has(e,t)?e[t].push(n):e[t]=[n]}),w.indexBy=P(function(e,t,n){e[t]=n}),w.countBy=P(function(e,t){w.has(e,t)?e[t]++:e[t]=1}),w.sortedIndex=function(e,t,n,r){n=S(n);for(var o=n.call(r,t),i=0,s=e.length;s>i;){var a=i+s>>>1;n.call(r,e[a])<o?i=a+1:s=a}return i},w.toArray=function(e){return e?w.isArray(e)?a.call(e):e.length===+e.length?w.map(e,w.identity):w.values(e):[]},w.size=function(e){return null==e?0:e.length===+e.length?e.length:w.keys(e).length},w.first=w.head=w.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:a.call(e,0,t)},w.initial=function(e,t,n){return a.call(e,0,e.length-(null==t||n?1:t))},w.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},w.rest=w.tail=w.drop=function(e,t,n){return a.call(e,null==t||n?1:t)},w.compact=function(e){return w.filter(e,w.identity)};var I=function(e,t,n){return t&&w.every(e,w.isArray)?u.apply(n,e):(T(e,function(e){w.isArray(e)||w.isArguments(e)?t?s.apply(n,e):I(e,t,n):n.push(e)}),n)};w.flatten=function(e,t){return I(e,t,[])},w.without=function(e){return w.difference(e,a.call(arguments,1))},w.partition=function(e,t){var n=[],r=[];return T(e,function(e){(t(e)?n:r).push(e)}),[n,r]},w.uniq=w.unique=function(e,t,n,r){w.isFunction(t)&&(r=n,n=t,t=!1);var o=n?w.map(e,n,r):e,i=[],s=[];return T(o,function(n,r){(t?r&&s[s.length-1]===n:w.contains(s,n))||(s.push(n),i.push(e[r]))}),i},w.union=function(){return w.uniq(w.flatten(arguments,!0))},w.intersection=function(e){var t=a.call(arguments,1);return w.filter(w.uniq(e),function(e){return w.every(t,function(t){return w.contains(t,e)})})},w.difference=function(e){var t=u.apply(r,a.call(arguments,1));return w.filter(e,function(e){return!w.contains(t,e)})},w.zip=function(){for(var e=w.max(w.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=w.pluck(arguments,""+n);return t},w.object=function(e,t){if(null==e)return{};for(var n={},r=0,o=e.length;o>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},w.indexOf=function(e,t,n){if(null==e)return-1;var r=0,o=e.length;if(n){if("number"!=typeof n)return r=w.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,o+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;o>r;r++)if(e[r]===t)return r;return-1},w.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var o=r?n:e.length;o--;)if(e[o]===t)return o;return-1},w.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),o=0,i=new Array(r);r>o;)i[o++]=e,e+=n;return i};var O=function(){};w.bind=function(e,t){var n,r;if(R&&e.bind===R)return R.apply(e,a.call(arguments,1));if(!w.isFunction(e))throw new TypeError;return n=a.call(arguments,2),r=function(){if(!(this instanceof r))return e.apply(t,n.concat(a.call(arguments)));O.prototype=e.prototype;var o=new O;O.prototype=null;var i=e.apply(o,n.concat(a.call(arguments)));return Object(i)===i?i:o}},w.partial=function(e){var t=a.call(arguments,1);return function(){for(var n=0,r=t.slice(),o=0,i=r.length;i>o;o++)r[o]===w&&(r[o]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},w.bindAll=function(e){var t=a.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=w.bind(e[t],e)}),e},w.memoize=function(e,t){var n={};return t||(t=w.identity),function(){var r=t.apply(this,arguments);return w.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},w.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},w.defer=function(e){return w.delay.apply(w,[e,1].concat(a.call(arguments,1)))},w.throttle=function(e,t,n){var r,o,i,s=null,a=0;n||(n={});var u=function(){a=!1===n.leading?0:w.now(),s=null,i=e.apply(r,o),r=o=null};return function(){var c=w.now();a||!1!==n.leading||(a=c);var l=t-(c-a);return r=this,o=arguments,0>=l?(clearTimeout(s),s=null,a=c,i=e.apply(r,o),r=o=null):s||!1===n.trailing||(s=setTimeout(u,l)),i}},w.debounce=function(e,t,n){var r,o,i,s,a,u=function(){var c=w.now()-s;t>c?r=setTimeout(u,t-c):(r=null,n||(a=e.apply(i,o),i=o=null))};return function(){i=this,o=arguments,s=w.now();var c=n&&!r;return r||(r=setTimeout(u,t)),c&&(a=e.apply(i,o),i=o=null),a}},w.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},w.wrap=function(e,t){return w.partial(t,e)},w.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},w.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},w.keys=function(e){if(!w.isObject(e))return[];if(E)return E(e);var t=[];for(var n in e)w.has(e,n)&&t.push(n);return t},w.values=function(e){for(var t=w.keys(e),n=t.length,r=new Array(n),o=0;n>o;o++)r[o]=e[t[o]];return r},w.pairs=function(e){for(var t=w.keys(e),n=t.length,r=new Array(n),o=0;n>o;o++)r[o]=[t[o],e[t[o]]];return r},w.invert=function(e){for(var t={},n=w.keys(e),r=0,o=n.length;o>r;r++)t[e[n[r]]]=n[r];return t},w.functions=w.methods=function(e){var t=[];for(var n in e)w.isFunction(e[n])&&t.push(n);return t.sort()},w.extend=function(e){return T(a.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},w.pick=function(e){var t={},n=u.apply(r,a.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},w.omit=function(e){var t={},n=u.apply(r,a.call(arguments,1));for(var o in e)w.contains(n,o)||(t[o]=e[o]);return t},w.defaults=function(e){return T(a.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},w.clone=function(e){return w.isObject(e)?w.isArray(e)?e.slice():w.extend({},e):e},w.tap=function(e,t){return t(e),e};var C=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof w&&(e=e._wrapped),t instanceof w&&(t=t._wrapped);var o=c.call(e);if(o!=c.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var i=n.length;i--;)if(n[i]==e)return r[i]==t;var s=e.constructor,a=t.constructor;if(s!==a&&!(w.isFunction(s)&&s instanceof s&&w.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),r.push(t);var u=0,l=!0;if("[object Array]"==o){if(u=e.length,l=u==t.length)for(;u--&&(l=C(e[u],t[u],n,r)););}else{for(var p in e)if(w.has(e,p)&&(u++,!(l=w.has(t,p)&&C(e[p],t[p],n,r))))break;if(l){for(p in t)if(w.has(t,p)&&!u--)break;l=!u}}return n.pop(),r.pop(),l};w.isEqual=function(e,t){return C(e,t,[],[])},w.isEmpty=function(e){if(null==e)return!0;if(w.isArray(e)||w.isString(e))return 0===e.length;for(var t in e)if(w.has(e,t))return!1;return!0},w.isElement=function(e){return!(!e||1!==e.nodeType)},w.isArray=v||function(e){return"[object Array]"==c.call(e)},w.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){w["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),w.isArguments(arguments)||(w.isArguments=function(e){return!(!e||!w.has(e,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(e){return"function"==typeof e}),w.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},w.isNaN=function(e){return w.isNumber(e)&&e!=+e},w.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==c.call(e)},w.isNull=function(e){return null===e},w.isUndefined=function(e){return void 0===e},w.has=function(e,t){return l.call(e,t)},w.noConflict=function(){return e._=t,this},w.identity=function(e){return e},w.constant=function(e){return function(){return e}},w.property=function(e){return function(t){return t[e]}},w.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},w.times=function(e,t,n){for(var r=Array(Math.max(0,e)),o=0;e>o;o++)r[o]=t.call(n,o);return r},w.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},w.now=Date.now||function(){return(new Date).getTime()};var L={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};L.unescape=w.invert(L.escape);var B={escape:new RegExp("["+w.keys(L.escape).join("")+"]","g"),unescape:new RegExp("("+w.keys(L.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(e){w[e]=function(t){return null==t?"":(""+t).replace(B[e],function(t){return L[e][t]})}}),w.result=function(e,t){if(null!=e){var n=e[t];return w.isFunction(n)?n.call(e):n}},w.mixin=function(e){T(w.functions(e),function(t){var n=w[t]=e[t];w.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),k.call(this,n.apply(w,e))}})};var M=0;w.uniqueId=function(e){var t=++M+"";return e?e+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,
interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j=/(.)^/,q={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},U=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(e,t,n){var r;n=w.defaults({},n,w.templateSettings);var o=new RegExp([(n.escape||j).source,(n.interpolate||j).source,(n.evaluate||j).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(o,function(t,n,r,o,a){return s+=e.slice(i,a).replace(U,function(e){return"\\"+q[e]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),i=a+t.length,t}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{r=new Function(n.variable||"obj","_",s)}catch(e){throw e.source=s,e}if(t)return r(t,w);var a=function(e){return r.call(this,e,w)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},w.chain=function(e){return w(e).chain()};var k=function(e){return this._chain?w(e).chain():e};w.mixin(w),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];w.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],k.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];w.prototype[e]=function(){return k.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return w})}.call(this);var factory=function(e){var t=function(){this.initialize.apply(this,arguments)};return e.extend(t.prototype,{initialize:function(e,t){this._opts=e,this.errorDescription=t},get:function(e){if(this._opts.hasOwnProperty(e))return this._opts[e]},getOrError:function(e){if(void 0===this._opts[e]||null===this._opts[e])throw new Error("Option required but not found: "+e+"\n From: "+this.errorDescription);return this._opts[e]},getOrElse:function(e,t){return void 0===this._opts[e]||null===this._opts[e]?t:this._opts[e]},getOrElseFn:function(e,t){return void 0===this._opts[e]||null===this._opts[e]?t():this._opts[e]}}),t.fromObject=function(e,n){return new t(e||{},n||"")},t};"undefined"!=typeof module&&module.exports?module.exports=factory(require("underscore")):void 0!==define&&define("bit/commons/options",["underscore"],factory);var factory=function(e,t){"use strict";var n=function(){this.initialize.apply(this,arguments)};return e.extend(n.prototype,{initialize:function(e){e=t.fromObject(e),this._handler=e.getOrError("handler")},matches:function(e){return this._handler===e},notify:function(e){this._handler(e)},dispose:function(){this._handler=null}}),n};"undefined"!=typeof module&&module.exports?module.exports=factory(require("underscore"),require("bit/commons/options")):void 0!==define&&define("bit/messaging/internals/message-subscriber",["underscore","bit/commons/options"],factory);var factory=function(e,t,n){"use strict";var r=function(){this.initialize.apply(this,arguments)};return e.extend(r.prototype,{initialize:function(e){e=t.fromObject(e),this._sentinel=e.getOrError("sentinel"),this._subscribers=[]},publish:function(t,n){if(this._sentinel!==t)throw new Error("Invalid sentinel provided; cannot publish message.");e.invoke(this._subscribers,"notify",n)},subscribe:function(t){if(t){if(e.any(this._subscribers,function(e){return e.matches(t)}))throw new Error("Cannot double-subscribe to a channel.");this._subscribers.push(new n({handler:t}))}},unsubscribe:function(t){var n=0,r=e.find(this._subscribers,function(e){if(e.matches(t))return!0;n+=1});r&&(this._subscribers.splice(n,1),r.dispose())},dispose:function(){e.invoke(this._subscribers,"dispose"),this._subscribers=[]}}),r};"undefined"!=typeof module&&module.exports?module.exports=factory(require("underscore"),require("bit/commons/options"),require("bit/messaging/internals/message-subscriber")):void 0!==define&&define("bit/messaging/message-channel",["underscore","bit/commons/options","bit/messaging/internals/message-subscriber"],factory);var factory=function(){return{v4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}};"undefined"!=typeof module&&module.exports?module.exports=factory():void 0!==define&&define("bit/commons/uuid",[],factory);var factory=function(e,t,n){"use strict";var r={Message:function(e){return{msgId:n.v4(),mType:e.getOrError("mType"),payload:e.getOrElse("msg",null),t:Date.now()}},rpcSend:function(e){return this.Message(e)},rpcSendAndReceive:function(e){return this.Message(e)},rpcReply:function(t){return e.extend(this.Message(t),{rMsgId:t.getOrError("inReplyTo"),error:t.getOrElse("error",null)})},localDispatch:function(t){return e.extend(this.Message(t),{oMsgId:t.getOrError("originalMsgId"),replyCallback:t.getOrError("replyCallback")})}},o=function(){this.initialize.apply(this,arguments)};return e.extend(o.prototype,{initialize:function(e){}}),o.createMessage=function(e){return e=t.fromObject(e),r[e.getOrError("mType")](e)},o};"undefined"!=typeof module&&module.exports?module.exports=factory(require("underscore"),require("bit/commons/options"),require("bit/commons/uuid")):void 0!==define&&define("bit/messaging/message-factory",["underscore","bit/commons/options","bit/commons/uuid"],factory);var factory=function(e){var t=function(){this.initialize.apply(this,arguments)};return e.extend(t.prototype,{initialize:function(e){this._isSet=!1,this._val=null,void 0!==e&&this._set(e)},get:function(){if(!this._isSet)throw new Error("Requested future before underlying value was set.");return this._val},getOrElse:function(e){return this._isSet?this._val:e},set:function(e){this._set(e)},isSet:function(){return this._isSet},_set:function(e){this._isSet=!0,this._val=e}}),t};"undefined"!=typeof module&&module.exports?module.exports=factory(require("underscore")):void 0!==define&&define("bit/commons/simple-future",["underscore"],factory);var factory=function(e,t){var n=function(){};n.prototype={noop:function(){},partiallyApply:function(){var t=e.toArray(arguments),n=t.shift();return function(){var r=e.toArray(arguments);return n.apply(null,t.concat(r))}},params:function(e){return new r(e)},returns:function(e,t){return function(n){if(n)return void t(n);t(null,e)}},cbOnErr:function(e,t){return e=e||this.noop,!!t&&(e(t),!0)},doThrow:function(e){throw e},future:function(e){return new t(e)},pojoKlass:function(t,n){t=t||[],n=n||{};var r=function(){this.initialize.apply(this,arguments)},o=function(){var n=e.toArray(arguments);e.each(t,e.bind(function(e,t){this["_"+e]=n[t]},this))};return r.prototype.initialize=o,e.each(t,function(e){var t="_"+e,n=function(){return this[t]};r.prototype[e]=n}),n.setters&&e.each(t,function(e){var t="_"+e,n="set"+e.charAt(0).toUpperCase()+e.substr(1),o=function(e){this[t]=e};r.prototype[n]=o}),r}};var r=function(){this.initialize.apply(this,arguments)};return e.extend(r.prototype,{initialize:function(e){if(!e)throw new Error("Invalid target provided for scoped require");this._target=e},req:function(e,t){if(!e)throw new Error("Invalid attribute provided");if(t=t||"Attribute required but missing: `"+e+"'",void 0===this._target[e]||null===this._target[e])throw new Error(t);return this}}),new n};"undefined"!=typeof module&&module.exports?module.exports=factory(require("underscore"),require("bit/commons/simple-future")):void 0!==define&&define("bit/commons/lang",["underscore","bit/commons/simple-future"],factory);var factory=function(e,t){"use strict";return{scheduleTask:function(e,n){if(e=e||t.noop,n=n||1,"undefined"!=typeof setTimeout)return setTimeout(e,n);throw new Error("Don't know who to delegate task to!")},cancelTask:function(e){if("undefined"!=typeof setTimeout)return clearTimeout(e);throw new Error("Don't know who to delegate cancel to!")}}};"undefined"!=typeof module&&module.exports?module.exports=factory(require("underscore"),require("bit/commons/lang")):void 0!==define&&define("bit/commons/task-manager",["underscore","bit/commons/lang"],factory);var factory=function(e,t,n){"use strict";var r=function(){this.initialize.apply(this,arguments)};e.extend(r.prototype,{initialize:function(n){n=t.fromObject(n),this._owner=n.getOrError("owner"),this._key=n.getOrError("key"),this._timeout=n.getOrError("timeout"),this._lastAccess=null,this._expiryRequested=!1,this._disposed=!1,this.touch(),e.bindAll(this,"_checkExpired"),this._scheduleExpiryCheck()},setValue:function(e){this.touch(),this._value=e},value:function(){return this.touch(),this._value},touchlessValue:function(){return this._value},touch:function(){this._lastAccess=Date.now()},dispose:function(){this._disposed=!0,this._value=null,this._owner=null,this._key=null},isExpired:function(){return this._expiryRequested||Date.now()-this._lastAccess>this._timeout},_requestExpiry:function(){this._expiryRequested=!0,this._key&&this._owner._requestExpiry(this._key,this)},_scheduleExpiryCheck:function(){n.scheduleTask(this._checkExpired,850)},_checkExpired:function(){this._disposed||(this.isExpired()?this._requestExpiry():n.scheduleTask(this._checkExpired,850))}});var o=function(){this.initialize.apply(this,arguments)};return e.extend(o.prototype,{initialize:function(e){e=t.fromObject(e),this._timeout=e.getOrElse("timeout",5e3),this._onTimeout=e.getOrElse("onTimeout",function(){}),this._hash={},this._disposed=!1},dispose:function(){this._disposed||(this._hash&&(e.each(this._hash,function(e){e.dispose()}),this._hash=null),this._disposed=!0)},_checkNotDisposed:function(){if(this._disposed)throw new Error("Tried to modify disposed TimeoutHash")},put:function(e,t,n){this._checkNotDisposed();var o=this._hash[e];o||(o=new r({owner:this,key:e,timeout:n||this._timeout}),this._hash[e]=o),o.setValue(t)},get:function(e){this._checkNotDisposed();var t=this._hash[e];return t?t.value():void 0},getAndRemove:function(e){this._checkNotDisposed();var t,n=this._hash[e];return n?(t=n.value(),this.remove(e),t):void 0},remove:function(e){this._checkNotDisposed();var t=this._hash[e];t&&(delete this._hash[e],t.dispose())},_requestExpiry:function(e,t){var n=t.touchlessValue();delete this._hash[e],t.dispose(),this._onTimeout(e,n)}}),o};"undefined"!=typeof module&&module.exports?module.exports=factory(require("underscore"),require("bit/commons/options"),require("bit/commons/task-manager")):void 0!==define&&define("bit/commons/timeout-hash",["underscore","bit/commons/options","bit/commons/task-manager"],factory);var factory=function(e,t){"use strict";var n=function(){this.initialize.apply(this,arguments)};return e.extend(n.prototype,t.prototype),e.extend(n.prototype,{initialize:function(){t.prototype.initialize.apply(this,arguments),this._joinedChannels=[],e.bindAll(this,"_forwardDispatcher")},join:function(e){e.subscribe(this._forwardDispatcher),this._joinedChannels.push(e)},leave:function(e){var t,n=this._joinedChannels.indexOf(e);-1!==n&&(t=this._joinedChannels[n],this._joinedChannels.splice(n,1)),t&&e.unsubscribe(this._forwardDispatcher)},_forwardDispatcher:function(e){this.publish(this._sentinel,e)}}),n};"undefined"!=typeof module&&module.exports?module.exports=factory(require("underscore"),require("bit/messaging/message-channel")):void 0!==define&&define("bit/messaging/composite-message-channel",["underscore","bit/messaging/message-channel"],factory),define("ubp/commons/messaging/MessageExchange",["require","exports","lib/lodash","lib/bluebird","bit/messaging/message-channel","bit/messaging/message-factory","bit/commons/timeout-hash","bit/messaging/composite-message-channel","../error/Errors","../error/BaseError"],function(e,t,n,r,o,i,s,a,u,c){"use strict";return function(){function e(e){if(!n.isNumber(e)||n.isNaN(e))throw new Error("MessageExchange.constructor: 'timeout' argument is not a valid number.");this._ingressBus=new a({sentinel:this}),this._egressBus=new o({sentinel:this}),this._dispatchBus=new o({sentinel:this}),n.bindAll(this,"_onReplyTimeout","_receive"),this._pendingRemoteReplies=new s({timeout:e,onTimeout:this._onReplyTimeout}),this._ingressBus.subscribe(this._receive),this._disposed=!1}return e.prototype.dispose=function(){var e=this;return r.bind(this).then(function(){e._disposed||(e._ingressBus&&(e._ingressBus.dispose(),e._ingressBus=null),e._egressBus&&(e._egressBus.dispose(),e._egressBus=null),e._dispatchBus&&(e._dispatchBus.dispose(),e._dispatchBus=null),e._pendingRemoteReplies&&(e._pendingRemoteReplies.dispose(),e._pendingRemoteReplies=null),e._disposed=!0)})},e.prototype.dispatchBus=function(){return this._dispatchBus},e.prototype.egressBus=function(){return this._egressBus},e.prototype.listen=function(e){var t=this;return r.bind(this).then(function(){t._ingressBus.join(e)})},e.prototype.leave=function(e){var t=this;return r.bind(this).then(function(){t._ingressBus.leave(e)})},e.prototype.twine=function(e){var t=this;return r.bind(this).then(function(){return e.listen(t.egressBus())}).then(function(){return t.listen(e.egressBus())})},e.prototype.untwine=function(e){var t=this;return r.bind(this).then(function(){return e.leave(t.egressBus())}).then(function(){return t.leave(e.egressBus())})},e.prototype.send=function(e){var t=this;return r.bind(this).then(function(){var n=i.createMessage({mType:"rpcSend",msg:e});t._egressBus.publish(t,n)})},e.prototype.sendAndReceive=function(e,t){var o=this;return new r(function(r,s){n.isUndefined(t)||n.isNumber(t)&&!n.isNaN(t)||s(new Error("MessageExchange.sendAndReceive: 'timeout' argument is not a valid number."));var a=i.createMessage({mType:"rpcSendAndReceive",msg:e});o._pendingRemoteReplies.put(a.msgId,function(e,t){e?s(e instanceof Error||e instanceof c?e:new Error(e)):r(t)},t),o._egressBus.publish(o,a)})},e.prototype._reply=function(e,t,n){var r=i.createMessage({mType:"rpcReply",msg:n,rMsgId:e,error:t});this._egressBus.publish(this,r)},e.prototype._receive=function(e){var t="_receive_"+e.mType;this[t]&&this[t](e)},e.prototype._receive_rpcReply=function(e){var t=e.rMsgId,n=e.payload,r=e.error,o=this._pendingRemoteReplies.getAndRemove(t);if(o)if(r)if(r.status){var i=u.Auto(r.name,r.message,r.status,r.cause);o(i)}else o(u.Internal(r.message||r));else o(null,n)},e.prototype._receive_rpcSend=function(e){var t=e.payload,n=e.msgId;this._dispatchBus.publish(this,i.createMessage({mType:"localDispatch",msg:t,originalMsgId:n,replyCallback:function(){}}))},e.prototype._receive_rpcSendAndReceive=function(e){var t=this,r=e.payload,o=e.msgId,s=n.bind(function(e,n){e&&(r=null);var s=i.createMessage({mType:"rpcReply",msg:n,inReplyTo:o,error:e});t._egressBus.publish(t,s)},this);this._dispatchBus.publish(this,i.createMessage({mType:"localDispatch",msg:r,originalMsgId:o,replyCallback:s}))},e.prototype._onReplyTimeout=function(e,t){t(u.RequestTimeout())},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/process/BaseProcess",["require","exports","lib/lodash","lib/bluebird","./ProcessState","../../commons/Events/Events","../../commons/logging/Logger","../../commons/localization/Locale","../../commons/messaging/MessageExchange"],function(e,t,n,r,o,i,s,a,u){"use strict";return function(e){function t(n,r,i){var a=e.call(this)||this;return a._state=o.NEW,t.logger=t.logger||s.getLogger("BaseProcess"),a._manifest=n,a._messageReceiver=r,a._options=i,a}return __extends(t,e),t.prototype.start=function(){var e=this;return r.bind(this).then(function(){return e.getState()}).then(function(n){if(n!==o.NEW){var i=new Error("This Process has already been started and can only be started once.");return t.logger.error("start",i.toString()),r.reject(i)}return e.setState(o.STARTING)})},t.prototype.terminate=function(){var e=this;return r.bind(this).then(function(){return e._exchange&&e._exchange.dispose()}).then(function(){return e.setState(o.TERMINATED)}).then(function(){e._transport=null,e._exchange=null,e._messageReceiver=null,e._manifest=null})},t.prototype._setupMessageExchange=function(){var e=this;return this._exchange=new u(t.MESSAGE_TIMEOUT),this._transport.forward(this._exchange.egressBus()).then(function(){return e._exchange.listen(e._transport.dispatchBus())}).then(function(){return e._exchange.dispatchBus().subscribe(function(t){e._messageReceiver(t,e)})})},t.prototype.getState=function(){return r.cast(this._state)},t.prototype.setState=function(e){var t=this;return r.bind(this).then(function(){t._state!==e&&(t._state=e,t.notify("StateChange",t._state,t))})},t.prototype.send=function(e){var n=this;return this.getState().then(function(e){if(e!==o.STABLE){var n=new Error("This Process must be stable before making any method calls.");return t.logger.info("send",n.toString()),r.reject(n)}}).then(function(){return n._exchange.send(e)})},t.prototype.sendAndReceive=function(e,n){var i=this;return this.getState().then(function(e){if(e!==o.STABLE){var n=new Error("This Process must be stable before making any method calls.");return t.logger.info("send",n.toString()),r.reject(n)}}).then(function(){return i._exchange.sendAndReceive(e,n)})},t.prototype.getManifest=function(){var e=this;return r.bind(this).then(function(){return e._manifest})},t._extractOrigin=function(e){return e.replace(/(https?:\/\/).*/,"$1")+e.split(/https?:\/\//)[1].split("/")[0]},t._getProcessUrl=function(e,r){var o=e.configuration.url,i=a[t.DEFAULT_LOCALE];if(n.isUndefined(r)||n.isUndefined(a[r.locale])||(i=a[r.locale]),o=t._appendQueryParams(o,{locale:i}),e.configuration.assetTag){if(e.configuration.url.match(/[&\?]assetTag=/)){var s=new Error("URL already has an assetTag; can't append assetTag");throw t.logger.info("send",s.toString()),s}o=t._appendQueryParams(o,{assetTag:e.configuration.assetTag})}return o},t._appendQueryParams=function(e,t){var r="";return n.each(t,function(e,t){r+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e)}),e.indexOf("?")>-1?"&"!==e.charAt(e.length-1)&&"?"!==e.charAt(e.length-1)||(r=r.slice(1)):r="?"+r.slice(1),e+r},t.MESSAGE_TIMEOUT=1e4,t.DEFAULT_LOCALE=a.US,t}(i)}),define("ubp/commons/messaging/BaseTransportStrategy",["require","exports","lib/bluebird","bit/messaging/message-channel","bit/messaging/composite-message-channel"],function(e,t,n,r,o){"use strict";return function(){function e(e){this._identity=e.identity,this._dispatchBus=new r({sentinel:this}),this._egressBus=new o({sentinel:this}),this._validSources=e.validSources,this._validOrigins=e.validOrigins}return e.prototype.dispatchBus=function(){return this._dispatchBus},e.prototype.forward=function(e){var t=this;return n.bind(this).then(function(){t._egressBus.join(e)})},e.prototype.bind=function(e,t){return n.resolve()},e.prototype.unbind=function(){return n.resolve()},e}()}),define("ubp/commons/messaging/primitives/TransportStrategyType",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.PostMessage=0]="PostMessage",e[e.PanelMessage=1]="PanelMessage",e[e.Port=2]="Port",e[e.Pseudo=3]="Pseudo"}(n||(n={})),n});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/messaging/PostMessageTransportStrategy",["require","exports","lib/lodash","lib/bluebird","./BaseTransportStrategy","./primitives/TransportStrategyType"],function(e,t,n,r,o,i){"use strict";return function(e){function t(t){var r=e.call(this,t)||this;return n.bindAll(r,"_onMessage","_send"),r._egressBus.subscribe(r._send),r.bind(t.inboundPort,t.outboundPort),r}return __extends(t,e),t.prototype.dispatchBus=function(){return e.prototype.dispatchBus.call(this)},t.prototype.forward=function(t){return e.prototype.forward.call(this,t)},t.prototype.bind=function(e,t){var n=this;return r.bind(this).then(function(){n._outboundPort=t,n._inboundPort=e,n._inboundPort.addEventListener("message",n._onMessage,!1)})},t.prototype.unbind=function(){var e=this;return r.bind(this).then(function(){n.isObject(e._inboundPort)&&e._inboundPort.removeEventListener("message",e._onMessage),e._inboundPort=null,e._outboundPort=null})},t.prototype._send=function(e){var t={mType:i.PostMessage,source:this._identity,payload:e};n.isObject(this._outboundPort)&&this._outboundPort.postMessage(t,"*")},t.prototype._onMessage=function(e){if(n.contains(this._validOrigins,"*")||n.contains(this._validOrigins,e.origin)){var t=e.data;(n.contains(this._validSources,"*")||n.contains(this._validSources,t.source))&&t.source!==this._identity&&this._dispatchBus.publish(this,t.payload)}},t}(o)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/process/IFrameProcess",["require","exports","lib/bluebird","./BaseProcess","./ProcessState","../../commons/messaging/PostMessageTransportStrategy"],function(e,t,n,r,o,i){"use strict";return function(e){function t(t,n,r,o,i){var s=e.call(this,t,n,r)||this;return s._frameAttributes=i,s._frame=o||s._createFrame(),s}return __extends(t,e),t.prototype.start=function(i){var s=this;return void 0===i&&(i=t.DEFAULT_TIMEOUT),n.bind(this).then(function(){return e.prototype.start.call(s)}).then(function(){return s._frame.src=r._getProcessUrl(s._manifest,s._options),s._setupMessagingInfrastructure()}).then(function(){return new n(function(e){s._state===o.STABLE&&e(),s.on("StateChange",function(t){t===o.STABLE&&e()},s)}).timeout(i,"Did not receive handshake in time")}).catch(function(e){var t=new Error("Could not start process: "+e.message);return r.logger.error("IFrameProcess.start",t.message),n.reject(t)})},t.prototype.terminate=function(){var t=this;return n.bind(this).then(function(){return e.prototype.terminate.call(t)}).then(function(){return t._exchange&&t._exchange.dispose()}).then(function(){return t._transport=null,t._exchange=null,t._messageReceiver=null,t._manifest=null,t._frame.src="about:blank",t._frame.contentWindow.close(),t._frame})},t.prototype._setupMessagingInfrastructure=function(){return this._transportStrategyOptions={identity:"PlatformHub",inboundPort:window,outboundPort:this._frame.contentWindow,validOrigins:[t._extractOrigin(this._manifest.configuration.url.toString())],validSources:[this._manifest.name]},this._transport=new i(this._transportStrategyOptions),e.prototype._setupMessageExchange.call(this)},t.prototype._createFrame=function(){var e=document.createElement("iframe");return e.src="about:blank",_.each(this._frameAttributes,function(t,n){t&&n&&e.setAttribute(n,t)},this),document.body.appendChild(e),e},t.DEFAULT_TIMEOUT=3e4,t}(r)}),define("ubp/extension/runtime/BaseContentScripts",["require","exports","../../commons/logging/Logger"],function(e,t,n){"use strict";return function(){function e(){this._contentScriptsHash={}}return e.prototype.get=function(t){if(this._contentScriptsHash[t])return this._contentScriptsHash[t];var n=new Error("feature not supported");throw e.logger.error("get",n.message),n},e.logger=n.getLogger("BaseContentScripts"),e}()}),define("ubp/extension/contextual/ContextualFeature",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.Sandbox=1]="Sandbox",e[e.Scrape=2]="Scrape",e[e.Action=3]="Action",e[e.Style=4]="Style",e[e.MetaData=5]="MetaData",e[e.GetUWLItem=6]="GetUWLItem",e[e.Webpage=7]="Webpage",e[e.InlineWidget=8]="InlineWidget"}(n||(n={})),n});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/chrome/ChromelikeContentScripts",["require","exports","../BaseContentScripts","../../contextual/ContextualFeature"],function(e,t,n,r){"use strict";return function(e){function t(){var t=e.call(this)||this;return t._contentScriptsHash[r.Scrape]=["/js/ubp/extension/contextual/peer-scripts/libraries/GlobalDeclarations.js","/js/ubp/extension/contextual/peer-scripts/libraries/Xpath2Library.js","/js/ubp/extension/contextual/peer-scripts/libraries/ScrapeLibrary.js","/js/ubp/extension/contextual/peer-scripts/drivers/chrome/ScrapeDriver.js"],t._contentScriptsHash[r.Sandbox]=["/js/ubp/extension/contextual/peer-scripts/libraries/GlobalDeclarations.js","/js/ubp/extension/contextual/peer-scripts/libraries/SandboxLibrary.js","/js/ubp/extension/contextual/peer-scripts/drivers/chrome/SandboxDriver.js"],t._contentScriptsHash[r.Action]=["/js/ubp/extension/contextual/peer-scripts/libraries/GlobalDeclarations.js","/js/ubp/extension/contextual/peer-scripts/libraries/ActionLibrary.js","/js/ubp/extension/contextual/peer-scripts/drivers/chrome/ActionDriver.js"],t._contentScriptsHash[r.Style]=["/js/ubp/extension/contextual/peer-scripts/libraries/GlobalDeclarations.js","/js/ubp/extension/contextual/peer-scripts/libraries/StyleLibrary.js","/js/ubp/extension/contextual/peer-scripts/drivers/chrome/StyleDriver.js"],t._contentScriptsHash[r.MetaData]=["/js/ubp/extension/contextual/peer-scripts/libraries/GlobalDeclarations.js","/js/ubp/extension/contextual/peer-scripts/libraries/MetaDataLibrary.js","/js/ubp/extension/contextual/peer-scripts/drivers/chrome/MetaDataDriver.js"],t._contentScriptsHash[r.GetUWLItem]=["/js/ubp/extension/contextual/peer-scripts/libraries/GlobalDeclarations.js","/js/ubp/extension/contextual/peer-scripts/libraries/GetUWLItemLibrary.js","/js/ubp/extension/contextual/peer-scripts/drivers/chrome/GetUWLItemDriver.js"],t._contentScriptsHash[r.Webpage]=["/js/ubp/extension/contextual/peer-scripts/libraries/GlobalDeclarations.js","/js/ubp/extension/contextual/peer-scripts/libraries/WebpageInstrumentLibrary.js","/js/ubp/extension/contextual/peer-scripts/drivers/chrome/WebpageDriver.js"],t._contentScriptsHash[r.InlineWidget]=["/js/ubp/extension/contextual/peer-scripts/libraries/GlobalDeclarations.js","/js/ubp/extension/contextual/peer-scripts/libraries/InlineWidgetLibrary.js","/js/ubp/extension/contextual/peer-scripts/drivers/chrome/InlineWidgetDriver.js"],t}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/messaging/ChromePanelMessageTransportStrategy",["require","exports","lib/lodash","lib/bluebird","./BaseTransportStrategy","./primitives/TransportStrategyType"],function(e,t,n,r,o,i){"use strict";return function(e){function t(t){var r=e.call(this,t)||this;return n.bindAll(r,"_onMessage","_send"),r._egressBus.subscribe(r._send),r.bind(t.inboundPort,t.outboundPort),r}return __extends(t,e),t.prototype.dispatchBus=function(){return e.prototype.dispatchBus.call(this)},t.prototype.forward=function(t){return e.prototype.forward.call(this,t)},t.prototype.bind=function(e,t){var n=this;return r.bind(this).then(function(){n._outboundPort=t,n._inboundPort=e,n._inboundPort.onMessage.addListener(n._onMessage)})},t.prototype.unbind=function(){var e=this;return r.bind(this).then(function(){n.isObject(e._inboundPort)&&e._inboundPort.onMessage.removeListener(e._onMessage),e._inboundPort=null,e._outboundPort=null})},t.prototype._send=function(e){var t={mType:i.PanelMessage,source:this._identity,payload:e};n.isObject(this._outboundPort)&&this._outboundPort.postMessage(t)},t.prototype._onMessage=function(e,t){var r=e.data?e.data:e;(n.contains(this._validSources,"*")||n.contains(this._validSources,r.source))&&r.source!==this._identity&&this._dispatchBus.publish(this,r.payload)},t}(o)}),define("ubp/extension/runtime/chrome/ChromeLikePanelRuntime",["require","exports","lib/lodash","lib/bluebird","../../../commons/logging/Logger","../../../commons/error/BadRequestError","../../../commons/messaging/ChromePanelMessageTransportStrategy"],function(e,t,n,r,o,i,s){"use strict";return function(){function e(e){this.namespace=e||chrome,this.createLogger(),this.namespace&&this.namespace.runtime&&this.namespace.runtime.onConnect&&this.namespace.runtime.onConnect.addListener(n.bind(this._panelConnectHandler,this))}return e.prototype.getNamespace=function(){return this.namespace},e.prototype.createLogger=function(){e._logger=e._logger||o.getLogger("ChromelikeRuntime")},e.prototype.registerPanelConnect=function(t){var n=this;return this._panelMessageHandler=t,r.bind(this).then(function(){n._panelPort&&n._panelMessageHandler&&(n._setGatewayTransportStrategy(),e._logger.info("_panelConnectHandler","Calling GatewayCore callback that was registered"),n._panelMessageHandler.call(n,n._transport))})},e.prototype.registerPanelDisconnect=function(e){var t=this;return r.bind(this).then(function(){t._registeredPanelDisconnectHandler=e})},e.prototype._panelConnectHandler=function(t){var o=this;return r.bind(this).then(function(){if(!t)throw e._logger.error("_panelConnectHandler","Not a valid panel port"),new i("Not a valid port");if(e._logger.info("_panelConnectHandler","Connected extension from Panel with name => "+t.name),t.name!=e.UBP_PANEL_NAME){var r="Received connection from unrecognized port "+t.name;throw e._logger.error("_panelConnectHandler",r),new i(r)}o._panelPort=t,o._panelPort.onDisconnect.addListener(n.bind(o._panelDisconnectHandler,o)),o._panelMessageHandler&&(o._setGatewayTransportStrategy(),e._logger.info("_panelConnectHandler","Calling GatewayCore callback that was registered"),o._panelMessageHandler.call(o,o._transport))})},e.prototype._setGatewayTransportStrategy=function(){this._panelPort&&this._panelMessageHandler&&(this._transportStrategyOptions={identity:"PlatformHub",inboundPort:this._panelPort,outboundPort:this._panelPort,validOrigins:["*"],validSources:["*"]},this._transport=new s(this._transportStrategyOptions))},e.prototype._panelDisconnectHandler=function(){return this.destroyPanel()},e.prototype.destroyPanel=function(){var e=this;return r.bind(this).then(function(){e._panelPort=null,"function"==typeof e._registeredPanelDisconnectHandler&&e._registeredPanelDisconnectHandler()})},e.prototype.registerPanelMessageHandler=function(e){var t=this;return r.bind(this).then(function(){t._panelPort.onMessage.addListener(e)})},e.prototype.createConnectionToExtension=function(t){var n=this;if(!t||!t.name)return e._logger.error("createConnectionToExtension","Wrong request panel connection request"),r.reject(new i("Wrong request panel connection request"));var o=t.name;return e.UBP_PANEL_NAME!==o?(e._logger.error("createConnectionToExtension","Wrong port name ["+o+"] in the request"),r.reject(new i("Wrong port name ["+o+"] in the request"))):r.bind(this).then(function(){n._panelPort=n.namespace.runtime.connect(t)})},e.prototype.registerExtensionMessageHandler=function(e){var t=this;return r.bind(this).then(function(){t._panelPort.onMessage.addListener(e)})},e.prototype.sendMessageToExtensionPort=function(e){return e.data?this._sendMessageToExternalPort(e.data):this._sendMessageToExternalPort(e)},
e.prototype.sendMessageToPanelPort=function(e){return this._sendMessageToExternalPort(e)},e.prototype.addMessageListener=function(e,t){return r.bind(this).then(function(){window.addEventListener(e,t,!1)})},e.prototype._sendMessageToExternalPort=function(e){var t=this;return r.bind(this).then(function(){t._panelPort.postMessage(e)})},e.prototype.sendPostConnectionMessageToExtension=function(){return r.resolve()},e.UBP_PANEL_NAME="UBPv2Panel",e}()}),define("ubp/extension/runtime/platformInfo/userAgent/regexElements/RegexElement",["require","exports"],function(e,t){"use strict";return function(){function e(e,t){this.regex=e,this.replacement=t||""}return e.prototype.getRegex=function(){return this.regex},e.prototype.getReplacement=function(){return this.replacement},e.prototype.classify=function(e){var t=e.match(new RegExp(this.getRegex()));if(t)return this._getParseData(t)},e.prototype._getParseData=function(e){var t=this.getReplacement()?this.getReplacement():e[1]||"other",n=isNaN(parseInt(e[2]))?null:parseInt(e[2]),r=isNaN(parseInt(e[3]))?null:parseInt(e[3]),o=isNaN(parseInt(e[4]))?null:parseInt(e[4]),i=null!==n?n+"":"";return i+=null!==r?"."+r:"",i+=null!==o?"."+o:"",{getName:function(){return t},getVersion:function(){return i}}},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/regexElements/os/OSRegexElement",["require","exports","../RegexElement"],function(e,t,n){"use strict";return function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/regexElements/device/DeviceRegexElement",["require","exports","../RegexElement"],function(e,t,n){"use strict";return function(e){function t(t,n,r){var o=e.call(this,t,n)||this;return o._tablet=r||!1,o}return __extends(t,e),t.prototype.isTablet=function(){return this._tablet},t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/regexElements/browsers/BrowserRegexElement",["require","exports","../RegexElement"],function(e,t,n){"use strict";return function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t}(n)}),define("ubp/extension/runtime/platformInfo/UserAgentRegexVisitor",["require","exports","./userAgent/regexElements/os/OSRegexElement","./userAgent/regexElements/device/DeviceRegexElement","./userAgent/regexElements/browsers/BrowserRegexElement","lib/lodash"],function(e,t,n,r,o,i){"use strict";return function(){function e(e){this.userAgentString=e,this.deviceResult=null,this.osResult=null,this.browserResult=null,this.isTablet=!1}return e.prototype.visit=function(e){e instanceof n&&!this.osResult?this.osResult=e.classify(this.userAgentString):e instanceof r&&!this.deviceResult?(this.deviceResult=e.classify(this.userAgentString),this.isTablet=e.isTablet()):e instanceof o&&!this.browserResult&&(this.browserResult=e.classify(this.userAgentString))},e.prototype.getBrowserName=function(){return this.browserResult?this.browserResult.getName():""},e.prototype.getBrowserVersion=function(){return this.browserResult?this.browserResult.getVersion():""},e.prototype.getOSName=function(){return this.osResult?this.osResult.getName():""},e.prototype.getOSVersion=function(){return this.osResult?this.osResult.getVersion():""},e.prototype.getDeviceName=function(){return this.deviceResult?this.deviceResult.getName():this.getDeviceType()},e.prototype.getDeviceType=function(){return this.deviceResult&&!0===this.isTablet?"Tablet":this.deviceResult&&i.contains(e.mobileFamily,this.deviceResult.getName())?"Mobile":"Desktop"},e.prototype.getDeviceVersion=function(){return this.deviceResult?this.deviceResult.getVersion():""},e.prototype.getUserAgentString=function(){return this.userAgentString},e.mobileFamily=["Android","FireFox Mobile","Opera Mobile","Opera Mini","Jasmine","UP.Browser","Bolt","Dolfin","Tizen Browser","Polaris","BREW"],e}()}),define("ubp/extension/runtime/platformInfo/userAgent/parsers/UserAgentParser",["require","exports","../../UserAgentRegexVisitor","lib/bluebird"],function(e,t,n,r){"use strict";return function(){function e(e){this._uaRegexElements=e}return e.prototype.parse=function(e){for(var t=this,o=new n(e),i=0,s=this._uaRegexElements.length;i<s;i++)this._uaRegexElements[i].accept(o);return r.bind(this).then(function(){return t._extractRuntimeInfo(o,e)})},e.prototype._extractRuntimeInfo=function(e,t){return{browserVersion:e.getBrowserVersion(),operatingSystem:e.getOSName(),device:e.getDeviceName(),browser:e.getBrowserName(),userAgent:t}},e}()}),define("ubp/extension/runtime/platformInfo/userAgent/regexElements/RegexElementCollection",["require","exports"],function(e,t){"use strict";return function(){function e(e){this._regexElements=e}return e.prototype.accept=function(e){for(var t=0,n=this._regexElements.length;t<n;t++)e.visit(this._regexElements[t])},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/regexElements/os/AndroidOSUARegexElementCollection",["require","exports","../RegexElementCollection","./OSRegexElement"],function(e,t,n,r){"use strict";return function(e){function t(){var t=[new r("(Android) (\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"),new r("(Android)\\-(\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"),new r("(Android) Donut"),new r("(Android) Eclair"),new r("(Android) Froyo"),new r("(Android) Gingerbread"),new r("(Android) Honeycomb"),new r("(Silk-Accelerated=[a-z]{4,5})","Android")];return e.call(this,t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/regexElements/os/MacOSUARegexElementCollection",["require","exports","../RegexElementCollection","./OSRegexElement"],function(e,t,n,r){"use strict";return function(e){function t(){var t=[new r("(Mac OS X) (\\d+)[_.](\\d+)(?:[_.](\\d+))?","Mac"),new r("(?:PPC|Intel) (Mac OS X)","Mac")];return e.call(this,t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/regexElements/os/IosOSUARegexElementCollection",["require","exports","../RegexElementCollection","./OSRegexElement"],function(e,t,n,r){"use strict";return function(e){function t(){var t=[new r("(CPU OS|iPhone OS) (\\d+)_(\\d+)(?:_(\\d+))?","IOS"),new r("(iPhone|iPad|iPod); Opera","IOS"),new r("(iPhone|iPad|iPod).*Mac OS X.*Version/(\\d+)\\.(\\d+)","IOS")];return e.call(this,t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/regexElements/os/WindowOSUARegexElementCollection",["require","exports","../RegexElementCollection","./OSRegexElement"],function(e,t,n,r){"use strict";return function(e){function t(){var t=[new r("(Windows (?:NT 5\\.2|NT 5\\.1))","Windows XP"),new r("(Windows NT 6\\.1)","Windows 7"),new r("(Windows NT 6\\.0)","Windows Vista"),new r("(Windows 98|Windows XP|Windows ME|Windows 95|Windows CE|Windows 7|Windows NT 4\\.0|Windows Vista|Windows 2000)"),new r("(Windows NT 6\\.2)","Windows 8"),new r("(Windows NT 6\\.3)","Windows 8.1"),new r("(Windows NT 10\\.0)","Windows 10"),new r("(Windows NT 5\\.0)","Windows 2000"),new r("(WinNT4.0)","Windows NT 4.0"),new r("(Win98)","Windows 98"),new r("(Windows NT \\d\\.\\d)","Windows"),new r("(Windows \\d\\.\\d)")];return e.call(this,t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/regexElements/os/LinuxOSUARegexElementCollection",["require","exports","../RegexElementCollection","./OSRegexElement"],function(e,t,n,r){"use strict";return function(e){function t(){var t=[new r("(SUSE|Fedora|Red Hat|Puppy|PCLinuxOS|CentOS)/(\\d+)\\.(\\d+)\\.(\\d+)","Linux"),new r("(Ubuntu|Kindle|Bada|Lubuntu|BackTrack|Red Hat|Slackware)/(\\d+)\\.(\\d+)","Linux"),new r("OpenBSD|FreeBSD|NetBSD|Ubuntu|Kubuntu|Android|Arch Linux|CentOS|WeTab|Slackware","Linux"),new r("(Linux|BSD)","Linux")];return e.call(this,t)||this}return __extends(t,e),t}(n)}),define("ubp/extension/runtime/platformInfo/userAgent/regexElements/os/OSRegexElementCollection",["require","exports","./AndroidOSUARegexElementCollection","./MacOSUARegexElementCollection","./IosOSUARegexElementCollection","./WindowOSUARegexElementCollection","./LinuxOSUARegexElementCollection"],function(e,t,n,r,o,i,s){"use strict";return function(){function e(){this._uaRegexElementArray=[new n,new r,new o,new i,new s]}return e.prototype.accept=function(e){for(var t=0,n=this._uaRegexElementArray.length;t<n;t++)this._uaRegexElementArray[t].accept(e)},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/regexElements/device/TabletDeviceUARegexElementCollection",["require","exports","../RegexElementCollection","./DeviceRegexElement"],function(e,t,n,r){"use strict";return function(e){function t(){var t=[new r("(iPad).*Version/(\\d+)\\.(\\d+)\\.(\\d+)","iPad",!0),new r("(iPad).*Version/(\\d+)\\.(\\d+)","iPad",!0),new r("(iPad)","iPad",!0),new r("(PlayBook).+RIM Tablet OS (\\d+)\\.(\\d+)\\.(\\d+)","Blackberry WebKit",!0),new r("(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?","Kindle Fire",!0)];return e.call(this,t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/regexElements/device/MobileDeviceUARegexElementCollection",["require","exports","../RegexElementCollection","./DeviceRegexElement"],function(e,t,n,r){"use strict";return function(e){function t(){var t=[new r("(Fennec)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)","FireFox Mobile"),new r("(Fennec)/(\\d+)\\.(\\d+)(pre)","FireFox Mobile"),new r("(Fennec)/(\\d+)\\.(\\d+)","FireFox Mobile"),new r("Mobile.*(Firefox)/(\\d+)\\.(\\d+)","FireFox Mobile"),new r("(Opera)/.+Opera Mobi.+Version/(\\d+)\\.(\\d+)","Opera Mobile"),new r("Opera Mobi","Opera Mobile"),new r("(Opera Mini)/(\\d+)\\.(\\d+)","Opera Mini"),new r("(Opera Mini)/att/(\\d+)\\.(\\d+)","Opera Mini"),new r("(Jasmine|Opera Mini||UP\\.Browser|)/(\\d+)\\.(\\d+)\\.(\\d+)"),new r("(Bolt|BOLT|Jasmine|Opera Mini|Opera|Dolfin|Tizen Browser|Polaris)/(\\d+)\\.(\\d+)"),new r("(Jasmine|Polaris|Android|BREW) (\\d+)\\.(\\d+)\\.?(\\d+)?")];return e.call(this,t)||this}return __extends(t,e),t}(n)}),define("ubp/extension/runtime/platformInfo/userAgent/regexElements/device/DeviceRegexElementCollection",["require","exports","./TabletDeviceUARegexElementCollection","./MobileDeviceUARegexElementCollection"],function(e,t,n,r){"use strict";return function(){function e(){this._uaRegexElementArray=[new n,new r]}return e.prototype.accept=function(e){for(var t=0,n=this._uaRegexElementArray.length;t<n;t++)this._uaRegexElementArray[t].accept(e)},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/regexElements/browsers/ChromeLikeBrowserRegexElementCollection",["require","exports","../RegexElementCollection","./BrowserRegexElement"],function(e,t,n,r){"use strict";return function(e){function t(){var t=[new r("(Chrome)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+) Mobile","Chrome Mobile"),new r("(Chromium|Maxthon|Chrome|Vienna)/(\\d+)\\.(\\d+)\\.(\\d+)"),new r("(Maxthon|Chrome)/(\\d+)\\.(\\d+)"),new r("(MetaSr) (\\d+)\\.(\\d+)"),new r("(Fennec)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)","Firefox mobile"),new r("(Fennec)/(\\d+)\\.(\\d+)(pre)","Firefox mobile"),new r("(Fennec)/(\\d+)\\.(\\d+)","Firefox mobile"),new r("Mobile.*(Firefox)/(\\d+)\\.(\\d+)","Firefox mobile"),new r("(Firefox)/(\\d+)\\.(\\d+)(a\\d+[a-z]*)","Firefox alpha"),new r("(Firefox)/(\\d+)\\.(\\d+)(b\\d+[a-z]*)","Firefox beta"),new r("(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(a\\d+[a-z]*)","Firefox alpha"),new r("(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(b\\d+[a-z]*)","Firefox beta"),new r("(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+)"),new r("(Firefox)/(\\d+)\\.(\\d+)(pre|[ab]\\d+[a-z]*)?")];return e.call(this,t)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/platformInfo/userAgent/parsers/ChromelikeUAParser",["require","exports","./UserAgentParser","../regexElements/os/OSRegexElementCollection","../regexElements/device/DeviceRegexElementCollection","../regexElements/browsers/ChromeLikeBrowserRegexElementCollection"],function(e,t,n,r,o,i){"use strict";return function(e){function t(){var t=[new r,new o,new i];return e.call(this,t)||this}return __extends(t,e),t}(n)});var factory=function(){"use strict";var e=function(){};return e.getWebRequestConfiguration=function(){return{enabled:!1,trackingURLPatterns:[]}},e};"undefined"!=typeof module&&module.exports?module.exports=factory():void 0!==define&&define("configuration/IntegrationTestConfiguration",[],factory),define("ubp/extension/runtime/chrome/WebRequestAccessor",["require","exports","../../../commons/logging/Logger","configuration/IntegrationTestConfiguration"],function(e,t,n,r){"use strict";return function(){function e(t,o){this._namespace=t,this._runtime=o,e._logger=e._logger||n.getLogger("WebRequestAccessor");try{this._webrequestConfiguration=r.getWebRequestConfiguration(),this._webrequestConfiguration&&this._webrequestConfiguration.enabled&&Array.isArray(this._webrequestConfiguration.trackingURLPatterns)&&this._webrequestConfiguration.trackingURLPatterns.length>0&&this._setupHandlers()}catch(t){e._logger.error("WebRequestAccessor","Error while setting up handlers"+t)}}return e.prototype._setupHandlers=function(){this._namespace.webRequest.onBeforeRequest.addListener(_.bind(this.onWebRequestBeforeRequest,this),{urls:this._webrequestConfiguration.trackingURLPatterns},["requestBody"]),this._namespace.webRequest.onBeforeSendHeaders.addListener(_.bind(this.onWebRequestBeforeSendHeaders,this),{urls:this._webrequestConfiguration.trackingURLPatterns},["requestHeaders"]),this._namespace.webRequest.onCompleted.addListener(_.bind(this.onWebRequestCompleted,this),{urls:this._webrequestConfiguration.trackingURLPatterns},["responseHeaders"])},e.prototype.onWebRequestBeforeRequest=function(t){try{this._runtime.notify(this._runtime.RUNTIME_EVENT,{name:e._ON_BEFORE_REQUEST_EVENT,eventArgs:{tabId:t.tabId,requestId:t.requestId,url:t.url,method:t.method,frameId:t.frameId,parentFrameId:t.parentFrameId,timeStamp:t.timeStamp,requestBody:t.requestBody,type:t.type},tabId:t.tabId})}catch(t){e._logger.error("onWebRequestBeforeRequest","Error while notifying"+t)}},e.prototype.onWebRequestBeforeSendHeaders=function(t){try{this._runtime.notify(this._runtime.RUNTIME_EVENT,{name:e._ON_BEFORE_SEND_HEADERS_EVENT,eventArgs:{tabId:t.tabId,requestId:t.requestId,url:t.url,method:t.method,frameId:t.frameId,parentFrameId:t.parentFrameId,timeStamp:t.timeStamp,type:t.type,initiator:t.initiator,requestHeaders:t.requestHeaders},tabId:t.tabId})}catch(t){e._logger.error("onWebRequestBeforeSendHeaders","Error while notifying"+t)}},e.prototype.onWebRequestCompleted=function(t){try{this._runtime.notify(this._runtime.RUNTIME_EVENT,{name:e._ON_COMPLETED_EVENT,eventArgs:{tabId:t.tabId,requestId:t.requestId,url:t.url,method:t.method,frameId:t.frameId,parentFrameId:t.parentFrameId,timeStamp:t.timeStamp,type:t.type,ip:t.ip,fromCache:t.fromCache,statusCode:t.statusCode,responseHeaders:t.responseHeaders,statusLine:t.statusLine},tabId:t.tabId})}catch(t){e._logger.error("onWebRequestCompleted","Error while notifying"+t)}},e._ON_BEFORE_REQUEST_EVENT="WebRequest.onBeforeRequest",e._ON_BEFORE_SEND_HEADERS_EVENT="WebRequest.onBeforeSendHeaders",e._ON_COMPLETED_EVENT="WebRequest.onCompleted",e}()}),define("ubp/commons/specification/arguments/Platform/Sandbox/StaticSandboxProxy",["require","exports"],function(e,t){"use strict";return{LocalProxy:"LocalProxy",CookieProxy:"CookieProxy"}});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/extension/runtime/chrome/ChromelikeRuntime",["require","exports","lib/bluebird","lib/lodash","../BaseRuntime","../../process/IFrameProcess","./ChromelikeContentScripts","../../../commons/logging/Logger","../../../commons/error/Errors","./ChromeLikePanelRuntime","../platformInfo/userAgent/parsers/ChromelikeUAParser","../../../commons/error/FeatureUnavailableError","../../../commons/error/InternalError","./WebRequestAccessor","../../../commons/specification/arguments/Platform/Sandbox/StaticSandboxProxy"],function(e,t,n,r,o,i,s,a,u,c,l,p,f,d,h){"use strict";var _;return function(e){function t(n){var o=e.call(this)||this;return o.DESKTOP_NOTIFICATION_EVENT="DesktopNotificationEvent",o._templateTypeMap={1:"basic",2:"image"},o._availableFramePool=[],o.name="Chromelike",o._namespace=n||chrome,o.createLogger(),o._namespace.tabs.onUpdated.addListener(r.bind(o._onChromelikePageTurn,o)),o._namespace.runtime.onMessage.addListener(r.bind(o._onChromelikeExternalMessage,o)),o._namespace.tabs.onRemoved.addListener(r.bind(o._onChromelikeTabRemoved,o)),o._namespace&&o._namespace.contextMenus&&o._namespace.contextMenus.onClicked.addListener(r.bind(o._onChromelikeContextMenuClick,o)),o._redirectURLMap={},o._contentTypeMap={},o.panelRuntime=o.createPanelRuntime(),t._logger.info("constructor","ChromelikeRuntime constructed"),o.webRequestAccessor=new d(o._namespace,o),o}return __extends(t,e),t.prototype._onChromelikeContextMenuClick=function(e,t){var n={menuItemId:e.menuItemId,tabId:t.id?t.id.toString():null,tabUrl:t.url,srcUrl:e.srcUrl,selectionText:e.selectionText,parentMenuItemId:e.parentMenuItemId,mediaType:e.mediaType,linkUrl:e.linkUrl,pageUrl:e.pageUrl,frameUrl:e.frameUrl,frameId:e.frameId};this._onContextMenuClick(n)},t.prototype.isContextMenuApiSupported=function(){return!0},t.prototype.createContextMenuItem=function(e){var r=this;return new n(function(n,o){r._namespace&&r._namespace.contextMenus?n(r._namespace.contextMenus.create(e,function(){if(void 0!==chrome.runtime.lastError){var e=new f(chrome.runtime.lastError.message);t._logger.error("createContextMenuItem",e.toString()),o(e)}})):o(new p("chrome.contextMenus.create API unavailable"))})},t.prototype.deleteAllContextMenuItems=function(){var e=this;return new n(function(t,n){e._namespace&&e._namespace.contextMenus&&e._namespace.contextMenus.removeAll?e._namespace.contextMenus.removeAll(function(){t()}):n(new p("chrome.contextMenus.removeAll API is unavailable"))})},t.prototype.deleteContextMenuItemById=function(e){var t=this;return new n(function(n,r){t._namespace&&t._namespace.contextMenus&&t._namespace.contextMenus.remove?t._namespace.contextMenus.remove(e,function(){n()}):r(new p("chrome.contextMenus.remove API is unavailable"))})},t.prototype.getNamespace=function(){return this._namespace},t.prototype.createLogger=function(){t._logger=t._logger||a.getLogger("ChromelikeRuntime")},t.prototype._onChromelikeExternalMessage=function(e,t){e&&"number"==typeof e.performanceType||this._onExternalMessage(e,t.tab.id.toString())},t.prototype.createPanelRuntime=function(){return new c(chrome)},t.prototype.createProcessInstance=function(e,t,n){return new i(e,t,n,this._availableFramePool.pop())},t.prototype.destroyProcessInstance=function(e){var t=this;return e.terminate().then(function(e){t._availableFramePool.push(e)})},t.prototype.sendMessage=function(e,r,o){var i=this;return t._logger.debug("sendMessage","sendMessage called for tab: "+e),new n(function(n,r){i._namespace.tabs.sendMessage(parseInt(e),o,function(e){if(arguments.length)n(e);else{var o=new Error(this._namespace.runtime.lastError.toString());t._logger.error("sendMessage",o.toString()),r(o)}})}).timeout(this.MESSAGE_TIMEOUT)},t.prototype.executeScript=function(e,r){return t._logger.debug("executeScript","ExecuteScript called for file: "+r),new n(function(n,o){var i=this;this._namespace.tabs.executeScript(parseInt(e),{file:r,allFrames:!1,runAt:"document_idle"},function(e){if(i._checkLastError()){var r=new Error(i._namespace.runtime.lastError.toString());t._logger.error("executeScript",r.toString()),o(r)}n(null)})}.bind(this))},t.prototype.setTimeout=function(e,t){return window.setTimeout(e,t)},t.prototype.clearTimeout=function(e){window.clearTimeout(e)},t.prototype.delay=function(e){var t=this;return new n(function(n){t.setTimeout(n,e)})},t.prototype.executeScripts=function(e,r){return t._logger.debug("executeScripts","ExecuteScripts called for files: "+r),n.bind(this).then(function(){return r}).reduce(function(t,n){return t++,this.executeScript(e,n)},0).then(function(){return"chromelike"})},t.prototype.openNewTab=function(e){var r=this;return new n(function(n,o){r._namespace&&r._namespace.tabs&&r._namespace.tabs.create?r._namespace.tabs.create({url:e},function(e){if(e&&void 0!==e.id)n(e.id.toString());else{var r=new Error(this._namespace.runtime.lastError.toString());t._logger.error("openNewTab",r.toString()),o(r)}}):o(new Error("_namespace.tabs.create API unavailable"))}).timeout(this.NEW_TAB_TIMEOUT)},t.prototype.removeTab=function(e){var t=this;return new n(function(n,r){t._namespace&&t._namespace.tabs&&t._namespace.tabs.remove?t._namespace.tabs.remove(e,function(){n()}):r(new Error("_namespace.tabs.remove API unavailable"))})},t.prototype.createDesktopNotification=function(e,o){var i=this;return n.bind(this).then(function(){var n=i._prepareNotificationOptions(e,o);i._checkNotificationSupport(),i._registerClickHandler(),i._registerCloseHandler(),i._namespace.notifications.create(o.id,n,function(){});try{r.has(o,"redirectURL")&&(i._redirectURLMap[o.id]=o.redirectURL),r.has(o,"contentType")&&(i._contentTypeMap[o.id]=o.contentType),i._timeoutHandle=i.setTimeout(function(){delete i._redirectURLMap[o.id],delete i._contentTypeMap[o.id],i._namespace.notifications.clear(o.id),i._publishNotificationEvent("DesktopNotification.Closed",o.id,"Closed")},t.NOTIFICATION_TIMEOUT)}catch(e){t._logger.error("createDesktopNotification","Error during notification creation for notificationID ["+o.id+"] "+e)}})},t.prototype.getCookieInfo=function(e,r){var o=this;return new n(function(n,i){try{o._namespace&&o._namespace.cookies&&o._namespace.cookies.get?o._namespace.cookies.get({name:e,url:r},function(e){if(e&&void 0!==e.name){var t={name:e.name,domain:e.domain,value:e.value,path:e.path,session:e.session,expirationDate:e.expirationDate},r={cookieFound:!0,cookieInfo:t};n(r)}else{var r={cookieFound:!1};n(r)}}):i(new Error("_namespace.cookies.get API unavailable"))}catch(e){var s=new Error(o._namespace.runtime.lastError.toString());t._logger.error("getCookieInfo",s.toString()),i(s)}})},t.prototype.bulkGetCookieInfo=function(e,r){var o=this;return new n(function(n,i){try{o._namespace&&o._namespace.cookies&&o._namespace.cookies.getAll?o._namespace.cookies.getAll({url:r},function(t){var r={};t.forEach(function(t){if(-1!==e.indexOf(t.name)){var n={name:t.name,domain:t.domain,value:t.value,path:t.path,session:t.session,expirationDate:t.expirationDate};r[t.name]=n}}),n({cookieInfoMap:r})}):i(new Error("_namespace.cookies.getAll API unavailable"))}catch(e){var s=new Error(o._namespace.runtime.lastError.toString());t._logger.error("bulkGetCookieInfo",s.toString()),i(s)}})},t.prototype.getActiveTabInfo=function(){var e=this;return new n(function(t,n){e._namespace.tabs.query({active:!0,lastFocusedWindow:!0},function(e){e.length>0?t({activeTab:e[0].id.toString(),title:e[0].title,url:e[0].url}):n(u.NotFound("No active tab found."))})})},t.prototype.renderButtonText=function(e){var t=this;return new n(function(n,o){if(!(t._namespace&&t._namespace.browserAction&&t._namespace.browserAction.setIcon))return void o(new Error("_namespace.browserAction.setIcon API unavailable"));t._namespace.browserAction.setIcon({path:{16:chrome.extension.getURL("static/images/asmile_16.png"),48:chrome.extension.getURL("static/images/asmile_48.png"),128:chrome.extension.getURL("static/images/asmile_128.png")}},function(){if(!t._namespace.browserAction.setBadgeBackgroundColor||!t._namespace.browserAction.setBadgeText)return void o(new Error("_namespace.browserAction.setBadgeBackgroundColor or _namespace.browserAction.setBadgeText API unavailable"));if(t._namespace.browserAction.setBadgeBackgroundColor({color:t.BADGE_COLOR}),null===e||r.isUndefined(e)||""===e.trim())t._namespace.browserAction.setBadgeText({text:""});else{var i=e||"";t._namespace.browserAction.setBadgeText({text:i})}n()})})},t.prototype._onChromelikePageTurn=function(e,t,n){n.incognito||(t.title?this._onPageTurn(e.toString(),n.url,"title",n.title):this._onPageTurn(e.toString(),n.url,t.status,n.title))},t.prototype._onChromelikeTabRemoved=function(e,t){this._onTabRemoved(e.toString())},t.prototype.getExtensionVersion=function(){return this._namespace.runtime.getManifest().version},t.prototype.getExtensionResourceURL=function(e){void 0===e&&(e="");try{return this._namespace.runtime.getURL(e)}catch(e){return""}},t.prototype.getUserAgent=function(){var e;try{e=window.navigator.userAgent}catch(e){throw u.NotFound("Not able to get userAgent from winow object, Error: "+e.message)}return e},t.prototype.getCookies=function(e){return n.resolve()},t.prototype.getTotalTabsByQuery=function(e){var t=this;return new n(function(n){t._namespace.tabs.query(e,function(e){n(void 0!=e?e.length:0)})})},t.prototype.onCookieChangeAction=function(){return n.resolve()},t.prototype.getRuntimeName=function(){return this.name},t.prototype.getContentScripts=function(){return t.CONTENT_SCRIPTS},t.prototype.getLocalProxyUrl=function(){return this._namespace.runtime.getURL(t.LOCAL_PROXY_PATH)},t.prototype.getStaticAssetProxy=function(e){return this._namespace.runtime.getURL(t._staticProxyTypeToUrl[e])},t.prototype.getFromExtensionStorage=function(e){return new n(function(n,r){var o=[];o.push(e),this._bulkGetFromChromeExtensionStorage(o,function(o,i){o?(t._logger.error("getFromExtensionStorage","Error during extension storage get for key ["+e+"] "+o),r(o)):(t._logger.debug("getFromExtensionStorage","extension storage value for key ["+e+"] = ["+i+"]"),n(i[e]))})}.bind(this))},t.prototype.bulkGetFromExtensionStorage=function(e){return new n(function(n,r){this._bulkGetFromChromeExtensionStorage(e,function(e,o){e?(t._logger.error("bulkGetFromExtensionStorage","Error during extension storage get "+e),r(e)):(t._logger.debug("bulkGetFromExtensionStorage","extension storage values retrieved = ["+JSON.stringify(o)+"]"),n(o))})}.bind(this))},t.prototype._bulkGetFromChromeExtensionStorage=function(e,n){this._namespace&&this._namespace.storage&&this._namespace.storage.local&&this._namespace.storage.local.get(e,function(e){if(this._checkLastError())t._logger.error("_bulkGetFromChromeExtensionStorage","Error during retrieving values from storage "),n(new Error("Error during retrieving values from storage"),null);else{var o={};e&&r.forEach(e,function(n,r){o[r]=t._stringifyIfNotString(e[r])}),n(null,o)}}.bind(this))},t.prototype.putInExtensionStorage=function(e,r){var o=this;return n.bind(this).then(function(){o._putInExtensionStorage(e,r,function(n){if(n)throw t._logger.error("putInExtensionStorage","Error during extension storage set for key ["+e+"] "+n),n;t._logger.debug("putInExtensionStorage","extension storage stored key/value pair ["+e+"] = ["+r+"]")})})},t.prototype._putInExtensionStorage=function(e,n,r){var o={};o[e]=n,this._namespace&&this._namespace.storage&&this._namespace.storage.local&&this._namespace.storage.local.set(o,function(){this._checkLastError()?(t._logger.error("putInExtensionStorage","Error during storing value in storage "),r(new Error("Error in storing data in storage"))):r(null)}.bind(this))},t.prototype.removeFromExtensionStorage=function(e){return new n(function(n,r){this._removeFromExtensionStorage(e,function(o){o?(t._logger.error("removeFromExtensionStorage","Error during extension storage remove for key ["+e+"] "+o),r(o)):(t._logger.debug("removeFromExtensionStorage","extension storage successfully deleted key ["+e+"]"),n())})}.bind(this))},t.prototype._removeFromExtensionStorage=function(e,n){
this._namespace&&this._namespace.storage&&this._namespace.storage.local&&this._namespace.storage.local.remove(e,function(){this._checkLastError()?(t._logger.error("removeFromExtensionStorage","Error during deleting key from storage "),n(new Error("Error in deleting data from storage"))):n(null)}.bind(this))},t.prototype.bulkGetFromPreferencesStorage=function(e){return n.resolve({})},t.prototype.getFromPreferencesStorage=function(e){return n.resolve("")},t.prototype.putInPreferencesStorage=function(e,t){return n.resolve()},t.prototype.removeFromPreferencesStorage=function(e){return n.resolve()},t.prototype.getValueFromLocalStorage=function(e){return n.bind(this).then(function(){var n=localStorage.getItem(e);return t._stringifyIfNotString(n)}).catch(function(e){return e.message+=" (this may be a localStorage failure due to cookies being disabled)",t._logger.error("getValueFromLocalStorage",e.toString()),n.reject(e)})},t.prototype.bulkGetFromLocalStorage=function(e){var o={};return n.bind(this).then(function(){return r.forEach(e,function(e){var n=localStorage.getItem(e);o[e]=t._stringifyIfNotString(n)}),o}).catch(function(e){return e.message+=" (this may be a localStorage failure due to cookies being disabled)",t._logger.error("bulkGetFromLocalStorage",e.toString()),n.reject(e)})},t.prototype.setValueInLocalStorage=function(e,r){return n.bind(this).then(function(){localStorage.setItem(e,r)}).catch(function(e){return e.message+=" (this may be a localStorage failure due to cookies being disabled)",t._logger.error("setValueInLocalStorage",e.toString()),n.reject(e)})},t.prototype.removeValueFromLocalStorage=function(e){return n.bind(this).then(function(){localStorage.removeItem(e)}).catch(function(e){return e.message+=" (this may be a localStorage failure due to cookies being disabled)",t._logger.error("removeValueFromLocalStorage",e.toString()),n.reject(e)})},t.prototype.reloadExtension=function(){var e=this;return n.bind(this).then(function(){e._namespace&&e._namespace.runtime&&e._namespace.runtime.reload&&e._namespace.runtime.reload()})},t.prototype.onExtensionReload=function(e){this.on("onExtensionReload",function(){e()})},t.prototype.isOnline=function(){return n.bind(this).then(function(){return!(window&&window.navigator&&!window.navigator.onLine)})},t.prototype.onBrowserOnline=function(e){window&&window.addEventListener&&window.addEventListener("online",function(t){"function"==typeof e&&e()})},t.prototype._logLastRuntimeError=function(){this._namespace&&this._namespace.runtime&&this._namespace.runtime.lastError&&t._logger.error("_checkLastError","Last error in ChromelikeRuntime: "+JSON.stringify(this._namespace.runtime.lastError))},t.prototype._checkLastError=function(){return this._logLastRuntimeError(),!!this._namespace.runtime.lastError},t._stringifyIfNotString=function(e){return e&&"string"!=typeof e?JSON.stringify(e):e},t.prototype.processRemoteConfigurationData=function(e){return n.resolve()},t.prototype.getUAParser=function(){return new l},t.prototype.enableExtensionFeature=function(){return n.resolve(!0)},t.prototype.registerNotificationHandler=function(e){this.on(this.DESKTOP_NOTIFICATION_EVENT,e)},t.prototype._notificationClickHandler=function(e){if(this._redirectURLMap[e]){if(this._namespace.notifications.clear(e),this.openNewTab(this._redirectURLMap[e]),delete this._redirectURLMap[e],r.isUndefined(this._timeoutHandle))throw u.NotFound("Timeout handle not found");this.clearTimeout(this._timeoutHandle),this.notify(this.RUNTIME_EVENT,{name:"DesktopNotification.Clicked",eventArgs:{notificationId:e,status:"Clicked",contentType:void 0!==this._contentTypeMap[e]?this._contentTypeMap[e]:"Default"}}),delete this._contentTypeMap[e],this._publishNotificationEvent("DesktopNotification.Closed",e,"Closed")}},t.prototype._notificationCloseHandler=function(e){this._publishNotificationEvent("DesktopNotification.Closed",e,"Closed")},t.prototype._publishNotificationEvent=function(e,t,n){this.notify(this.DESKTOP_NOTIFICATION_EVENT,{name:e,eventArgs:{notificationId:t,status:n}})},t.prototype._registerClickHandler=function(){this._namespace.notifications&&!t.NOTIFICATION_ONCLICK_REGISTERED&&(this._namespace.notifications.onClicked.addListener(r.bind(this._notificationClickHandler,this)),t.NOTIFICATION_ONCLICK_REGISTERED=!0)},t.prototype._registerCloseHandler=function(){this._namespace.notifications&&!t.NOTIFICATION_ONCLOSE_REGISTERED&&(this._namespace.notifications.onClosed.addListener(r.bind(this._notificationCloseHandler,this)),t.NOTIFICATION_ONCLOSE_REGISTERED=!0)},t.prototype._checkNotificationSupport=function(){if(!(this._namespace&&this._namespace.notifications&&this._namespace.notifications.create))throw u.FeatureUnavailable("Chrome.Notifications API is unavailable")},t.prototype._prepareNotificationOptions=function(e,t){var n={type:this._templateTypeMap[e],title:t.title,message:t.text,iconUrl:chrome.extension.getURL("static/images/notif-icon.png")};return t.iconURL&&(n.iconUrl=t.iconURL),n},t.prototype.uninstallSelf=function(e){var r=this;return new n(function(n,o){r._namespace&&r._namespace.management&&r._namespace.management.uninstallSelf?r._namespace.management.uninstallSelf({showConfirmDialog:e},function(){this._checkLastError()?(t._logger.error("uninstallSelf","Error while uninstalling the extension "),o(this._namespace.runtime.lastError.message)):n()}.bind(r)):o(new p("chrome.management.uninstallSelf API is unavailable"))})},t.prototype.getExtensionDetails=function(){var e=this;return new n(function(n,r){e._namespace&&e._namespace.management&&e._namespace.management.getSelf?e._namespace.management.getSelf(function(e){this._checkLastError()?(t._logger.error("getExtensionDetails","Error while retrieving extension details"),r(this._namespace.runtime.lastError.message)):n(e)}.bind(e)):r(new p("chrome.management.getSelf API is unavailable"))})},t.CONTENT_SCRIPTS=new s,t.LOCAL_PROXY_PATH="static/html/localProxy.html",t._staticProxyTypeToUrl=(_={},_[h.LocalProxy]="static/html/localProxy.html",_[h.CookieProxy]="static/html/cookieProxy.html",_),t.NOTIFICATION_TIMEOUT=8e3,t.NOTIFICATION_ONCLICK_REGISTERED=!1,t.NOTIFICATION_ONCLOSE_REGISTERED=!1,t.RED_DOT_BADGE=".",t}(o)}),define("ubp/commons/messaging/clients/network/HTTPMethod",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.GET=1]="GET",e[e.HEAD=2]="HEAD",e[e.POST=3]="POST",e[e.PUT=4]="PUT"}(n||(n={})),n}),define("ubp/commons/messaging/clients/network/XHRState",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.UNSENT=0]="UNSENT",e[e.OPENED=1]="OPENED",e[e.HEADERS_RECEIVED=2]="HEADERS_RECEIVED",e[e.LOADING=3]="LOADING",e[e.DONE=4]="DONE"}(n||(n={})),n}),define("ubp/commons/messaging/clients/network/HTTPStatus",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.OK=200]="OK",e[e.CREATED=201]="CREATED",e[e.ACCEPTED=202]="ACCEPTED",e[e.NO_CONTENT=204]="NO_CONTENT",e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.NOTFOUND=404]="NOTFOUND",e[e.INTERNAL_ERROR=500]="INTERNAL_ERROR"}(n||(n={})),n}),define("ubp/commons/messaging/clients/network/NetworkRequestError",["require","exports"],function(e,t){"use strict";return function(){function e(e,t,n,r,o){this.error=e||new Error("Network Error"),this.status=t,this.statusText=n,this.didTimeout=r||!1,this.responseText=o||""}return e}()}),define("ubp/commons/messaging/clients/network/NetworkClientError",["require","exports","lib/lodash"],function(e,t,n){"use strict";return function(){function e(e,t,r,o){var i=n.isUndefined(o)?"":"URL: "+o+", ",s=n.isUndefined(t)?"":t+", ",a=n.isUndefined(r)?"":"response: "+r;this.status=t,this.responseText=r,this.message=e+": "+s+i+a}return Object.defineProperty(e.prototype,"name",{get:function(){return e.Name},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.name+": "+this.message},e.Name="NetworkClientError",e}()}),define("ubp/commons/messaging/clients/network/BaseNetworkClient",["require","exports","lib/bluebird","lib/lodash","./HTTPStatus","./HTTPMethod","./NetworkRequestError","./NetworkClientError"],function(e,t,n,r,o,i,s,a){"use strict";return function(){function e(e){this._defaultConfig={headers:{},timeout:0,httpMethod:i.GET,maxAttempts:1,backoffFactor:2,initialRetryInterval:1e3,withCredentials:!1},this.delay=e||r.bind(n.delay,n)}return e.prototype.request=function(e,t,o){var s=this;return n.bind(this).then(function(){if(t||(t={}),r.defaults(t,s._defaultConfig),!e||"string"!=typeof e)throw new Error("Must provide a string URL: "+e);if(!i[t.httpMethod])throw new Error("Unrecognized HTTPMethod: "+t.httpMethod);if((t.httpMethod===i.GET||t.httpMethod===i.HEAD)&&t.data)throw new Error("Cannot send data in a GET or HEAD request");var n=t.maxAttempts;return s._buildAndSendRequestWithRetries(e,t,n,o)})},e.prototype._buildAndSendRequest=function(e,t){throw new Error("Implement me! I'm abstract and stuff!")},e.prototype._buildAndSendRequestWithRetries=function(t,o,i,u){var c=this;return n.bind(this).then(function(){if(r.isFunction(u))return u()}).then(function(){return c._buildAndSendRequest(t,o)}).catch(function(r){if(!(r instanceof s))throw r;if(i--,e.isHTTPStatus5xx(r.status)){if(i<=0)throw new a("Network request failed with 5xx error",r.status,r.responseText);return n.bind(c).then(function(){return c.delay(Math.pow(o.backoffFactor,o.maxAttempts-i-1)*o.initialRetryInterval,"_BuildAndSendRequestWithRetries.DelayBetweenAttempts")}).then(function(){return c._buildAndSendRequestWithRetries(t,o,i,u)})}throw e.isHTTPStatus2xx(r.status)?new a("Non-approved 2xx Success",r.status,r.responseText,t):e.isHTTPStatus3xx(r.status)?new a("3xx Redirection",r.status,r.responseText,t):e.isHTTPStatus4xx(r.status)?new a("4xx Client Error",r.status,r.responseText,t):new a("non-2xx/3xx/4xx/5xx status: URL: "+t+" Error: "+JSON.stringify(r))})},e.isHTTPStatusSuccessful=function(e){return e===o.OK||e===o.CREATED||e===o.ACCEPTED||e===o.NO_CONTENT},e.isHTTPStatus2xx=function(e){return 2===Math.floor(e/100)},e.isHTTPStatus3xx=function(e){return 3===Math.floor(e/100)},e.isHTTPStatus4xx=function(e){return 4===Math.floor(e/100)},e.isHTTPStatus5xx=function(e){return 5===Math.floor(e/100)},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/messaging/clients/network/XHRNetworkClient",["require","exports","lib/bluebird","lib/lodash","./HTTPMethod","./XHRState","./BaseNetworkClient","./NetworkRequestError","../../../logging/Logger"],function(e,t,n,r,o,i,s,a,u){"use strict";return function(e){function t(t){var n=e.call(this)||this;if(n.xhr=t||XMLHttpRequest,!n.xhr)throw new Error("Needs a native XHR constructor");return n}return __extends(t,e),t.prototype._buildAndSendRequest=function(e,t){var s=this;return new n(function(n,u){var c=new s.xhr;t.withCredentials&&(c.withCredentials=!0),c.open(o[t.httpMethod],e,!0),r.each(t.headers,function(e,t){c.setRequestHeader(t,e)}),t.responseType&&"responseType"in c&&(c.responseType=t.responseType),c.timeout=t.timeout,c.ontimeout=function(){u(new a(new Error("Request timed out"),void 0,void 0,!0))},c.onreadystatechange=function(){switch(c.readyState){case i.DONE:s.onRequestCompleted(c,t,n,u)}};try{c.send(t.data)}catch(e){u(e)}})},t.prototype.onRequestCompleted=function(e,t,n,o){if(s.isHTTPStatusSuccessful(e.status)){var i=null;try{i=e.response||e.responseText||e.responseXML}catch(e){}if("string"==typeof i&&"json"===t.responseType)try{i=JSON.parse(i)}catch(e){}n({data:i,headers:this.parseResponseHeaders(e.getAllResponseHeaders()),status:e.status,statusText:e.statusText})}else{var u="";try{"json"===e.responseType?r.isObject(e.response)?u=JSON.stringify(e.response):r.isString(e.response)&&(u=e.response):""!==e.responseType&&"text"!==e.responseType||(u=e.responseText)}catch(e){}o(new a(new Error("HTTP status code: "+e.status+" "+e.statusText),e.status,e.statusText,!1,u))}},t.prototype.parseResponseHeaders=function(e){var t={};if(!e)return t;var n=e.split("\r\n");return r.each(n,function(e){var n=e.indexOf(": "),r=e.slice(0,n);t[r]=e.slice(n+2)}),t},t.logger=u.getLogger("XHRNetworkClient"),t}(s)}),define("ubp/commons/Panel/messageSpecifications/PanelMessageName",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.GatewayURLResponse=1]="GatewayURLResponse",e[e.ClearPanelCache=2]="ClearPanelCache"}(n||(n={})),n}),define("ubp/commons/utilities/UUID",["require","exports"],function(e,t){"use strict";var n;return function(e){function t(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}e.v4=t}(n||(n={})),n});var factory=function(e){var t=function(){};return e.extend(t.prototype,{parse:function(e){return parseUri(e)}}),new t};parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},"undefined"!=typeof module&&module.exports?module.exports=factory(require("underscore")):void 0!==define&&define("bit/commons/uri",["underscore"],factory),define("ubp/commons/utilities/URI",["require","exports","bit/commons/uri","../../commons/error/BadRequestError"],function(e,t,n,r){"use strict";var o;return function(e){function t(e){if(!e||!e.domain||!e.scheme)throw new r("Invalid arguments received: "+JSON.stringify(e));var t=e.port?":"+e.port:"";return e.scheme+"://"+e.domain+t}function o(e){if(!e)throw new r("Invalid arguments received: "+e);var o=n.parse(e),i={path:o.path};return o.host&&(i.origin=t({scheme:o.protocol,domain:o.host,port:o.port})),o.query&&(i.queryString=o.query),o.anchor&&(i.fragment=o.anchor),i}function i(e,t){void 0===t&&(t=!0);var n="";if(!e||!e.path||!e.origin&&t)throw new r("Invalid arguments received: "+JSON.stringify(e));var o=e.queryString&&"?"!==e.queryString[0]?"?"+e.queryString:e.queryString||"",i=e.fragment&&"#"!==e.fragment[0]?"#"+e.fragment:e.fragment||"";return n=t?e.origin:"",n+=e.path+o+i}function s(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function a(e){if(void 0===e&&(e=""),!(e=e.length&&"?"===e[0]?e.substr(1):e))return{};var t={},n=e.split("&");return _.each(n,function(e){var n=e.split("=");t[decodeURIComponent(n[0])]=n[1]?decodeURIComponent(n[1]):""}),t}function u(e,t,n){if(!t)return e;e||(e="");var r=encodeURIComponent(t)+"="+encodeURIComponent(n||"");return e.indexOf("?")<0?e+="?"+r:e.indexOf("?")>=0&&(e+="&"+r),e}function c(e){return e&&e.split("/").length<3&&"/"!==e[0]?e:e.replace(/^(?:\/\/|[^\/]+)*\//,"/")}function l(e,t){return t?(e||(e=""),"string"!=typeof t&&(t=JSON.stringify(t)),e.indexOf("#")>0?e.replace(/(#).+/,"$1"+t):e+"#"+t):e}e.getOrigin=t,e.getURLComponents=o,e.getURL=i,e.getQueryParameterString=s,e.getQueryParamsObject=a,e.appendInURLParameter=u,e.getRelativePath=c,e.putHash=l}(o||(o={})),o}),define("ubp/commons/localization/Marketplace",["require","exports","./Locale"],function(e,t,n){"use strict";return function(){function e(){this.marketplaceIdMap={ATVPDKIKX0DER:n[n.US],A2EUQ1WTGCTBG2:n[n.CA],A1VC38T7YXB528:n[n.JP],AAHKV2X7AFYLW:n[n.CN],A1F83G8C2ARO7P:n[n.UK],A1PA6795UKMFR9:n[n.DE],A13V1IB3VIYZZH:n[n.FR],APJ6JRA9NG5V4:n[n.IT],A3HOBANJMCMD83:n[n.IT],A1RKKUPIHCS9HS:n[n.ES],AJZF8LZ1EJVJN:n[n.ES],A21TJRUUN4KGV:n[n.IN],A2XZLSVIQ0F4JT:n[n.IN],A1AM78C64UM0Y8:n[n.MX],A3P3J5A7D2ZVXI:n[n.MX],A2Q3Y263D00KWC:n[n.BR],AZXD3QD5B39HD:n[n.BR],A39IBJ37TRP1C6:n[n.AU],A1RNPCQ4K8U27I:n[n.AU],A2VIGQ35RCS4UG:n[n.AE],A34GYYCZVDBSIK:n[n.AE],A33AVAJ2PDY3EV:n[n.TR],A3CQBQD3RGPJR8:n[n.TR]}}return e.prototype.getMarketplaceById=function(e){return this.marketplaceIdMap[e]},e}()}),define("ubp/metrics/anonymous/ForesterMetricsLogger",["require","exports","lib/lodash","lib/bluebird","../../commons/utilities/URI","../../commons/localization/Marketplace","../../commons/messaging/clients/network/HTTPMethod","../../commons/messaging/clients/network/HTTPStatus","../../commons/error/InternalError","../../commons/error/ForbiddenError","../../commons/error/NotFoundError","../../commons/error/BadRequestError"],function(e,t,n,r,o,i,s,a,u,c,l,p){"use strict";return function(){function e(e,t,n){this._client=e,this._endpoint=t,this._marketplaceId=n}return e.prototype.report=function(e){var t=this;return r.bind(this).then(function(){if(e.userIdentifiable)throw new p("User identifiable metrics must not be reported through the the ForesterMetricsLogger");return e.realTimeTimers&&0!==n.size(e.realTimeTimers)||e.realTimeCounters&&0!==n.size(e.realTimeCounters)?t._formatAndSendRequestToForester(e):r.resolve()})},e.prototype._formatAndSendRequestToForester=function(t){var i=this;return r.bind(this).then(function(){var r=o.getURLComponents(i._endpoint);n.endsWith(r.path,e._URIPathDelimiter)||(r.path+=e._URIPathDelimiter),r.path+=i.buildMetricsPath(t),null!=r.queryString&&void 0!=r.queryString||(r.queryString=""),r.queryString.length>0&&(r.queryString+=e._URIQueryStringDelimiter),r.queryString+=i.buildQueryParameters(t);var s=o.getURL(r);return i._client.request(s,e._ForesterRequestConfig)}).then(function(e){switch(e.status){case a.OK:case a.ACCEPTED:case a.NO_CONTENT:case a.CREATED:return;case a.FORBIDDEN:throw new c(e.statusText);case a.NOTFOUND:throw new l(e.statusText);case a.INTERNAL_ERROR:throw new u(e.statusText);default:throw new u("Received an unexpected response from Forester ["+JSON.stringify(e)+"]")}})},e.prototype.buildMetricsPath=function(t){var r=this.formatResources(t.realTimeCounters,n.bind(this.formatCounterValue,this)),o=this.formatResources(t.realTimeTimers,n.bind(this.formatTimerValue,this)),i="prod"===t.extensionStage.toLowerCase()?t.operationName:"Test_"+t.operationName,s=i+"_:";return r&&(s+=r),r&&o&&(s+=e._ResourceDelimiter),o&&(s+=o),s},e.prototype.formatResources=function(t,r){return n.reduce(t,function(t,n,o){return t.push(o+e._ResourceKeyValueSeparator+r(n)),t},[]).join(e._ResourceDelimiter)},e.prototype.formatCounterValue=function(e){return"v="+e},e.prototype.formatTimerValue=function(t){return"v="+n.reduce(t,function(e,t){return e+t})+e._ResourceMetadataDelimiter+"u=ms"},e.prototype.buildQueryParameters=function(t){var n=new i,r={marketplaceId:this._marketplaceId,marketplace:n.getMarketplaceById(this._marketplaceId),requestId:t.requestId,service:e._ServiceNamePrefix+t.featureName,method:t.operationName,session:e._AnonymousSessionId};return o.getQueryParameterString(r)},e._ServiceNamePrefix="AmazonAssistant.",e._AnonymousSessionId="",e._ResourceDelimiter=",",e._ResourceMetadataDelimiter="|",e._ResourceKeyValueSeparator="@",e._URIPathDelimiter="/",e._URIQueryStringDelimiter="&",e._RequestTimeout=3e4,e._MaxAttempts=1,e._BackoffFactor=2,e._InitialRetryInterval=200,e._ForesterRequestConfig={httpMethod:s.GET,headers:{},timeout:e._RequestTimeout,initialRetryInterval:e._InitialRetryInterval,backoffFactor:e._BackoffFactor,maxAttempts:e._MaxAttempts,withCredentials:!1},e}()}),define("ubp/metrics/sentry/SentryWhiteList",["require","exports","lib/lodash","lib/bluebird"],function(e,t,n,r){"use strict";return function(){function e(){}return e.purge=function(e,t){var n=this;return e?r.bind(this).then(function(){return n._hasAllowedFeature(e,t)&&n._hasAllowedOperation(e,t)?(n._purgeMetricsMap(e,t.realTimeCounters,t.featureName,t.operationName),n._purgeMetricsMap(e,t.realTimeTimers,t.featureName,t.operationName),r.resolve(t)):r.resolve(void 0)}):r.resolve(t)},e._hasAllowedFeature=function(e,t){return null!=e[t.featureName]},e._hasAllowedOperation=function(e,t){return null!=e[t.featureName][t.operationName]},e._purgeMetricsMap=function(e,t,r,o){n.filter(Object.keys(t),function(t){return-1==n.indexOf(e[r][o],t)}).forEach(function(e){delete t[e]})},e}()}),define("ubp/metrics/sentry/Sentry",["require","exports","lib/lodash","lib/bluebird","../anonymous/ForesterMetricsLogger","../../commons/localization/Locale","../../commons/messaging/clients/network/HTTPMethod","./SentryWhiteList"],function(e,t,n,r,o,i,s,a){"use strict";return function(){function e(){if(this._configuration=null,this._networkClient=null,this._timer=null,this._refreshTimerId=null,this._refreshInterval=null,this._metricsLogger=null,this._locale=null,e._instance)throw new Error("Error: Instantiation failed: Use Sentry.getInstance() instead of new.");e._instance=this}return e.getInstance=function(){return null===e._instance&&(e._instance=new e),e._instance},e.prototype.init=function(e,t){this._networkClient=e,this._timer=t},e.prototype.getTimer=function(){return this._timer},e.prototype.configure=function(t,r,o){return this._configuration=t,this._locale=r,this._refreshInterval=o||e.DEFAULT_CONFIGURATION_REFRESH_INTERVAL,this._refreshTimerId&&this._timer.clearTimeout(this._refreshTimerId),n.isEmpty(this._configuration.remoteConfigurationEndpoint)?this._configureLocal():this._configureRemote()},e.prototype._configureRemote=function(){var t=this;return r.bind(this).then(function(){return t._networkClient.request(t._configuration.remoteConfigurationEndpoint,e.NETWORK_REQUEST_CONFIGURATION)}).then(function(e){var o=n.extend({merged:!0},t._configuration,e.data);return n.isEqual(o,t._configuration)?r.resolve():(t._configuration=o,t._configureLocal())}).finally(function(){t._refreshTimerId=t._timer.setTimeout(n.bind(function(){t._configureRemote()},t),t._refreshInterval)})},e.prototype._configureLocal=function(){return this._metricsLogger=new o(this._networkClient,this._configuration.foresterEndpoint,this._configuration.marketplaceId),r.resolve()},e.prototype.report=function(e){var t=this;return this._configuration&&this._configuration.isEnabled?r.bind(this).then(function(){var n={platformData:{locale:i[t._locale]},extensionStage:t._configuration.envStage,requestId:e.requestId,operationName:e.operationName,featureName:e.featureName,realTimeCounters:e.realTimeCounters,realTimeTimers:e.latenciesMapForRealTimeTimers};return a.purge(t._configuration.metricsWhiteList,n)}).then(function(e){return e?t._metricsLogger.report(e):r.resolve()}):r.resolve()},e.DEFAULT_CONFIGURATION_REFRESH_INTERVAL=216e5,e.RESPONSE_TYPE="json",e.MAX_ATTEMPTS=2,e.BACKOFF_FACTOR=2,e.NETWORK_TIMEOUT=3e4,e.INITIAL_RETRY_INTERVAL=1e3,e.NETWORK_REQUEST_CONFIGURATION={httpMethod:s.GET,maxAttempts:e.MAX_ATTEMPTS,responseType:e.RESPONSE_TYPE,backoffFactor:e.BACKOFF_FACTOR,timeout:e.NETWORK_TIMEOUT,initialRetryInterval:e.INITIAL_RETRY_INTERVAL},e._instance=null,e}()}),define("ubp/metrics/sentry/SentryReport",["require","exports","lib/lodash","lib/bluebird","../../commons/error/ConflictError","../../commons/error/BadRequestError","./Sentry"],function(e,t,n,r,o,i,s){"use strict";return function(){function e(e,t,r,o){this._realTimeCounters={},this._realTimeTimers={},this._timerTrackMap={},this._featureName=e,this._operationName=t,this._requestId=r,this._isValid=!0,n.isUndefined(o)?this._globalWindow="object"!=typeof window||n.isNull(window)?void 0:window:this._globalWindow=o}return Object.defineProperty(e.prototype,"requestId",{get:function(){return this._requestId},set:function(e){this._checkPublished(),this._requestId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"operationName",{get:function(){return this._operationName},set:function(e){this._checkPublished(),this._operationName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureName",{get:function(){return this._featureName},set:function(e){this._checkPublished(),this._featureName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"realTimeTimers",{get:function(){return this._realTimeTimers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latenciesMapForRealTimeTimers",{get:function(){var e={};return n.forEach(this._realTimeTimers,function(t,n){e[n]=t.latencies}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"realTimeCounters",{get:function(){return this._realTimeCounters},enumerable:!0,configurable:!0}),e.prototype.startRealTimeTimer=function(t,r){return this._checkPublished(),n.isUndefined(r)&&(r=this._getElapsedTimeSinceBrowserPageLoad()||e._getCurrentTime()),this._startTimer(t,r)},e.prototype.clearStartedRealTimeTimers=function(){var e=this._timerTrackMap;return this._timerTrackMap={},e},e.prototype._startTimer=function(e,t){if(this._timerTrackMap[e])throw new o("Timer already exists");this._timerTrackMap[e]=t},e.prototype._stopTimer=function(e,t,r){try{var i=this._timerTrackMap[e];if(!i){throw new o("Error! Trying to stop the timer that has not started yet")}var s=t-i;if(r[e]){var a=r[e];r[e].latencies.push(s);r[e].totalLatency=n.reduce(a.latencies,function(e,t){return e+t},0),r[e].numberOfInstances=a.latencies.length}else r[e]={},r[e].latencies=[],r[e].latencies.push(s),r[e].totalLatency=s,r[e].numberOfInstances=1}finally{delete this._timerTrackMap[e]}},e.prototype._setTimer=function(e,t,n,r){if(t<0||n<=0){throw new i("Error! The number of instances and/or latency of the timer ["+e+"] is invalid")}r[e]&&r[e].latencies&&r[e].latencies.splice(0,r[e].latencies.length),r[e]={},r[e].latencies=[],r[e].totalLatency=t,r[e].numberOfInstances=n,delete this._timerTrackMap[e]},e.prototype.setRealTimeTimer=function(e,t,n){return this._checkPublished(),n=n||1,this._setTimer(e,t,n,this._realTimeTimers)},e.prototype.stopRealTimeTimer=function(t,r){return this._checkPublished(),n.isUndefined(r)&&(r=this._getElapsedTimeSinceBrowserPageLoad()||e._getCurrentTime()),this._stopTimer(t,r,this._realTimeTimers)},e._getCurrentTime=function(){return(new Date).getTime()},e.prototype._incrementCounter=function(e,t,n){n[e]=(n[e]||0)+t},e.prototype.incrementRealTimeCounter=function(e,t){return void 0===t&&(t=1),this._checkPublished(),this._incrementCounter(e,t,this._realTimeCounters)},e.prototype._getElapsedTimeSinceBrowserPageLoad=function(){return this._globalWindow&&this._globalWindow.performance&&"function"==typeof this._globalWindow.performance.now?this._globalWindow.performance.now():null},e.prototype.isValid=function(){return this._isValid},e.prototype._checkPublished=function(){if(!this._isValid)throw new i("This object has already been published.")},e.prototype.publishAsync=function(){var e=this;return r.bind(this).then(function(){return e._checkPublished(),e._isValid=!1,s.getInstance().report(e)}).catch(function(t){return e._isValid=!0,r.reject(t)})},e.prototype.publish=function(){var e=this,t=s.getInstance().getTimer();if(!t&&this._globalWindow)t=this._globalWindow;else if(!t)throw new Error("Runtime doesn't support global window object and Sentry wasn't configured with Timer; unable to publish");t.setTimeout(n.bind(function(){e.publishAsync()},this),0)},e}()});var factory=function(){"use strict";var e=function(){};return e.getGlobalParameters=function(){return{browser:"chrome",partner:"",programCode:"",extensionStage:"prod",partnersRequiringTermsOfUse:["acer1","avast1","dell1","lenovo1","mozilla1","msi1","opera1","pokki1","toshiba1","samsung1","sleipnir1","hp1"],isTOURequired:function(){return this.partnersRequiringTermsOfUse.indexOf(this.partner)>=0},isTOURequiredForPartner:function(e){return this.partnersRequiringTermsOfUse.indexOf(e)>=0},pageMessagingDriverIncludePatterns:["*.amazon.com","*.amazon.ca","*.amazon.co.uk","*.amazon.de","*.amazon.es","*.amazon.it","*.amazon.fr","*.amazon.in","*.amazon.co.jp","*.amazon.cn","*.amazon.in","*.amazon.com.mx","*.amazon.ae","*.amazon.com.br","*.amazon.com.tr","*.amazon.com.au"],safariPageMessagingDriverIncludePatterns:["http://*.amazon.com/*","http://*.amazon.ca/*","http://*.amazon.co.uk/*","http://*.amazon.de/*","http://*.amazon.es/*","http://*.amazon.it/*","http://*.amazon.fr/*","http://*.amazon.co.jp/*","http://*.amazon.cn/*","http://*.amazon.in/*","http://*.amazon.com.mx/*","http://*.amazon.ae/*","http://*.amazon.com.tr/*","http://*.amazon.com.br/*","http://*.amazon.com.au/*","https://*.amazon.com/*","https://*.amazon.ca/*","https://*.amazon.co.uk/*","https://*.amazon.de/*","https://*.amazon.es/*","https://*.amazon.it/*","https://*.amazon.fr/*","https://*.amazon.co.jp/*","https://*.amazon.cn/*","https://*.amazon.in/*","https://*.amazon.com.mx/*","https://*.amazon.ae/*","https://*.amazon.com.tr/*","https://*.amazon.com.br/*","https://*.amazon.com.au/*"],setLocaleTimeout:2e4}},e};"undefined"!=typeof module&&module.exports?module.exports=factory():void 0!==define&&define("configuration/GlobalParameters",[],factory),define("ubp/extension/gateway/GatewayLoadEventConstants",["require","exports"],function(e,t){"use strict";return function(){function e(){}return e.PANEL_BOOTSTRAPPER="PanelBootstrapper",e.PANEL_BOOTSTRAPPER_SUCCESS="PanelBootstrapperSuccess",e.PANEL_BOOTSTRAPPER_FAILURE="PanelBootstrapperFailure",e.GATEWAY_URL="GatewayURL",e.CONNECT="Connect",e.DISCONNECT="Disconnect",e.YWAIN_INIT="YwainInit",e.YWAIN_ONE_PIXEL="YwainOnePixel",e.YWAIN_CALL_FEED="YwainCallFeed",e.YWAIN_SUCCESS="YwainSuccess",e.GATEWAY_LOAD_OPERATION="Gateway.ReportLoadEvent",e.GATEWAY_LOAD_FEATURE="Gateway",e.START_EVENT=e.CONNECT,e.END_EVENTS=[e.DISCONNECT,e.YWAIN_SUCCESS,"YwainFeedError","Panic_ext101","Panic_ext102","Panic_ext103","Panic_ext104"],e.MISSING_END_EVENT="MissingEndEvent",e.TIMEOUT_EVENT="Timeout",e.CANCEL_EVENTS=[e.DISCONNECT,e.MISSING_END_EVENT],e.SUCCESS_EVENTS=[e.YWAIN_SUCCESS],e.FAILURE_EVENTS=["YwainFeedError","Panic_ext101","Panic_ext102","Panic_ext103","Panic_ext104",e.TIMEOUT_EVENT],e.LATENCY_METRIC="Latency",e.INVALID_METRIC="Invalid",e.DELIMITER=".",e.SESSION_TIMEOUT=2e4,e.LOAD_SUCCESS="LoadSuccess",e.LOAD_FAILURE="LoadFailure",e.LOAD_CANCELLED="LoadCancelled",e.LOAD_INVALID="LoadInvalid",e}()}),define("ubp/extension/constant/Constant",["require","exports"],function(e,t){"use strict";return function(){function e(){}return e.GATEWAY_URL_LOCAL_STORAGE_KEY="UBPv2GatewayURL",e}()}),define("ubp/extension/panel/PanelManager",["require","exports","lib/lodash","lib/bluebird","../../commons/logging/Logger","../../commons/Panel/messageSpecifications/PanelMessageName","../../commons/error/BadRequestError","../../commons/utilities/UUID","../../metrics/sentry/SentryReport","configuration/GlobalParameters","../gateway/GatewayLoadEventConstants","../constant/Constant"],function(e,t,n,r,o,i,s,a,u,c,l,p){"use strict";return function(){function e(t,n,r){this._isStarted=!1,this._handlers={},this._urlFetchedFromStorage="",this._runtime=t,this._networkClient=n,this._client=r,e.logger=e.logger||o.getLogger("PanelManager")}return e.prototype.start=function(){var t=this;if(this._isStarted){var o=new Error("This PanelManager has already been started and can only be started once.");throw e.logger.error("start",o.toString()),o}return this._isStarted=!0,this._panelStartTimestamp=Date.now(),this._isFirstLoad=!0,r.bind(this).then(function(){return t._handlers[i.GatewayURLResponse]=n.bind(t._handleGatewayURLResponse,t),t._runtime.panelRuntime.addMessageListener("message",n.bind(t._gatewayMessageReceiver,t))}).then(function(){return t._runtime.getValueFromLocalStorage(p.GATEWAY_URL_LOCAL_STORAGE_KEY).then(function(n){if(n&&t._runtime.isOnline())return t._urlFetchedFromStorage=n,t._setNewGatewayURL(e.PANEL_IFRAME_ID,n)}).catch(function(t){e.logger.error("Failed to fetch gatewayURL from local storage: ",t.toString())})}).then(function(){return t._runtime.panelRuntime.createConnectionToExtension({name:e.PANEL_CONNECT_PORT_NAME})}).then(function(){
return t._runtime.panelRuntime.registerExtensionMessageHandler(n.bind(t._extensionMessageReceiver,t))}).then(function(){e.logger.info("start","Panel Manager started successfully")}).then(function(){t._runtime.panelRuntime.sendPostConnectionMessageToExtension(),e.logger.info("start","Panel Manager connect successfully")}).catch(function(n){throw t._isStarted=!1,e.logger.error("start","Failed to start PanelManager "+n.toString()),n})},e.prototype._handleGatewayURLResponse=function(t){var n=this;return r.bind(this).then(function(){var o=t.panelResponseData;if(!(o&&o.messageData&&o.messageData[e.GATEWAY_URL_NAME]))throw e.logger.error("_handleGatewayURLResponse","Unable to retrieve gateway URL from extension"),new s("Unable to retrieve gateway URL from extension");if(n._runtime.isOnline()){var i=o.messageData[e.GATEWAY_URL_NAME];return i===n._urlFetchedFromStorage?r.resolve():n._setNewGatewayURL(e.PANEL_IFRAME_ID,i)}})},e.prototype._handleReloadExtensionMessage=function(t){var n=this;return r.bind(this).then(function(){n._runtime.reloadExtension()}).catch(function(n){var r=new Error("Error occured while trying to reload extension");t.data&&"function"==typeof t.data.replyCallback&&t.data.replyCallback(r),e.logger.error("_handleReloadExtensionMessage",r.toString())}).then(function(){t.data&&"function"==typeof t.data.replyCallback&&t.data.replyCallback(null),e.logger.debug("_handleReloadExtensionMessage","Successfully called reload extension")})},e.prototype._extensionMessageReceiver=function(t){var n=this;return r.bind(this).then(function(){if(!t)throw e.logger.error("_extensionMessageReceiver","Message received is malformed"),new s("Message received is malformed");if(e.logger.debug("_extensionMessageReceiver",(t.data,JSON.stringify(t.data))),t.panelHeader){if(!t.panelHeader.messageName)throw e.logger.error("_extensionMessageReceiver","Message name is missing in the message"),new s("Message name is missing in the message");if(!n._handlers[t.panelHeader.messageName])throw e.logger.error("_extensionMessageReceiver","Unrecognized message type received, rejecting the message"),new s("Unrecognized message type received, rejecting the message");return n._handlers[t.panelHeader.messageName].call(n,t)}return n._runtime.sendMessageToIFrame(e.PANEL_IFRAME_ID,t)})},e.prototype._gatewayMessageReceiver=function(t){var n=this;return r.bind(this).then(function(){if(!t)throw e.logger.error("_gatewayMessageReceiver","Message received is malformed"),new s("Message received is malformed");if(e.logger.debug("_gatewayMessageReceiver",(t.data,JSON.stringify(t.data))),!t.panelHeader){var r=t.data&&t.data.payload&&t.data.payload.payload&&t.data.payload.payload.header;return r&&"Platform"===r.namespace&&("reloadExtension"===r.name?n._handleReloadExtensionMessage(t):"closePanel"===r.name&&n._runtime.closePanel()),n._runtime.panelRuntime.sendMessageToExtensionPort(t)}if(!t.panelHeader.messageName)throw e.logger.error("_gatewayMessageReceiver","Message name is missing in the message"),new s("Message name is missing in the message");if(!n._handlers[t.panelHeader.messageName])throw e.logger.error("_gatewayMessageReceiver","Unrecognized message type received from the gateway, rejecting the message"),new s("Unrecognized message type received from the gateway, rejecting the message");n._handlers[t.panelHeader.messageName].call(n)}).then(function(){e.logger.debug("_gatewayMessageReceiver","message handled successfully in Panel")})},e.prototype._setNewGatewayURL=function(t,n){var o=this;return e.logger.info("_setNewGatewayURL","changing gateway URL to "+n),r.bind(this).then(function(){if(!t)throw e.logger.error("_setNewGatewayURL","No valid iframe id specified"),new s("No valid iframe id specified");return e.logger.info("_setNewGatewayURL","Updating Gateway URL to => "+n),o._runtime.setURLForIframe(t,n)}).then(function(){if(o._isFirstLoad){var t=Date.now()-o._panelStartTimestamp;o._client.Gateway.reportLoadEvent(l.GATEWAY_URL,Date.now());var n=new u("Panel","PanelManager.GatewayURL-"+c.getGlobalParameters().extensionStage,a.v4());n.incrementRealTimeCounter("RequestTimeSuccess",t),n.incrementRealTimeCounter("RequestTimeSuccess."+c.getGlobalParameters().browser,t);try{n.publish()}catch(t){e.logger.error("_setNewGatewayURL","Error publishing GatewayURL metrics: "+t.toString())}}o._isFirstLoad=!1}).then(function(){e.logger.info("_setNewGatewayURL","gateway URL changed to ["+n+"]")})},e.GATEWAY_URL_LOCAL_STORAGE_KEY="UBPv2GatewayURL",e.GATEWAY_URL_NAME="gatewayURL",e.PANEL_IFRAME_ID="UBPv2MainPanelFrame",e.PANEL_CONNECT_PORT_NAME="UBPv2Panel",e}()}),define("ubp/extension/panel/configuration/LocalSentryConfiguration",["require","exports"],function(e,t){"use strict";var n;return function(e){function t(e){return n[e.toUpperCase()]}var n={US:{foresterEndpoint:"https://fls-na.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"ATVPDKIKX0DER",isEnabled:!0,envStage:"PROD",remoteConfigurationEndpoint:null},CA:{envStage:"PROD",isEnabled:!0,foresterEndpoint:"https://fls-na.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A2EUQ1WTGCTBG2",remoteConfigurationEndpoint:null},MX:{foresterEndpoint:"https://fls-na.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A1AM78C64UM0Y8",isEnabled:!0,envStage:"PROD",remoteConfigurationEndpoint:null},BR:{foresterEndpoint:"https://fls-na.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A2Q3Y263D00KWC",isEnabled:!0,envStage:"PROD",remoteConfigurationEndpoint:null},UK:{envStage:"PROD",isEnabled:!0,foresterEndpoint:"https://fls-eu.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A1F83G8C2ARO7P",remoteConfigurationEndpoint:null},DE:{envStage:"PROD",isEnabled:!0,foresterEndpoint:"https://fls-eu.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A1PA6795UKMFR9",remoteConfigurationEndpoint:null},FR:{envStage:"PROD",isEnabled:!0,foresterEndpoint:"https://fls-eu.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A13V1IB3VIYZZH",remoteConfigurationEndpoint:null},IT:{envStage:"PROD",isEnabled:!0,foresterEndpoint:"https://fls-eu.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"APJ6JRA9NG5V4",remoteConfigurationEndpoint:null},TR:{foresterEndpoint:"https://fls-eu.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A33AVAJ2PDY3EV",isEnabled:!0,envStage:"PROD",remoteConfigurationEndpoint:null},AE:{foresterEndpoint:"https://fls-eu.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A2VIGQ35RCS4UG",isEnabled:!0,envStage:"PROD",remoteConfigurationEndpoint:null},AU:{foresterEndpoint:"https://fls-fe.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A39IBJ37TRP1C6",isEnabled:!0,envStage:"PROD",remoteConfigurationEndpoint:null},JP:{envStage:"PROD",isEnabled:!0,foresterEndpoint:"https://fls-fe.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A1VC38T7YXB528",remoteConfigurationEndpoint:null},ES:{envStage:"PROD",isEnabled:!0,foresterEndpoint:"https://fls-eu.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A1RKKUPIHCS9HS",remoteConfigurationEndpoint:null},IN:{envStage:"PROD",isEnabled:!0,foresterEndpoint:"https://fls-eu.amazon.com/1/action-impressions/1/OE/bit-reporter/action",marketplaceId:"A21TJRUUN4KGV",remoteConfigurationEndpoint:null}};e.get=t}(n||(n={})),n}),define("ubp/commons/logging/ForesterAppender",["require","exports","lib/lodash","lib/bluebird","./LogLevel","../messaging/clients/network/HTTPMethod"],function(e,t,n,r,o,i){"use strict";return function(){function e(e,t,r,o){this._backoffInterval=3e4,this._shouldBackoff=!1,this._timer=null,this._client=e,this._endpoint=t,this._timer=r,n.isNumber(o)&&(this._backoffInterval=o)}return e.prototype.log=function(e,t,o,i,s,a){var u=this;return this._timer.setTimeout(n.bind(function(){u.logAsync(e,t,o,i,s,a)},this),0),r.resolve()},e.prototype.logAsync=function(t,o,i,s,a,u){var c=this;return r.bind(this).then(function(){if(c._shouldBackoff)return r.reject(new Error("ForesterAppender is in back-off mode."));var l=c._formatLogData(t,o,i,s,a,u);return c._client.request(c._endpoint,n.extend(e.NETWORK_REQUEST_CONFIGURATION,{data:l})).then(function(){return r.resolve()}).catch(function(e){return c._shouldBackoff=!0,c._timer.setTimeout(n.bind(function(){c._shouldBackoff=!1},c),c._backoffInterval),r.reject(new Error("ForesterAppender is in back-off mode."))})})},e.prototype._formatLogData=function(e,t,n,r,i,s){return(new Date).toUTCString()+" ["+o[e]+"] "+t+"."+n+" : "+r+", "+i+", "+s+"\n"},e.HEADERS={"Content-Type":"text/plain"},e.NETWORK_REQUEST_CONFIGURATION={httpMethod:i.POST,headers:e.HEADERS,maxAttempts:2,backoffFactor:2,timeout:3e4,initialRetryInterval:1e3},e}()}),define("ubp/commons/logging/ConsoleAppender",["require","exports","lib/bluebird","./LogLevel"],function(e,t,n,r){"use strict";return function(){function e(){}return e.prototype.log=function(e,t,o,i,s,a){switch(e){case r.DEBUG:console.debug(r[e],t,o,i,s,a);break;case r.INFO:console.info(r[e],t,o,i,s,a);break;case r.WARN:console.warn(r[e],t,o,i,s,a);break;case r.ERROR:case r.FATAL:console.error(r[e],t,o,i,s,a);break;default:console.log(r[e],t,o,i,s,a)}return n.resolve()},e}()}),define("ubp/commons/logging/LoggingManager",["require","exports","lib/lodash","lib/bluebird","./Logger","./LogLevel","./ForesterAppender","./ConsoleAppender","../messaging/clients/network/HTTPMethod"],function(e,t,n,r,o,i,s,a,u){"use strict";return function(){function e(){if(this._configuration=null,this._networkClient=null,this._timer=null,this._refreshTimerId=null,this._refreshInterval=null,e._instance)throw new Error("Error: Instantiation failed: Use LoggingManager.getInstance() instead of new.");e._instance=this}return e.getInstance=function(){return null===e._instance&&(e._instance=new e),e._instance},e.prototype.init=function(e,t){this._networkClient=e,this._timer=t},e.prototype.configure=function(t,r){return this._configuration=t,this._refreshInterval=r||e.DEFAULT_CONFIGURATION_REFRESH_INTERVAL,this._refreshTimerId&&this._timer.clearTimeout(this._refreshTimerId),n.isEmpty(this._configuration.remoteConfigurationEndpoint)?this._configureLocal():this._configureRemote()},e.prototype._configureRemote=function(){var t=this;return r.bind(this).then(function(){return t._networkClient.request(t._configuration.remoteConfigurationEndpoint,e.NETWORK_REQUEST_CONFIGURATION)}).then(function(e){var o=n.extend({merged:!0},t._configuration,e.data);return n.isEqual(o,t._configuration)?r.resolve():(t._configuration=o,t._configureLocal())}).finally(function(){t._refreshTimerId=t._timer.setTimeout(n.bind(function(){t._configureRemote()},t),t._refreshInterval)})},e.prototype._configureLocal=function(){return o.root.setLogLevel(i[this._configuration.rootLogLevel]),o.root.removeAppender(e.CONSOLE_LOG_APPENDER_ALIAS),o.root.addAppender(e.CONSOLE_LOG_APPENDER_ALIAS,new a),o.root.removeAppender(e.FORESTER_APPENDER_ALIAS),n.isEmpty(this._configuration.foresterEndpoint)||o.root.addAppender(e.FORESTER_APPENDER_ALIAS,new s(this._networkClient,this._configuration.foresterEndpoint,this._timer,this._configuration.foresterBackoffInterval)),r.resolve()},e.DEFAULT_CONFIGURATION_REFRESH_INTERVAL=6e5,e.CONSOLE_LOG_APPENDER_ALIAS="Console",e.FORESTER_APPENDER_ALIAS="Forester",e.RESPONSE_TYPE="json",e.MAX_ATTEMPTS=2,e.BACKOFF_FACTOR=2,e.NETWORK_TIMEOUT=3e4,e.INITIAL_RETRY_INTERVAL=1e3,e.NETWORK_REQUEST_CONFIGURATION={httpMethod:u.GET,maxAttempts:e.MAX_ATTEMPTS,responseType:e.RESPONSE_TYPE,backoffFactor:e.BACKOFF_FACTOR,timeout:e.NETWORK_TIMEOUT,initialRetryInterval:e.INITIAL_RETRY_INTERVAL},e._instance=null,e}()});var factory=function(){"use strict";var e=function(){};return e.getGatewayConfiguration=function(){return{version:"07-07-15",refreshETagRate:36e5,configuration:{US:{gatewayURL:"https://horizonte.browserapps.amazon.com",gatewayURLV2:"https://horizonte.browserapps.amazon.com/gatewayProcess",gatewayTreatmentURL:"https://horizonte.browserapps.amazon.com/gatewayETag",termsOfUseURL:"https://horizonte.browserapps.amazon.com/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-us-prod.s3.amazonaws.com/logging/logging-config.js"}},CA:{gatewayURL:"https://horizonte.browserapps.amazon.ca",gatewayURLV2:"https://horizonte.browserapps.amazon.ca/gatewayProcess",gatewayTreatmentURL:"https://horizonte.browserapps.amazon.ca/gatewayETag",termsOfUseURL:"https://horizonte.browserapps.amazon.ca/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-ca-prod.s3.amazonaws.com/logging/logging-config.js"}},UK:{gatewayURL:"https://horizonte.browserapps.amazon.co.uk",gatewayURLV2:"https://horizonte.browserapps.amazon.co.uk/gatewayProcess",gatewayTreatmentURL:"https://horizonte.browserapps.amazon.co.uk/gatewayETag",termsOfUseURL:"https://horizonte.browserapps.amazon.co.uk/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-uk-prod.s3.amazonaws.com/logging/logging-config.js"}},DE:{gatewayURL:"https://horizonte.browserapps.amazon.de",gatewayURLV2:"https://horizonte.browserapps.amazon.de/gatewayProcess",gatewayTreatmentURL:"https://horizonte.browserapps.amazon.de/gatewayETag",termsOfUseURL:"https://horizonte.browserapps.amazon.de/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-de-prod.s3.amazonaws.com/logging/logging-config.js"}},FR:{gatewayURL:"https://horizonte.browserapps.amazon.fr",gatewayURLV2:"https://horizonte.browserapps.amazon.fr/gatewayProcess",gatewayTreatmentURL:"https://horizonte.browserapps.amazon.fr/gatewayETag",termsOfUseURL:"https://horizonte.browserapps.amazon.fr/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-fr-prod.s3.amazonaws.com/logging/logging-config.js"}},IT:{gatewayURL:"https://horizonte.browserapps.amazon.it",gatewayURLV2:"https://horizonte.browserapps.amazon.it/gatewayProcess",gatewayTreatmentURL:"https://horizonte.browserapps.amazon.it/gatewayETag",termsOfUseURL:"https://horizonte.browserapps.amazon.it/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-it-prod.s3.amazonaws.com/logging/logging-config.js"}},JP:{gatewayURL:"https://horizonte.browserapps.amazon.co.jp",gatewayURLV2:"https://horizonte.browserapps.amazon.co.jp/gatewayProcess",gatewayTreatmentURL:"https://horizonte.browserapps.amazon.co.jp/gatewayETag",termsOfUseURL:"https://horizonte.browserapps.amazon.co.jp/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-jp-prod.s3.amazonaws.com/logging/logging-config.js"}},ES:{gatewayURL:"https://horizonte.browserapps.amazon.es",gatewayURLV2:"https://horizonte.browserapps.amazon.es/gatewayProcess",gatewayTreatmentURL:"https://horizonte.browserapps.amazon.es/gatewayETag",termsOfUseURL:"https://horizonte.browserapps.amazon.es/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-es-prod.s3.amazonaws.com/logging/logging-config.js"}},IN:{gatewayURL:"https://horizonte.browserapps.amazon.in",gatewayURLV2:"https://horizonte.browserapps.amazon.in/gatewayProcess",gatewayTreatmentURL:"https://horizonte.browserapps.amazon.in/gatewayETag",termsOfUseURL:"https://horizonte.browserapps.amazon.in/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-in-prod.s3.amazonaws.com/logging/logging-config.js"}},MX:{gatewayURL:"https://horizonte-browserapps.amazon.com.mx",gatewayURLV2:"https://horizonte-browserapps.amazon.com.mx/gatewayProcess",gatewayTreatmentURL:"https://horizonte-browserapps.amazon.com.mx/gatewayETag",termsOfUseURL:"https://horizonte-browserapps.amazon.com.mx/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-mx-prod.s3.amazonaws.com/logging/logging-config.js"}},AE:{gatewayURL:"https://horizonte-browserapps.amazon.ae",gatewayURLV2:"https://horizonte-browserapps.amazon.ae/gatewayProcess",gatewayTreatmentURL:"https://horizonte-browserapps.amazon.ae/gatewayETag",termsOfUseURL:"https://horizonte-browserapps.amazon.ae/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-ae-prod.s3.amazonaws.com/logging/logging-config.js"}},TR:{gatewayURL:"https://horizonte-browserapps.amazon.com.tr",gatewayURLV2:"https://horizonte-browserapps.amazon.com.tr/gatewayProcess",gatewayTreatmentURL:"https://horizonte-browserapps.amazon.com.tr/gatewayETag",termsOfUseURL:"https://horizonte-browserapps.amazon.com.tr/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-tr-prod.s3.amazonaws.com/logging/logging-config.js"}},BR:{gatewayURL:"https://horizonte-browserapps.amazon.com.br",gatewayURLV2:"https://horizonte-browserapps.amazon.com.br/gatewayProcess",gatewayTreatmentURL:"https://horizonte-browserapps.amazon.com.br/gatewayETag",termsOfUseURL:"https://horizonte-browserapps.amazon.com.br/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-br-prod.s3.amazonaws.com/logging/logging-config.js"}},AU:{gatewayURL:"https://horizonte-browserapps.amazon.com.au",gatewayURLV2:"https://horizonte-browserapps.amazon.com.au/gatewayProcess",gatewayTreatmentURL:"https://horizonte-browserapps.amazon.com.au/gatewayETag",termsOfUseURL:"https://horizonte-browserapps.amazon.com.au/tou",loggingConfiguration:{remoteConfigurationEndpoint:"https://ubp-common-au-prod.s3.amazonaws.com/logging/logging-config.js"}}}}},e};"undefined"!=typeof module&&module.exports?module.exports=factory():void 0!==define&&define("configuration/GatewayConfiguration",[],factory),define("ubp/client/Reporter/MetricsPublishConfiguration",["require","exports"],function(e,t){"use strict";return function(){function e(){this.enableUserIdentifiableLogging=!0,this.enableAnonymousLogging=!0,this.whiteListedOperationNames=["Dossier.buildURLs","Storage.get","Storage.put","Storagev2.get","Storagev2.put","Dossier._fetchTagPeriodically","Dossier._getAssociateTag","Dossier._getAssociateSubTag","Dossier._getPartnerFallBackTag","Dossier._getLocaleFallBackTag","Dossier._getLastResortTag","Dossier._fetchTag","Dossier._generateRequestURL","Dossier._updateSmileStatus","Dossier.getSubtag","Dossier.getSubtag.defaultSubtag","Dossier.fromJsonMap","Feed.DealFetcher.fetch","Platform.createContextMenuItem","Platform.deleteContextMenuItemById","Gateway.redeemModalContentMissing","Gateway.shopModalContentMissing","Gateway.auiModalCreate","Gateway.auiModalExecute","Gateway.matchDefaultList","Gateway.addUnknownSite","Gateway.itemInfoEdit","Gateway.addToList","Gateway.addToRegistry","Gateway.DataBus.Transform","DataBus.PlatformDataFetcher.fetchPlatformData","DataBus.DataBuffer.add","DataBus.IdentityTokenFetcher.updateToken","DataBus.DataBusClient.ReportEvents","DataBus.DataBusServiceClient.ReportEvents","Identity.getPseudoIdToken","Identity._handleIdentityRegistrationOnUpgrade","Identity._handleUnRegisteredInstallation","Identity._generateRequestURL","Identity._updateCustomerPreferences","Identity._updateCustomerPreferences.Bootstrap","Identity._updateCustomerPreferences.Cookie","Identity._updateCustomerPreferences.GetCustomerPreferences"]}return e}()}),define("ubp/client/Reporter/MetricReport",["require","exports","lib/lodash","lib/bluebird","../../commons/error/ConflictError","../../commons/error/BadRequestError","../../commons/logging/Logger","./MetricsPublishConfiguration"],function(e,t,n,r,o,i,s,a){"use strict";return function(){function e(t){this._metricsPublishConfiguration=t||new a,this._userIdentifiable=!1,this._eventName="",this._featureId="",this._requestId="",this._realTimeCounters={},this._analyticalCounters={},this._realTimeTimers={},this._analyticalTimers={},this._additionalInfo={},this._startTime=e._getCurrentTime(),this._endTime=0,this._marketplace="",this._operationName="",this._prependOperationNameToMetrics=!1,this._timerTrackMap={},this._processName="",this._valid=!0}return e._getCurrentTime=function(){return(new Date).getTime()},e._getElapsedTimeSinceBrowserPageLoad=function(){return window.performance&&"function"==typeof window.performance.now?window.performance.now():null},e.prototype._checkPublished=function(){if(!this.isValid())throw new i("This metric object has already been published")},e.prototype.isValid=function(){return this._valid},e.prototype.setUserIdentifiable=function(e){this._checkPublished(),this._userIdentifiable=e},e.prototype.setEventName=function(e){this._checkPublished(),this._eventName=e},e.prototype.setFeatureId=function(e){this._checkPublished(),this._featureId=e},e.prototype.setRequestId=function(e){this._checkPublished(),this._requestId=e},e.prototype._incrementCounter=function(e,t,n){this._checkPublished(),n[e]=(n[e]||0)+t},e.prototype.incrementRealTimeCounter=function(e,t){return void 0===t&&(t=1),this._checkPublished(),this._incrementCounter(e,t,this._realTimeCounters)},e.prototype.incrementAnalyticalCounter=function(e,t){return void 0===t&&(t=1),this._checkPublished(),this._incrementCounter(e,t,this._analyticalCounters)},e.prototype._startTimer=function(t){if(this._checkPublished(),this._timerTrackMap[t]){var n=new o("Timer already exists");throw e.logger.error("_startTime",n.toString()),n}this._timerTrackMap[t]=e._getElapsedTimeSinceBrowserPageLoad()||e._getCurrentTime()},e.prototype.startRealTimeTimer=function(e,t){return this._checkPublished(),this._startTimer(e)},e.prototype.cancelRealTimeTimer=function(e){},e.prototype._stopTimer=function(t,r){this._checkPublished();try{var i=this._timerTrackMap[t];if(!i){var s=new o("Error! Trying to stop the timer that has not started yet");throw e.logger.error("_stopTimer",s.toString()),s}var a=e._getElapsedTimeSinceBrowserPageLoad()||e._getCurrentTime(),u=a-i;if(r[t]){var c=r[t];r[t].latencies.push(u);r[t].totalLatency=n.reduce(c.latencies,function(e,t){return e+t},0),r[t].numberOfInstances=c.latencies.length}else r[t]={},r[t].latencies=[],r[t].latencies.push(u),r[t].totalLatency=u,r[t].numberOfInstances=1}finally{delete this._timerTrackMap[t]}},e.prototype.stopRealTimeTimer=function(e){return this._checkPublished(),this._stopTimer(e,this._realTimeTimers)},e.prototype._setTimer=function(t,n,r,o){if(this._checkPublished(),n<0||r<=0){var s=new i("Error! The number of instances and/or latency of the timer ["+t+"] is invalid");throw e.logger.error("_setTimer",s.toString()),s}o[t]&&o[t].latencies&&o[t].latencies.splice(0,o[t].latencies.length),o[t]={},o[t].latencies=[],o[t].totalLatency=n,o[t].numberOfInstances=r,delete this._timerTrackMap[t]},e.prototype.setRealTimeTimer=function(e,t,n){return this._checkPublished(),n=n||1,this._setTimer(e,t,n,this._realTimeTimers)},e.prototype.setRealTimeTimerLatency=function(e,t){this._checkPublished(),this._realTimeTimers[e]?this._realTimeTimers[e].latencies?this._realTimeTimers[e].latencies.push(t):(this._realTimeTimers[e].latencies=[],this._realTimeTimers[e].latencies.push(t)):(this._realTimeTimers[e]={},this._realTimeTimers[e].latencies=[],this._realTimeTimers[e].latencies.push(t))},e.prototype.startAnalyticalTimer=function(e,t){return this._checkPublished(),this._startTimer(e)},e.prototype.cancelAnalyticalTimer=function(e){},e.prototype.stopAnalyticalTimer=function(e){return this._checkPublished(),this._stopTimer(e,this._analyticalTimers)},e.prototype.setAnalyticalTimer=function(e,t,n){return this._checkPublished(),n=n||1,this._setTimer(e,t,n,this._analyticalTimers)},e.prototype.setAnalyticalTimerLatency=function(e,t){this._checkPublished(),this._analyticalTimers[e]?this._analyticalTimers[e].latencies?this._analyticalTimers[e].latencies.push(t):(this._analyticalTimers[e].latencies=[],this._analyticalTimers[e].latencies.push(t)):(this._analyticalTimers[e]={},this._analyticalTimers[e].latencies=[],this._analyticalTimers[e].latencies.push(t))},e.prototype.setAdditionalInfo=function(e,t){this._checkPublished(),this._additionalInfo[e]=t},e.prototype.setStartTime=function(e){this._checkPublished(),this._startTime=e},e.prototype.setEndTime=function(e){this._checkPublished(),this._endTime=e},e.prototype.setMarketplace=function(e){this._checkPublished(),this._marketplace=e},e.prototype.setOperationName=function(e,t){this._checkPublished(),this._operationName=e},e.prototype._setProcessName=function(e){this._checkPublished(),this._processName=e},e.prototype.publish=function(t){var n=this;if(t.getNamespace()===e.REPORTER_PROCESS_NAME)return e.logger.info("publish","Reporter process cannot log metrics for actions generated by itself, rejecting"),r.resolve();if(!this._shouldPublishMetrics())return e.logger.info("publish","based on the configuration, not publishing metrics "),r.resolve();if(!this.isValid()){var o=new i("This metric object has already been published");return e.logger.error("publish",o.toString()),r.reject(o)}return this.getEndTime()<=0&&this.setEndTime(e._getCurrentTime()),this.setRealTimeTimer("TotalTime",this.getEndTime()-this.getStartTime(),1),this._setProcessName(t.getNamespace()),this._valid=!1,r.bind(this).then(function(){return e.logger.info("publish","Metric Data: "+n.toString()),t.Reporter.buildAppendMetricData(n).withMaxAttempts(e._maxRetryAttempts).withTimeout(e._apiTimeout).buildAndSend(t)})},e.prototype._shouldPublishMetrics=function(){return!this._metricsPublishConfiguration.enableUserIdentifiableLogging&&this.getUserIdentifiable()?(e.logger.warn("publish","Warning !!! User Identifiable metrics are disabled, will not log"),!1):this._metricsPublishConfiguration.enableAnonymousLogging||this.getUserIdentifiable()?!(this._metricsPublishConfiguration.enableAnonymousLogging&&!this.getUserIdentifiable()&&!n.contains(this._metricsPublishConfiguration.whiteListedOperationNames,this.getOperation()))||(e.logger.info("publish",this.getOperation()+" is not white listed for publishing to Reporter service"),!1):(e.logger.warn("publish","Anonymous logging is disabled, will not log anonymous metrics"),!1)},e.prototype.getUserIdentifiable=function(){return this._userIdentifiable},e.prototype.getEventName=function(){return this._eventName},e.prototype.getFeatureId=function(){return this._featureId},e.prototype.getRequestId=function(){return this._requestId},e.prototype.getRealTimeCounters=function(){return this._realTimeCounters},e.prototype.getAnalyticalCounters=function(){return this._analyticalCounters},e.prototype.getRealTimeTimers=function(){return this._realTimeTimers},e.prototype.getAnalyticalTimers=function(){return this._analyticalTimers},e.prototype.getAdditionalInfo=function(){return this._additionalInfo},e.prototype.getStartTime=function(){return this._startTime},e.prototype.getEndTime=function(){return this._endTime},e.prototype.getMarketplace=function(){return this._marketplace},e.prototype.getOperation=function(){return this._operationName},e.prototype.getPrependOperationNameToMetrics=function(){return this._prependOperationNameToMetrics},e.prototype.getProcessName=function(){return this._processName},e.REPORTER_PROCESS_NAME="Reporter",e.logger=s.getLogger("MetricReport"),e._maxRetryAttempts=3,e._apiTimeout=5e3,e.LABEL_REQUEST_COUNT="RequestCount",e.LABEL_REQUEST_FAILURE="Failure",e.LABEL_REQUEST_SUCCESS="Success",e.LABEL_REQUEST_TIME="RequestTime",e.LABEL_REQUEST_TIME_SUCCESS=e.LABEL_REQUEST_TIME+e.LABEL_REQUEST_SUCCESS,e.LABEL_REQUEST_TIME_FAILURE=e.LABEL_REQUEST_TIME+e.LABEL_REQUEST_FAILURE,e.LABEL_DEFAULT_FAILURE_REASON="Unknown",e}()}),define("ubp/client/Reporter/MetricReportDecorator",["require","exports"],function(e,t){"use strict";return function(){function e(e){this.metricReport=e}return e.prototype.publish=function(e){return this.metricReport.publish(e)},e.prototype.isValid=function(){return this.metricReport.isValid()},e.prototype.setUserIdentifiable=function(e){this.metricReport.setUserIdentifiable(e)},e.prototype.setEventName=function(e){this.metricReport.setEventName(e)},e.prototype.setFeatureId=function(e){this.metricReport.setFeatureId(e)},e.prototype.setRequestId=function(e){this.metricReport.setRequestId(e)},e.prototype.incrementRealTimeCounter=function(e,t){this.metricReport.incrementRealTimeCounter(e,t)},e.prototype.incrementAnalyticalCounter=function(e,t){this.metricReport.incrementAnalyticalCounter(e,t)},e.prototype.startRealTimeTimer=function(e,t){this.metricReport.startRealTimeTimer(e,t)},e.prototype.stopRealTimeTimer=function(e){this.metricReport.stopRealTimeTimer(e)},e.prototype.setRealTimeTimer=function(e,t,n){this.metricReport.setRealTimeTimer(e,t,n)},e.prototype.setRealTimeTimerLatency=function(e,t){this.metricReport.setRealTimeTimerLatency(e,t)},e.prototype.cancelRealTimeTimer=function(e){this.metricReport.cancelRealTimeTimer(e)},e.prototype.startAnalyticalTimer=function(e,t){this.metricReport.startAnalyticalTimer(e,t)},e.prototype.stopAnalyticalTimer=function(e){this.metricReport.stopAnalyticalTimer(e)},e.prototype.setAnalyticalTimer=function(e,t,n){this.metricReport.setAnalyticalTimer(e,t,n)},e.prototype.setAnalyticalTimerLatency=function(e,t){this.metricReport.setAnalyticalTimerLatency(e,t)},e.prototype.cancelAnalyticalTimer=function(e){this.metricReport.cancelAnalyticalTimer(e)},e.prototype.setAdditionalInfo=function(e,t){this.metricReport.setAdditionalInfo(e,t)},e.prototype.setStartTime=function(e){this.metricReport.setStartTime(e)},e.prototype.setEndTime=function(e){this.metricReport.setEndTime(e)},e.prototype.setMarketplace=function(e){this.metricReport.setMarketplace(e)},e.prototype.setOperationName=function(e,t){this.metricReport.setOperationName(e,t)},e.prototype.getUserIdentifiable=function(){return this.metricReport.getUserIdentifiable()},e.prototype.getEventName=function(){return this.metricReport.getEventName()},e.prototype.getFeatureId=function(){return this.metricReport.getFeatureId()},e.prototype.getRequestId=function(){return this.metricReport.getRequestId()},e.prototype.getRealTimeCounters=function(){return this.metricReport.getRealTimeCounters()},e.prototype.getAnalyticalCounters=function(){return this.metricReport.getAnalyticalCounters()},e.prototype.getRealTimeTimers=function(){return this.metricReport.getRealTimeTimers()},e.prototype.getAnalyticalTimers=function(){return this.metricReport.getAnalyticalTimers()},e.prototype.getAdditionalInfo=function(){return this.metricReport.getAdditionalInfo()},e.prototype.getStartTime=function(){return this.metricReport.getStartTime()},e.prototype.getEndTime=function(){return this.metricReport.getEndTime()},e.prototype.getMarketplace=function(){return this.metricReport.getMarketplace()},e.prototype.getOperation=function(){return this.metricReport.getOperation()},e.prototype.getPrependOperationNameToMetrics=function(){return this.metricReport.getPrependOperationNameToMetrics()},e.prototype.getProcessName=function(){return this.metricReport.getProcessName()},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Reporter/MetricReportGamified",["require","exports","./MetricReportDecorator","../../commons/logging/Logger"],function(e,t,n,r){"use strict";return function(e){function t(n,o){var i=e.call(this,n)||this;return i._referee=o,t.logger=r.getLogger("MetricReportGamified"),i}return __extends(t,e),t.prototype.publish=function(n){try{e.prototype.getAdditionalInfo.call(this)[t.GAME_KEY]&&this._referee.processGameAction(e.prototype.getAdditionalInfo.call(this)[t.GAME_KEY])}catch(e){t.logger.error("publish","gameReferee.processGameAction fails on - "+(e.toString&&e.toString()))}return e.prototype.publish.call(this,n)},t.GAME_KEY="Game",t}(n)}),define("ubp/client/Gamification/referee/GameReferee",["require","exports","lib/bluebird","../../../commons/logging/Logger"],function(e,t,n,r){"use strict";return function(){function e(e,t,r){this._isStarted=n.resolve(!1),this._validator=e,this._gameFactory=t,this._client=r}return e.prototype._updateGameData=function(e){
this._gameData=this._gameFactory.fabricate(e.feedItems[0])},e.prototype.isStarted=function(){return this._isStarted},e.prototype.start=function(){var t=this;return this.isStarted().then(function(r){return r?n.reject("GameReferee already started!"):t._isStarted=t._client.getGameData(!0).then(function(e){return t._updateGameData(e),n.resolve(!0)}).catch(function(t){return e.logger.error("start","fails on - "+(t.toString&&t.toString())),n.resolve(!1)})})},e.prototype.stop=function(){this._isStarted=n.resolve(!1)},e.prototype.processGameAction=function(t){var r=this;return this.isStarted().then(function(o){return o?r._validator.validate(t,r._gameData)?r._client.reportGameAction(t,r._gameData).catch(function(t){e.logger.error("start","fails on - "+(t.toString&&t.toString()))}):n.resolve():n.reject(new Error("Using GameReferee.processGameAction when GameReferee has not started!"))})},e.FEED_ITEM_TYPE_GAME="Game",e.logger=r.getLogger("GameReferee"),e}()}),define("ubp/client/factory/MetricReportFactory",["require","exports","lib/bluebird","../Reporter/MetricReport","../Reporter/MetricReportGamified","../Gamification/referee/GameReferee"],function(e,t,n,r,o,i){"use strict";return function(){function e(){this._gamified=!1}return e.prototype.gamify=function(e){if(!(e instanceof i))throw new Error("MetricReportFactory gamify - invalid referee instance");this._referee=e,this._gamified=!0},e.prototype.startReferee=function(){return this.isGamified()?this._referee.start():n.reject("MetricReportFactory startReferee - factory is not gamified!")},e.prototype.isGamified=function(){return this._gamified},e.prototype.fabricate=function(){return this.isGamified()?new o(new r,this._referee):new r},e}()}),define("ubp/commons/specification/message/MessageType",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.API=1]="API",e[e.EVENT=2]="EVENT",e[e.SIGNAL=3]="SIGNAL",e[e.HANDSHAKE=4]="HANDSHAKE",e[e.HEALTHCHECK=5]="HEALTHCHECK"}(n||(n={})),n}),define("ubp/client/request/RequestBuilderBase",["require","exports","lib/bluebird","../Reporter/MetricReport","../../commons/error/BaseError","../../commons/logging/Logger","../../commons/specification/message/MessageType"],function(e,t,n,r,o,i,s){"use strict";return function(){function e(t,n,r){if(this._timeout=e._DefaultTimeout,this._maxAttempts=e._DefaultMaxAttempts,!t||!n){var o=new Error("The namespace and API method must both be specified; apiNamespace: "+t+"; apiMethod: "+n);throw e.baseLogger.error("constructor",o.toString()),o}this._apiNamespace=t,this._apiMethod=n,this._message=r||this._buildAPIRequestMessage()}return e.prototype.withTimeout=function(e){return this._timeout=e,this},e.prototype.withMaxAttempts=function(e){return this._maxAttempts=e,this},e.prototype.getTimeout=function(){return this._timeout},e.prototype.getMaxAttempts=function(){return this._maxAttempts},e.prototype.buildAndSend=function(e){var t=this,i=this._initializeMetricReport(e.getMetricReportFactory());return n.bind(this).then(function(){return e.messageClient._sendAndReceive(t._message,t.getTimeout(),t.getMaxAttempts())}).then(function(e){return i.stopRealTimeTimer(r.LABEL_REQUEST_TIME_SUCCESS),i.incrementRealTimeCounter(r.LABEL_REQUEST_SUCCESS),e},function(e){i.stopRealTimeTimer(r.LABEL_REQUEST_TIME_FAILURE);var n=r.LABEL_DEFAULT_FAILURE_REASON;throw e instanceof o&&(n=e.getName()),i.incrementRealTimeCounter(r.LABEL_REQUEST_FAILURE),i.setAdditionalInfo(r.LABEL_REQUEST_FAILURE,n),t.logError(e),e}).finally(function(){i.publish(e)})},e.prototype.logError=function(t){e.baseLogger.error("buildAndSend",t)},e.prototype._buildAPIRequestMessage=function(){return{header:this._buildAPIRequestMessageHeader()}},e.prototype._buildAPIRequestMessageHeader=function(){return{messageType:s.API,name:this._apiMethod,namespace:this._apiNamespace}},e.prototype._initializeMetricReport=function(e){var t=e.fabricate();return t.setOperationName(this._apiNamespace+"."+this._apiMethod,!0),t.incrementRealTimeCounter(r.LABEL_REQUEST_COUNT),t.startRealTimeTimer(r.LABEL_REQUEST_TIME_SUCCESS),t.startRealTimeTimer(r.LABEL_REQUEST_TIME_FAILURE),t.incrementRealTimeCounter(r.LABEL_REQUEST_SUCCESS,0),t.incrementRealTimeCounter(r.LABEL_REQUEST_FAILURE,0),t},e._DefaultTimeout=5e3,e._DefaultMaxAttempts=3,e.baseLogger=i.getLogger("RequestBuilderBase"),e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/OpenNewTabRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"openNewTab",namespace:"Platform"},data:{args:{url:t}}};return e.call(this,"Platform","openNewTab",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/RegisterWhitelistRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"registerWhitelist",namespace:"Platform"},data:{args:{domains:t}}};return e.call(this,"Platform","registerWhitelist",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/NotificationRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"createDesktopNotification",namespace:"Platform"},data:{args:{notificationType:t,notificationSpecification:n}}};return e.call(this,"Platform","createDesktopNotification",o)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/SubscribeRequestBuilder",["require","exports","lib/bluebird","../request/RequestBuilderBase","../Reporter/MetricReport","../../commons/error/BaseError","../../commons/logging/Logger","../../commons/specification/message/MessageType"],function(e,t,n,r,o,i,s,a){"use strict";return function(e){function t(t,n){var r=e.call(this,"PlatformHub","subscribe")||this;return r._eventName=t,r._eventHandler=n,r}return __extends(t,e),t.prototype.buildAndSend=function(e){var r=this,s={header:{messageType:a.EVENT,name:"subscribe",namespace:"PlatformHub"},data:{args:{eventName:this._eventName}}},u=this._initializeMetricReport(e.getMetricReportFactory());return n.bind(this).then(function(){return e.messageClient.on(r._eventName,r._eventHandler)}).then(function(){return e.messageClient._sendAndReceive(s,r.getTimeout(),r.getMaxAttempts())}).then(function(){u.stopRealTimeTimer(o.LABEL_REQUEST_TIME_SUCCESS),u.incrementRealTimeCounter(o.LABEL_REQUEST_SUCCESS)},function(e){u.stopRealTimeTimer(o.LABEL_REQUEST_TIME_FAILURE);var n=o.LABEL_DEFAULT_FAILURE_REASON;throw e instanceof i&&(n=e.getName()),u.incrementRealTimeCounter(o.LABEL_REQUEST_FAILURE),u.setAdditionalInfo(o.LABEL_REQUEST_FAILURE,n),t.logger.error("buildAndSend",e),e}).finally(function(){u.publish(e)})},t.logger=s.getLogger("SubscribeRequestBuilder"),t}(r)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/PublishRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.EVENT,name:"publish",namespace:"PlatformHub"},data:{args:{eventName:t,eventArgs:n}}};return e.call(this,"PlatformHub","publish",o)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/GetPlatformInfoRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Platform","getPlatformInfo")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/SetPlatformCoreInfoRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"setPlatformCoreInfo",namespace:"Platform"},data:{args:{corePropertyToValueMap:t}}};return e.call(this,"Platform","setPlatformCoreInfo",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/ClearPlatformInfoCacheRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Platform","clearPlatformInfoCache")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/UnsubscribeRequestBuilder",["require","exports","lib/bluebird","../request/RequestBuilderBase","../Reporter/MetricReport","../../commons/error/BaseError","../../commons/logging/Logger","../../commons/specification/message/MessageType"],function(e,t,n,r,o,i,s,a){"use strict";return function(e){function t(t){var n=e.call(this,"PlatformHub","unsubscribe")||this;return n._eventName=t,n}return __extends(t,e),t.prototype.buildAndSend=function(e){var r=this,s={header:{messageType:a.EVENT,name:"unsubscribe",namespace:"PlatformHub"},data:{args:{eventName:this._eventName}}},u=this._initializeMetricReport(e.getMetricReportFactory());return n.bind(this).then(function(){return e.messageClient.off(r._eventName)}).then(function(){return e.messageClient._sendAndReceive(s,r.getTimeout(),r.getMaxAttempts())}).then(function(){u.stopRealTimeTimer(o.LABEL_REQUEST_TIME_SUCCESS),u.incrementRealTimeCounter(o.LABEL_REQUEST_SUCCESS)},function(e){u.stopRealTimeTimer(o.LABEL_REQUEST_TIME_FAILURE);var n=o.LABEL_DEFAULT_FAILURE_REASON;throw e instanceof i&&(n=e.getName()),u.incrementRealTimeCounter(o.LABEL_REQUEST_FAILURE),u.setAdditionalInfo(o.LABEL_REQUEST_FAILURE,n),t.logger.error("buildAndSend",e),e}).finally(function(){u.publish(e)})},t.logger=s.getLogger("UnsubscribeRequestBuilder"),t}(r)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/ScrapeRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"scrape",namespace:"Platform"},data:{args:{tabId:t,specification:n}}};return e.call(this,"Platform","scrape",o)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/GetUWLItemRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"getUWLItem",namespace:"Platform"},data:{args:{tabId:t}}};return e.call(this,"Platform","getUWLItem",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/SetLocaleRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"setLocale",namespace:"Platform"},data:{args:{locale:t}}};return e.call(this,"Platform","setLocale",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/RenderButtonTextRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"renderButtonText",namespace:"Platform"},data:{args:{value:t}}};return e.call(this,"Platform","renderButtonText",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/SandboxRequestBuilders",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";var o;return function(e){var t=function(e){function t(t,n){var o={header:{messageType:r.API,name:"createSandbox",namespace:"Platform"},data:{args:{tabId:t,sandboxSpecification:n}}};return e.call(this,"Platform","createSandbox",o)||this}return __extends(t,e),t}(n);e.CreateSandboxRequestBuilder=t;var o=function(e){function t(t,n){var o={header:{messageType:r.API,name:"createLocalSandbox",namespace:"Platform"},data:{args:{tabId:t,sandboxSpecification:n}}};return e.call(this,"Platform","createLocalSandbox",o)||this}return __extends(t,e),t}(n);e.CreateLocalSandboxRequestBuilder=o;var i=function(e){function t(t,n){var o={header:{messageType:r.API,name:"createSandboxById",namespace:"Platform"},data:{args:{tabId:t,sandboxSpecification:n}}};return e.call(this,"Platform","createSandboxById",o)||this}return __extends(t,e),t}(n);e.CreateSandboxByIdRequestBuilder=i;var s=function(e){function t(t,n){var o={header:{messageType:r.API,name:"createSandboxByIdPost",namespace:"Platform"},data:{args:{tabId:t,sandboxSpecification:n}}};return e.call(this,"Platform","createSandboxByIdPost",o)||this}return __extends(t,e),t}(n);e.CreateSandboxByIdPostRequestBuilder=s;var a=function(e){function t(t,n,o){var i={header:{messageType:r.API,name:"modifySandbox",namespace:"Platform"},data:{args:{tabId:t,sandboxId:n,sandboxCSSSpecification:o}}};return e.call(this,"Platform","modifySandbox",i)||this}return __extends(t,e),t}(n);e.ModifySandboxRequestBuilder=a;var u=function(e){function t(t,n,o,i){var s={header:{messageType:r.API,name:"showSandbox",namespace:"Platform"},data:{args:{tabId:t,sandboxId:n,sandboxCSSSpecification:o,pageStyleSpecification:i}}};return e.call(this,"Platform","showSandbox",s)||this}return __extends(t,e),t}(n);e.ShowSandboxRequestBuilder=u;var c=function(e){function t(t,n){var o={header:{messageType:r.API,name:"destroySandbox",namespace:"Platform"},data:{args:{tabId:t,sandboxId:n}}};return e.call(this,"Platform","destroySandbox",o)||this}return __extends(t,e),t}(n);e.DestroySandboxRequestBuilder=c;var l=function(e){function t(t,n,o){var i={header:{messageType:r.API,name:"sendMessageToSandbox",namespace:"Platform"},data:{args:{tabId:t,sandboxId:n,message:o}}};return e.call(this,"Platform","sendMessageToSandbox",i)||this}return __extends(t,e),t}(n);e.SendMessageToSandboxRequestBuilder=l;var p=function(e){function t(t,n,o){var i={header:{messageType:r.API,name:"instrumentSandbox",namespace:"Platform"},data:{args:{tabId:t,sandboxSelector:n,message:o}}};return e.call(this,"Platform","instrumentSandbox",i)||this}return __extends(t,e),t}(n);e.InstrumentSandboxRequestBuilder=p}(o||(o={})),o});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/StyleRequestBuilders",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";var o;return function(e){var t=function(e){function t(t,n){var o={header:{messageType:r.API,name:"applyStyle",namespace:"Platform"},data:{args:{tabId:t,specification:n}}};return e.call(this,"Platform","applyStyle",o)||this}return __extends(t,e),t}(n);e.ApplyStyleRequestBuilder=t;var o=function(e){function t(t,n){var o={header:{messageType:r.API,name:"resetStyle",namespace:"Platform"},data:{args:{tabId:t,styleHandle:n}}};return e.call(this,"Platform","resetStyle",o)||this}return __extends(t,e),t}(n);e.ResetStyleRequestBuilder=o}(o||(o={})),o});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/InstrumentWebpageRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n,o){var i={header:{messageType:r.API,name:"instrumentWebpage",namespace:"Platform"},data:{args:{tabId:t,action:n,targetFrame:o}}};return e.call(this,"Platform","instrumentWebpage",i)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/ActionRequestBuilders",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";var o;return function(e){var t=function(e){function t(t,n){var o={header:{messageType:r.API,name:"registerAction",namespace:"Platform"},data:{args:{tabId:t,specification:n}}};return e.call(this,"Platform","registerAction",o)||this}return __extends(t,e),t}(n);e.RegisterActionRequestBuilder=t;var o=function(e){function t(t,n){var o={header:{messageType:r.API,name:"deregisterAction",namespace:"Platform"},data:{args:{tabId:t,actionListenerId:n}}};return e.call(this,"Platform","deregisterAction",o)||this}return __extends(t,e),t}(n);e.DeregisterActionRequestBuilder=o}(o||(o={})),o});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/RuntimeStorage/GetStorageValueRequestBuilder",["require","exports","../../request/RequestBuilderBase","../../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"getStorageValue",namespace:"Platform"},data:{args:{key:t}}};return e.call(this,"Platform","getStorageValue",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/RuntimeStorage/PutStorageValueRequestBuilder",["require","exports","../../request/RequestBuilderBase","../../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"putStorageValue",namespace:"Platform"},data:{args:{key:t,value:n}}};return e.call(this,"Platform","putStorageValue",o)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/RuntimeStorage/DeleteStorageValueRequestBuilder",["require","exports","../../request/RequestBuilderBase","../../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"deleteStorageValue",namespace:"Platform"},data:{args:{key:t}}};return e.call(this,"Platform","deleteStorageValue",n)||this}return __extends(t,e),t}(n)}),define("ubp/client/Platform/RuntimeStorage/PlatformRuntimeStorageClient",["require","exports","./GetStorageValueRequestBuilder","./PutStorageValueRequestBuilder","./DeleteStorageValueRequestBuilder"],function(e,t,n,r,o){"use strict";return function(){function e(e){this.base=e}return e.prototype.getStorageValue=function(e){return new n(e).buildAndSend(this.base)},e.prototype.buildGetStorageValue=function(e){return new n(e)},e.prototype.putStorageValue=function(e,t){return new r(e,t).buildAndSend(this.base)},e.prototype.buildPutStorageValue=function(e,t){return new r(e,t)},e.prototype.deleteStorageValue=function(e){return new o(e).buildAndSend(this.base)},e.prototype.buildDeleteStorageValue=function(e){return new o(e)},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/GetFeatureListRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Platform","getFeatureList")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/GetActiveTabInfoRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Platform","getActiveTabInfo")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/Page/GetPageReferrerRequestBuilder",["require","exports","../../request/RequestBuilderBase","../../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"getPageReferrer",namespace:"Platform"},data:{args:{tabId:t}}};return e.call(this,"Platform","getPageReferrer",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/Page/GetPageLocationDataRequestBuilder",["require","exports","../../request/RequestBuilderBase","../../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"getPageLocationData",namespace:"Platform"},data:{args:{tabId:t}}};return e.call(this,"Platform","getPageLocationData",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/Page/GetPageDimensionDataRequestBuilder",["require","exports","../../request/RequestBuilderBase","../../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"getPageDimensionData",namespace:"Platform"},data:{args:{tabId:t}}};return e.call(this,"Platform","getPageDimensionData",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/Page/GetPagePerformanceTimingDataRequestBuilder",["require","exports","../../request/RequestBuilderBase","../../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"getPagePerformanceTimingData",namespace:"Platform"},data:{args:{tabId:t}}};return e.call(this,"Platform","getPagePerformanceTimingData",n)||this}return __extends(t,e),t}(n)}),define("ubp/client/Platform/Page/PlatformPageMetaDataClient",["require","exports","./GetPageReferrerRequestBuilder","./GetPageLocationDataRequestBuilder","./GetPageDimensionDataRequestBuilder","./GetPagePerformanceTimingDataRequestBuilder"],function(e,t,n,r,o,i){"use strict";return function(){function e(e){this.base=e}return e.prototype.getPageReferrer=function(e){return this.buildGetPageReferrer(e).buildAndSend(this.base)},e.prototype.buildGetPageReferrer=function(e){return new n(e)},e.prototype.getPageLocationData=function(e){return this.buildGetPageLocationData(e).buildAndSend(this.base)},e.prototype.buildGetPageLocationData=function(e){return new r(e)},e.prototype.getPageDimensionData=function(e){return this.buildGetPageDimensionData(e).buildAndSend(this.base)},e.prototype.buildGetPageDimensionData=function(e){return new o(e)},e.prototype.getPagePerformanceTimingData=function(e){return this.buildGetPagePerformanceTimingData(e).buildAndSend(this.base)},e.prototype.buildGetPagePerformanceTimingData=function(e){return new i(e)},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/AcceptTermsOfUseRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Platform","acceptTermsOfUse")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()
;define("ubp/client/Platform/IsTOUAcceptedRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Platform","isTOUAccepted")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/ClosePanelRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Platform","closePanel")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/ReloadExtensionRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Platform","reloadExtension")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/GetBrowserRecSettingsRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Platform","getBrowserRecSettings")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/UpdateBrowserRecSettingsRequestBuilder",["require","exports","../../commons/specification/message/MessageType","../request/RequestBuilderBase"],function(e,t,n,r){"use strict";return function(e){function t(t){var r={header:{messageType:n.API,name:"updateBrowserRecSettings",namespace:"Platform"},data:{args:{settingsMap:t}}};return e.call(this,"Platform","updateBrowserRecSettings",r)||this}return __extends(t,e),t}(r)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/CreateContextMenuItemRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(n,o){n.id=o+t._contextMenuItemSeperator+n.id;var i={header:{messageType:r.API,name:"createContextMenuItem",namespace:"Platform"},data:{args:{createContextMenuProperties:n,processNamespace:o}}};return e.call(this,"Platform","createContextMenuItem",i)||this}return __extends(t,e),t._contextMenuItemSeperator=".",t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/DeleteAllContextMenuItemsRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"deleteAllContextMenuItems",namespace:"Platform"},data:{args:{processNamespace:t}}};return e.call(this,"Platform","deleteAllContextMenuItems",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/DeleteContextMenuItemByIdRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"deleteContextMenuItemById",namespace:"Platform"},data:{args:{contextMenuItemId:t,processNamespace:n}}};return e.call(this,"Platform","deleteContextMenuItemById",o)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/RemoveTabRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"removeTab",namespace:"Platform"},data:{args:{tabIds:t}}};return e.call(this,"Platform","removeTab",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/SetSmileModeRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"setSmileMode",namespace:"Platform"},data:{args:{mode:t}}};return e.call(this,"Platform","setSmileMode",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/GetCookieInfoRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"getCookieInfo",namespace:"Platform"},data:{args:{cookieName:t,url:n}}};return e.call(this,"Platform","getCookieInfo",o)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Platform/BulkGetCookieInfoRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"bulkGetCookieInfo",namespace:"Platform"},data:{args:{cookieNames:t,url:n}}};return e.call(this,"Platform","bulkGetCookieInfo",o)||this}return __extends(t,e),t}(n)}),define("ubp/client/Platform/PlatformClient",["require","exports","./OpenNewTabRequestBuilder","./RegisterWhitelistRequestBuilder","./NotificationRequestBuilder","./SubscribeRequestBuilder","./PublishRequestBuilder","./GetPlatformInfoRequestBuilder","./SetPlatformCoreInfoRequestBuilder","./ClearPlatformInfoCacheRequestBuilder","./UnsubscribeRequestBuilder","./ScrapeRequestBuilder","./GetUWLItemRequestBuilder","./SetLocaleRequestBuilder","./RenderButtonTextRequestBuilder","./SandboxRequestBuilders","./StyleRequestBuilders","./InstrumentWebpageRequestBuilder","./ActionRequestBuilders","./RuntimeStorage/PlatformRuntimeStorageClient","./GetFeatureListRequestBuilder","./GetActiveTabInfoRequestBuilder","./Page/PlatformPageMetaDataClient","./AcceptTermsOfUseRequestBuilder","./IsTOUAcceptedRequestBuilder","./ClosePanelRequestBuilder","../../commons/logging/Logger","./ReloadExtensionRequestBuilder","./GetBrowserRecSettingsRequestBuilder","./UpdateBrowserRecSettingsRequestBuilder","./CreateContextMenuItemRequestBuilder","./DeleteAllContextMenuItemsRequestBuilder","./DeleteContextMenuItemByIdRequestBuilder","./RemoveTabRequestBuilder","./SetSmileModeRequestBuilder","./GetCookieInfoRequestBuilder","./BulkGetCookieInfoRequestBuilder"],function(e,t,n,r,o,i,s,a,u,c,l,p,f,d,h,_,m,g,y,b,v,E,R,w,T,x,A,S,P,I,O,C,L,B,M,j,q){"use strict";return function(){function e(e){this.base=e,this.RuntimeStorage=new b(this.base),this.PageMetaData=new R(this.base)}return e.prototype.openNewTab=function(e){return this.buildOpenNewTab(e).buildAndSend(this.base)},e.prototype.buildOpenNewTab=function(e){return new n(e)},e.prototype.removeTab=function(e){return this.buildRemoveTab(e).buildAndSend(this.base)},e.prototype.buildRemoveTab=function(e){return new B(e)},e.prototype.createDesktopNotification=function(e,t){return this.buildCreateDesktopNotification(e,t).buildAndSend(this.base)},e.prototype.buildCreateDesktopNotification=function(e,t){return new o(e,t)},e.prototype.createContextMenuItem=function(e){return this.buildCreateContextMenuItem(e).buildAndSend(this.base)},e.prototype.buildCreateContextMenuItem=function(e){return new O(e,this.base.getNamespace())},e.prototype.deleteAllContextMenuItems=function(){return this.buildDeleteAllContextMenuItems().buildAndSend(this.base)},e.prototype.buildDeleteAllContextMenuItems=function(){return new C(this.base.getNamespace())},e.prototype.deleteContextMenuItemById=function(e){return this.buildDeleteContextMenuItemById(e).buildAndSend(this.base)},e.prototype.buildDeleteContextMenuItemById=function(e){return new L(e,this.base.getNamespace())},e.prototype.createSandbox=function(e,t){return this.buildCreateSandbox(e,t).buildAndSend(this.base)},e.prototype.buildCreateSandbox=function(e,t){return new _.CreateSandboxRequestBuilder(e,t)},e.prototype.createLocalSandbox=function(e,t){return this.buildCreateLocalSandbox(e,t).buildAndSend(this.base)},e.prototype.buildCreateLocalSandbox=function(e,t){return new _.CreateLocalSandboxRequestBuilder(e,t)},e.prototype.createSandboxById=function(e,t){return this.buildCreateSandboxById(e,t).buildAndSend(this.base)},e.prototype.createSandboxByIdPost=function(e,t){return this.buildCreateSandboxByIdPost(e,t).buildAndSend(this.base)},e.prototype.buildCreateSandboxById=function(e,t){return new _.CreateSandboxByIdRequestBuilder(e,t)},e.prototype.buildCreateSandboxByIdPost=function(e,t){return new _.CreateSandboxByIdPostRequestBuilder(e,t)},e.prototype.modifySandbox=function(e,t,n){return this.buildModifySandbox(e,t,n).buildAndSend(this.base)},e.prototype.buildModifySandbox=function(e,t,n){return new _.ModifySandboxRequestBuilder(e,t,n)},e.prototype.showSandbox=function(e,t,n,r){return this.buildShowSandbox(e,t,n,r).buildAndSend(this.base)},e.prototype.buildShowSandbox=function(e,t,n,r){return new _.ShowSandboxRequestBuilder(e,t,n,r)},e.prototype.registerWhitelist=function(e){return this.buildRegisterWhitelist(e).buildAndSend(this.base)},e.prototype.buildRegisterWhitelist=function(e){return new r(e)},e.prototype.sendMessageToSandbox=function(e,t,n){return this.buildSendMessageToSandbox(e,t,n).buildAndSend(this.base)},e.prototype.buildSendMessageToSandbox=function(e,t,n){return new _.SendMessageToSandboxRequestBuilder(e,t,n)},e.prototype.instrumentSandbox=function(e,t,n){return this.buildInstrumentSandbox(e,t,n).buildAndSend(this.base)},e.prototype.buildInstrumentSandbox=function(e,t,n){return new _.InstrumentSandboxRequestBuilder(e,t,n)},e.prototype.instrumentWebpage=function(e,t,n){return this.buildInstrumentWebpage(e,t,n).buildAndSend(this.base)},e.prototype.buildInstrumentWebpage=function(e,t,n){return new g(e,t,n)},e.prototype.destroySandbox=function(e,t){return this.buildDestroySandbox(e,t).buildAndSend(this.base)},e.prototype.buildDestroySandbox=function(e,t){return new _.DestroySandboxRequestBuilder(e,t)},e.prototype.scrape=function(e,t){return new p(e,t).buildAndSend(this.base)},e.prototype.buildScrape=function(e,t){return new p(e,t)},e.prototype.getUWLItem=function(e){return new f(e).buildAndSend(this.base)},e.prototype.buildGetUWLItem=function(e){return new f(e)},e.prototype.getCookieInfo=function(e,t){return this.buildGetCookieInfo(e,t).buildAndSend(this.base)},e.prototype.buildGetCookieInfo=function(e,t){return new j(e,t)},e.prototype.bulkGetCookieInfo=function(e,t){return this.buildBulkGetCookieInfo(e,t).buildAndSend(this.base)},e.prototype.buildBulkGetCookieInfo=function(e,t){return new q(e,t)},e.prototype.renderButtonText=function(e){return this.buildRenderButtonText(e).buildAndSend(this.base)},e.prototype.buildRenderButtonText=function(e){return new h(e)},e.prototype.getPlatformInfo=function(){return this.buildGetPlatformInfo().buildAndSend(this.base)},e.prototype.buildGetPlatformInfo=function(){return new a},e.prototype.setPlatformCoreInfo=function(e){return this.buildSetPlatformCoreInfo(e).buildAndSend(this.base)},e.prototype.buildSetPlatformCoreInfo=function(e){return new u(e)},e.prototype.clearPlatformInfoCache=function(){return this.buildClearPlatformInfoCache().buildAndSend(this.base)},e.prototype.buildClearPlatformInfoCache=function(){return new c},e.prototype.subscribe=function(e,t){return this.buildSubscribe(e,t).buildAndSend(this.base)},e.prototype.buildSubscribe=function(e,t){return new i(e,t)},e.prototype.publish=function(e,t){return this.buildPublish(e,t).buildAndSend(this.base)},e.prototype.buildPublish=function(e,t){return new s(e,t)},e.prototype.unsubscribe=function(e){return this.buildUnsubscribe(e).buildAndSend(this.base)},e.prototype.buildUnsubscribe=function(e){return new l(e)},e.prototype.setLocale=function(e){return this.buildSetLocale(e).buildAndSend(this.base)},e.prototype.buildSetLocale=function(e){return new d(e)},e.prototype.getFeatureList=function(){return this.buildGetFeatureList().buildAndSend(this.base)},e.prototype.buildGetFeatureList=function(){return new v},e.prototype.getActiveTabInfo=function(){return this.buildGetActiveTabInfo().buildAndSend(this.base)},e.prototype.buildGetActiveTabInfo=function(){return new E},e.prototype.acceptTermsOfUse=function(){return this.buildAcceptTermsOfUse().buildAndSend(this.base)},e.prototype.buildAcceptTermsOfUse=function(){return new w},e.prototype.isTOUAccepted=function(){return this.buildIsTOUAccepted().buildAndSend(this.base)},e.prototype.buildIsTOUAccepted=function(){return new T},e.prototype.applyStyle=function(e,t){return this.buildApplyStyle(e,t).buildAndSend(this.base)},e.prototype.buildApplyStyle=function(e,t){return new m.ApplyStyleRequestBuilder(e,t)},e.prototype.resetStyle=function(e,t){return this.buildResetStyle(e,t).buildAndSend(this.base)},e.prototype.buildResetStyle=function(e,t){return new m.ResetStyleRequestBuilder(e,t)},e.prototype.registerAction=function(e,t){return this.buildRegisterAction(e,t).buildAndSend(this.base)},e.prototype.buildRegisterAction=function(e,t){return new y.RegisterActionRequestBuilder(e,t)},e.prototype.deregisterAction=function(e,t){return this.buildDeregisterAction(e,t).buildAndSend(this.base)},e.prototype.buildDeregisterAction=function(e,t){return new y.DeregisterActionRequestBuilder(e,t)},e.prototype.closePanel=function(){return this.buildClosePanel().buildAndSend(this.base)},e.prototype.buildClosePanel=function(){return new x},e.prototype.reloadExtension=function(){return this.buildReloadExtension().buildAndSend(this.base)},e.prototype.buildReloadExtension=function(){return new S},e.prototype.getBrowserRecSettings=function(){return this.buildGetBrowserRecSettings().buildAndSend(this.base)},e.prototype.buildGetBrowserRecSettings=function(){return new P},e.prototype.updateBrowserRecSettings=function(e){return this.buildUpdateBrowserRecSettings(e).buildAndSend(this.base)},e.prototype.buildUpdateBrowserRecSettings=function(e){return new I(e)},e.prototype.setSmileMode=function(e){return this.buildSetSmileMode(e).buildAndSend(this.base)},e.prototype.buildSetSmileMode=function(e){return new M(e)},e.logger=A.getLogger("PlatformClient"),e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Identity/GetCustomerTokenRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Identity","getCustomerToken")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Identity/GetInstallationTokenRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Identity","getInstallationToken")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Identity/GetInstallationIdRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Identity","getInstallationId")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Identity/GetInstallationLocaleRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Identity","getInstallationLocale")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Identity/GetIsInternalRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Identity","isInternal")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Identity/GetAllWeblabTreatmentsRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"getAllWeblabTreatments",namespace:"Identity"},data:{args:{weblabList:t,skipRecordTrigger:!!n}}};return e.call(this,"Identity","getAllWeblabTreatments",o)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Identity/GetCohortTokenRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Identity","getCohortToken")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Identity/GetPseudoIdTokenRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"getPseudoIdToken",namespace:"Identity"},data:{args:{clientIdTypes:t.clientIdTypes,isForceUpdate:!!t.isForceUpdate,isolationZone:t.isolationZone}}};return e.call(this,"Identity","GetPseudoIdToken",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Identity/GetCustomerPreferencesRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Identity","getCustomerPreferences")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Identity/ConfirmRTBFExecutionRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"confirmRTBFExecution",namespace:"Identity"},data:{args:{scope:t.scope}}};return e.call(this,"Identity","ConfirmRTBFExecution",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Identity/GetRTBFStatusRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"getRTBFStatus",namespace:"Identity"},data:{args:{scope:t.scope}}};return e.call(this,"Identity","GetRTBFStatus",n)||this}return __extends(t,e),t}(n)}),define("ubp/client/Identity/IdentityClient",["require","exports","../../commons/logging/Logger","./GetCustomerTokenRequestBuilder","./GetInstallationTokenRequestBuilder","./GetInstallationIdRequestBuilder","./GetInstallationLocaleRequestBuilder","./GetIsInternalRequestBuilder","./GetAllWeblabTreatmentsRequestBuilder","../../client/Identity/GetCohortTokenRequestBuilder","./GetPseudoIdTokenRequestBuilder","./GetCustomerPreferencesRequestBuilder","./ConfirmRTBFExecutionRequestBuilder","./GetRTBFStatusRequestBuilder"],function(e,t,n,r,o,i,s,a,u,c,l,p,f,d){"use strict";return function(){function e(e){this.base=e}return e.prototype.getCustomerToken=function(){return this.buildGetCustomerToken().buildAndSend(this.base)},e.prototype.buildGetCustomerToken=function(){return new r},e.prototype.getInstallationToken=function(){return this.buildGetInstallationToken().buildAndSend(this.base)},e.prototype.buildGetInstallationToken=function(){return new o},e.prototype.getInstallationId=function(){return this.buildGetInstallationId().buildAndSend(this.base)},e.prototype.buildGetInstallationId=function(){return new i},e.prototype.getInstallationLocale=function(){return this.buildGetInstallationLocale().buildAndSend(this.base)},e.prototype.buildGetInstallationLocale=function(){return new s},e.prototype.getAllWeblabTreatments=function(e,t){return this.buildGetAllWeblabTreatments(e,t).buildAndSend(this.base)},e.prototype.buildGetAllWeblabTreatments=function(e,t){return new u(e,t)},e.prototype.getCustomerPreferences=function(){return this.buildGetCustomerPreferences().buildAndSend(this.base)},e.prototype.buildGetCustomerPreferences=function(){return new p},e.prototype.getCohortToken=function(){return this.buildGetCohortToken().buildAndSend(this.base)},e.prototype.buildGetCohortToken=function(){return new c},e.prototype.isInternal=function(){return this.buildIsInternal().buildAndSend(this.base)},e.prototype.buildIsInternal=function(){return new a},e.prototype.getPseudoIdToken=function(e){return this.buildGetPseudoIdToken(e).buildAndSend(this.base)},e.prototype.buildGetPseudoIdToken=function(e){return new l(e)},e.prototype.getRTBFStatus=function(e){return this.buildGetRTBFStatus(e).buildAndSend(this.base)},e.prototype.confirmRTBFExecution=function(e){return this.buildConfirmRTBFExecution(e).buildAndSend(this.base)},e.prototype.buildGetRTBFStatus=function(e){return new d(e)},e.prototype.buildConfirmRTBFExecution=function(e){return new f(e)},e.logger=n.getLogger("IdentityClient"),e}()}),define("ubp/commons/platform/FallbackURLBuilder",["require","exports","lib/bluebird","../utilities/URI"],function(e,t,n,r){"use strict";return function(){function e(){}return e.buildUrls=function(t,r){return r.then(function(r){for(var o=[],i=0;i<t.length;i++)o.push(e._buildUrl(t[i].url,r));return n.resolve(o)}).catch(function(e){return n.reject(e)})},e._buildUrl=function(t,n){var o=r.getURLComponents(t),i=r.getQueryParamsObject(o.queryString);i[e.ASSOCIATE_TAG_QUERYPARAM_KEY]=n.fallbackTag;var s=e.FALLBACK_SUBTAG_FORMAT.replace(e.FALLBACK_SUBTAG_LOCALE,n.locale.toLowerCase()).replace(e.FALLBACK_SUBTAG_PARTNER,n.partner);return i[e.SUBTAG_QUERYPARAM_KEY]=s,o.origin=n.fallbackSite,o.queryString=r.getQueryParameterString(i),r.getURL(o)},e.SUBTAG_QUERYPARAM_KEY="ascsubtag",e.ASSOCIATE_TAG_QUERYPARAM_KEY="tag",e.FALLBACK_SUBTAG_LOCALE="%LOCALE%",e.FALLBACK_SUBTAG_PARTNER="%PARTNER%",e.FALLBACK_SUBTAG_FORMAT="0-0-0-0-0-0-%LOCALE%-0-partn-%PARTNER%",e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Dossier/BuildURLsRequestBuilder",["require","exports","lib/lodash","lib/bluebird","../request/RequestBuilderBase","../Reporter/MetricReport","../../commons/error/BadRequestError","../../commons/error/BaseError","../../commons/logging/Logger","../../commons/platform/FallbackURLBuilder"],function(e,t,n,r,o,i,s,a,u,c){"use strict";return function(e){function t(t){void 0===t&&(t=new Array);var n=e.call(this,"Dossier","buildURLs")||this;return n._requestSpec=t,n}return __extends(t,e),t.prototype.withURLSpec=function(e){return this._requestSpec.push(e),this},t.prototype.getBuildURLsRequestSpec=function(){return this._requestSpec},t.prototype.buildAndSend=function(e){var n=this;if(!this._requestSpec.length){var o=new s("BuildURLs Request Specifications array is empty");return t.logger.error("buildAndSend",o.toString()),r.reject(o)}var u={header:this._buildAPIRequestMessageHeader(),data:{args:{requestSpec:this._requestSpec}}},c=this._initializeMetricReport(e.getMetricReportFactory());return r.bind(this).then(function(){return e.messageClient._sendAndReceive(u,n.getTimeout(),n.getMaxAttempts())}).then(function(e){return c.stopRealTimeTimer(i.LABEL_REQUEST_TIME_SUCCESS),c.incrementRealTimeCounter(i.LABEL_REQUEST_SUCCESS),e},function(r){c.stopRealTimeTimer(i.LABEL_REQUEST_TIME_FAILURE);var o=i.LABEL_DEFAULT_FAILURE_REASON;return r instanceof a&&(o=r.getName()),c.incrementRealTimeCounter(i.LABEL_REQUEST_FAILURE),c.setAdditionalInfo(i.LABEL_REQUEST_FAILURE,o),t.logger.error("buildAndSend",r),n._fallback(e,r)}).finally(function(){c.publish(e)})},t.prototype._fallback=function(e,o){if(!n.isFunction(o.getName)||"RequestTimeoutError"!==o.getName())return r.reject(o);var i=e.Platform.getPlatformInfo();return c.buildUrls(this._requestSpec,i).catch(function(e){return t.logger.fatal("buildAndSend","Error in fallback: "+e),r.reject(o)})},t.logger=u.getLogger("BuildURLsRequestBuilder"),t}(o)}),define("ubp/client/Dossier/DossierClient",["require","exports","./BuildURLsRequestBuilder","../../commons/logging/Logger"],function(e,t,n,r){"use strict";return function(){function e(e){this.base=e}return e.prototype.buildURLs=function(e){return this.buildBuildURLs(e).buildAndSend(this.base)},e.prototype.buildBuildURLs=function(e){return new n(e)},e.prototype.getFallbackTagByLocale=function(t){return t&&e._FallBackTagMap[t.toLowerCase()]?e._FallBackTagMap[t.toLowerCase()]:null},e.logger=r.getLogger("DossierClient"),e._FallBackTagMap={us:"amz-failure-catch-us-20",uk:"amz-failure-catch-uk-21",jp:"amz-failure-catch-jp-22",de:"amz-failure-catch-de-21",fr:"amz-failure-catch-fr-21",ca:"amz-failure-catch-ca-20",it:"amz-failure-catch-it-21",cn:"amz-failure-catch-cn-23",es:"amz-failure-catch-es-21",in:"amz-failure-catch-in-21"},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]
}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Gateway/InstrumentGatewayRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"instrumentGateway",namespace:"Gateway"},data:{args:{message:t}}};return e.call(this,"Gateway","instrumentGateway",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Gateway/ReportLoadEventRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"reportLoadEvent",namespace:"Gateway"},data:{args:{name:t,timestamp:n}}};return e.call(this,"Gateway","reportLoadEvent",o)||this}return __extends(t,e),t}(n)}),define("ubp/client/Gateway/GatewayClient",["require","exports","./InstrumentGatewayRequestBuilder","./ReportLoadEventRequestBuilder","../../commons/logging/Logger"],function(e,t,n,r,o){"use strict";return function(){function e(e){this.base=e}return e.prototype.instrumentGateway=function(e){return this.buildInstrumentGateway(e).buildAndSend(this.base)},e.prototype.buildInstrumentGateway=function(e){return new n(e)},e.prototype.reportLoadEvent=function(e,t){this.buildReportLoadEvent(e,t||Date.now()).buildAndSend(this.base)},e.prototype.buildReportLoadEvent=function(e,t){return new r(e,t)},e.logger=o.getLogger("GatewayClient"),e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Reporter/AppendMetricDataRequestBuilder",["require","exports","lib/bluebird","../request/RequestBuilderBase","../../commons/logging/Logger"],function(e,t,n,r,o){"use strict";return function(e){function t(t){var n=e.call(this,"Reporter","appendMetricData")||this;return n._metricData=t,n}return __extends(t,e),t.prototype._getMetricReportDataFromMetricObject=function(e){var t={};return t.additionalInfo=e.getAdditionalInfo(),t.analyticalCounters=e.getAnalyticalCounters(),t.analyticalTimers=e.getAnalyticalTimers(),t.endTime=e.getEndTime(),t.eventName=e.getEventName(),t.featureId=e.getFeatureId(),t.marketplace=e.getMarketplace(),t.operationName=e.getOperation(),t.processName=e.getProcessName(),t.realTimeCounters=e.getRealTimeCounters(),t.realTimeTimers=e.getRealTimeTimers(),t.requestId=e.getRequestId(),t.startTime=e.getStartTime(),t.userIdentifiable=e.getUserIdentifiable(),t.valid=e.isValid(),t},t.prototype.buildAndSend=function(e){var r=this,o=this._getMetricReportDataFromMetricObject(this._metricData),i={header:this._buildAPIRequestMessageHeader(),data:{args:{metricData:o}}};return n.bind(this).then(function(){return e.messageClient._sendAndReceive(i,r.getTimeout(),r.getMaxAttempts())}).then(function(){},function(e){throw t.logger.error("buildAndSend",e),e})},t.logger=o.getLogger("AppendMetricDataRequestBuilder"),t}(r)}),define("ubp/client/Reporter/ReporterClient",["require","exports","../../commons/logging/Logger","./AppendMetricDataRequestBuilder"],function(e,t,n,r){"use strict";return function(){function e(e){this.base=e}return e.prototype.appendMetricData=function(e){return this.buildAppendMetricData(e).buildAndSend(this.base)},e.prototype.buildAppendMetricData=function(e){return new r(e)},e.logger=n.getLogger("ReporterClient"),e}()}),define("ubp/client/request/RequestUtils",["require","exports","lib/bluebird"],function(e,t,n){"use strict";return function(){function e(){}return e.buildRetry=function(t,r,o,i,s){var a=this;if(void 0===r&&(r=this.DEFAULT_MESSAGE_TIMEOUT),void 0===o&&(o=this.DEFAULT_ATTEMPTS),void 0===i&&(i=this.DEFAULT_RETRY_DELAY),void 0===s&&(s=this.DEFAULT_BACKOFF_FACTOR),o<=0)throw new Error("Invalid input to buildRetry: maxAttempts must be at least 1");return n.bind(this).then(function(){return e.withTimeout(t,r,new Error("Timeout error")).then(function(e){return n.resolve(e)})}).catch(function(e){if(o-1>0)return o--,n.delay(i).then(function(){return a.buildRetry(t,r,o,i*s)});throw e})},e.withTimeout=function(e,t,r){var o=null;return n.race([new n(function(e,n){return o=setTimeout(n,t,r)}),e().then(function(e){return clearTimeout(o),e})])},e.DEFAULT_MESSAGE_TIMEOUT=1e3,e.DEFAULT_ATTEMPTS=3,e.DEFAULT_RETRY_DELAY=100,e.DEFAULT_BACKOFF_FACTOR=2,e}()}),define("ubp/client/Storage/StorageConstants",["require","exports"],function(e,t){"use strict";return function(){function e(){}return e.prepareKeyWithPrefixAndNamespace=function(t,n){if(!t)throw new Error("Storage key is invalid");var r=new RegExp(e.PrefixFilterRegExp);if(t&&t.search(r)>-1)return t;var o=e.StorageKeyPrefix;return n&&(o=o+e.StorageKeySeparator+n),t=o+e.StorageKeySeparator+t},e.MaxAllowedStorageValueSize=16384,e.MaxAttemptsToPublishEvent=3,e.StorageKeyPrefix="ubpv2",e.StorageKeySeparator=".",e.PrefixFilterRegExp="^legacy..*|^ubpMigration..*|^shared..*",e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Storage/DeleteRequestBuilder",["require","exports","../../commons/error/BaseError","../request/RequestBuilderBase","lib/bluebird","../Reporter/MetricReport","../../commons/error/BadRequestError","../../commons/error/ConflictError","../../commons/logging/Logger","../request/RequestUtils","./StorageConstants"],function(e,t,n,r,o,i,s,a,u,c,l){"use strict";return function(e){function t(t,n){var r=e.call(this,"Storage","delete")||this;return r._key=t,r._expectedValue=n,r}return __extends(t,e),t.prototype.buildAndSend=function(e){var r=this,s=this._initializeMetricReport(e.getMetricReportFactory());return s.setOperationName("Storagev2.delete",!0),o.bind(this).then(function(){return c.buildRetry(function(){return r._remove(r._key,e,r._expectedValue)},r.getTimeout(),r.getMaxAttempts())}).then(function(e){return s.stopRealTimeTimer(i.LABEL_REQUEST_TIME_SUCCESS),s.incrementRealTimeCounter(i.LABEL_REQUEST_SUCCESS),e},function(e){s.stopRealTimeTimer(i.LABEL_REQUEST_TIME_FAILURE);var r=i.LABEL_DEFAULT_FAILURE_REASON;throw e instanceof n&&(r=e.getName()),s.incrementRealTimeCounter(i.LABEL_REQUEST_FAILURE),s.setAdditionalInfo(i.LABEL_REQUEST_FAILURE,r),t.logger.error("buildAndSend",e),e}).finally(function(){s.publish(e)})},t.prototype._remove=function(e,n,r){var i="",u="";return t.logger.debug("remove","Incoming request with key: "+e+", expectedValue: "+r),o.bind(this).then(function(){if(!e){var r=new s("key is not part of the Storage.delete message");throw t.logger.error("delete",r.toString()),r}return u=l.prepareKeyWithPrefixAndNamespace(e,n.getNamespace()),n.Platform.RuntimeStorage.getStorageValue(u)}).then(function(e){if(r&&r!==e){var o=new a("The expected value "+r+" and the current value "+e+" in the storage, do not match");throw t.logger.error("get",o.toString()),o}return i=e,n.Platform.RuntimeStorage.deleteStorageValue(u)}).then(function(){var t={oldValue:i,newValue:null};return n.Platform.buildPublish("Storage.onDelete."+e,t).withMaxAttempts(l.MaxAttemptsToPublishEvent).buildAndSend(n),i})},t.logger=u.getLogger("DeleteRequestBuilder"),t}(r)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Storage/GetRequestBuilder",["require","exports","lib/bluebird","../../commons/error/BadRequestError","../../commons/error/BaseError","../../commons/logging/Logger","../Reporter/MetricReport","../request/RequestBuilderBase","../request/RequestUtils","./StorageConstants"],function(e,t,n,r,o,i,s,a,u,c){"use strict";return function(e){function t(t){var n=e.call(this,"Storage","get")||this;return n._key=t,n}return __extends(t,e),t.prototype.buildAndSend=function(e){var r=this,i=this._initializeMetricReport(e.getMetricReportFactory());return i.setOperationName("Storagev2.get",!0),n.bind(this).then(function(){return u.buildRetry(function(){return r._get(r._key,e)},r.getTimeout(),r.getMaxAttempts())}).then(function(e){return i.stopRealTimeTimer(s.LABEL_REQUEST_TIME_SUCCESS),i.incrementRealTimeCounter(s.LABEL_REQUEST_SUCCESS),e},function(e){i.stopRealTimeTimer(s.LABEL_REQUEST_TIME_FAILURE);var n=s.LABEL_DEFAULT_FAILURE_REASON;throw e instanceof o&&(n=e.getName()),i.incrementRealTimeCounter(s.LABEL_REQUEST_FAILURE),i.setAdditionalInfo(s.LABEL_REQUEST_FAILURE,n),t.logger.error("buildAndSend",e),e}).finally(function(){i.publish(e)})},t.prototype._get=function(e,n){if(t.logger.debug("get","Incoming request for key: "+e),!e){var o=new r("key is invalid for Storage.get");throw t.logger.error("get",o.toString()),o}return e=c.prepareKeyWithPrefixAndNamespace(e,n.getNamespace()),n.Platform.RuntimeStorage.getStorageValue(e)},t.logger=i.getLogger("GetRequestBuilder"),t}(a)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Storage/PutRequestBuilder",["require","exports","lib/bluebird","../../commons/error/BadRequestError","../../commons/error/BaseError","../../commons/error/ConflictError","../../commons/logging/Logger","../Reporter/MetricReport","../request/RequestBuilderBase","../request/RequestUtils","./StorageConstants"],function(e,t,n,r,o,i,s,a,u,c,l){"use strict";return function(e){function t(t,n,r){var o=e.call(this,"Storage","put")||this;if(!t)throw new Error("PutRequestBuilder Key cannot be null or undefined");return o._key=t,o._value=n,o._expectedValue=r,o}return __extends(t,e),t.prototype.buildAndSend=function(e){var r=this,i=this._initializeMetricReport(e.getMetricReportFactory());return i.setOperationName("Storagev2.put",!0),n.bind(this).then(function(){return c.buildRetry(function(){return r._put(r._key,r._value,e,r._expectedValue)},r.getTimeout(),r.getMaxAttempts())}).then(function(e){return i.stopRealTimeTimer(a.LABEL_REQUEST_TIME_SUCCESS),i.incrementRealTimeCounter(a.LABEL_REQUEST_SUCCESS),e},function(e){i.stopRealTimeTimer(a.LABEL_REQUEST_TIME_FAILURE);var n=a.LABEL_DEFAULT_FAILURE_REASON;throw e instanceof o&&(n=e.getName()),i.incrementRealTimeCounter(a.LABEL_REQUEST_FAILURE),i.setAdditionalInfo(a.LABEL_REQUEST_FAILURE,n),t.logger.error("buildAndSend",e),e}).finally(function(){i.publish(e)})},t.prototype._put=function(e,o,s,a){var u="",c="";return t.logger.debug("put","Incoming request with key: "+e+", value: "+o+", expectedValue: "+a),n.bind(this).then(function(){if(!e||!o){var n=new r("key/value is not part of the Storage.put message");throw t.logger.error("put",n.toString()),n}if(l.MaxAllowedStorageValueSize<o.length){var n=new r("The value size "+o.length+" is too large for storage");throw t.logger.error("get",n.toString()),n}return c=l.prepareKeyWithPrefixAndNamespace(e,s.getNamespace()),s.Platform.RuntimeStorage.getStorageValue(c)}).then(function(n){if(a&&a!==n)throw new i("The expected value and the current value in the storage, does not match");return u=n,s.Platform.RuntimeStorage.putStorageValue(c,o).then(function(n){t.logger.debug("_put","Stored value in Storage, old value was ["+e+"] = "+n)})}).then(function(){if(u!==o){var t={oldValue:u,newValue:o};s.Platform.buildPublish("Storage.onChange."+e,t).withMaxAttempts(l.MaxAttemptsToPublishEvent).buildAndSend(s)}return u})},t.logger=s.getLogger("PutRequestBuilder"),t}(u)}),define("ubp/client/Storage/PlatformStorageClient",["require","exports","./DeleteRequestBuilder","./GetRequestBuilder","./PutRequestBuilder"],function(e,t,n,r,o){"use strict";return function(){function e(e){this._client=e}return e.prototype.get=function(e){return this.buildGet(e).buildAndSend(this._client)},e.prototype.buildGet=function(e){return new r(e)},e.prototype.put=function(e,t,n){return this.buildPut(e,t,n).buildAndSend(this._client)},e.prototype.buildPut=function(e,t,n){return new o(e,t,n)},e.prototype.delete=function(e,t){return this.buildDelete(e,t).buildAndSend(this._client)},e.prototype.buildDelete=function(e,t){return new n(e,t)},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Feed/GetFeedDataRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Feed","getFeedData")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Feed/GetFeedItemsDataRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"getFeedItemsData",namespace:"Feed"},data:{args:{feedItemTypes:t,fromCache:n}}};return e.call(this,"Feed","getFeedItemsData",o)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Feed/GetFeedDataV2RequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"getFeedDataV2",namespace:"Feed"},data:{args:{getFeedDataQuickly:t}}};return e.call(this,"Feed","getFeedDataV2",n)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Gamification/ReportGameActionBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"reportGameAction",namespace:"Feed"},data:{args:{gameID:n.getID(),gameActionData:{gameAction:t,timestamp:Date.now()}}}};return e.call(this,"Feed","reportGameAction",o)||this}return __extends(t,e),t}(n)}),define("ubp/client/Feed/FeedClient",["require","exports","./GetFeedDataRequestBuilder","./GetFeedItemsDataRequestBuilder","./GetFeedDataV2RequestBuilder","../Gamification/ReportGameActionBuilder","../../commons/logging/Logger"],function(e,t,n,r,o,i,s){"use strict";return function(){function e(e){this.base=e}return e.prototype.getFeedData=function(){return this.buildGetFeedData().buildAndSend(this.base)},e.prototype.getFeedDataV2=function(e){return this.buildGetFeedDataV2(e).buildAndSend(this.base)},e.prototype.buildGetFeedData=function(){return new n},e.prototype.buildGetFeedDataV2=function(e){return new o(e)},e.prototype.getFeedItemsData=function(e,t){return this.buildGetFeedItemsData(e,t).buildAndSend(this.base)},e.prototype.buildGetFeedItemsData=function(e,t){return new r(e,t)},e.prototype.reportGameAction=function(e,t){return this.buildReportGameAction(e,t).buildAndSend(this.base)},e.prototype.buildReportGameAction=function(e,t){return new i(e,t)},e.logger=s.getLogger("FeedClient"),e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Wishlist/GetItemInfoRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"Wishlist","getItemInfo")||this}return __extends(t,e),t}(n)}),define("ubp/client/Wishlist/WishlistClient",["require","exports","./GetItemInfoRequestBuilder","../../commons/logging/Logger"],function(e,t,n,r){"use strict";return function(){function e(e){this.base=e}return e.prototype.getItemInfo=function(){return this.buildGetItemInfo().buildAndSend(this.base)},e.prototype.buildGetItemInfo=function(){return new n},e.logger=r.getLogger("WishlistClient"),e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Product/GetProductDataRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"getProductData",namespace:"Product"},data:{args:{productIds:t,requestType:n}}};return e.call(this,"Product","getProductData",o)||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Product/FetchProductDataRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t,n){var o={header:{messageType:r.API,name:"fetchProductData",namespace:"Product"},data:{args:{productIds:t,requestType:n}}};return e.call(this,"Product","fetchProductData",o)||this}return __extends(t,e),t}(n)}),define("ubp/client/Product/ProductClient",["require","exports","./GetProductDataRequestBuilder","./FetchProductDataRequestBuilder","../../commons/logging/Logger"],function(e,t,n,r,o){"use strict";return function(){function e(e){this.base=e}return e.prototype.getProductData=function(e,t){return this.buildGetProductData(e,t).buildAndSend(this.base)},e.prototype.buildGetProductData=function(e,t){return new n(e,t)},e.prototype.fetchProductData=function(e,t){return this.buildFetchProductData(e,t).buildAndSend(this.base)},e.prototype.buildFetchProductData=function(e,t){return new r(e,t)},e.logger=o.getLogger("ProductClient"),e}()}),define("ubp/client/Gamification/GameClient",["require","exports","../../commons/logging/Logger"],function(e,t,n){"use strict";return function(){function e(t){this._base=t,e.logger=n.getLogger("GameClient")}return e.prototype.getGameData=function(t,n,r){return void 0===n&&(n=e.DEFAULT_TIMEOUT),void 0===r&&(r=e.DEFAULT_ATTEMPTS),this._base.Feed.buildGetFeedItemsData([e.FEED_ITEM_TYPE_GAME],t).withTimeout(n).withMaxAttempts(r).buildAndSend(this._base)},e.prototype.reportGameAction=function(t,n,r,o){return void 0===r&&(r=e.DEFAULT_TIMEOUT),void 0===o&&(o=e.DEFAULT_ATTEMPTS),this._base.Feed.buildReportGameAction(t,n).withTimeout(r).withMaxAttempts(o).buildAndSend(this._base)},e.FEED_ITEM_TYPE_GAME="Game",e.DEFAULT_TIMEOUT=1e3,e.DEFAULT_ATTEMPTS=2,e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Titan/PauseEventPublishingRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"TitanClient","pauseEventPublishing")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Titan/ResumeEventPublishingRequestBuilder",["require","exports","../request/RequestBuilderBase"],function(e,t,n){"use strict";return function(e){function t(){return e.call(this,"TitanClient","resumeEventPublishing")||this}return __extends(t,e),t}(n)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Titan/RefreshClientTokenRequestBuilder",["require","exports","../request/RequestBuilderBase","../../commons/specification/message/MessageType"],function(e,t,n,r){"use strict";return function(e){function t(t){var n={header:{messageType:r.API,name:"refreshClientToken",namespace:"TitanClient"},data:{args:{isolationZoneId:t}}};return e.call(this,"TitanClient","refreshClientToken",n)||this}return __extends(t,e),t}(n)}),define("ubp/client/Titan/TitanClient",["require","exports","./PauseEventPublishingRequestBuilder","./ResumeEventPublishingRequestBuilder","./RefreshClientTokenRequestBuilder"],function(e,t,n,r,o){"use strict";return function(){function e(e){this.base=e}return e.prototype.refreshClientToken=function(e){return new o(e).buildAndSend(this.base)},e.prototype.pauseEventPublishing=function(){return(new n).buildAndSend(this.base)},e.prototype.resumeEventPublishing=function(){return(new r).buildAndSend(this.base)},e}()}),define("ubp/client/request/RestartRequestBuilder",["require","exports","lib/bluebird","../../commons/error/Errors","../Reporter/MetricReport","../../commons/error/BaseError","../../commons/logging/Logger","../../commons/specification/message/MessageType"],function(e,t,n,r,o,i,s,a){"use strict";return function(){function e(t,n,o){if(void 0===o&&(o=0),this._timeout=e._DefaultTimeout,this._maxAttempts=e._DefaultMaxAttempts,!t){var i=r.BadRequest("The namespace of the process to restart must be specified when signalling a restart; namespace: "+t);throw e.logger.error("constructor",i.toString()),i}if(!n){var i=r.BadRequest("A reason must be specified when signalling a restart; reason: "+n);throw e.logger.error("constructor",i.toString()),i}this._namespace=t,this._reason=n,this._delay=o}return e.prototype.withTimeout=function(e){return this._timeout=e,this},e.prototype.withMaxAttempts=function(e){return this._maxAttempts=e,this},e.prototype.getTimeout=function(){return this._timeout},e.prototype.getMaxAttempts=function(){return this._maxAttempts},e.prototype.buildAndSend=function(t){var r=this;return n.bind(this).then(function(){var e={header:{messageType:a.SIGNAL,name:"restart",namespace:r._namespace},data:{args:{namespace:r._namespace,reason:r._reason,delay:r._delay}}},n=t.getMetricReportFactory().fabricate();return n.setOperationName(r._namespace+".restart",!0),n.incrementRealTimeCounter(o.LABEL_REQUEST_COUNT),n.publish(t),t.messageClient._sendAndReceive(e,r._timeout,r._maxAttempts)}).then(function(){e.logger.warn("buildAndSend","Weird edge case. This process should have been killed, and should never have received a 'success' response from the extension at all, unless in a test context")},function(n){var s=t.getMetricReportFactory().fabricate();s.setOperationName(r._namespace+".restart",!0),s.incrementRealTimeCounter(o.LABEL_REQUEST_SUCCESS,0),s.incrementRealTimeCounter(o.LABEL_REQUEST_FAILURE,1);var a=o.LABEL_DEFAULT_FAILURE_REASON;throw n instanceof i&&(a=n.getName()),s.setAdditionalInfo(o.LABEL_REQUEST_FAILURE,a),s.publish(t),e.logger.error("buildAndSend",n),n})},e._DefaultTimeout=5e3,e._DefaultMaxAttempts=3,e.logger=s.getLogger("RestartRequestBuilder"),e}()}),define("ubp/client/UBPClient",["require","exports","lib/bluebird","./Platform/PlatformClient","./Identity/IdentityClient","./Dossier/DossierClient","./Gateway/GatewayClient","./Reporter/ReporterClient","./Storage/PlatformStorageClient","./Feed/FeedClient","./Wishlist/WishlistClient","./Product/ProductClient","./Gamification/GameClient","./Titan/TitanClient","./request/RestartRequestBuilder","./factory/MetricReportFactory","../commons/error/ConflictError"],function(e,t,n,r,o,i,s,a,u,c,l,p,f,d,h,_,m){"use strict";return function(){function e(e,t,n){this.Platform=new r(this),this.Identity=new o(this),this.Dossier=new i(this),this.Reporter=new a(this),this.Storage=new u(this),this.Feed=new c(this),this.Wishlist=new l(this),this.Product=new p(this),this.Gateway=new s(this),this.Game=new f(this),this.Titan=new d(this),this._namespace=e,this.messageClient=t,this._hasStarted=!1,this._metricReportFactory=n||new _}return e.prototype.start=function(){var e=this;return n.bind(this).then(function(){if(e._hasStarted)throw new Error("UBP Client has already been started and is running.")}).then(function(){return e.messageClient.start()}).then(function(){e._hasStarted=!0,e._metricReportFactory&&"function"==typeof e._metricReportFactory.isGamified&&e._metricReportFactory.isGamified()&&e._metricReportFactory.startReferee().catch(function(e){})})},e.prototype.ready=function(){var t=this;return n.bind(this).then(function(){return t.messageClient.ready(e.HANDSHAKE_TIMEOUT_MILLIS)})},e.prototype.signalRestart=function(e,t){return this.buildSignalRestart(e,t).buildAndSend(this)},e.prototype.buildSignalRestart=function(e,t){if(!this._hasStarted)throw new Error("The UBP Client has not been started yet.");return new h(this._namespace,e,t)},e.prototype._checkIfClientStarted=function(){if(!this._hasStarted)throw new m("The UBP client has not yet been started")},e.prototype.getMetricReportFactory=function(){return this._checkIfClientStarted(),this._metricReportFactory},e.prototype.getNamespace=function(){return this._namespace},e.HANDSHAKE_TIMEOUT_MILLIS=5e3,e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/StorageLegacy/GetRequestBuilderLegacy",["require","exports","lib/bluebird","../request/RequestBuilderBase","../Reporter/MetricReport","../../commons/error/BaseError","../../commons/logging/Logger"],function(e,t,n,r,o,i,s){"use strict";return function(e){function t(t){var n=e.call(this,"Storage","get")||this;return n._key=t,n}return __extends(t,e),t.prototype.buildAndSend=function(e){var r=this,s={header:this._buildAPIRequestMessageHeader(),data:{args:{key:this._key}}},a=this._initializeMetricReport(e.getMetricReportFactory());return n.bind(this).then(function(){return e.messageClient._sendAndReceive(s,r.getTimeout(),r.getMaxAttempts())}).then(function(e){return a.stopRealTimeTimer(o.LABEL_REQUEST_TIME_SUCCESS),a.incrementRealTimeCounter(o.LABEL_REQUEST_SUCCESS),e},function(e){a.stopRealTimeTimer(o.LABEL_REQUEST_TIME_FAILURE);var n=o.LABEL_DEFAULT_FAILURE_REASON;throw e instanceof i&&(n=e.getName()),a.incrementRealTimeCounter(o.LABEL_REQUEST_FAILURE),a.setAdditionalInfo(o.LABEL_REQUEST_FAILURE,n),t.logger.error("buildAndSend",e),e}).finally(function(){a.publish(e)})},t.logger=s.getLogger("GetRequestBuilder"),t}(r)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/StorageLegacy/PutRequestBuilderLegacy",["require","exports","lib/bluebird","../request/RequestBuilderBase","../Reporter/MetricReport","../../commons/error/BaseError","../../commons/logging/Logger"],function(e,t,n,r,o,i,s){"use strict";return function(e){function t(t,n,r){var o=e.call(this,"Storage","put")||this;return o._key=t,o._value=n,o._expectedValue=r,o}return __extends(t,e),t.prototype.buildAndSend=function(e){var r=this,s={header:this._buildAPIRequestMessageHeader(),data:{args:{key:this._key,value:this._value,expectedValue:this._expectedValue}}},a=this._initializeMetricReport(e.getMetricReportFactory());return n.bind(this).then(function(){return e.messageClient._sendAndReceive(s,r.getTimeout(),r.getMaxAttempts())}).then(function(e){return a.stopRealTimeTimer(o.LABEL_REQUEST_TIME_SUCCESS),a.incrementRealTimeCounter(o.LABEL_REQUEST_SUCCESS),e},function(e){a.stopRealTimeTimer(o.LABEL_REQUEST_TIME_FAILURE);var n=o.LABEL_DEFAULT_FAILURE_REASON;throw e instanceof i&&(n=e.getName()),a.incrementRealTimeCounter(o.LABEL_REQUEST_FAILURE),a.setAdditionalInfo(o.LABEL_REQUEST_FAILURE,n),t.logger.error("buildAndSend",e),e}).finally(function(){a.publish(e)})},t.logger=s.getLogger("PutRequestBuilder"),t}(r)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()
;define("ubp/client/StorageLegacy/PutIfAbsentRequestBuilderLegacy",["require","exports","lib/bluebird","../request/RequestBuilderBase","../Reporter/MetricReport","../../commons/error/BaseError","../../commons/logging/Logger"],function(e,t,n,r,o,i,s){"use strict";return function(e){function t(t,n){var r=e.call(this,"Storage","putIfAbsent")||this;return r._key=t,r._value=n,r}return __extends(t,e),t.prototype.buildAndSend=function(e){var r=this,s={header:this._buildAPIRequestMessageHeader(),data:{args:{key:this._key,value:this._value}}},a=this._initializeMetricReport(e.getMetricReportFactory());return n.bind(this).then(function(){return e.messageClient._sendAndReceive(s,r.getTimeout(),r.getMaxAttempts())}).then(function(e){return a.stopRealTimeTimer(o.LABEL_REQUEST_TIME_SUCCESS),a.incrementRealTimeCounter(o.LABEL_REQUEST_SUCCESS),e},function(e){a.stopRealTimeTimer(o.LABEL_REQUEST_TIME_FAILURE);var n=o.LABEL_DEFAULT_FAILURE_REASON;throw e instanceof i&&(n=e.getName()),a.incrementRealTimeCounter(o.LABEL_REQUEST_FAILURE),a.setAdditionalInfo(o.LABEL_REQUEST_FAILURE,n),t.logger.error("buildAndSend",e),e}).finally(function(){a.publish(e)})},t.logger=s.getLogger("PutIfAbsentRequestBuilder"),t}(r)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/StorageLegacy/DeleteRequestBuilderLegacy",["require","exports","lib/bluebird","../request/RequestBuilderBase","../Reporter/MetricReport","../../commons/error/BaseError","../../commons/logging/Logger"],function(e,t,n,r,o,i,s){"use strict";return function(e){function t(t,n){var r=e.call(this,"Storage","delete")||this;return r._key=t,r._expectedValue=n,r}return __extends(t,e),t.prototype.buildAndSend=function(e){var r=this,s={header:this._buildAPIRequestMessageHeader(),data:{args:{key:this._key,expectedValue:this._expectedValue}}},a=this._initializeMetricReport(e.getMetricReportFactory());return n.bind(this).then(function(){return e.messageClient._sendAndReceive(s,r.getTimeout(),r.getMaxAttempts())}).then(function(e){return a.stopRealTimeTimer(o.LABEL_REQUEST_TIME_SUCCESS),a.incrementRealTimeCounter(o.LABEL_REQUEST_SUCCESS),e},function(e){a.stopRealTimeTimer(o.LABEL_REQUEST_TIME_FAILURE);var n=o.LABEL_DEFAULT_FAILURE_REASON;throw e instanceof i&&(n=e.getName()),a.incrementRealTimeCounter(o.LABEL_REQUEST_FAILURE),a.setAdditionalInfo(o.LABEL_REQUEST_FAILURE,n),t.logger.error("buildAndSend",e),e}).finally(function(){a.publish(e)})},t.logger=s.getLogger("DeleteRequestBuilder"),t}(r)}),define("ubp/client/StorageLegacy/StorageClientLegacy",["require","exports","../../commons/logging/Logger","./GetRequestBuilderLegacy","./PutRequestBuilderLegacy","./PutIfAbsentRequestBuilderLegacy","./DeleteRequestBuilderLegacy"],function(e,t,n,r,o,i,s){"use strict";return function(){function e(e){this.base=e}return e.prototype.get=function(e){return this.buildGet(e).buildAndSend(this.base)},e.prototype.buildGet=function(e){return new r(e)},e.prototype.put=function(e,t,n){return this.buildPut(e,t,n).buildAndSend(this.base)},e.prototype.buildPut=function(e,t,n){return new o(e,t,n)},e.prototype.putIfAbsent=function(e,t){return this.buildPutIfAbsent(e,t).buildAndSend(this.base)},e.prototype.buildPutIfAbsent=function(e,t){return new i(e,t)},e.prototype.delete=function(e,t){return this.buildDelete(e,t).buildAndSend(this.base)},e.prototype.buildDelete=function(e,t){return new s(e,t)},e.logger=n.getLogger("StorageClient"),e}()}),define("ubp/client/v2/UBPClientV2",["require","exports","lib/lodash","lib/bluebird","../Platform/PlatformClient","../Identity/IdentityClient","../Dossier/DossierClient","../Reporter/ReporterClient","../StorageLegacy/StorageClientLegacy","../Feed/FeedClient","../Wishlist/WishlistClient","../Product/ProductClient","../Gateway/GatewayClient","../Gamification/GameClient","../factory/MetricReportFactory","../request/RestartRequestBuilder","../../commons/error/Errors","../Titan/TitanClient"],function(e,t,n,r,o,i,s,a,u,c,l,p,f,d,h,_,m,g){"use strict";return function(){function e(e,t,n){var _=this;void 0===n&&(n=new h),this._namespace=e,this.messageClient=t,this._metricReportFactory=n,this.Platform=new o(this),this.Identity=new i(this),this.Dossier=new s(this),this.Reporter=new a(this),this.Storage=new u(this),this.Feed=new c(this),this.Wishlist=new l(this),this.Product=new p(this),this.Gateway=new f(this),this.Game=new d(this),this.Titan=new g(this),this._isStarted=!1,this._readyPromise=new r(function(e){_._readyPromiseResolver=e}),this.messageClient.startHandler=function(){return _._readyPromise}}return e.prototype.start=function(){var e=this;return r.bind(this).then(function(){if(e._isStarted)throw m.Conflict("The UBP client has already been started");e.messageClient.init(),e._isStarted=!0,e._startGameReferee()})},e.prototype.ready=function(){var e=this;return r.bind(this).then(function(){return e._readyPromiseResolver(),e._readyPromise})},e.prototype.buildSignalRestart=function(e,t){return this._checkIsStarted(),new _(this._namespace,e,t)},e.prototype.signalRestart=function(e,t){return this.buildSignalRestart(e,t).buildAndSend(this)},e.prototype.getNamespace=function(){return this._namespace},e.prototype.getMetricReportFactory=function(){return this._checkIsStarted(),this._metricReportFactory},Object.defineProperty(e.prototype,"shouldNackHeartbeats",{get:function(){return!this.messageClient.isHealthy},set:function(e){this.messageClient.isHealthy=!e},enumerable:!0,configurable:!0}),e.prototype._startGameReferee=function(){this._metricReportFactory&&"function"==typeof this._metricReportFactory.isGamified&&this._metricReportFactory.isGamified()&&this._metricReportFactory.startReferee().catch(n.noop)},e.prototype._checkIsStarted=function(){if(!this._isStarted)throw m.Conflict("The UBP client has not yet been started")},e}()}),define("ubp/client/Gamification/validator/GameValidator",["require","exports"],function(e,t){"use strict";return function(){function e(e){this.validators=e}return e.prototype.validate=function(e,t){if(!t||"function"!=typeof t.getType||!t.getType())throw new Error("Unable to validate game action, invalid gameData");if(!this.validators[t.getType()])throw new Error("Unable to validate game action, no matching validator for game type "+t.getType());return this.validators[t.getType()].validate(e,t)},e}()}),define("ubp/client/Gamification/factory/GameFactory",["require","exports","../../../commons/logging/Logger"],function(e,t,n){"use strict";return function(){function e(e){this._logger=n.getLogger("GameFactory"),this._builders=e}return e.prototype.fabricate=function(e){var t,n;e||this._logAndThrowError("fabricate","Error fabricating GameData, feedItem is undefined"),t=e.externalId;try{n=JSON.parse(e.data)}catch(e){this._logAndThrowError("fabricate","Error fabricating GameData, "+e.message)}return this.fabricateFromData(t,n)},e.prototype.fabricateFromData=function(e,t){var n=t&&t.gameData;return e||this._logAndThrowError("fabricate","Error fabricating GameData, invalid game ID: "+e),n||this._logAndThrowError("fabricate","Error fabricating GameData, invalid data: "+JSON.stringify(n)),this._builders.get(n.type)||this._logAndThrowError("fabricate","Error fabricating GameData, invalid game type: "+n.type),this._builders.get(n.type).build(e,n)},e.prototype._logAndThrowError=function(e,t){throw this._logger.error(e,t),new Error(t)},e}()}),define("ubp/client/Gamification/GameType",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.SINGLE_ACTION=0]="SINGLE_ACTION"}(n||(n={})),n}),define("ubp/client/Gamification/GameStatus",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.NOT_ACTIVATED=0]="NOT_ACTIVATED",e[e.ACTIVATED=1]="ACTIVATED",e[e.COMPLETED=2]="COMPLETED",e[e.EXPIRED=3]="EXPIRED"}(n||(n={})),n}),define("ubp/client/Gamification/data/GameData",["require","exports"],function(e,t){"use strict";return function(){function e(e,t,n,r){this.gameID=e,this.gameType=t,this.rules=n,this.stats=r}return e.prototype.getID=function(){return this.gameID},e.prototype.getType=function(){return this.gameType},e.prototype.getRules=function(){return this.rules},e.prototype.getStats=function(){return this.stats},e.prototype.getActionRules=function(){return this.rules&&this.rules.actionRules},e.prototype.getStatusRules=function(){return this.rules&&this.rules.statusRules},e.prototype.getActionStats=function(){return this.stats&&this.stats.actionStats},e.prototype.getStatusStats=function(){return this.stats&&this.stats.statusStats},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/Gamification/data/SingleActionGameData",["require","exports","./GameData"],function(e,t,n){"use strict";return function(e){function t(t,n,r,o){return e.call(this,t,n,r,o)||this}return __extends(t,e),t}(n)}),define("ubp/client/Gamification/factory/SingleActionGameBuilder",["require","exports","../GameType","../GameStatus","../../../commons/logging/Logger","../data/SingleActionGameData"],function(e,t,n,r,o,i){"use strict";return function(){function e(){this._logger=o.getLogger("SingleActionGameBuilder")}return e.prototype.build=function(e,t){var r,o,s;if(e||this._logAndThrowError("build","Error building SingleActionGameData, Invalid game ID: "+e),t&&t.type===n[n.SINGLE_ACTION]&&t.rules&&t.stats){r=n[n.SINGLE_ACTION];try{return o={actionRules:this.validateActionRules(t),statusRules:this.validateStatusRules(t)},s={actionStats:this.validateActionStats(t),statusStats:this.validateStatusStats(t)},new i(e,r,o,s)}catch(e){this._logAndThrowError("build","Error building SingleActionGameData, "+e.message)}}this._logAndThrowError("build","Error building SingleActionGameData, Invalid game data")},e.prototype.validateActionRules=function(e){if(e&&e.rules&&e.rules.actionRules&&e.rules.actionRules.actionOptions&&"string"==typeof e.rules.actionRules.gameAction&&"string"==typeof e.rules.actionRules.actionOptions.frequency&&e.rules.actionRules.actionOptions.maxPerFrequency>0&&e.rules.actionRules.actionOptions.maxPerGame>0)return e.rules.actionRules;throw new Error("Invalid action rules")},e.prototype.validateStatusRules=function(e){if(e&&e.rules&&e.rules.statusRules&&e.rules.statusRules[r[r.NOT_ACTIVATED]]&&e.rules.statusRules[r[r.NOT_ACTIVATED]].expirationMillis>0&&e.rules.statusRules[r[r.ACTIVATED]]&&e.rules.statusRules[r[r.ACTIVATED]].expirationMillis>0&&e.rules.statusRules[r[r.COMPLETED]]&&e.rules.statusRules[r[r.COMPLETED]].expirationMillis>0&&e.rules.statusRules[r[r.EXPIRED]]&&e.rules.statusRules[r[r.EXPIRED]].expirationMillis>0)return e.rules.statusRules;throw new Error("Invalid status rules")},e.prototype.validateActionStats=function(e){if(e&&e.stats&&e.stats.actionStats&&"number"==typeof e.stats.actionStats.score&&"number"==typeof e.stats.actionStats.lastActionTimestamp)return e.stats.actionStats;throw new Error("Invalid action stats")},e.prototype.validateStatusStats=function(e){if(e&&e.stats&&e.stats.statusStats&&"string"==typeof e.stats.statusStats.status&&"number"==typeof e.stats.statusStats.startTimestamp)return e.stats.statusStats;throw new Error("Invalid status stats")},e.prototype._logAndThrowError=function(e,t){throw this._logger.error(e,t),new Error(t)},e}()}),define("ubp/client/Gamification/factory/GameBuilderMap",["require","exports","../GameType","./SingleActionGameBuilder"],function(e,t,n,r){"use strict";return function(){function e(){this.builderMap={},this.builderMap[n[n.SINGLE_ACTION]]=new r}return e.prototype.update=function(e,t){if(!e)throw new Error("GameBuilderMap#update invalid type");if(!t||"function"!=typeof t.build)throw new Error("GameBuilderMap#update invalid builder");this.builderMap[e]=t},e.prototype.get=function(e){return this.builderMap[e]},e}()}),define("ubp/client/Gamification/validator/SingleActionGameValidator",["require","exports","../GameType","../GameStatus"],function(e,t,n,r){"use strict";return function(){function e(){}return e.prototype.validate=function(e,t){return!!t&&t.getType()===n[n.SINGLE_ACTION]&&t.getStatusStats().status===r[r.ACTIVATED]&&t.getActionRules().gameAction===e},e}()}),define("ubp/client/Gamification/referee/GameRefereeBuilder",["require","exports","../GameClient","../validator/GameValidator","../factory/GameFactory","../factory/GameBuilderMap","../GameType","../validator/SingleActionGameValidator","./GameReferee"],function(e,t,n,r,o,i,s,a,u){"use strict";return function(){function e(e){this.validatorsMap={},this.client=e}return e.prototype.isValidators=function(e){var t="object"==typeof e&&Object.keys(e);return!(!t||0===t.length)&&t.reduce(function(t,n,r,o){return!(!t||!e[n]||"function"!=typeof e[n].validate)},!0)},e.prototype.setClient=function(e){return this.client=e,this},e.prototype.getClient=function(){return this.client},e.prototype.setValidatorStrategies=function(e){if(!this.isValidators(e))throw new Error("GameRefereeBuilder setValidatorStrategies invalid");return this.validatorsMap=e,this},e.prototype.getValidatorStrategies=function(){return this.validatorsMap},e.prototype.setBuilderStrategies=function(e){if(!(e instanceof i))throw new Error("GameRefereeBuilder setBuilderStrategies invalid");return this.buildersMap=e,this},e.prototype.getBuilderStrategies=function(){return this.buildersMap},e.prototype.build=function(){var e,t,c;return 0===Object.keys(this.validatorsMap).length&&(this.validatorsMap[s[s.SINGLE_ACTION]]=new a),this.buildersMap||(this.buildersMap=new i),t=new r(this.validatorsMap),c=new o(this.buildersMap),e=new n(this.client),new u(t,c,e)},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/client/BaseMessageClient",["require","exports","lib/bluebird","lib/lodash","../Events/Events","../messaging/MessageExchange","../specification/message/MessageType","../error/Errors","../error/BaseError"],function(e,t,n,r,o,i,s,a,u){"use strict";return function(e){function t(t,n,r){var o=e.call(this)||this;return o._isStarted=!1,o._handlers={},o._namespace=t,o._handlers=n,o._transport=r,o}return __extends(t,e),t.prototype.start=function(){var e=this;return n.bind(this).then(function(){return e._setupMessageInfrastructure()}).then(function(){e._isStarted=!0})},t.prototype.ready=function(e){var t=this;return n.bind(this).then(function(){var n={header:{messageType:s.HANDSHAKE,name:"handshake",namespace:t._namespace},data:{args:{namespace:t._namespace}}};return t._sendAndReceive(n,e)}).then(function(e){if(e.UBPHandshakeResponse.namespace!==t._namespace)throw new Error("Did not get correct handshake response")}).catch(function(e){return n.reject(new Error("Could not handshake with process manager: "+e.toString()))})},t.prototype._setupMessageInfrastructure=function(){var e=this;return n.bind(this).then(function(){return this._exchange=new i(1e4),this._transport.forward(this._exchange.egressBus())}).then(function(){return e._exchange.listen(e._transport.dispatchBus())}).then(function(){return r.bindAll(e,"_messageReceiver"),e._exchange.dispatchBus().subscribe(e._messageReceiver)})},t.prototype._send=function(e){return this._exchange.send(e)},t.prototype._sendAndReceive=function(e,r,o,i,s){var a=this;return void 0===r&&(r=t.DEFAULT_MESSAGE_TIMEOUT),void 0===o&&(o=t.DEFAULT_ATTEMPTS),void 0===i&&(i=t.DEFAULT_RETRY_DELAY),void 0===s&&(s=t.DEFAULT_BACKOFF_FACTOR),this._exchange.sendAndReceive(e,r).catch(function(t){if(o>0)return o--,n.delay(i).then(function(){return a._sendAndReceive(e,r,o,i*s)});throw t})},t.prototype._messageReceiver=function(e){var t=this;if(!e||!e.payload)return void console.log("BaseMessageClient received a malformed message");var r=e.payload,o=r.header,i=r.data;if(o)switch(o.messageType){case s.API:o.name&&"function"==typeof this._handlers[o.name]?n.bind(this).then(function(){return t._handlers[o.name](r)}).then(function(t){e.replyCallback(null,t)}).catch(function(t){t instanceof u||(t=a.Internal(t.message||t)),e&&e.replyCallback&&e.replyCallback({name:t.getName(),message:t.getMessage(),status:t.getStatus(),cause:t.getCause()},null)}):e.replyCallback(a.BadRequest());break;case s.EVENT:switch(o.name){case"publish":if(i){var c=i.args,l=c.eventName;this.notify(l,r)}break;default:e.replyCallback(a.BadRequest())}break;case s.HEALTHCHECK:if(i.args.namespace===this._namespace){var p={UBPHealthCheckResponse:{namespace:this._namespace}};e.replyCallback(null,p)}else{var f=new Error("Health Check did not have the expected namespace. My namespace is "+this._namespace);e.replyCallback(f,null)}break;default:e.replyCallback(a.BadRequest())}},t.DEFAULT_MESSAGE_TIMEOUT=1e3,t.DEFAULT_ATTEMPTS=3,t.DEFAULT_RETRY_DELAY=100,t.DEFAULT_BACKOFF_FACTOR=2,t}(o)});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/client/MessageClient",["require","exports","../commons/client/BaseMessageClient","../commons/messaging/PostMessageTransportStrategy"],function(e,t,n,r){"use strict";return function(e){function t(t,n){return e.call(this,t,n,new r({identity:t,inboundPort:window,outboundPort:window.parent,validOrigins:["*"],validSources:["PlatformHub"]}))||this}return __extends(t,e),t}(n)}),define("ubp/client/factory/MessageClientFactory",["require","exports","../MessageClient"],function(e,t,n){"use strict";return function(){function e(){}return e.prototype.fabricate=function(e,t){return new n(e,t)},e}()}),define("ubp/commons/messaging/v2/MessageExchange",["require","exports","lib/lodash","lib/bluebird","../../error/Errors"],function(e,t,n,r,o){"use strict";return function(){function e(){var t=this;this._pendingReplies={},this._transportListener=function(n){if(e.isMessage(n))switch(n.messageType){case e.REQUEST_MESSAGE_TYPE:t._handleRequest(n);break;case e.REPLY_MESSAGE_TYPE:t._handleReply(n)}}}return e.prototype.sendAndReceive=function(t,n){var i,s=this;return new r(function(n){i=e.messageIdCounter++,s._pendingReplies[i]=n,s._transport.send({messageType:e.REQUEST_MESSAGE_TYPE,originalMessageId:i,underlyingMessage:t})}).timeout(n,e.TIMEOUT_ERROR_MESSAGE).catch(function(t){if(t.message===e.TIMEOUT_ERROR_MESSAGE)throw o.RequestTimeout();return r.reject(t)}).finally(function(){delete s._pendingReplies[i]})},e.prototype.attachTransport=function(e){if(this._transport){if(e===this._transport)return;throw new Error('Cannot call "attachTransport" with another transport already attached')}this._transport=e,e.addListener(this._transportListener),e.bind()},e.prototype.detachTransport=function(){this._transport&&(this._transport.removeListener(this._transportListener),this._transport.unbind(),this._transport=void 0)},e.prototype._handleRequest=function(t){var n=this;if(this.messageHandler){var r=this.messageHandler(t.underlyingMessage);r&&r.then(function(r){n._transport.send({messageType:e.REPLY_MESSAGE_TYPE,originalMessageId:t.originalMessageId,underlyingMessage:r})}).catch(function(e){return console.error("messageHandler should never reject",e)})}},e.prototype._handleReply=function(e){var t=this._pendingReplies[e.originalMessageId];t&&t(e.underlyingMessage)},e.isMessage=function(e){return n.isString(e.messageType)&&n.isNumber(e.originalMessageId)&&n.isObject(e.underlyingMessage)},e.REQUEST_MESSAGE_TYPE="SendAndReceive",e.REPLY_MESSAGE_TYPE="SendAndReceiveReply",e.TIMEOUT_ERROR_MESSAGE="PROMISE_DELAY_TIMEOUT_ERROR",e.messageIdCounter=0,e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/messaging/v2/TransportStrategy",["require","exports","lib/lodash","../../Events/Events"],function(e,t,n,r){"use strict";return function(e){function t(r,o,i){void 0===r&&(r="*"),void 0===o&&(o=function(){return window.parent}),void 0===i&&(i=window);var s=e.call(this)||this;return s._targetOrigin=r,s._targetWindow=o,s._window=i,s._messageListener=function(e){s._isSourceValid(e)&&s._isOriginValid(e)&&n.isObject(e.data)&&s.notify(t.INGRESS_EVENT_NAME,e.data)},s}return __extends(t,e),t.prototype.bind=function(){this._window.addEventListener("message",this._messageListener)},t.prototype.unbind=function(){this._window.removeEventListener("message",this._messageListener)},t.prototype.addListener=function(e){this.on(t.INGRESS_EVENT_NAME,e)},t.prototype.removeListener=function(e){this.off(t.INGRESS_EVENT_NAME,e)},t.prototype.send=function(e){this._targetWindow().postMessage(e,this._targetOrigin)},t.prototype._isOriginValid=function(e){return"*"===this._targetOrigin||this._targetOrigin===e.origin},t.prototype._isSourceValid=function(e){return this._targetWindow()===e.source},t.INGRESS_EVENT_NAME="ingress",t}(r)}),define("ubp/commons/lang/RetryAsyncTask",["require","exports","lib/bluebird"],function(e,t,n){"use strict";return function(){function e(e,t,n,r){var o=this;void 0===t&&(t=2),void 0===n&&(n=100),void 0===r&&(r=2),this.task=e,this.retries=t,this.delay=n,this.backoffFactor=r,this.runWithRetries=function(){return o._retryTask(o.task,o.retries,o.delay)}}return e.prototype._retryTask=function(e,t,r){var o=this;return n.bind(this).then(function(){return e()}).catch(function(i){if(t>0)return n.delay(r).then(function(){return o._retryTask(e,t-1,r*o.backoffFactor)});throw i})},e}()});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("ubp/commons/client/v2/UBPProcessMessageClient",["require","exports","lib/lodash","lib/bluebird","../../Events/Events","../../messaging/v2/MessageExchange","../../messaging/v2/TransportStrategy","../../error/Errors","../../specification/message/MessageType","../../error/BaseError","../../lang/RetryAsyncTask"],function(e,t,n,r,o,i,s,a,u,c,l){"use strict";function p(e){return{success:e}}function f(e){return{error:{name:e.getName(),message:e.getMessage(),status:e.getStatus(),cause:e.getCause()}}}return function(e){function t(t,o,a,u,c,l){void 0===t&&(t={}),void 0===o&&(o=function(){return r.resolve()}),void 0===a&&(a=function(){return r.resolve()}),void 0===u&&(u=new i),void 0===c&&(c=new s),void 0===l&&(l=window.parent);var p=e.call(this)||this;return p.apiHandlers=t,p.startHandler=o,p.stopHandler=a,p._exchange=u,p._transport=c,p._targetWindow=l,p.isHealthy=!0,p._wasInitCalled=!1,p._messageHandler=function(e){if(n.isObject(e)&&n.isString(e.action))switch(e.action){case"ProcessStart":return p.startHandler().return({});case"ProcessStop":return p.stopHandler().return({});case"ProcessHeartbeat":return r.resolve({isAlive:p.isHealthy?1:0});case"ProcessApplicationMessage":return p.handleProcessApplicationMessage(e.args.message)}},p}return __extends(t,e),t.prototype.init=function(){if(this._wasInitCalled)throw a.Conflict();this._wasInitCalled=!0,this._exchange.messageHandler=this._messageHandler,this._exchange.attachTransport(this._transport),this._targetWindow.postMessage("ready","*")},t.prototype._sendAndReceive=function(e,t,n,r,o){return this.sendAndReceive(e,t,n,r,o)},t.prototype.sendAndReceive=function(e,t,n,o,i){var s=this;return void 0===t&&(t=1e3),void 0===n&&(n=3),void 0===o&&(o=100),void 0===i&&(i=2),this._wasInitCalled?new l(function(){return s._exchange.sendAndReceive(e,t).then(function(e){var t=e.error,n=e.success;if(t){if(t.status)throw a.Auto(t.name,t.message,t.status,t.cause);throw a.Internal(t.message||t)}return n})},n,o,i).runWithRetries().catch(function(e){return e instanceof c||(e=a.Internal(e.message||e)),r.reject(e)}):r.reject(a.Conflict())},t.prototype.handleProcessApplicationMessage=function(e){switch(e.header.messageType){case u.API:return this.handleUBPAPI(e);case u.EVENT:return this.handleUBPEvent(e)}},t.prototype.handleUBPEvent=function(e){var t=e.header,n=e.data;"publish"===t.name&&n&&this.notify(e.data.args.eventName,e)},t.prototype.handleUBPAPI=function(e){var t=this,o=e.header;return n.isFunction(this.apiHandlers[o.name])?r.bind(this).then(function(){return t.apiHandlers[o.name](e)}).then(function(e){return p(e)}).catch(function(e){return e instanceof c||(e=a.Internal(e.message||e)),f(e)}):r.resolve(f(a.BadRequest()))},t}(o)}),define("ubp/client/factory/UBPClientFactory",["require","exports","./MetricReportFactory","../UBPClient","../v2/UBPClientV2","../Gamification/referee/GameRefereeBuilder","../../commons/logging/Logger","./MessageClientFactory","../../commons/client/v2/UBPProcessMessageClient"],function(e,t,n,r,o,i,s,a,u){"use strict";return function(){function e(t,r){void 0===t&&(t=new a),void 0===r&&(r=new n),this._gamified=!1,this._messageClientFactory=t,this._metricReportFactory=r,e.logger=s.getLogger("UBPClientFactory")}return e.prototype.gamify=function(){this._gamified=!0},e.prototype.isGamified=function(){return this._gamified},e.prototype.fabricate=function(t,n){var o,s,a=new r(t,this._messageClientFactory.fabricate(t,n),this._metricReportFactory);if(this.isGamified())try{o=new i(a),s=o.build(),this._metricReportFactory.gamify(s)}catch(t){e.logger.error("fabricate","creating referee: "+(t.toString&&t.toString()))}return a},e.prototype.fabricate_V2=function(t,n){var r=new u(n),s=new o(t,r,this._metricReportFactory);if(this.isGamified())try{var a=new i(s),c=a.build();this._metricReportFactory.gamify(c)}catch(t){e.logger.error("fabricate","creating referee: "+(t.toString&&t.toString()))}return s},e}()}),define("ubp/extension/panel/PanelBootstrapper",["require","exports","./PanelManager","../../commons/logging/Logger","../../commons/utilities/UUID","../../metrics/sentry/Sentry","../../metrics/sentry/SentryReport","./configuration/LocalSentryConfiguration","configuration/GlobalParameters","../../commons/logging/LoggingManager","configuration/GatewayConfiguration","../../commons/localization/Locale","../../client/factory/UBPClientFactory","../gateway/GatewayLoadEventConstants"],function(e,t,n,r,o,i,s,a,u,c,l,p,f,d){"use strict";return function(){function e(t,o){this._isStarted=!1,this._clientFactory=new f,this._client=this._clientFactory.fabricate("Panel",{}),this._panelManager=new n(t,o,this._client),this._runtime=t,this._networkClient=o,this._loggingConfiguration=l.getGatewayConfiguration().configuration[p[e._DEFAULT_LOCALE]].loggingConfiguration,c.getInstance().init(this._networkClient,this._runtime),this._sentryConfiguration=a.get(p[e._DEFAULT_LOCALE]),i.getInstance().init(this._networkClient,this._runtime),r.root.setUniversalContext({installationId:"eb362584-da2a-4bb9-a52c-79e9f56ed535"}),e.logger=e.logger||r.getLogger("PanelBootstrapper"),e.logger.info("constructor","PanelBootstrapper constructed")}return e.prototype.start=function(){var t=this;if(this._isStarted){var n=new Error("This PanelBootstrapper has already been started and can only be started once.");throw e.logger.error("start",n.toString()),n}this._isStarted=!0;var r=Date.now(),f=new s("Panel","PanelBootstrapper-"+u.getGlobalParameters().extensionStage,o.v4());f.startRealTimeTimer("RequestTimeSuccess"),f.startRealTimeTimer("RequestTimeFailure"),f.incrementRealTimeCounter("RequestCount"),f.incrementRealTimeCounter("RequestCount."+u.getGlobalParameters().browser),this._client.start().then(function(){return t._runtime.getFromExtensionStorage(e._STORAGE_LOCALE_KEY)}).then(function(n){return n&&""!==n&&p[n]||(n=p[e._DEFAULT_LOCALE]),t._loggingConfiguration=l.getGatewayConfiguration().configuration[n].loggingConfiguration,t._sentryConfiguration=a.get(n),Promise.all([c.getInstance().configure(t._loggingConfiguration),i.getInstance().configure(t._sentryConfiguration,p[n])])}).then(function(){return t._panelManager.start()}).then(function(){t._client.Gateway.reportLoadEvent(d.PANEL_BOOTSTRAPPER_SUCCESS,Date.now()),e.logger.info("start","PanelBootstrapper started"),f.stopRealTimeTimer("RequestTimeSuccess"),f.incrementRealTimeCounter("Success"),f.incrementRealTimeCounter("Success."+u.getGlobalParameters().browser),f.publish()}).catch(function(n){throw t._isStarted=!1,t._client.Gateway.reportLoadEvent(d.PANEL_BOOTSTRAPPER_FAILURE,Date.now()),e.logger.error("start","Failed to start PanelBootstrapper "+n),f.stopRealTimeTimer("RequestTimeFailure"),f.incrementRealTimeCounter("Failure"),f.incrementRealTimeCounter("Failure."+u.getGlobalParameters().browser),f.publish(),n}).finally(function(){t._client.Gateway.reportLoadEvent(d.PANEL_BOOTSTRAPPER,r)})},e._STORAGE_LOCALE_KEY="ubpv2.extension.installation.locale",e._DEFAULT_LOCALE=p.US,e}()}),define("ubp/extension/panel/Chromelike_PanelEntrypoint",["require","exports","../runtime/chrome/ChromelikeRuntime","../../commons/messaging/clients/network/XHRNetworkClient","./PanelBootstrapper"],function(e,t,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),new o(new n(chrome),new r(XMLHttpRequest)).start()}),require(["ubp/extension/panel/Chromelike_PanelEntrypoint"]);