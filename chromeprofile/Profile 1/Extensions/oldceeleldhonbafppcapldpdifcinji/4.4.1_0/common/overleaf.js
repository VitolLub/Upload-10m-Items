/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Overleaf{static _checkForAvailableInputAreas(){const t=[];t.push(...OverleafSourceEditor.getInputAreas()),t.push(...OverleafRichEditor.getInputAreas());for(const e of t)this._onInputAreaAvailableCallbacks.forEach((t=>t(e)))}static _getSubstring(t,e=0,r=t.length){let i="";for(let n=e;n<r;n++)i+=t[n];return i}static isEditorPage(){if(!document.querySelector("div.editor[ng-controller='IdeController']"))return!1;const t=document.createElement("script"),e="LanguageTool_OverleafTest";t.innerText=`\n\t\t\t\ttry {\n\t\t\t\t\tdocument.body.dataset.${e} = !!_ide.editorManager;\n\t\t\t\t} catch(e) { }\n\t\t\t`,document.head.appendChild(t),t.remove();const r=document.body.dataset[e];return document.body.dataset[e]="","true"===r}static init(){this._storageController=StorageController.create(),this._checkForAvailableInputAreasInterval=window.setInterval((()=>{this._checkForAvailableInputAreas()}),750),OverleafSourceEditor.init(),OverleafRichEditor.init()}static initPage(t){let e=null;e=window.setTimeout((()=>{if(!this._storageController||!this._storageController.isReady())return;const{hasSeenNewOverleafTeaser:t}=this._storageController.getUIState();t||this._showTeaser()}),800)}static _showTeaser(){const t=Array.from(document.querySelectorAll(`.${this.TOOLBAR_CLASS_NAME}`));if(!t.length)return;const e=t.find((t=>{const e=t.getBoundingClientRect();return e.top>=0&&e.top<window.innerHeight&&e.width>0}));if(!e)return;const r=new Hint("","overleaf",i18nManager.getMessage("overleafNewTeaserHeadline"),i18nManager.getMessage("overleafNewTeaserText"),"top-right",e),i=()=>{r.getElement().remove(),e&&e.classList.remove("lt-toolbar--hint-opened"),this._storageController&&this._storageController.updateUIState({hasSeenNewOverleafTeaser:!0})};r.getClose().addEventListener("click",(t=>{t.stopImmediatePropagation(),t.preventDefault(),i()}),!0),e.classList.add("lt-toolbar--hint-opened"),e.addEventListener("mouseup",(t=>{t.target instanceof HTMLElement&&r.getElement().contains(t.target)||i()}),{capture:!0,once:!0}),this._onInput((()=>i()),!0)}static _onInput(t,e=!1){const r=window;r&&r.document&&r.document.addEventListener("keydown",(e=>{["Control","Shift","Meta","Alt"].includes(e.key)||t()}),{capture:!0,once:e})}static destroy(){OverleafSourceEditor.enableBuiltInValidator(),OverleafRichEditor.enableBuiltInValidator(),null!==this._checkForAvailableInputAreasInterval&&(window.clearInterval(this._checkForAvailableInputAreasInterval),this._checkForAvailableInputAreasInterval=null),this._onInputAreaAvailableCallbacks=[]}static onInputAreaAvailable(t){this._onInputAreaAvailableCallbacks.push((e=>t(e,!1)))}static isEditor(t){return OverleafSourceEditor.isEditor(t)||OverleafRichEditor.isEditor(t)}static disableBuiltInValidator(){OverleafSourceEditor.disableBuiltInValidator(),OverleafRichEditor.disableBuiltInValidator()}static createMutationObserver(t,e){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.createMutationObserver(e):OverleafRichEditor.isEditor(t)?OverleafRichEditor.createMutationObserver(e):new MutationObserver(e)}static isElementIgnored(t,e){return!OverleafSourceEditor.isEditor(t)&&(!!OverleafRichEditor.isEditor(t)&&OverleafRichEditor.isElementIgnored(e))}static getReplacementText(){return""}static replaceText(t,e,r){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.replaceText(e,r):OverleafRichEditor.isEditor(t)?OverleafRichEditor.replaceText(e,r):e}static isBlock(t,e,r){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.isBlock(e,r):!!OverleafRichEditor.isEditor(t)&&OverleafRichEditor.isBlock(e,r)}static isBlockElementRelevant(t,e){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.isBlockElementRelevant(e):!!OverleafRichEditor.isEditor(t)&&OverleafRichEditor.isBlockElementRelevant(e)}static getDocumentId(t){const e=t.match(/\/project\/([a-z0-9]+)/);if(e)return e[1]}static getSelectedText(){return OverleafSourceEditor.getSelectedText()||OverleafRichEditor.getSelectedText()}static getSelection(){return OverleafSourceEditor.getSelection()||OverleafRichEditor.getSelection()}static addScrollEventListener(t,e){OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.addScrollEventListener(t,e):OverleafRichEditor.isEditor(t)&&OverleafRichEditor.addScrollEventListener(t,e)}static removeScrollEventListener(t,e){OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.removeScrollEventListener(t,e):OverleafRichEditor.isEditor(t)&&OverleafRichEditor.removeScrollEventListener(t,e)}static getScrollableElementSize(t,e){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.getScrollableElementSize(t,e):OverleafRichEditor.isEditor(t)?OverleafRichEditor.getScrollableElementSize(t,e):{width:0,height:0}}static getScrollPosition(t,e,r,i){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.getScrollPosition(t,e,r,i):OverleafRichEditor.isEditor(t)?OverleafRichEditor.getScrollPosition(t,e,r,i):{top:0,left:0}}static getScrollingThrottleLimit(t){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.getScrollingThrottleLimit():OverleafRichEditor.isEditor(t)?OverleafRichEditor.getScrollingThrottleLimit():void 0}static getToolbarPosition(t,e,r){return OverleafSourceEditor.isEditor(t)?OverleafSourceEditor.getToolbarPosition(t,e,r):OverleafRichEditor.isEditor(t)?OverleafRichEditor.getToolbarPosition(t,e,r):r}static getMaxTextLength(t,e){return Number.MAX_SAFE_INTEGER}static getReplacedParts(t){const e=[];e.length=t.length,fill(e,!1);const r=[];r.length=t.length;const i=[];i.length=t.length,fill(i,0);const n=new StringMap(t),s=LatexParser.getCommentTokens(t);for(const t of s)fill(e,!0,t.start,t.end),n.fill(" ",t.start,t.end);s.length&&(t=n.toString());const o=matchAll(t,/\n+/g);for(const t of o){const e=t[0].length;e<4?(r[t.index]=" ",n.fill(" ",t.index,t.index+e)):(n.fill("\n",t.index,t.index+2),n.fill(" ",t.index+2,t.index+e))}o.length&&(t=n.toString());const a=matchAll(t,/\t+/g);for(const t of a){const e=t.index,i=e+t[0].length;fill(r," ",e,i),n.fill(" ",e,i)}a.length&&(t=n.toString());const l=LatexParser.getSymbolTokens(t);for(const t of l)if(fill(e,!0,t.start,t.end),this.REPLACABLE_SYMBOLS.has(t.symbolName)){const i=this.REPLACABLE_SYMBOLS.get(t.symbolName);fill(e,!1,t.start,t.start+i.length);for(let e=0;e<i.length;e++)r[t.start+e]=i[e];n.set(i,t.start),n.fill(" ",t.start+i.length,t.end)}l.length&&(t=n.toString());const c=LatexParser.getCommandTokens(t),d=LatexParser.getSwitchTokens(t,c);for(const t of d)fill(e,!0,t.start,t.textStart),e[t.textEnd]=!0,n.fill(" ",t.start,t.textStart),n.fill(" ",t.textEnd,t.end);d.length&&(t=n.toString());const u=LatexParser.getMathTokens(t,c);for(const t of u)fill(e,!0,t.start,t.end),n.fill(" ",t.start,t.end);u.length&&(t=n.toString());const E=LatexParser.getCommandTokens(t).reverse();for(const t of E){let s=0===t.arguments.length&&0===t.optionalArguments.length;if(this.COMMANDS_WITH_VALUABLE_ARGUMENT.has(t.commandName)){const r=this.COMMANDS_WITH_VALUABLE_ARGUMENT.get(t.commandName);let i=t.arguments.length>0?t.arguments[0].start:t.end;fill(e,!0,t.start,i),n.fill(" ",t.start,i);for(let s=0;s<t.arguments.length;s++){const o=t.arguments[s];fill(e,!0,i,o.start),n.fill(" ",i,o.start),r[s]||(fill(e,!0,o.start,o.end),n.fill(" ",o.start,o.end)),i=o.end}fill(e,!0,i,t.end),n.fill(" ",i,t.end)}else if(this.REPLACABLE_COMMANDS.has(t.commandName)){let o="",a=0;const l=this.REPLACABLE_COMMANDS.get(t.commandName);"string"==typeof l?o=l:({replacingText:o,offsetShift:a}=l(t,n));const c=t.start+o.length;if(0===a)fill(e,!1,t.start,c);else{const r=t.start+a,i=r+o.length,n=e.slice(r,i);fill(e,!1,t.start,r);for(let r=0;r<n.length;r++)e[t.start+r]=n[r]}fill(e,!0,c,t.end);for(let e=0;e<o.length;e++)r[t.start+e]=o[e];fill(i,a,t.start,c),s=!1,n.set(o,t.start),n.fill(" ",c,t.end)}else fill(e,!0,t.start,t.end),n.fill(" ",t.start,t.end);if(s)for(let r=t.end;r<n.length&&" "===n.charAt(r);r++)e[r]=!0}E.length&&(t=n.toString());const h=matchAll(t,/ +/g);for(const i of h){const n=i.index,s=i.index+i[0].length,o=0===n||"\n"===t[n-1]||s===t.length||"\n"===t[s],a=e.indexOf(!1,n);o||-1===a?(fill(e,!0,n,s),fill(r,void 0,n,s)):(fill(e,!0,n,a),fill(e,!0,a+1,s),fill(r,void 0,n,a),fill(r,void 0,a+1,s))}const g=[];let f=0;for(;f<e.length;)if(e[f]){let t=f;for(;t<n.length&&e[t];)t++;g.push({offset:f,length:t-f}),f=t}else f++;for(f=0;f<r.length;)if(void 0!==r[f]){const t=i[f];let e=f;for(;e<r.length&&i[e]===t&&void 0!==r[e];)e++;const n=Overleaf._getSubstring(r,f,e);g.push({offset:f,length:e-f,replacingText:n,offsetShift:t}),f=e}else f++;return g}static shouldUsePartialValidationCaching(t){return OverleafSourceEditor.isEditor(t.inputArea)?OverleafSourceEditor.shouldUsePartialValidationCaching(t):!OverleafRichEditor.isEditor(t.inputArea)||OverleafRichEditor.shouldUsePartialValidationCaching(t)}static getValidationOptions(t,e){return OverleafSourceEditor.isEditor(t.inputArea)?OverleafSourceEditor.getValidationOptions(t,e):OverleafRichEditor.isEditor(t.inputArea)?OverleafRichEditor.getValidationOptions(t,e):{throttlingLimit:config.VALIDATION_THROTTLING_LIMIT,useFullValidation:!0}}static filterErrors(t,e){const r=[];for(const i of e){if(this.DISABLED_RULES.some((t=>i.rule.id.endsWith(t))))continue;!!binarySearch(t.ignoredParts,(t=>compareSegments(i,t)))||r.push(i)}return r}static applyFix(t){return OverleafSourceEditor.isEditor(t.editor.inputArea)?OverleafSourceEditor.applyFix(t):OverleafRichEditor.isEditor(t.editor.inputArea)?OverleafRichEditor.applyFix(t):Promise.reject()}}Overleaf.TOOLBAR_CLASS_NAME="lt-overleaf-toolbar",Overleaf.REPLACABLE_SYMBOLS=new Map([["~"," "],["&","\t"]]),Overleaf.COMMANDS_WITH_VALUABLE_ARGUMENT=new Map([["\\author",[!0]],["\\thanks",[!0]],["\\textrm",[!0]],["\\textsf",[!0]],["\\textmd",[!0]],["\\textbf",[!0]],["\\textup",[!0]],["\\textit",[!0]],["\\textsl",[!0]],["\\textsc",[!0]],["\\emph",[!0]],["\\textnormal",[!0]],["\\underline",[!0]],["\\hyperref",[!1,!0]],["\\href",[!1,!0]],["\\hypertarget",[!1,!0]],["\\hyperlink",[!1,!0]],["\\textcolor",[!1,!0]],["\\caption",[!0]],["\\item",[!0]],["\\lettercontent",[!0]],["\\frame",[!0]],["\\AtBeginSection",[!0]],["\\AtBeginSubsection",[!0]],["\\alert",[!0]]]),Overleaf.REPLACABLE_COMMANDS=new Map([["\\&","&"],["\\$","$"],["\\%","%"],["\\_","_"],["\\^","^"],["\\~","~"],["\\#","#"],["\\{","{"],["\\}","}"],["\\S","§"],["\\ "," "],["\\ref","1"],["\\pageref","1"],["\\vref","1"],["\\autoref","(1)"],["\\nameref","(1)"],["\\eqref","(1)"],["\\textbar","|"],["\\textbackslash","\\"],["\\dots","…"],["\\ldots","…"],["\\textbullet","•"],["\\TeX","TeX"],["\\LaTeX","LaTeX"],["\\dotfill"," "],["\\hspace"," "],["\\rule"," "],["\\\\","\n\n"],["\\newline","\n\n"],["\\break","\n\n"],["\\linebreak","\n\n"],["\\pagebreak","\n\n"],["\\cite","[1]"],["\\textasciicircum","^"],["\\textless","<"],["\\textasciitilde","~"],["\\textordfeminine","ª"],["\\textasteriskcentered","∗"],["\\textordmasculine","º"],["\\textparagraph","¶"],["\\textperiodcentered","·"],["\\textbraceleft","{"],["\\textquestiondown","¿"],["\\textbraceright","}"],["\\textquotedblleft","“"],["\\textquotedblright","”"],["\\textcopyright","©"],["\\textquoteleft","‘"],["\\textdagger","†"],["\\textquoteright","’"],["\\textdaggerdbl","‡"],["\\textregistered","®"],["\\textsection","§"],["\\textellipsis","…"],["\\textsterling","£"],["\\textemdash","—"],["\\texttrademark","™"],["\\textendash","–"],["\\textunderscore","_"],["\\textexclamdown","¡"],["\\textvisiblespace","␣"],["\\textgreater",">"],["\\ddag","‡"],["\\P","¶"],["\\copyright","©"],["\\dag","†"],["\\pounds","£"],["\\aa","å"],["\\DH","Ð"],["\\L","Ł"],["\\o","ø"],["\\ss","ß"],["\\AA","Å"],["\\dh","ð"],["\\l","ł"],["\\O","Ø"],["\\SS","SS"],["\\AE","Æ"],["\\DJ","Đ"],["\\NG","Ŋ"],["\\OE","Œ"],["\\TH","Þ"],["\\ae","æ"],["\\dj","đ"],["\\ng","ŋ"],["\\oe","œ"],["\\th","þ"],["\\guillemotleft","«"],["\\guilsinglleft","‹"],["\\quotedblbase","„"],["\\guillemotright","»"],["\\guilsinglright","›"],["\\quotesinglbase","‚"],["\\textasciicaron","ˇ"],["\\textasciimacron","¯"],["\\textasciiacute","´"],["\\textasciidieresis","¨"],["\\textasciibreve","˘"],["\\textasciigrave","`"],["\\textbaht","฿"],["\\textdollar","$"],["\\textguarani","₲"],["\\textwon","₩"],["\\textcent","¢"],["\\textdollaroldstyle","“"],["\\textlira","₤"],["\\textyen","¥"],["\\textcentoldstyle","“"],["\\textdong","₫"],["\\textnaira","₦"],["\\textcolonmonetary","₡"],["\\texteuro","€"],["\\textpeso","₱"],["\\textcurrency","¤"],["\\textflorin","ƒ"],["\\textcircledP","℗"],["\\textservicemark","℠"],["\\textcopyleft","“"],["\\textbardbl","‖"],["\\textbigcircle","◯"],["\\textblank","“"],["\\textbrokenbar","¦"],["\\textpertenthousand","‱"],["\\textperthousand","‰"],["\\textpilcrow","¶"],["\\textquotesingle","'"],["\\textdblhyphen","="],["\\textquotestraightbase","“"],["\\textdblhyphenchar","="],["\\textquotestraightdblbase","“"],["\\textdiscount","⁒"],["\\textrecipe","℞"],["\\textestimated","℮"],["\\textreferencemark","※"],["\\textinterrobang","‽"],["\\textinterrobangdown","“"],["\\textthreequartersemdash","“"],["\\textmusicalnote","♪"],["\\texttildelow","˷"],["\\textnumero","№"],["\\texttwelveudash","“"],["\\textopenbullet","○"],["\\|","“"],["\\G","“"],["\\t","“"],["\\h","“"],["\\U","“"],["\\newtie","“"],["\\mathdollar","$"],["\\mathparagraph","¶"],["\\mathsterling","£"],["\\mathellipsis","…"],["\\mathsection","§"],["\\mathunderscore","_"],["\\amalg","⨿"],["\\cup","∪"],["\\oplus","⊕"],["\\times","×"],["\\ast","∗"],["\\dagger","†"],["\\oslash","⊘"],["\\triangleleft","◁"],["\\bigcirc","◯"],["\\ddagger","‡"],["\\otimes","⊗"],["\\triangleright","▷"],["\\bigtriangledown","▽"],["\\diamond","⋄"],["\\pm","±"],["\\unlhd","⊴"],["\\bigtriangleup","△"],["\\div","÷"],["\\rhd","▷"],["\\unrhd","⊵"],["\\bullet","•"],["\\lhd","◁"],["\\setminus","∖"],["\\uplus","⊎"],["\\cap","∩"],["\\mp","∓"],["\\sqcap","⊓"],["\\vee","∨"],["\\cdot","·"],["\\odot","⊙"],["\\sqcup","⊔"],["\\wedge","∧"],["\\circ","∘"],["\\ominus","⊖"],["\\star","⋆"],["\\wr","≀"],["\\bigcap","∩"],["\\bigotimes","⊗"],["\\bigwedge","∧"],["\\prod","∏"],["\\bigcup","∪"],["\\bigsqcup","⊔"],["\\coprod","∐"],["\\sum","∑"],["\\bigodot","⊙"],["\\biguplus","⊎"],["\\bigoplus","⊕"],["\\bigvee","∨"],["\\approx","≈"],["\\equiv","≡"],["\\perp","⊥"],["\\smile","‿"],["\\asymp","≍"],["\\frown","⁀"],["\\prec","≺"],["\\succ","≻"],["\\bowtie","⋈"],["\\Join","⑅"],["\\preceq","≼"],["\\succeq","≽"],["\\cong","≅"],["\\mid","∣"],["\\propto","∝"],["\\vdash","⊢"],["\\dashv","⊣"],["\\models","⊨"],["\\sim","∼"],["\\doteq","≐"],["\\parallel","∥"],["\\simeq","≃"],["\\sqsubset","⊏"],["\\sqsupseteq","⊒"],["\\supset","⊃"],["\\sqsubseteq","⊑"],["\\subset","⊂"],["\\supseteq","⊇"],["\\sqsupset","⊐"],["\\subseteq","⊆"],["\\geq","≥"],["\\gg","≫"],["\\leq","≤"],["\\ll","≪"],["\\neq","≠"],["\\Downarrow","⇓"],["\\longleftarrow","←—"],["\\nwarrow","↖"],["\\downarrow","↓"],["\\Longleftarrow","⇐="],["\\Rightarrow","⇒"],["\\hookleftarrow","↩"],["\\longleftrightarrow","←→"],["\\rightarrow","→"],["\\hookrightarrow","↪"],["\\Longleftrightarrow","⇐⇒"],["\\searrow","↘"],["\\leadsto","↝"],["\\longmapsto","⊢→"],["\\swarrow","↙"],["\\leftarrow","←"],["\\Longrightarrow","=⇒"],["\\uparrow","↑"],["\\Leftarrow","⇐"],["\\longrightarrow","—→"],["\\Uparrow","⇑"],["\\Leftrightarrow","⇔"],["\\mapsto","↦"],["\\updownarrow","↕"],["\\leftrightarrow","↔"],["\\nearrow","↗"],["\\Updownarrow","⇕"],["\\leftharpoondown","↽"],["\\rightharpoondown","⇁"],["\\rightleftharpoons","⇌"],["\\leftharpoonup","↼"],["\\rightharpoonup","⇀"],["\\relbar","⎯"],["\\Relbar","="],["\\textdownarrow","↓"],["\\textrightarrow","→"],["\\textleftarrow","←"],["\\textuparrow","↑"],["\\ddot","“"],["\\vec","“"],["\\alpha","α"],["\\theta","θ"],["\\tau","τ"],["\\beta","β"],["\\vartheta","ϑ"],["\\pi","π"],["\\upsilon","υ"],["\\gamma","γ"],["\\iota","ι"],["\\varpi","ϖ"],["\\phi","φ"],["\\delta","δ"],["\\kappa","κ"],["\\rho","ρ"],["\\varphi","ϕ"],["\\epsilon","є"],["\\lambda","λ"],["\\varrho","ϱ"],["\\chi","χ"],["\\varepsilon","ε"],["\\mu","µ"],["\\sigma","σ"],["\\psi","ψ"],["\\zeta","ζ"],["\\nu","ν"],["\\varsigma","ς"],["\\omega","ω"],["\\eta","η"],["\\xi","ξ"],["\\Gamma","Γ"],["\\Lambda","Λ"],["\\Sigma","Σ"],["\\Psi","Ψ"],["\\Delta","Δ"],["\\Xi","Ξ"],["\\Upsilon","Υ"],["\\Omega","Ω"],["\\Theta","Θ"],["\\Pi","Π"],["\\Phi","Φ"],["\\bot","⊥"],["\\forall","∀"],["\\ni","∋"],["\\top","⊤"],["\\ell","ℓ"],["\\hbar","ℏ"],["\\in","∈"],["\\partial","∂"],["\\wp","℘"],["\\exists","∃"],["\\Im","ℑ"],["\\Re","ℜ"],["\\textlangle","〈"],["\\textrangle","〉"],["\\textlbrackdbl","⟦"],["\\textrbrackdbl","⟧"],["\\textlquill","“"],["\\textrquill","“"],["\\widetilde","“"],["\\widehat","“"],["\\cdotp","·"],["\\colon","∶"],["\\ldotp","."],["\\vdots","⋮"],["\\cdots","⋯"],["\\ddots","⋱"],["\\textdegree","°"],["\\textonehalf","½"],["\\textthreequarters","¾"],["\\textdiv","÷"],["\\textonequarter","¼"],["\\textthreesuperior","³"],["\\textfractionsolidus","⁄"],["\\textonesuperior","¹"],["\\texttimes","×"],["\\textlnot","¬"],["\\textpm","±"],["\\texttwosuperior","²"],["\\textminus","-"],["\\textsurd","√"],["\\textcelsius","℃"],["\\textmho","℧"],["\\textmu","µ"],["\\textohm","Ω"],["\\textborn","⋆"],["\\textdivorced","⚮"],["\\textmarried","⚭"],["\\textdied","⚰"],["\\textleaf","“"],["\\aleph","ℵ"],["\\Diamond","◇"],["\\infty","∞"],["\\prime","′"],["\\angle","∠"],["\\diamondsuit","♦"],["\\mho","℧"],["\\sharp","♯"],["\\backslash","\\"],["\\emptyset","∅"],["\\nabla","∇"],["\\spadesuit","♠"],["\\Box","□"],["\\flat","♭"],["\\natural","♮"],["\\surd","√"],["\\clubsuit","♣"],["\\heartsuit","♥"],["\\neg","¬"],["\\triangle","△"],["\\checkmark","✓"],["\\circledR","®"],["\\maltese","✠"],["\\barwedge","⊼"],["\\circledcirc","⊚"],["\\intercal","⊺"],["\\boxdot","⊡"],["\\circleddash","⊝"],["\\leftthreetimes","⋋"],["\\boxminus","⊟"],["\\Cup","⋓"],["\\ltimes","⋉"],["\\boxplus","⊞"],["\\curlyvee","⋎"],["\\rightthreetimes","⋌"],["\\boxtimes","⊠"],["\\curlywedge","⋏"],["\\rtimes","⋊"],["\\Cap","⋒"],["\\divideontimes","⋇"],["\\smallsetminus","﹨"],["\\centerdot","·"],["\\dotplus","∔"],["\\veebar","⊻"],["\\circledast","⊛"],["\\doublebarwedge","⌆"],["\\approxeq","≊"],["\\eqcirc","≖"],["\\succapprox","≿"],["\\backepsilon","∍"],["\\fallingdotseq","≒"],["\\succcurlyeq","≽"],["\\backsim","∽"],["\\multimap","⊸"],["\\succsim","≿"],["\\backsimeq","⋍"],["\\pitchfork","⋔"],["\\therefore","∴"],["\\because","∵"],["\\precapprox","≾"],["\\thickapprox","“"],["\\between","≬"],["\\preccurlyeq","≼"],["\\thicksim","“"],["\\Bumpeq","≎"],["\\precsim","≾"],["\\varpropto","∝"],["\\bumpeq","≏"],["\\risingdotseq","≓"],["\\Vdash","⊩"],["\\circeq","≗"],["\\shortmid","“"],["\\vDash","⊨"],["\\curlyeqprec","⋞"],["\\shortparallel","“"],["\\Vvdash","⊪"],["\\curlyeqsucc","⋟"],["\\smallfrown","“"],["\\doteqdot","≑"],["\\smallsmile","“"],["\\ncong","≇"],["\\nshortparallel","“"],["\\nVDash","⊯"],["\\nmid","∤"],["\\nsim","≁"],["\\precnapprox","⋨"],["\\nparallel","∦"],["\\nsucc","⊁"],["\\precnsim","⋨"],["\\nprec","⊀"],["\\nsucceq","⋡"],["\\succnapprox","⋩"],["\\npreceq","⋠"],["\\nvDash","⊭"],["\\succnsim","⋩"],["\\nshortmid","“"],["\\nvdash","⊬"],["\\nsubseteq","⊈"],["\\subseteqq","⫅"],["\\supsetneqq","⫌"],["\\nsupseteq","⊉"],["\\subsetneq","⊊"],["\\varsubsetneq","“"],["\\nsupseteqq","“"],["\\subsetneqq","⫋"],["\\varsubsetneqq","“"],["\\Supset","⋑"],["\\varsupsetneq","“"],["\\supseteqq","⫆"],["\\varsupsetneqq","“"],["\\Subset","⋐"],["\\supsetneq","⊋"],["\\eqslantgtr","⋝"],["\\gtrdot","⋗"],["\\lesseqgtr","⋚"],["\\ngeq","≱"],["\\eqslantless","⋜"],["\\gtreqless","⋛"],["\\lesseqqgtr","⪋"],["\\ngeqq","“"],["\\geqq","≧"],["\\gtreqqless","⪌"],["\\lessgtr","≶"],["\\ngeqslant","“"],["\\geqslant","⩾"],["\\gtrless","≷"],["\\lesssim","≲"],["\\ngtr","≯"],["\\ggg","⋙"],["\\gtrsim","≳"],["\\lll","⋘"],["\\nleq","≰"],["\\gnapprox","⪊"],["\\gvertneqq","“"],["\\lnapprox","⪇"],["\\nleqq","“"],["\\gneq","⪈"],["\\leqq","≦"],["\\lneq","⪇"],["\\nleqslant","“"],["\\gneqq","≩"],["\\leqslant","⩽"],["\\lneqq","≨"],["\\nless","≮"],["\\gnsim","⋧"],["\\lessapprox","≲"],["\\lnsim","⋦"],["\\gtrapprox","≳"],["\\lessdot","⋖"],["\\lvertneqq","“"],["\\blacktriangleleft","◂"],["\\ntrianglelefteq","⋬"],["\\trianglelefteq","⊴"],["\\vartriangleleft","⊲"],["\\blacktriangleright","▸"],["\\ntriangleright","⋫"],["\\triangleq","≜"],["\\vartriangleright","⊳"],["\\ntriangleleft","⋪"],["\\ntrianglerighteq","⋭"],["\\trianglerighteq","⊵"],["\\circlearrowleft","↺"],["\\leftleftarrows","⇇"],["\\rightleftarrows","⇄"],["\\circlearrowright","↻"],["\\leftrightarrows","⇆"],["\\rightrightarrows","⇉"],["\\curvearrowleft","↶"],["\\leftrightsquigarrow","↭"],["\\rightsquigarrow","⇝"],["\\curvearrowright","↷"],["\\Lleftarrow","⇚"],["\\Rsh","↱"],["\\dashleftarrow","⇠"],["\\looparrowleft","↫"],["\\twoheadleftarrow","↞"],["\\dashrightarrow","⇢"],["\\looparrowright","↬"],["\\twoheadrightarrow","↠"],["\\downdownarrows","⇊"],["\\Lsh","↰"],["\\upuparrows","⇈"],["\\leftarrowtail","↢"],["\\rightarrowtail","↣"],["\\nLeftarrow","⇍"],["\\nLeftrightarrow","⇎"],["\\nRightarrow","⇏"],["\\nleftarrow","↚"],["\\nleftrightarrow","↮"],["\\nrightarrow","↛"],["\\downharpoonleft","⇃"],["\\leftrightharpoons","⇋"],["\\upharpoonleft","↿"],["\\downharpoonright","⇂"],["\\upharpoonright","↾"],["\\injlim","inj lim"],["\\varinjlim","“"],["\\projlim","proj lim"],["\\varprojlim","“"],["\\digamma","Ϝ"],["\\varkappa","ϰ"],["\\beth","ℶ"],["\\gimel","ℷ"],["\\daleth","ℸ"],["\\Bbbk","ƙ"],["\\complement","∁"],["\\Finv","Ⅎ"],["\\hslash","ℏ"],["\\circledS","Ⓢ"],["\\Game","อ"],["\\nexists","∄"],["\\ulcorner","⌜"],["\\urcorner","⌝"],["\\llcorner","⌞"],["\\lrcorner","⌟"],["\\dddot","“"],["\\dotsb","⋯"],["\\dotsi","⋯"],["\\dotso","…"],["\\dotsc","…"],["\\dotsm","⋯"],["\\blacktriangledown","▾"],["\\backprime","‵"],["\\diagdown","/"],["\\sphericalangle","∢"],["\\bigstar","★"],["\\square","▫"],["\\blacklozenge","✦"],["\\eth","ð"],["\\triangledown","▿"],["\\blacksquare","▪"],["\\lozenge","◊"],["\\varnothing","∅"],["\\blacktriangle","▴"],["\\measuredangle","∡"],["\\vartriangle","▵"],["\\title",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};let r,i;if(1===t.optionalArguments.length){const n=t.arguments[0].start<t.optionalArguments[0].start?t.arguments[0]:t.optionalArguments[0],s=t.arguments[0].start<t.optionalArguments[0].start?t.optionalArguments[0]:t.arguments[0];r=e.substring(n.start,n.end)+"\n\n"+"⁣".repeat(s.start-n.end-2)+e.substring(s.start,s.end)+"\n\n",i=n.start-t.start}else r=e.substring(t.arguments[0].start,t.arguments[0].end)+"\n\n",i=t.arguments[0].start-t.start;return{replacingText:r,offsetShift:i}}],["\\subtitle",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\chapter",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\chapter*",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\section",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\section*",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\subsection",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\subsection*",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\subsubsection",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\subsubsection*",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\paragraph",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\footnote",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0],n=0!==t.start&&isLetter(e.charAt(t.start-1)),s=t.end+1<e.length&&isLetter(e.charAt(t.end)),o="".concat(n?" ":"","[",e.substring(r,i),"]",s?" ":"");let a=r-t.start-1;return n&&a--,{replacingText:o,offsetShift:a}}],["\\footnotetext",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0],n=0!==t.start&&isLetter(e.charAt(t.start-1)),s=t.end+1<e.length&&isLetter(e.charAt(t.end)),o="".concat(n?" ":"","[",e.substring(r,i),"]",s?" ":"");let a=r-t.start-1;return n&&a--,{replacingText:o,offsetShift:a}}],["\\rhead",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\lhead",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}],["\\rfoot",(t,e)=>{if(1!==t.arguments.length)return{replacingText:"",offsetShift:0};const{start:r,end:i}=t.arguments[0];return{replacingText:e.substring(r,i)+"\n\n",offsetShift:r-t.start}}]]),Overleaf.DISABLED_RULES=["UNPAIRED_BRACKETS"],Overleaf._storageController=null,Overleaf._checkForAvailableInputAreasInterval=null,Overleaf._onInputAreaAvailableCallbacks=[],Overleaf.EDITOR_PAGE_URL_REGEXP=/\/project\/[a-z0-9]+(\/|\?|$)/i;class OverleafSourceEditor{static _isMutationIgnored(t){const e=t.target;return!!isElementNode(e)&&(!this._isTextLayer(e)||(!(!e.matches("div.ace_editor.ace-editor-body")||"attributes"!==t.type||"class"!==t.attributeName)||!(!e.matches("div.ace_editor.ace-editor-body")||"attributes"!==t.type||"draggable"!==t.attributeName)))}static _isTextLayer(t){return contains(t,this.TEXT_LAYER_SELECTOR)||!!closestElement(t,this.TEXT_LAYER_SELECTOR)}static _isMouseOnError(t){return Array.from(document.querySelectorAll(this.HIGHLIGHTED_ERRORS_SELECTOR)).some((e=>isPointInsideRect(e.getBoundingClientRect(),t.pageX,t.pageY)))}static _onEditorMouseDown(t){2===t.button&&this._isMouseOnError(t)&&t.stopPropagation()}static _onEditorContextMenu(t){this._isMouseOnError(t)&&t.stopPropagation()}static init(){this._isMutationIgnored=this._isMutationIgnored.bind(this),this._onEditorMouseDown=this._onEditorMouseDown.bind(this),this._onEditorContextMenu=this._onEditorContextMenu.bind(this),this._domMeasurement=new DomMeasurement,this._mutationObserversHub=new MutationObserversHub(this.THROTTLED_MUTATION_OBSERVER_DELAY,(t=>new FilteringMutationObserver(t,this._isMutationIgnored)))}static getInputAreas(){return Array.from(document.querySelectorAll(this.EDITOR_SELECTOR))}static isEditor(t){return t.matches(this.EDITOR_SELECTOR)}static disableBuiltInValidator(){if(null===this._styleTag){this._styleTag=createStylesheet(`${this.HIGHLIGHTED_ERRORS_SELECTOR} {\n\t\t\t\t\tbackground-image: none !important;\n\t\t\t\t}`);const t=document.querySelector(this.EDITOR_SELECTOR);t&&(t.addEventListener("mousedown",this._onEditorMouseDown,!0),t.addEventListener("contextmenu",this._onEditorContextMenu,!0))}}static enableBuiltInValidator(){null!==this._styleTag&&(this._styleTag.remove(),this._styleTag=null);const t=document.querySelector(this.EDITOR_SELECTOR);t&&(t.removeEventListener("mousedown",this._onEditorMouseDown,!0),t.removeEventListener("contextmenu",this._onEditorContextMenu,!0))}static createMutationObserver(t){return this._mutationObserversHub.createMutationObserver(t)}static isBlock(t,e){return!t.classList.contains("ace_line")&&CEElementInspector.DISPLAY_BLOCK_VALUES.includes(e.display||"")}static isBlockElementRelevant(t){return t.classList.contains("ace_line_group")&&1===t.childNodes.length&&1===t.children.length&&t.firstElementChild.classList.contains("ace_line")&&0===t.firstElementChild.childNodes.length}static replaceText(t,e){const r=e.parentElement;return r?this.ONLY_NBSP_REGEXP.test(t)&&r.firstChild===e&&r.matches(this.TEXT_LINE_PART_SELECTOR)?"":this.ONLY_POINTS_REGEXP.test(t)&&1===r.childNodes.length&&r.firstChild===e&&r.matches(this.INVALID_CHAR_SELECTOR)?" ".repeat(t.length):t:t}static getEditorText(t,e){let r=e.map((t=>t.parsedText)).join("");if(!r)return{textChunks:e,fullText:r,offset:0};if(!t.ownerDocument||!t.ownerDocument.head)return{textChunks:e,fullText:r,offset:0};const i=t.ownerDocument,n=i.createElement("script"),s="LanguageTool_SourceEditorContent";n.innerText=`\n\t\t\t\ttry {\n\t\t\t\t\tdocument.body.dataset.${s} = _ide.editorManager.getCurrentDocValue() || "";\n\t\t\t\t} catch(e) { }\n\t\t\t`,i.head.appendChild(n),n.remove();let o=i.body.dataset[s]||"";if(i.body.dataset[s]="",!o)return{textChunks:e,fullText:r,offset:0};const a=o.split("\n"),l=Array.from(document.querySelectorAll(this.LINE_NUMBER_SELECTOR));if(0===l.length||!l[0].textContent)return{textChunks:e,fullText:r,offset:0};const c=parseInt(l[0].textContent.trim()),d=c+document.querySelectorAll(this.TEXT_LINE_SELECTOR).length-1;let u=a.slice(0,c-1).join("\n\n");u&&(u+="\n\n");let E=a.slice(d).join("\n\n");E&&(E="\n\n"+E);const h=a.slice(c-1,d).join("\n\n"),g=e.map((t=>Object.assign({},t)));let f=0,m=0;t:for(const t of g){let e=0;for(let r=0;r<t.parsedText.length;r++){const i=t.parsedText[r],n=h[f+e];if(i===n)e++;else if(" "===i)e++;else if(" "===i){if("\t"===n){for(let e=0;e<3&&" "===t.parsedText[r+1];e++)r++;e++}}else if("\n"!==i)break t}t.parsedText=h.substr(f,e),t.parsedTextOffset=m,f+=e,m+=t.parsedText.length}return r=g.map((t=>t.parsedText)).join(""),{textChunks:g,fullText:u+r+E,offset:u.length}}static getSelectedText(){if(!document.activeElement||"TEXTAREA"!==document.activeElement.tagName.toUpperCase())return"";const t=this.getSelection();if(!t)return"";const e=new Range;return e.setStart(t.startNode,t.startOffset),e.setEnd(t.endNode,t.endOffset),e.toString()}static getSelection(){const t=Array.from(document.body.querySelectorAll(this.SELECTION_BLOCK_SELECTOR));if(!t.length)return null;const e=document.querySelector(this.TEXT_LAYER_SELECTOR);if(!e)return null;const r=t[0].getBoundingClientRect(),i=1===t.length?r:t[t.length-1].getBoundingClientRect();this._domMeasurement.setStyles(e,{"pointer-events":"auto"},!0);const n=getRangeAtPoint({x:r.left+1,y:Math.round(r.bottom-.5*r.height)}),s=getRangeAtPoint({x:i.right-.5,y:Math.round(i.bottom-.5*i.height)});return this._domMeasurement.removeStyle(e,"pointer-events"),n&&s?{startNode:n.startContainer,startOffset:n.startOffset,endNode:s.endContainer,endOffset:s.endOffset,isCollapsed:!1}:null}static addScrollEventListener(t,e){t.addEventListener("scroll",e);const r=t.querySelector(this.VERTICAL_SCROLL_SELECTOR);r&&r.addEventListener("scroll",e)}static removeScrollEventListener(t,e){t.removeEventListener("scroll",e);const r=t.querySelector(this.VERTICAL_SCROLL_SELECTOR);r&&r.removeEventListener("scroll",e)}static getScrollableElementSize(t,e){const r=t.querySelector(this.VERTICAL_SCROLL_SELECTOR);if(!r||"none"===e.getStyle(r,"display"))return e.getScrollDimensions(t,!1);const{height:i}=e.getScrollDimensions(r,!1),{width:n}=e.getScrollDimensions(t,!1);return{height:i,width:n}}static getScrollPosition(t,e,r,i){const n=t.querySelector(this.VERTICAL_SCROLL_SELECTOR);if(!n)return e.getScrollPosition(t,r,i);const{top:s}=e.getScrollPosition(n,r,i),{left:o}=e.getScrollPosition(t,r,i);return{top:s,left:o}}static getScrollingThrottleLimit(){return 100}static getToolbarPosition(t,e,r){if(!r||void 0===r.left)return r;const i=t.querySelector(this.VERTICAL_SCROLL_SELECTOR);if(!i)return r;if("none"!==this._domMeasurement.getStyle(i,"display")){const t=Number.parseInt(r.left),n=Number.parseInt(this._domMeasurement.getStyle(i,"width"));r.left=(e?t+n:t-n)+"px"}return r}static shouldUsePartialValidationCaching(t){return""!==t.validatedText.text}static getValidationOptions(t,e){return{throttlingLimit:config.VALIDATION_THROTTLING_LIMIT,useFullValidation:!1,textTooLongMessage:i18nManager.getMessage("paragraphTooLong")}}static applyFix(t){const{offset:e,length:r,replacementText:i,editor:n}=t,s=n.inputArea.querySelector(this.EVENT_TARGET_SELECTOR);if(!s)return Promise.resolve();const o=n.inputArea.querySelector(this.PASTE_TEXTAREA_SELECTOR);if(!o)return Promise.resolve();const a=n.inputAreaWrapper.getTextRanges(e,r);return Promise.resolve().then((()=>{this._domMeasurement.clearCache();const t=this._domMeasurement.getTextBoundingBoxes(a,n.inputArea,!1)[0],e={clientX:Math.ceil(t.left),clientY:t.top+t.height/2,bubbles:!0,shiftKey:!1};return s.dispatchEvent(new MouseEvent("mousedown",e)),s.dispatchEvent(new MouseEvent("mouseup",e)),wait(10)})).then((()=>{this._domMeasurement.clearCache();const t=this._domMeasurement.getTextBoundingBoxes(a,n.inputArea,!1),e=t[0],r=t[t.length-1],i={clientX:Math.ceil(e.left),clientY:e.top+e.height/2,bubbles:!0,shiftKey:!1},o={clientX:Math.floor(r.right),clientY:r.top+r.height/2,bubbles:!0,shiftKey:!1};return s.dispatchEvent(new MouseEvent("mousedown",i)),s.dispatchEvent(new MouseEvent("mousemove",o)),s.dispatchEvent(new MouseEvent("mouseup",o)),wait(10)})).then((()=>{const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer,bubbles:!0});BrowserDetector.isFirefox()||BrowserDetector.isThunderbird()?t.wrappedJSObject.clipboardData.setData("text/plain",i):t.clipboardData.setData("text/plain",i),o.dispatchEvent(t)}))}}OverleafSourceEditor.EDITOR_SELECTOR="div#editor.ng-scope[ace-editor='editor'][track-changes='editor.trackChanges']",OverleafSourceEditor.HIGHLIGHTED_ERRORS_SELECTOR="div#editor div.spelling-highlight",OverleafSourceEditor.SELECTION_BLOCK_SELECTOR="div.ace_selection",OverleafSourceEditor.TEXT_LAYER_SELECTOR="div.ace_layer.ace_text-layer",OverleafSourceEditor.LINE_NUMBER_SELECTOR="div.ace_editor.ace-editor-body > div.ace_gutter > div.ace_gutter-layer > div.ace_gutter-cell",OverleafSourceEditor.TEXT_LINE_SELECTOR="div.ace_editor.ace-editor-body div.ace_content > div.ace_text-layer > div.ace_line_group",OverleafSourceEditor.TEXT_LINE_PART_SELECTOR="div.ace_editor.ace-editor-body div.ace_content > div.ace_text-layer > div.ace_line_group > div.ace_line",OverleafSourceEditor.INVALID_CHAR_SELECTOR="div.ace_editor.ace-editor-body div.ace_content > div.ace_text-layer > div.ace_line_group > div.ace_line > .ace_invisible.ace_invisible_space.ace_invalid",OverleafSourceEditor.VERTICAL_SCROLL_SELECTOR="div.ace_scrollbar.ace_scrollbar-v",OverleafSourceEditor.EVENT_TARGET_SELECTOR="div.ace_content",OverleafSourceEditor.PASTE_TEXTAREA_SELECTOR="textarea.ace_text-input",OverleafSourceEditor.THROTTLED_MUTATION_OBSERVER_DELAY=100,OverleafSourceEditor.ONLY_NBSP_REGEXP=/^\u00A0+$/,OverleafSourceEditor.ONLY_POINTS_REGEXP=/^·+$/,OverleafSourceEditor._styleTag=null;class OverleafRichEditor{static _isMouseOnError(t){return Array.from(document.querySelectorAll(this.HIGHLIGHTED_ERRORS_SELECTOR)).some((e=>isPointInsideRect(e.getBoundingClientRect(),t.pageX,t.pageY)))}static _onEditorMouseDown(t){2===t.button&&this._isMouseOnError(t)&&t.stopPropagation()}static _onEditorContextMenu(t){this._isMouseOnError(t)&&t.stopPropagation()}static _isTextLayer(t){return contains(t,this.TEXT_LAYER_SELECTOR)||!!closestElement(t,this.TEXT_LAYER_SELECTOR)}static _isLineNumber(t){return t.matches(this.LINE_NUMBER_SELECTOR)}static _isWidget(t){return t.matches(this.WIDGET_SELECTOR)||!!closestElement(t,this.WIDGET_SELECTOR)}static _isLabelWidget(t){if(t.matches(this.LABEL_WIDGET_OPEN_BRACKET_SELECTOR)&&"{"===t.textContent)return!0;const e=t.querySelector(this.LABEL_WIDGET_OPEN_BRACKET_SELECTOR);if(e&&"{"===e.textContent)return!0;if(t.matches(this.LABEL_WIDGET_CLOSE_BRACKET_SELECTOR)&&"}"===t.textContent)return!0;const r=t.querySelector(this.LABEL_WIDGET_CLOSE_BRACKET_SELECTOR);return!(!r||"{"!==r.textContent)}static _isReferenceWidget(t){if(t.matches(this.REFERENCE_WIDGET_OPEN_BRACKET_SELECTOR)&&"{"===t.textContent)return!0;const e=t.querySelector(this.REFERENCE_WIDGET_OPEN_BRACKET_SELECTOR);if(e&&"{"===e.textContent)return!0;if(t.matches(this.REFERENCE_WIDGET_CLOSE_BRACKET_SELECTOR)&&"}"===t.textContent)return!0;const r=t.querySelector(this.REFERENCE_WIDGET_CLOSE_BRACKET_SELECTOR);return!(!r||"}"!==r.textContent)}static _isListItemWidget(t){if(t.matches(this.UNORDERED_LIST_ITEM_MARK_SELECTOR)&&"●"===t.textContent)return!0;const e=t.querySelector(this.UNORDERED_LIST_ITEM_MARK_SELECTOR);if(e&&"●"===e.textContent)return!0;if(t.matches(this.ORDERED_LIST_ITEM_MARK_SELECTOR)&&this.ORDERED_LIST_ITEM_MARK_TEXT_REGEXP.test(t.textContent||""))return!0;return!(!t.querySelector(this.ORDERED_LIST_ITEM_MARK_SELECTOR)||!this.ORDERED_LIST_ITEM_MARK_TEXT_REGEXP.test(t.textContent||""))}static _isMathWidget(t){return contains(t,this.MATH_WIDGET_SELECTOR)||t.matches(this.MATH_WIDGET_SELECTOR)||!!closestElement(t,this.MATH_WIDGET_SELECTOR)}static _isFigureWrapper(t){return t.matches(this.FIGURE_WIDGET_SELECTOR)}static _isFigureWidgetContainer(t){return contains(t,this.FIGURE_WIDGET_SELECTOR)||this._isFigureWrapper(t)}static _isUsefulWidget(t){return this._isLabelWidget(t)||this._isReferenceWidget(t)||this._isListItemWidget(t)||this._isMathWidget(t)||this._isFigureWidgetContainer(t)}static _isWidgetOpenBracket(t){if("{"!==t.textContent)return!1;const e=t.parentElement;return!!e&&(e.matches(this.LABEL_WIDGET_OPEN_BRACKET_SELECTOR)||e.matches(this.REFERENCE_WIDGET_OPEN_BRACKET_SELECTOR))}static _isListItemMark(t){const e=t.parentElement;return!!e&&(e.matches(this.UNORDERED_LIST_ITEM_MARK_SELECTOR)&&"●"===t.textContent||e.matches(this.ORDERED_LIST_ITEM_MARK_SELECTOR)&&this.ORDERED_LIST_ITEM_MARK_TEXT_REGEXP.test(t.textContent||""))}static _isMathFormula(t){const e=t.parentElement;return!!e&&(1===e.childNodes.length&&e.matches(this.MATH_FORMULA_SELECTOR))}static _isMathEquation(t){const e=t.parentElement;return!!e&&(1===e.childNodes.length&&e.matches(this.MATH_EQUATION_SELECTOR))}static _isSpecifiedCommand(t,e,r,i){return Array.isArray(i)||(i=[i]),e.commandName===r&&1===e.arguments.length&&i.includes(t.substring(e.arguments[0].start,e.arguments[0].end))}static _getMathFormulaEndIndex(t,e,r){for(;"\n"===t[e];)e++;if("$"===t[e]){const r=/[^\\](\\\\)*\$/g;r.lastIndex=e+1;const i=r.exec(t);return i?i.index+i[0].length:-1}if("\\("===t.substr(e,2)){const r=/[^\\](\\\\)*\\\)/g;r.lastIndex=e+1;const i=r.exec(t);return i?i.index+i[0].length:-1}if(r.some((r=>r.start===e&&this._isSpecifiedCommand(t,r,"\\begin","math"))))for(const i of r)if(!(i.start<=e)){if(this._isSpecifiedCommand(t,i,"\\end","math"))return i.end;if(this._isSpecifiedCommand(t,i,"\\begin","math"))break}return-1}static _getMathEquationEndIndex(t,e,r){for(;"\n"===t[e];)e++;if("$$"===t.substr(e,2)){const r=/[^\\](\\\\)*\$\$/g;r.lastIndex=e+1;const i=r.exec(t);return i?i.index+i[0].length:-1}if("\\["===t.substr(e,2)){const r=/[^\\](\\\\)*\\\]/g;r.lastIndex=e+1;const i=r.exec(t);return i?i.index+i[0].length:-1}const i=r.find((r=>r.start===e&&this._isSpecifiedCommand(t,r,"\\begin",this.EQUATION_COMMAND_ARGUMENT_VALUES)));if(i){const n=t.substring(i.arguments[0].start,i.arguments[0].end);for(const i of r)if(!(i.start<=e)){if(this._isSpecifiedCommand(t,i,"\\end",n))return i.end;if(this._isSpecifiedCommand(t,i,"\\begin",this.EQUATION_COMMAND_ARGUMENT_VALUES))break;if(this._isSpecifiedCommand(t,i,"\\end",this.EQUATION_COMMAND_ARGUMENT_VALUES))break}}return-1}static _getEndFigureCommand(t,e,r){if(t.some((t=>t.start===e&&this._isSpecifiedCommand(r,t,"\\begin","figure"))))for(const i of t)if(!(i.start<=e)){if(this._isSpecifiedCommand(r,i,"\\end","figure"))return i;if(this._isSpecifiedCommand(r,i,"\\begin","figure"))break}return null}static _isMutationIgnored(t){const e=t.target;return!!isElementNode(e)&&(!(this._isTextLayer(e)&&!this._isLineNumber(e))||(!(!e.matches(this.EDITOR_WRAPPER_SELECTOR)||"attributes"!==t.type||"class"!==t.attributeName)||!(!e.matches(this.EDITOR_WRAPPER_SELECTOR)||"attributes"!==t.type||"draggable"!==t.attributeName)))}static init(){this._onEditorMouseDown=this._onEditorMouseDown.bind(this),this._onEditorContextMenu=this._onEditorContextMenu.bind(this),this._isMutationIgnored=this._isMutationIgnored.bind(this),this._domMeasurement=new DomMeasurement}static getInputAreas(){return Array.from(document.querySelectorAll(this.EDITOR_SELECTOR))}static disableBuiltInValidator(){if(null===this._styleTag){this._styleTag=createStylesheet(`${this.HIGHLIGHTED_ERRORS_SELECTOR} {\n\t\t\t\t\tbackground-image: none !important;\n\t\t\t\t}`);const t=document.querySelector(this.EDITOR_SELECTOR);t&&(t.addEventListener("mousedown",this._onEditorMouseDown,!0),t.addEventListener("contextmenu",this._onEditorContextMenu,!0))}}static enableBuiltInValidator(){null!==this._styleTag&&(this._styleTag.remove(),this._styleTag=null);const t=document.querySelector(this.EDITOR_SELECTOR);t&&(t.addEventListener("mousedown",this._onEditorMouseDown,!0),t.addEventListener("contextmenu",this._onEditorContextMenu,!0))}static createMutationObserver(t){return new FilteringMutationObserver(t,this._isMutationIgnored)}static isEditor(t){return t.matches(this.EDITOR_SELECTOR)}static isElementIgnored(t){return this._isLineNumber(t)||this._isWidget(t)&&!this._isUsefulWidget(t)}static isBlock(t,e){return CEElementInspector.DISPLAY_BLOCK_VALUES.includes(e.display||"")}static isBlockElementRelevant(t){if(!t.classList.contains("CodeMirror-line"))return!1;if(1===t.children.length&&1===t.firstElementChild.children.length&&"​"===t.firstElementChild.firstElementChild.textContent)return!0;return!!contains(t,this.FIGURE_WIDGET_SELECTOR)}static replaceText(t,e){t=removeZWC(t),t=normalizeWhiteSpaces(t);const r=e.parentElement;return r?("•"===t&&1===r.childNodes.length&&r.firstChild===e&&r.matches(this.INVALID_CHAR_SELECTOR)?t=" ":r.matches(this.SECTION_TITLE_SELECTOR)&&(t+="\n\n\n\n"),t):t}static getEditorText(t,e){let r=e.map((t=>t.parsedText)).join("");if(!r)return{textChunks:e,fullText:r,offset:0};if(!t.ownerDocument||!t.ownerDocument.head)return{textChunks:e,fullText:r,offset:0};const i=Array.from(document.querySelectorAll(this.LINE_NUMBER_SELECTOR));if(0===i.length||!i[0].textContent)return{textChunks:e,fullText:r,offset:0};const n=parseInt(i[0].textContent.trim()),s=i[i.length-1].textContent;if(!s)return{textChunks:e,fullText:r,offset:0};const o=parseInt(s.trim()),a=t.ownerDocument,l=a.createElement("script"),c="LanguageTool_SourceEditorContent";l.innerText=`\n\t\t\t\ttry {\n\t\t\t\t\tdocument.body.dataset.${c} = _ide.editorManager.getCurrentDocValue() || "";\n\t\t\t\t} catch(e) { }\n\t\t\t`,a.head.appendChild(l),l.remove();let d=a.body.dataset[c]||"";if(a.body.dataset[c]="",!d)return{textChunks:e,fullText:r,offset:0};const u=LatexParser.getCommentTokens(d),E=LatexParser.getCommandTokens(d).reverse(),h=[];for(const t of E){binarySearch(u,(e=>compareSegments(t,e)))||this.FORMATTING_COMMANDS.has(t.commandName)&&0!==t.arguments.length&&(h.push({offset:t.start,length:t.arguments[0].start-t.start}),h.push({offset:t.arguments[0].end,length:1}))}d=getValuableText(d,h).text;const g=d.split("\n");for(const t of this.LIST_WRAPPERS){let e=0;for(;e<g.length;){if(t.openCommand.test(g[e])){let r=e+1,i=!1,n=0;for(;r<g.length;){if(t.openCommand.test(g[r]))n++;else if(t.closeCommand.test(g[r])){if(!(n>0)){i=!0;break}n--}r++}i&&([g[e],g[r]]=t.replaceWith(g[e],g[r]))}e++}}let f=g.slice(0,n-1).join("\n\n");f&&(f+="\n\n");let m=g.slice(o).join("\n\n");m&&(m="\n\n"+m);const p=g.slice(n-1,o).join("\n\n"),_=e.map((t=>Object.assign({},t)));let T=0,S=0,R=null;t:for(const t of _){if(t.isTextNode){let e=-1;if(this._isWidgetOpenBracket(t.node)?(e=p.indexOf("{",T),-1!==e&&(e+=1)):this._isListItemMark(t.node)?(e=p.indexOf(" ",T),-1!==e&&(e+=1)):this._isMathFormula(t.node)?(null===R&&(R=LatexParser.getCommandTokens(p)),e=this._getMathFormulaEndIndex(p,T,R)):this._isMathEquation(t.node)&&(null===R&&(R=LatexParser.getCommandTokens(p)),e=this._getMathEquationEndIndex(p,T,R)),-1!==e){t.parsedText=p.substring(T,e),t.parsedTextOffset=S,T=e,S+=t.parsedText.length;continue}}else if(this._isFigureWrapper(t.node)){null===R&&(R=LatexParser.getCommandTokens(p));const e=this._getEndFigureCommand(R,T,p);if(e){let r=e.end;for(;"\n"===p[r];)r++;t.parsedText=p.substring(T,r),t.parsedTextOffset=S,T=r,S+=t.parsedText.length;continue}}let e=0,r=0;for(;r<t.parsedText.length;){const i=t.parsedText[r],n=p[T+e];if(i===n)e++,r++;else if("\n"===n)e++;else if(" "===i){if("\t"===n){for(let e=0;e<3&&" "===t.parsedText[r+1];e++)r++;e++}r++}else if(" "===i)e++,r++;else if("\n"===i)r++;else{if(" "!==n)break t;e++}}t.parsedText=p.substr(T,e),t.parsedTextOffset=S,T+=e,S+=t.parsedText.length}return r=_.map((t=>t.parsedText)).join(""),{textChunks:_,fullText:f+r+m,offset:f.length}}static getSelectedText(){if(!document.activeElement||"TEXTAREA"!==document.activeElement.tagName.toUpperCase())return"";const t=this.getSelection();if(!t)return"";const e=new Range;return e.setStart(t.startNode,t.startOffset),e.setEnd(t.endNode,t.endOffset),e.toString()}static getSelection(){const t=Array.from(document.body.querySelectorAll(this.SELECTION_BLOCK_SELECTOR));if(!t.length)return null;let e=t[0].getBoundingClientRect(),r=t[0].getBoundingClientRect();for(const i of t){const t=i.getBoundingClientRect();(t.top<e.top||t.top===e.top&&t.left<e.left)&&(e=t),(t.top>r.top||t.top===r.top&&t.left>r.left)&&(r=t)}const i=getRangeAtPoint({x:e.left+1,y:Math.round(e.bottom-.5*e.height)}),n=getRangeAtPoint({x:r.right-.5,y:Math.round(r.bottom-.5*r.height)});return i&&n?{startNode:i.startContainer,startOffset:i.startOffset,endNode:n.endContainer,endOffset:n.endOffset,isCollapsed:!1}:null}static addScrollEventListener(t,e){(t.querySelector(this.SCROLLABLE_ELEMENT_SELECTOR)||t).addEventListener("scroll",e)}static removeScrollEventListener(t,e){(t.querySelector(this.SCROLLABLE_ELEMENT_SELECTOR)||t).removeEventListener("scroll",e)}static getScrollableElementSize(t,e){const r=t.querySelector(this.SCROLLABLE_ELEMENT_SELECTOR)||t;return e.getScrollDimensions(r,!1)}static getScrollPosition(t,e,r,i){const n=t.querySelector(this.SCROLLABLE_ELEMENT_SELECTOR),s=t.querySelector(this.EDITOR_WRAPPER_SELECTOR);if(!n||!s)return e.getScrollPosition(t,r,i);let{top:o,left:a}=e.getScrollPosition(n,r,i);return o+=e.getScrollPosition(s,r,i).top,{top:o,left:a}}static getScrollingThrottleLimit(){}static getToolbarPosition(t,e,r){if(!r||void 0===r.left)return r;const i=t.querySelector(this.VERTICAL_SCROLLBAR_SELECTOR);if(!i)return r;if("none"!==this._domMeasurement.getStyle(i,"display")){const t=Number.parseInt(r.left),n=Number.parseInt(this._domMeasurement.getStyle(i,"width"));r.left=(e?t+n:t-n)+"px"}return r}static shouldUsePartialValidationCaching(t){return""!==t.validatedText.text}static getValidationOptions(t,e){return{throttlingLimit:config.VALIDATION_THROTTLING_LIMIT,useFullValidation:!1,textTooLongMessage:i18nManager.getMessage("paragraphTooLong")}}static applyFix(t){const{offset:e,length:r,replacementText:i,editor:n}=t,s=closestElement(n.inputArea,this.EDITOR_SELECTOR);if(!s)return Promise.resolve();const o=s.querySelector(this.PASTE_TEXTAREA_SELECTOR);if(!o)return Promise.resolve();const a=n.inputAreaWrapper.getTextRanges(e,r),l=a[0].textNode.parentElement.closest("pre.CodeMirror-line");return l?Promise.resolve().then((()=>{this._domMeasurement.clearCache();const t=this._domMeasurement.getTextBoundingBoxes(a,n.inputArea,!1)[0],e={clientX:Math.ceil(t.left),clientY:t.top+t.height/2,bubbles:!0,shiftKey:!1};return l.dispatchEvent(new MouseEvent("mousedown",e)),l.dispatchEvent(new MouseEvent("mouseup",e)),wait(10)})).then((()=>{this._domMeasurement.clearCache();const t=this._domMeasurement.getTextBoundingBoxes(a,n.inputArea,!1),e=t[0],r=t[t.length-1],i={clientX:Math.ceil(e.left),clientY:e.top+e.height/2,bubbles:!0,shiftKey:!1},s={clientX:Math.floor(r.right),clientY:r.top+r.height/2,bubbles:!0,shiftKey:!1};return l.dispatchEvent(new MouseEvent("mousedown",i)),l.dispatchEvent(new MouseEvent("mousemove",s)),l.dispatchEvent(new MouseEvent("mouseup",s)),wait(10)})).then((()=>{const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer,bubbles:!0});BrowserDetector.isFirefox()||BrowserDetector.isThunderbird()?t.wrappedJSObject.clipboardData.setData("text/plain",i):t.clipboardData.setData("text/plain",i),o.dispatchEvent(t)})):Promise.resolve()}}OverleafRichEditor.EDITOR_SELECTOR="div#editor-rich-text.ng-scope[cm-editor][track-changes='editor.trackChanges']",OverleafRichEditor.HIGHLIGHTED_ERRORS_SELECTOR="div#editor-rich-text span.spelling-error",OverleafRichEditor.EDITOR_WRAPPER_SELECTOR="div.CodeMirror.CodeMirror-wrap",OverleafRichEditor.SELECTION_BLOCK_SELECTOR="div.CodeMirror-selected",OverleafRichEditor.TEXT_LAYER_SELECTOR="div.CodeMirror-code",OverleafRichEditor.LINE_NUMBER_SELECTOR="div.CodeMirror-gutter-wrapper > div.CodeMirror-linenumber",OverleafRichEditor.WIDGET_SELECTOR="span.CodeMirror-widget",OverleafRichEditor.LABEL_WIDGET_OPEN_BRACKET_SELECTOR="span.CodeMirror-widget > span.wl-label-open > span.fa.fa-fw.fa-tag + span.wl-label-bracket",OverleafRichEditor.LABEL_WIDGET_CLOSE_BRACKET_SELECTOR="span.CodeMirror-widget > span.wl-label-bracket",OverleafRichEditor.REFERENCE_WIDGET_OPEN_BRACKET_SELECTOR="span.CodeMirror-widget > span.wl-label-open > span.fa.fa-fw.fa-book + span.wl-label-bracket",OverleafRichEditor.REFERENCE_WIDGET_CLOSE_BRACKET_SELECTOR="span.CodeMirror-widget > span.wl-label-bracket",OverleafRichEditor.UNORDERED_LIST_ITEM_MARK_SELECTOR="span.CodeMirror-widget > div.wl-item-open",OverleafRichEditor.ORDERED_LIST_ITEM_MARK_SELECTOR="span.CodeMirror-widget > div.wl-enumerate-item-open",OverleafRichEditor.MATH_FORMULA_SELECTOR="script[type='math/tex']",OverleafRichEditor.MATH_EQUATION_SELECTOR="script[type='math/tex; mode=display']",OverleafRichEditor.MATH_WIDGET_SELECTOR="script[type^='math/tex']",OverleafRichEditor.FIGURE_WIDGET_SELECTOR="span.CodeMirror-widget > div.wl-figure-wrap",OverleafRichEditor.INVALID_CHAR_SELECTOR=".CodeMirror-line span.cm-invalidchar",OverleafRichEditor.SECTION_TITLE_SELECTOR="span.wl-section, span.wl-subsection, span.wl-subsubsection",OverleafRichEditor.SCROLLABLE_ELEMENT_SELECTOR="div.CodeMirror-scroll",OverleafRichEditor.VERTICAL_SCROLLBAR_SELECTOR="div.CodeMirror-vscrollbar",OverleafRichEditor.PASTE_TEXTAREA_SELECTOR="div > textarea[tabindex='0']",OverleafRichEditor.ORDERED_LIST_ITEM_MARK_TEXT_REGEXP=/^\d+\.$/,OverleafRichEditor.EQUATION_COMMAND_ARGUMENT_VALUES=["displaymath","equation","eqnarray","multline","multline*","gather","gather*","align","align*","lyxcode","verbatim","lstlisting"],OverleafRichEditor.FORMATTING_COMMANDS=new Set(["\\textbf","\\textit","\\section","\\subsection","\\subsubsection"]),OverleafRichEditor.LIST_WRAPPERS=[{openCommand:/^[ \t]*\\begin\{itemize\}$/,closeCommand:/^[ \t]*\\end[ \t]*\{itemize\}$/,replaceWith:(t,e)=>{const r=/^[ \t]+/;if(r.test(t))return[t,e];const i=r.exec(e);return["",i?i[0]:""]}},{openCommand:/^[ \t]*\\begin\{enumerate\}$/,closeCommand:/^[ \t]*\\end[ \t]*\{enumerate\}$/,replaceWith:(t,e)=>{const r=/^[ \t]+/;if(r.test(t))return[t,e];const i=r.exec(e);return["",i?i[0]:""]}}],OverleafRichEditor._styleTag=null,"undefined"!=typeof module&&(module.exports.Overleaf=Overleaf);