/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
{let e,t,o,s;const n=document.getElementById("popup-container"),i=document.getElementById("lt-popup__package-badge-container"),a=document.getElementById("onboarding-button"),p=document.getElementById("popup-hint"),r=document.getElementById("popup-synonym-settings"),d=document.querySelector("#popup-option-capitalization"),c=document.querySelector("#popup-option-picky-mode"),l=document.querySelector("#popup-option-check"),u=document.querySelector("#popup-option-synonyms"),g=document.getElementById("popup-validator"),m=document.getElementById("popup-validator-button"),_=document.getElementById("popup-teaser"),b=document.getElementById("feedback-link"),h=document.getElementById("popup-more-options-link"),E=document.getElementById("lt-popup-logo");translateSection(document.body),translateElement("#popup-onboarding-text-1",{key:"popupOnboardingStep1",isHTML:!0}),translateElement("#popup-onboarding-text-2",{key:"popupOnboardingStep2",isHTML:!0,interpolations:['<span class="lt-popup__onboarding__icon1"></span>','<span class="lt-popup__onboarding__icon2"></span>']}),translateElement("#popup-onboarding-text-3",{key:"popupOnboardingStep3",isHTML:!0}),translateElement("#popup-onboarding-text-4",{key:"popupOnboardingStep4",isHTML:!0}),h.setAttribute("title",i18nManager.getMessage("popupSettingsHover")),h.addEventListener("click",(()=>{EnvironmentAdapter.openOptionsPage(void 0,"popup-icon"),window.close()})),E.addEventListener("click",(e=>{browser.runtime.sendMessage({command:"OPEN_URL",url:E.href}),e.preventDefault(),window.close()})),a.addEventListener("click",(()=>{n.classList.remove("lt-popup--show-onboarding"),n.classList.remove("lt-popup--disabled"),L.updateUIState({hasSeenOnboarding:!0}),Tracker.trackEvent("Action","popup:onboarding_banner:close")})),b.addEventListener("click",(()=>EnvironmentAdapter.openFeedbackForm(e)));let L=StorageController.create();L.onReady((()=>{browser.tabs.query({currentWindow:!0,active:!0}).then((a=>{if(!a||!a.length)return void window.close();o=a[0].id,e=a[0].url||"about:blank",t=getDomain(e),s=TweaksManager.getSiteTweaks(e);if(!L.getPrivacySettings().allowRemoteCheck&&!e.startsWith(config.INSTALL_URL)&&!BrowserDetector.isSafari()){const e={command:"OPEN_PRIVACY_CONFIRMATION"};return browser.runtime.sendMessage(e),void window.close()}reloadContentScriptsIfNecessary(o,t);const r=L.getValidationSettings(t,s.getEditorGroupId(e)),b={enabled:!r.isDomainDisabled&&!r.isEditorGroupDisabled,supported:!0,unsupportedMessage:"",capitalization:r.shouldCapitalizationBeChecked,pickyMode:!0};s.isSupported()?L.isDomainSupported(t)||(b.supported=!1,b.unsupportedMessage=browser.i18n.getMessage("siteCannotBeSupported")):(b.supported=!1,b.unsupportedMessage=s.unsupportedMessage());const h=L.getStatistics(),E=L.getSettings(),k=L.getUIState(),S=Date.now()-1e3*h.firstVisit;if(new PackageBadge(null,k.hasPaidSubscription?"premium":"basic","default",i).getElement().addEventListener("click",(()=>{EnvironmentAdapter.openOptionsPage(void 0,"popup-badge"),window.close()})),_.classList.add("lt-popup__teaser--hide"),h.appliedSuggestions<2&&!k.hasSeenOnboarding&&!BrowserDetector.isThunderbird())n.classList.add("lt-popup--show-onboarding"),n.classList.add("lt-popup--disabled"),Tracker.trackEvent("Action","popup:onboarding_banner",t);else if(b.supported&&!L.isUsedCustomServer())if(!k.hasPaidSubscription&&("like"===h.ratingValue||h.appliedSuggestions>7||S>432e5)){const e=getHistoricPremiumErrors(h);if(e.hiddenErrorsCount>5){const t="popup:historic_premium_teaser",o=browser.i18n.getMessage("historicPremiumErrorsHeadline"),s=browser.i18n.getMessage("historicPremiumErrorsText2",[e.hiddenErrorsCount,e.dayCount]),n=browser.i18n.getMessage("historicPremiumErrorsButton");_.classList.remove("lt-popup__teaser--hide"),new PremiumTeaser(_,t,o,s,n,{campaign:"addon2-popup-historic-premium-errors",historicMatches:e.hiddenErrorsCountStr})}else{const e="popup:premium_teaser",t=browser.i18n.getMessage("popupPremiumHeadline"),o=browser.i18n.getMessage("popupPremiumText"),s=browser.i18n.getMessage("popupPremiumLink");_.classList.remove("lt-popup__teaser--hide"),new PremiumTeaser(_,e,t,o,s,{campaign:"addon2-popup"})}Tracker.trackEvent("Action","popup:upgrade_teaser")}else k.hasRated||(_.classList.remove("lt-popup__teaser--hide"),new RatingTeaser(_,"popup",e));k.hasPaidSubscription&&n.classList.add("lt-popup--plus"),L.hasLanguageToolAccount()&&(m.textContent=i18nManager.getMessage("popupOpenEditorButton"),m.classList.add("lt-popup__button--edit"),g.classList.remove("lt-popup__validator--hide"),m.onclick=()=>{browser.runtime.sendMessage({command:"LAUNCH_EDITOR"}),Tracker.trackEvent("Action","popup:open_editor"),window.close()});browser.tabs.sendMessage(o,{command:"GET_SELECTED_TEXT"}).then((t=>{!t||t.selectedText.trim().length<config.MIN_TEXT_LENGTH||e.includes("//"+browser.runtime.id)||(g.classList.remove("lt-popup__validator--hide"),m.textContent=i18nManager.getMessage(L.hasLanguageToolAccount()?"popupOptionValidateInEditor":"popupOptionValidate"),m.onclick=()=>{const e={command:"LAUNCH_EDITOR",text:t.selectedText,html:t.selectedHTML};browser.runtime.sendMessage(e),Tracker.trackEvent("Action","popup:check_selected_text"),window.close()})})).catch((e=>console.log("Failed getting selected text",e))),b.supported||(p.classList.add("lt-popup__hint-visible"),p.innerHTML=b.unsupportedMessage,n.classList.add("lt-popup--disabled"),Tracker.trackEvent("Action","popup:disabled",getDomain(e))),b.enabled||(l.classList.add("lt-popup__option--switch-off"),A(),x()),L.isUsedCustomServer()&&x(),b.capitalization||d.classList.add("lt-popup__option--switch-off"),b.pickyMode||c.classList.add("lt-popup__option--switch-off"),E.hasSynonymsEnabled?u.classList.remove("lt-popup__option--switch-off"):u.classList.add("lt-popup__option--switch-off"),E.hasPickyModeEnabledGlobally?c.classList.remove("lt-popup__option--switch-off"):c.classList.add("lt-popup__option--switch-off"),d.addEventListener("click",(()=>f())),l.addEventListener("click",(()=>w())),u.addEventListener("click",(()=>v())),c.addEventListener("click",(()=>y())),setTimeout((()=>{n.classList.add("lt-popup--animations-enabled")}),500),Tracker.trackPageView()}))}));const k=t=>"extensions"===t?e:t,w=()=>{l.classList.contains("lt-popup__option--switch-off")?S():T()},f=()=>{d.classList.contains("lt-popup__option--switch-off")?P():B()},v=()=>{u.classList.contains("lt-popup__option--switch-off")?D():O()},y=()=>{c.classList.contains("lt-popup__option--switch-off")?C():I()},S=()=>{if(!L)return;l.classList.remove("lt-popup__option--switch-off");const n=s.getEditorGroupId(e);L.enableDomainAndEditorGroup(t,n),EnvironmentAdapter.ltAssistantStatusChanged(o,{enabled:!0}),M(),H(),Tracker.trackEvent("Action","enable_domain",k(t))},T=()=>{L&&(l.classList.add("lt-popup__option--switch-off"),L.disableDomain(t),EnvironmentAdapter.ltAssistantStatusChanged(o,{enabled:!1}),x(),A(),Tracker.trackEvent("Action","disable_domain",k(t)))},M=()=>{d.classList.remove("lt-popup__option--hide")},A=()=>{d.classList.add("lt-popup__option--hide")},C=()=>{L&&(c.classList.remove("lt-popup__option--switch-off"),L.updateSettings({hasPickyModeEnabledGlobally:!0}),Tracker.trackEvent("Action","enable_picky_mode",LanguageManager.getUserLanguageCodes()[0]))},I=()=>{L&&(c.classList.add("lt-popup__option--switch-off"),L.updateSettings({hasPickyModeEnabledGlobally:!1}),Tracker.trackEvent("Action","disable_picky_mode",LanguageManager.getUserLanguageCodes()[0]))},P=()=>{L&&(d.classList.remove("lt-popup__option--switch-off"),L.enableCapitalization(t),EnvironmentAdapter.ltAssistantStatusChanged(o,{capitalization:!0}),Tracker.trackEvent("Action","enable_capitalization",k(t)))},B=()=>{L&&(d.classList.add("lt-popup__option--switch-off"),L.disableCapitalization(t),EnvironmentAdapter.ltAssistantStatusChanged(o,{capitalization:!1}),Tracker.trackEvent("Action","disable_capitalization",k(t)))},D=()=>{L&&(u.classList.remove("lt-popup__option--switch-off"),L.updateSettings({hasSynonymsEnabled:!0}),Tracker.trackEvent("Action","enable_synonyms",LanguageManager.getUserLanguageCodes()[0]))},O=()=>{L&&(u.classList.add("lt-popup__option--switch-off"),L.updateSettings({hasSynonymsEnabled:!1}),Tracker.trackEvent("Action","disable_synonyms",LanguageManager.getUserLanguageCodes()[0]))},x=()=>{r.classList.add("lt-popup__settings--hide")},H=()=>{r.classList.remove("lt-popup__settings--hide")};BrowserDetector.isSafari()&&(n.classList.add("lt-popup--safari"),E.href=E.href+(E.href.includes("?")?"&":"?")+"hidePremium=true"),BrowserDetector.isFirefox()&&n.classList.add("lt-popup--firefox"),BrowserDetector.isThunderbird()&&n.classList.add("lt-popup--thunderbird")}