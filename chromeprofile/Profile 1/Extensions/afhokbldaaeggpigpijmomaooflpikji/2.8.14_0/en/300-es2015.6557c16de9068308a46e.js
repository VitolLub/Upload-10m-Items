(self.webpackChunkangular_newtab=self.webpackChunkangular_newtab||[]).push([[300],{28300:function(e,t,n){"use strict";n.r(t),n.d(t,{SettingsModule:function(){return B}});var o=n(55109),a=n(36278),i=n(67563),s=n(4391),c=n(40485),r=n(42304),g=n(33960),l=n(94253),h=n(88269),m=n(8723),d=n(54342),u=n(82758),f=n(19014),_=n(90095),b=n(53909),p=n(63566),k=n(48318),C=n(65901),v=n(28383);function x(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",26),r._UZ(1,"i",27),r.TgZ(2,"span"),r.SDv(3,28),r.qZA(),r.TgZ(4,"button",29),r.NdJ("click",function(){return r.CHM(e),r.oxw(2).messagingService.requestPerm()}),r.SDv(5,30),r.qZA(),r.qZA()}}function Z(e,t){1&e&&(r.TgZ(0,"mat-error"),r.SDv(1,31),r.qZA())}function w(e,t){1&e&&(r.TgZ(0,"span"),r.SDv(1,39),r.qZA())}function q(e,t){1&e&&(r.TgZ(0,"span"),r._uU(1,"Google"),r.qZA())}function S(e,t){1&e&&r._UZ(0,"i",40)}function P(e,t){1&e&&(r.TgZ(0,"span"),r.SDv(1,41),r.qZA())}function M(e,t){1&e&&(r.TgZ(0,"span"),r._uU(1,"Facebook"),r.qZA())}function y(e,t){1&e&&r._UZ(0,"i",40)}const O=function(e){return{google_synced:e}},T=function(e){return{fb_synced:e}};function A(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",32),r.TgZ(1,"h3"),r.SDv(2,33),r.qZA(),r.TgZ(3,"div",34),r.TgZ(4,"button",35),r.NdJ("click",function(){return r.CHM(e),r.oxw(2).oauthAction(1)}),r._UZ(5,"i",36),r.YNc(6,w,2,0,"span",0),r.YNc(7,q,2,0,"span",0),r.YNc(8,S,1,0,"i",37),r.qZA(),r.TgZ(9,"button",35),r.NdJ("click",function(){return r.CHM(e),r.oxw(2).oauthAction(2)}),r._UZ(10,"i",38),r.YNc(11,P,2,0,"span",0),r.YNc(12,M,2,0,"span",0),r.YNc(13,y,1,0,"i",37),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=r.oxw(2);r.xp6(4),r.Q6J("ngClass",r.VKq(8,O,e.settings.is_google_oauth)),r.xp6(2),r.Q6J("ngIf",!e.settings.is_google_oauth),r.xp6(1),r.Q6J("ngIf",e.settings.is_google_oauth),r.xp6(1),r.Q6J("ngIf",e.settings.is_google_oauth),r.xp6(1),r.Q6J("ngClass",r.VKq(10,T,e.settings.is_fb_oauth)),r.xp6(2),r.Q6J("ngIf",!e.settings.is_fb_oauth),r.xp6(1),r.Q6J("ngIf",e.settings.is_fb_oauth),r.xp6(1),r.Q6J("ngIf",e.settings.is_fb_oauth)}}function F(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"mat-checkbox",15),r.NdJ("click",function(t){return r.CHM(e),r.oxw(2).changeShowBookmarks(t)}),r.SDv(1,42),r.qZA()}if(2&e){const e=r.oxw(2);r.Q6J("checked",e.is_bookmarks_enabled)}}function J(e,t){if(1&e){const e=r.EpF();r.ynx(0),r.TgZ(1,"div",1),r.TgZ(2,"h2"),r.SDv(3,2),r.qZA(),r.qZA(),r.YNc(4,x,6,0,"div",3),r.TgZ(5,"div",4),r.TgZ(6,"h3"),r.SDv(7,5),r.qZA(),r.TgZ(8,"form",6),r.NdJ("submit",function(){return r.CHM(e),r.oxw().authChangeFormSubmit()}),r.TgZ(9,"mat-form-field",7),r.TgZ(10,"mat-label"),r._uU(11,"Email"),r.qZA(),r._UZ(12,"input",8),r.YNc(13,Z,2,0,"mat-error",0),r.qZA(),r.TgZ(14,"mat-form-field",7),r.TgZ(15,"mat-label"),r.SDv(16,9),r.qZA(),r._UZ(17,"input",10),r.qZA(),r.TgZ(18,"div"),r.TgZ(19,"button",11),r.SDv(20,12),r.qZA(),r.qZA(),r.qZA(),r.YNc(21,A,14,12,"div",13),r.TgZ(22,"div"),r.TgZ(23,"h3"),r.SDv(24,14),r.qZA(),r.TgZ(25,"div"),r.TgZ(26,"mat-checkbox",15),r.NdJ("click",function(){return r.CHM(e),r.oxw().changeEnableSound()}),r.SDv(27,16),r.qZA(),r.qZA(),r.TgZ(28,"div"),r.TgZ(29,"mat-checkbox",15),r.NdJ("click",function(){return r.CHM(e),r.oxw().changeHideFarm()}),r.SDv(30,17),r.qZA(),r.qZA(),r.TgZ(31,"div"),r.YNc(32,F,2,1,"mat-checkbox",18),r.qZA(),r.TgZ(33,"div",19),r.TgZ(34,"mat-form-field"),r.TgZ(35,"mat-label"),r.SDv(36,20),r.qZA(),r.TgZ(37,"mat-select",21),r.NdJ("selectionChange",function(t){return r.CHM(e),r.oxw().changeLanguage(t)})("ngModelChange",function(t){return r.CHM(e),r.oxw().selectedLanguage=t}),r.TgZ(38,"mat-option",22),r.SDv(39,23),r.qZA(),r.TgZ(40,"mat-option",24),r.SDv(41,25),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.BQk()}if(2&e){const e=r.oxw();r.xp6(4),r.Q6J("ngIf",!e.commonService.fcm_enable&&!e.commonService.is_mobile),r.xp6(4),r.Q6J("formGroup",e.authChangeForm),r.xp6(5),r.Q6J("ngIf",e.error_email_exist),r.xp6(6),r.Q6J("disabled",!e.authChangeForm.get("email").value||e.authChangeForm.get("email").invalid),r.xp6(2),r.Q6J("ngIf",!e.commonService.is_mobile),r.xp6(5),r.Q6J("checked",e.commonService.timer_status.enable_sound),r.xp6(3),r.Q6J("checked",1==e.settings.hide_farm),r.xp6(3),r.Q6J("ngIf",e.commonService.isChromeExtension()),r.xp6(5),r.Q6J("ngModel",e.selectedLanguage)}}function I(e,t){1&e&&(r.ynx(0),r.TgZ(1,"div",43),r._UZ(2,"mat-progress-spinner",44),r.qZA(),r.BQk())}const z=[{path:"",component:(()=>{class e{constructor(e,t,n,o,i,s,r,g,l){this.commonService=e,this.dialog=t,this.cdr=n,this._formBuilder=o,this.route=i,this.location=s,this._snackBar=r,this.messagingService=g,this.authService=l,this.is_loading=!0,this.rubErrors={invalid:{card:!1,yandex:!1,qiwi:!1}},this.uahErrors={invalid:{card:!1}},this.authChangeForm=this._formBuilder.group({email:["",[a.kI.email,a.kI.required]],password:["",[a.kI.minLength(4),a.kI.maxLength(12)]]}),this.rubChangeForm=this._formBuilder.group({card:[""],yandex:[""],qiwi:[""]}),this.uahChangeForm=this._formBuilder.group({card:[""]}),this.getSettings(),this.route.queryParams.subscribe(e=>{e.confirm_token&&this.commonService.createRequest("post","settings/confirm-settings",{confirm_token:e.confirm_token}).toPromise().then(e=>{e&&(e.token_not_found&&this._snackBar.open(c.error_confirm_not_found,null,{verticalPosition:"top",duration:5e3}),"success"==e.status&&(this._snackBar.open(c.email_changed,null,{verticalPosition:"top",duration:5e3}),this.authChangeForm.get("email").setValue(e.email),this.cdr.detectChanges())),this.location.replaceState("/settings")})});const h=window.location.href;this.selectedLanguage=h.match("/ru/index.html")?"ru":"en",this.is_bookmarks_enabled="1"==localStorage.getItem("is_bookmarks_enabled")}oauthAction(e){let t=1==e?this.settings.is_google_oauth:this.settings.is_fb_oauth;t?this.openDialog("unset_account",{soc_type:e}):this.commonService.createRequest("get","oauth-action/"+t.toString()+"/set",{}).toPromise().then(t=>{if(t.temp_token){let n=window.open("https://maketime.online/web/oauth_go?type="+e.toString()+"&temp_token="+t.temp_token,"_blank","width=640, height=480"),o=this,a=setInterval(function(){n.closed&&(clearInterval(a),o.getSettings())},500)}else this.getSettings()})}getSettings(){this.commonService.createRequest("get","settings",{}).toPromise().then(e=>{e&&(this.settings=e,this.authChangeForm.get("email").setValue(this.settings.email),this.rubChangeForm.get("card").setValue(this.settings.rub.card),this.rubChangeForm.get("yandex").setValue(this.settings.rub.yandex),this.rubChangeForm.get("qiwi").setValue(this.settings.rub.qiwi),this.uahChangeForm.get("card").setValue(this.settings.uah.card),this.is_loading&&(this.is_loading=!1),e.change_token&&this.openDialog("change_account"),this.cdr.destroyed||this.cdr.detectChanges())})}openDialog(e,t=null){let n;switch(e){case"change_account":n=this.dialog.open(s.a,{data:{type:"change_account"}}),n.afterClosed().subscribe(e=>{let t="";e&&(t=e.action),this.commonService.createRequest("post","settings/change-token",{action:t}).toPromise().then(()=>{switch(t){case"stay":1==this.settings.change_token.social_type?this.settings.is_google_oauth=!0:this.settings.is_fb_oauth=!0,this.settings.change_token=null;break;case"go":this.authService.setToken(this.settings.change_token.token),location.reload()}this.cdr.detectChanges()})});break;case"unset_account":n=this.dialog.open(s.a,{data:{type:"unset_account"}}),n.afterClosed().subscribe(e=>{e&&this.commonService.createRequest("get","oauth-action/"+t.soc_type.toString()+"/unset",{}).toPromise().then(e=>{1==t.soc_type&&(this.settings.is_google_oauth=!1),2==t.soc_type&&(this.settings.is_fb_oauth=!1),this.cdr.detectChanges()})});break;case"enable_bookmarks":n=this.dialog.open(s.a,{data:{type:"enable_bookmarks"}}),n.afterClosed().subscribe(e=>{e?chrome.permissions.request({permissions:["bookmarks"]},e=>{e?(localStorage.setItem("is_bookmarks_enabled","1"),this.is_bookmarks_enabled=!0):this.is_bookmarks_enabled=!1,this.cdr.detectChanges()}):(this.is_bookmarks_enabled=!1,this.cdr.detectChanges())})}}changeEnableSound(){return this.checkFCMToken(!this.commonService.timer_status.enable_sound).then(e=>{let t=this.commonService.timer_status.enable_sound?"unset":"set";this.commonService.createRequest("post","settings/change-sound",{action:t}).toPromise().then(()=>{this.commonService.timer_status.enable_sound="unset"!=t,this.cdr.detectChanges()})})}checkFCMToken(e){return this.commonService.fcm_enable?Promise.resolve(!0):e?this.messagingService.checkPermission().then(e=>{if(e)return Promise.resolve(!0);let t;return t=this.dialog.open(s.a,{data:{type:"request_push"},autoFocus:!1}),t.afterClosed().subscribe(e=>e?this.messagingService.requestPerm():Promise.resolve(!1))}).catch(()=>Promise.resolve(!1)):Promise.resolve(!1)}changeHideFarm(){let e=this.settings.hide_farm?"unset":"set";this.commonService.createRequest("post","settings/change-hide-farm",{action:e}).toPromise().then(()=>{this.settings.hide_farm="unset"!=e,this.cdr.detectChanges()})}authChangeFormSubmit(){this.authChangeForm.valid&&(this.error_email_exist=!1,this.commonService.createRequest("post","settings/change-auth",{email:this.authChangeForm.get("email").value,password:this.authChangeForm.get("password").value}).toPromise().then(e=>{if(e&&"email_exist"==e.error&&(this.error_email_exist=!0,this.authChangeForm.controls.email.setErrors({incorrect:!0})),e&&("send_confirm"==e.change_email||"success"==e.change_password)){let t="";"success"==e.change_password&&(t=c.password_changed),"send_confirm"==e.change_email&&(t=c.sended_mail_for_confirm_email),t&&this._snackBar.open(t,null,{verticalPosition:"top",duration:5e3})}this.cdr.detectChanges()}))}rubChangeFormSubmit(){this.rubChangeForm.valid&&this.commonService.createRequest("post","settings/change-wallets",{action:"RUB",card:this.rubChangeForm.get("card").value,yandex:this.rubChangeForm.get("yandex").value,qiwi:this.rubChangeForm.get("qiwi").value}).toPromise().then(e=>{e.invalid&&(this.rubErrors.invalid=e.invalid,e.invalid.card&&this.rubChangeForm.controls.card.setErrors({incorrect:!0}),e.invalid.yandex&&this.rubChangeForm.controls.yandex.setErrors({incorrect:!0}),e.invalid.qiwi&&this.rubChangeForm.controls.qiwi.setErrors({incorrect:!0})),e.change_data&&this._snackBar.open(c.data_changed,null,{verticalPosition:"top",duration:5e3}),this.cdr.detectChanges()})}uahChangeFormSubmit(){this.uahChangeForm.valid&&this.commonService.createRequest("post","settings/change-wallets",{action:"UAH",card:this.uahChangeForm.get("card").value}).toPromise().then(e=>{e.invalid&&(this.uahErrors.invalid=e.invalid,e.invalid.card&&this.uahChangeForm.controls.card.setErrors({incorrect:!0})),e.change_data&&this._snackBar.open(c.data_changed,null,{verticalPosition:"top",duration:5e3}),this.cdr.detectChanges()})}changeLanguage(e){const t=e.value;if(-1!=["ru","en"].indexOf(t)){localStorage.setItem("selectedLanguage",t);let e=window.location.href.replace(/(?:ru|en)\/index/gi,t+"/index");window.location.href=e}}changeShowBookmarks(e){if(e.preventDefault(),this.is_bookmarks_enabled)return localStorage.setItem("is_bookmarks_enabled","0"),void(this.is_bookmarks_enabled=!1);chrome.permissions.contains({permissions:["bookmarks"]},e=>{if(!e)return this.openDialog("enable_bookmarks");localStorage.setItem("is_bookmarks_enabled","1"),this.is_bookmarks_enabled=!0,this.cdr.detectChanges()})}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(g.v),r.Y36(l.uw),r.Y36(r.sBO),r.Y36(a.qu),r.Y36(i.gz),r.Y36(o.Ye),r.Y36(h.ux),r.Y36(m.o),r.Y36(d.e))},e.\u0275cmp=r.Xpm({type:e,selectors:[["ng-component"]],decls:2,vars:2,consts:function(){let e,t,n,o,a,i,s,c,r,g,l,h,m,d,u,f,_,b;return e="Settings",t="Access",n="New password",o="Save",a="Other",i="Show push notification at the end of timer",s="Exclude farm users from rating",c="Language",r="English",g="Russian",l="Enable notifications",h="If you have previously denied access, you need to go to the browser settings and activate notifications manually",m="Activate",d="This email belongs to another user.",u="Linked accounts",f="Link Google",_="Link Facebook",b="Show bookmarks bar in new tab",[[4,"ngIf"],[1,"title",2,"text-align","left"],e,["class","warn-title",4,"ngIf"],[2,"text-align","left","margin","2rem 1rem"],t,[1,"example-form",2,"display","flex","flex-direction","column",3,"formGroup","submit"],[1,"example-full-width"],["matInput","","formControlName","email"],n,["matInput","","formControlName","password","type","password","maxlength","12","autocomplete","false"],["mat-raised-button","","type","submit",3,"disabled"],o,["class","block-sync",4,"ngIf"],a,[3,"checked","click"],i,s,[3,"checked","click",4,"ngIf"],[2,"margin-top","2rem"],c,[3,"ngModel","selectionChange","ngModelChange"],["value","en"],r,["value","ru"],g,[1,"warn-title"],[1,"fas","fa-exclamation-triangle"],l,["mat-raised-button","","color","primary","matTooltip",h,"matTooltipPosition","above","matTooltipShowDelay","1500",3,"click"],m,d,[1,"block-sync"],u,[1,"buttons"],["mat-raised-button","",3,"ngClass","click"],[1,"fab","fa-google"],["class","fas fa-check","style","position: absolute;\n                right: 15px;\n                top: 11px;\n                color: #00d400;",4,"ngIf"],[1,"fab","fa-facebook-square"],f,[1,"fas","fa-check",2,"position","absolute","right","15px","top","11px","color","#00d400"],_,b,[1,"page-loader"],["color","warn","mode","indeterminate"]]},template:function(e,t){1&e&&(r.YNc(0,J,42,9,"ng-container",0),r.YNc(1,I,3,0,"ng-container",0)),2&e&&(r.Q6J("ngIf",!t.is_loading),r.xp6(1),r.Q6J("ngIf",t.is_loading))},directives:[o.O5,a._Y,a.JL,a.sg,u.KE,u.hX,f.Nt,a.Fj,a.JJ,a.u,a.nD,_.lW,b.oG,p.gD,a.On,k.ey,C.gM,u.TO,o.mk,v.Ou],styles:["mat-form-field[_ngcontent-%COMP%]{width:300px}.block[_ngcontent-%COMP%]{display:block;max-width:500px;margin:0 auto;text-align:left}.block-sync[_ngcontent-%COMP%]{margin:4rem 0}.block-sync[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.1rem;text-align:left;width:100%;display:block;margin-bottom:10px}.block-sync[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:210px;text-align:left;margin:10px}.fa-facebook-square[_ngcontent-%COMP%], .fa-google[_ngcontent-%COMP%]{margin-right:10px}.fa-google[_ngcontent-%COMP%]{color:#4285f4}.fa-facebook-square[_ngcontent-%COMP%]{color:#4267b2}.sound-conf[_ngcontent-%COMP%]{margin-top:3rem;font-size:1rem}.feedback[_ngcontent-%COMP%]{margin-top:2rem}.feedback[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.feedback[_ngcontent-%COMP%]   .send[_ngcontent-%COMP%]{text-align:left}.fb_synced[_ngcontent-%COMP%]{color:#fff;background-color:#4267b2}.fb_synced[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff}.google_synced[_ngcontent-%COMP%]{color:#fff;background-color:#4285f4}.google_synced[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff}.telegram-block[_ngcontent-%COMP%]{margin-top:2rem;font-size:1rem}.telegram-block[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-left:10px;font-weight:700;white-space:nowrap}.telegram-block[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:25px;position:relative;top:6px;margin-right:2px}.version[_ngcontent-%COMP%]{font-size:12px;margin-top:2rem;text-align:center}  share-buttons .sb-group{justify-content:center}  share-buttons :not(share-button) div.sb-button{display:none}mat-checkbox[_ngcontent-%COMP%]     .mat-checkbox-layout{white-space:normal}.pro-status[_ngcontent-%COMP%]{text-align:left;margin:3rem 1rem;line-height:24px}.pro-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{font-weight:700}.pro-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:2rem;font-weight:700}.warn-title[_ngcontent-%COMP%]{text-align:left;font-size:18px;margin:2rem 0 0 1rem;color:#3f51b5}.warn-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:10px}.warn-title[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:2rem}"]}),e})()}];let D=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[i.Bz.forChild(z)],i.Bz]}),e})();var N=n(25699),Q=n(87221),Y=n(8091);let B=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[a.u5,a.UX,o.ez,D,_.ot,N.Nh,a.u5,f.c,Q.QW,v.Cq,b.p9,Y.m]]}),e})()}}]);